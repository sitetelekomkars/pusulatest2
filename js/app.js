(function(){const _0x4ea033='Y29uc3QgQkFLSU1fTU9EVSA9IGZhbHNlOwoKZnVuY3Rpb24gc2hvd0dsb2JhbEVycm9yKG1lc3NhZ2UpewogIC8vIEt1bGxhbsSxY8SxbGFyYSBrxLFybcSxesSxIGJhbnQgZ8O2c3Rlcm1lIChpc3RlazogZWtyYW4gdGVtaXoga2Fsc8SxbikKICAvLyBTYWRlY2Uga29uc29sYSB5YXogdmUgKGxvY2FkbWluL2FkbWluIGlzZSkga8O8w6fDvGsgYmlyIHRvYXN0IGfDtnN0ZXIuCiAgdHJ5eyBjb25zb2xlLndhcm4oIltQdXN1bGFdIiwgbWVzc2FnZSk7IH1jYXRjaChlKXt9CiAgdHJ5ewogICAgY29uc3Qgcm9sZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJzU3BvcnRSb2xlIil8fCIiOwogICAgaWYocm9sZT09PSJhZG1pbiIgfHwgcm9sZT09PSJsb2NhZG1pbiIpewogICAgICBTd2FsLmZpcmUoe3RvYXN0OnRydWUscG9zaXRpb246J2JvdHRvbS1lbmQnLGljb246J3dhcm5pbmcnLHRpdGxlOlN0cmluZyhtZXNzYWdlfHwnVXlhcsSxJyksc2hvd0NvbmZpcm1CdXR0b246ZmFsc2UsdGltZXI6MjUwMH0pOwogICAgfQogIH1jYXRjaChlKXt9Cn0KCi8vIEFwcHMgU2NyaXB0IFVSTCdzaQpsZXQgU0NSSVBUX1VSTCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJQVVNVTEFfU0NSSVBUX1VSTCIpIHx8ICJodHRwczovL3NjcmlwdC5nb29nbGUuY29tL21hY3Jvcy9zL0FLZnljYng5TFY1YkNuUlJ1NHNCeDl6Nm1acVVpRENxUkkzeUplaDR0ZDRiYTFuOFp4NGViU1JRMkZ2dHdTVkVnNHpzYlZlWi9leGVjIjsgLy8gQXBwcyBTY3JpcHQgV2ViIEFwcCBVUkwKCi8vIC0tLS0gQVBJIENBTEwgaGVscGVyIChNZW51L1lldGtpIHZzIGnDp2luIGdlcmVrbGkpIC0tLS0KYXN5bmMgZnVuY3Rpb24gYXBpQ2FsbChhY3Rpb24sIHBheWxvYWQgPSB7fSkgewogIGNvbnN0IHVzZXJuYW1lID0gKHR5cGVvZiBjdXJyZW50VXNlciAhPT0gInVuZGVmaW5lZCIgJiYgY3VycmVudFVzZXIpID8gY3VycmVudFVzZXIgOiAobG9jYWxTdG9yYWdlLmdldEl0ZW0oInNTcG9ydFVzZXIiKSB8fCAiIik7CiAgY29uc3QgdG9rZW4gPSAodHlwZW9mIGdldFRva2VuID09PSAiZnVuY3Rpb24iID8gZ2V0VG9rZW4oKSA6IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJzU3BvcnRUb2tlbiIpKSB8fCAiIjsKICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaChTQ1JJUFRfVVJMLCB7CiAgICBtZXRob2Q6ICJQT1NUIiwKICAgIGhlYWRlcnM6IHsgIkNvbnRlbnQtVHlwZSI6ICJ0ZXh0L3BsYWluO2NoYXJzZXQ9dXRmLTgiIH0sCiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGFjdGlvbiwgdXNlcm5hbWUsIHRva2VuLCAuLi5wYXlsb2FkIH0pCiAgfSk7CiAgY29uc3QganNvbiA9IGF3YWl0IHJlcy5qc29uKCk7CiAgaWYgKGpzb24ucmVzdWx0ICE9PSAic3VjY2VzcyIpIHRocm93IG5ldyBFcnJvcihqc29uLm1lc3NhZ2UgfHwganNvbi5lcnJvciB8fCAiQVBJIGVycm9yIik7CiAgcmV0dXJuIGpzb247Cn0KCi8vIFN3ZWV0QWxlcnQyIHlva3NhIG1pbmltYWwgeWVkZWsgKHNlc3NpeiBrxLFyxLFsbWEgb2xtYXPEsW4pCmlmICh0eXBlb2YgU3dhbCA9PT0gInVuZGVmaW5lZCIpIHsKICB3aW5kb3cuU3dhbCA9IHsgCiAgICBmaXJlOiAoYSxiLGMpPT57IHRyeXsgYWxlcnQoKGEmJmEudGl0bGUpfHxhfHxifHxjfHwiIik7IH1jYXRjaChlKXt9IH0sCiAgfTsKfQoKCgovLyBPeXVuIERlxJ9pxZ9rZW5sZXJpCmxldCBqb2tlcnMgPSB7IGNhbGw6IDEsIGhhbGY6IDEsIGRvdWJsZTogMSB9OwpsZXQgZG91YmxlQ2hhbmNlVXNlZCA9IGZhbHNlOwpsZXQgZmlyc3RBbnN3ZXJJbmRleCA9IC0xOwpjb25zdCBWQUxJRF9DQVRFR09SSUVTID0gWydUZWtuaWsnLCAnxLBrbmEnLCAnS2FtcGFueWEnLCAnQmlsZ2knXTsKY29uc3QgTU9OVEhfTkFNRVMgPSBbIk9jYWsiLCAixZ51YmF0IiwgIk1hcnQiLCAiTmlzYW4iLCAiTWF5xLFzIiwgIkhhemlyYW4iLCAiVGVtbXV6IiwgIkHEn3VzdG9zIiwgIkV5bMO8bCIsICJFa2ltIiwgIkthc8SxbSIsICJBcmFsxLFrIl07Ci8vIC0tLSBHTE9CQUwgREXEnsSwxZ5LRU5MRVIgLS0tCmxldCBkYXRhYmFzZSA9IFtdLCBjYXJkc0RhdGEgPSBbXSwgbmV3c0RhdGEgPSBbXSwgc3BvcnRzRGF0YSA9IFtdLCBzYWxlc1NjcmlwdHMgPSBbXSwgcXVpelF1ZXN0aW9ucyA9IFtdLCBxdWlja0RlY2lzaW9uUXVlc3Rpb25zID0gW107CgovLyBEYXRhIGxvYWQgYmFycmllciAocHJldmVudHMgVGVjaC9UZWxlc2FsZXMgZmlyc3QtcmVuZGVyIGZsaWNrZXIpCmxldCBfX2RhdGFMb2FkZWRSZXNvbHZlOwp3aW5kb3cuX19kYXRhTG9hZGVkUHJvbWlzZSA9IG5ldyBQcm9taXNlKHI9PnsgX19kYXRhTG9hZGVkUmVzb2x2ZSA9IHI7IH0pOwpsZXQgdGVjaFdpemFyZERhdGEgPSB7fTsgLy8gVGVrbmlrIFNpaGlyYmF6IFZlcmlzaQpsZXQgY3VycmVudFVzZXIgPSAiIjsKCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tIE1lbnUgUGVybWlzc2lvbnMgKExvY0FkbWluKSAtLS0tLS0tLS0tLS0tLS0tLS0tLQpsZXQgbWVudVBlcm1pc3Npb25zID0gbnVsbDsgLy8geyBrZXk6IHthbGxvd2VkR3JvdXBzOltdLCBhbGxvd2VkUm9sZXM6W119IH0KCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tIEhvbWVCbG9ja3MgKEFuYSBTYXlmYSBibG9rIGnDp2VyaWtsZXJpKSAtLS0tLS0tLS0tLS0tLS0tLS0tLQpsZXQgaG9tZUJsb2NrcyA9IHt9OyAvLyB7IHF1b3RlOnsuLi59LCAuLi4gfQoKZnVuY3Rpb24gbG9hZEhvbWVCbG9ja3MoKXsKICAvLyBoZXJrZXMgacOnaW4gb2t1bmFiaWxpciAoc2hlZXQndGVuKQogIHJldHVybiBhcGlDYWxsKCJnZXRIb21lQmxvY2tzIiwge30pLnRoZW4ocmVzPT57CiAgICBob21lQmxvY2tzID0gKHJlcyAmJiByZXMuYmxvY2tzKSA/IHJlcy5ibG9ja3MgOiB7fTsKICAgIC8vIGxvY2FsIGZhbGxiYWNrIGNhY2hlCiAgICB0cnl7IGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdob21lQmxvY2tzQ2FjaGUnLCBKU09OLnN0cmluZ2lmeShob21lQmxvY2tzfHx7fSkpOyB9Y2F0Y2goZSl7fQogICAgdHJ5eyByZW5kZXJIb21lUGFuZWxzKCk7IH1jYXRjaChlKXt9CiAgICByZXR1cm4gaG9tZUJsb2NrczsKICB9KS5jYXRjaChlPT57CiAgICAvLyBzZXNzaXogZmFsbGJhY2sKICAgIHRyeXsgaG9tZUJsb2NrcyA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2hvbWVCbG9ja3NDYWNoZScpfHwne30nKSB8fCB7fTsgfWNhdGNoKF8peyBob21lQmxvY2tzID0ge307IH0KICAgIHRyeXsgcmVuZGVySG9tZVBhbmVscygpOyB9Y2F0Y2goXyl7fQogICAgcmV0dXJuIGhvbWVCbG9ja3M7CiAgfSk7Cn0KCmZ1bmN0aW9uIG5vcm1hbGl6ZVJvbGUodil7CiAgcmV0dXJuIFN0cmluZyh2fHwnJykudHJpbSgpLnRvTG93ZXJDYXNlKCk7Cn0KZnVuY3Rpb24gbm9ybWFsaXplR3JvdXAodil7CiAgLy8gbm9ybWFsaXplIFR1cmtpc2ggY2hhcnMgJiBjYXNlIHNvIGNvbXBhcmlzb25zIHdvcmsKICBjb25zdCBzID0gU3RyaW5nKHZ8fCcnKS50cmltKCkudG9Mb3dlckNhc2UoKTsKICBjb25zdCB0ciA9IHMucmVwbGFjZUFsbCgnxZ8nLCdzJykucmVwbGFjZUFsbCgnxZ4nLCdzJykKICAgICAgICAgICAgICAucmVwbGFjZUFsbCgnxLEnLCdpJykucmVwbGFjZUFsbCgnxLAnLCdpJykKICAgICAgICAgICAgICAucmVwbGFjZUFsbCgnxJ8nLCdnJykucmVwbGFjZUFsbCgnxJ4nLCdnJykKICAgICAgICAgICAgICAucmVwbGFjZUFsbCgnw7wnLCd1JykucmVwbGFjZUFsbCgnw5wnLCd1JykKICAgICAgICAgICAgICAucmVwbGFjZUFsbCgnw7YnLCdvJykucmVwbGFjZUFsbCgnw5YnLCdvJykKICAgICAgICAgICAgICAucmVwbGFjZUFsbCgnw6cnLCdjJykucmVwbGFjZUFsbCgnw4cnLCdjJyk7CiAgLy8gbWFwIGNvbW1vbiB2YXJpYW50cyB0byBkaXNwbGF5IG5hbWVzIHVzZWQgaW4gcGVybWlzc2lvbnMgdGFibGUKICBpZih0ci5pbmNsdWRlcygndGVsZXNhdCcpKSByZXR1cm4gJ1RlbGVzYXTEscWfJzsKICBpZih0ci5pbmNsdWRlcygndGVrbmlrJykpIHJldHVybiAnVGVrbmlrJzsKICBpZih0ci5pbmNsdWRlcygnY2hhdCcpKSByZXR1cm4gJ0NoYXQnOwogIHJldHVybiBTdHJpbmcodnx8JycpLnRyaW0oKTsKfQoKZnVuY3Rpb24gbm9ybWFsaXplTGlzdCh2KXsKICBpZighdikgcmV0dXJuIFtdOwogIHJldHVybiBTdHJpbmcodikuc3BsaXQoJywnKS5tYXAocz0+cy50cmltKCkpLmZpbHRlcihCb29sZWFuKTsKfQpmdW5jdGlvbiBnZXRNeUdyb3VwKCl7IHJldHVybiBub3JtYWxpemVHcm91cChsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgic1Nwb3J0R3JvdXAiKXx8IiIpOyB9CmZ1bmN0aW9uIGdldE15Um9sZSgpeyByZXR1cm4gbm9ybWFsaXplUm9sZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgic1Nwb3J0Um9sZSIpfHwiIik7IH0KCmZ1bmN0aW9uIGlzQWxsb3dlZEJ5UGVybShwZXJtKXsKICBpZighcGVybSkgcmV0dXJuIHRydWU7CiAgaWYocGVybS5lbmFibGVkID09PSBmYWxzZSkgcmV0dXJuIGZhbHNlOwogIGNvbnN0IHJvbGU9Z2V0TXlSb2xlKCksIGdycD1nZXRNeUdyb3VwKCk7CiAgY29uc3Qgcm9sZXM9cGVybS5hbGxvd2VkUm9sZXN8fFtdOwogIGxldCBncm91cHM9cGVybS5hbGxvd2VkR3JvdXBzfHxbXTsKICAvLyAiQUxMIiB2YXJzYSBoZXJrZXNlIGHDp8SxayBrYWJ1bCBldAogIGlmKGdyb3Vwcy5pbmRleE9mKCJBTEwiKT4tMSkgZ3JvdXBzPVtdOwogIGlmKHJvbGVzLmxlbmd0aCAmJiByb2xlcy5pbmRleE9mKHJvbGUpPT09LTEpIHJldHVybiBmYWxzZTsKICBpZihncm91cHMubGVuZ3RoICYmIGdyb3Vwcy5pbmRleE9mKGdycCk9PT0tMSkgcmV0dXJuIGZhbHNlOwogIHJldHVybiB0cnVlOwp9CmZ1bmN0aW9uIGFwcGx5TWVudVBlcm1pc3Npb25zKCl7CiAgdHJ5ewogICAgY29uc3QgbmF2QnV0dG9ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLW1lbnUta2V5XScpOwogICAgbmF2QnV0dG9ucy5mb3JFYWNoKGJ0bj0+ewogICAgICBjb25zdCBrZXkgPSBidG4uZ2V0QXR0cmlidXRlKCdkYXRhLW1lbnUta2V5Jyk7CiAgICAgIGNvbnN0IHBlcm0gPSBtZW51UGVybWlzc2lvbnMgJiYgbWVudVBlcm1pc3Npb25zW2tleV07CiAgICAgIGJ0bi5zdHlsZS5kaXNwbGF5ID0gaXNBbGxvd2VkQnlQZXJtKHBlcm0pID8gJycgOiAnbm9uZSc7CiAgICB9KTsKICAgIC8vIEjEsXpsxLEga8Sxc2F5b2xsYXIgKGFuYSBzYXlmYSkKICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLXNob3J0Y3V0LWtleV0nKS5mb3JFYWNoKGVsPT57CiAgICAgIGNvbnN0IGtleT1lbC5nZXRBdHRyaWJ1dGUoJ2RhdGEtc2hvcnRjdXQta2V5Jyk7CiAgICAgIGNvbnN0IHBlcm0gPSBtZW51UGVybWlzc2lvbnMgJiYgbWVudVBlcm1pc3Npb25zW2tleV07CiAgICAgIGVsLnN0eWxlLmRpc3BsYXkgPSBpc0FsbG93ZWRCeVBlcm0ocGVybSkgPyAnJyA6ICdub25lJzsKICAgIH0pOwogIH1jYXRjaChlKXt9Cn0KZnVuY3Rpb24gbG9hZE1lbnVQZXJtaXNzaW9ucygpewogIC8vIGhlcmtlcyBpw6dpbiBva3VuYWJpbGlyCiAgcmV0dXJuIGFwaUNhbGwoImdldE1lbnVQZXJtaXNzaW9ucyIsIHt9KS50aGVuKHJlcz0+ewogICAgaWYocmVzICYmIHJlcy5yZXN1bHQ9PT0ic3VjY2VzcyIpewogICAgICBtZW51UGVybWlzc2lvbnMgPSB7fTsKICAgICAgKHJlcy5pdGVtc3x8W10pLmZvckVhY2goaXQ9PnsKICAgICAgICBtZW51UGVybWlzc2lvbnNbaXQua2V5XSA9IHsKICAgICAgICAgIGFsbG93ZWRHcm91cHM6IG5vcm1hbGl6ZUxpc3QoaXQuYWxsb3dlZEdyb3VwcyksCiAgICAgICAgICBlbmFibGVkOiAoaXQuZW5hYmxlZCA9PT0gZmFsc2UgfHwgU3RyaW5nKGl0LmVuYWJsZWQpLnRvVXBwZXJDYXNlKCk9PT0iRkFMU0UiKSA/IGZhbHNlIDogdHJ1ZSwKICAgICAgICAgIGFsbG93ZWRSb2xlczogbm9ybWFsaXplTGlzdChpdC5hbGxvd2VkUm9sZXMpIC8vIGJhY2t3YXJkLWNvbXBhdCBpZiBzdGlsbCBwcmVzZW50CiAgICAgICAgfTsKICAgICAgfSk7CiAgICAgIGFwcGx5TWVudVBlcm1pc3Npb25zKCk7CiAgICB9CiAgfSkuY2F0Y2goKCk9Pnt9KTsKfQoKLy8gTG9jQWRtaW4gcGFuZWwKZnVuY3Rpb24gb3Blbk1lbnVQZXJtaXNzaW9ucygpewogIGNvbnN0IHJvbGU9Z2V0TXlSb2xlKCk7CiAgLy8gxLBzdGVrOiBZZXRraSBZw7ZuZXRpbWkgc2FkZWNlIExvY0FkbWluIHJvbMO8bmRlIGfDtnLDvG5zw7xuIHZlIMOnYWzEscWfc8SxbgogIGlmKHJvbGUhPT0ibG9jYWRtaW4iKXsKICAgIFN3YWwuZmlyZSgiWWV0a2lzaXoiLCAiWWV0a2kgWcO2bmV0aW1pIHNhZGVjZSBMb2NBZG1pbiByb2zDvG5kZSBrdWxsYW7EsWxhYmlsaXIuIiwgIndhcm5pbmciKTsKICAgIHJldHVybjsKICB9CiAgYXBpQ2FsbCgiZ2V0TWVudVBlcm1pc3Npb25zIix7fSkudGhlbihyZXM9PnsKICAgIGlmKCFyZXMgfHwgcmVzLnJlc3VsdCE9PSJzdWNjZXNzIil7CiAgICAgIFN3YWwuZmlyZSgiSGF0YSIsIllldGtpbGVyIG9rdW5hbWFkxLEiLCJlcnJvciIpOwogICAgICByZXR1cm47CiAgICB9CgogICAgLy8gR3J1cGxhcsSxIGJhY2tlbmQnZGVuIGFsLCB5b2tzYSBpdGVtcyBpw6dpbmRlbiB0w7xyZXQKICAgIGxldCBncm91cHMgPSAocmVzLmdyb3Vwc3x8W10pLm1hcChnPT5TdHJpbmcoZ3x8IiIpLnRyaW0oKSkuZmlsdGVyKEJvb2xlYW4pOwogICAgaWYoIWdyb3Vwcy5sZW5ndGgpewogICAgICBjb25zdCBzZXQ9bmV3IFNldCgpOwogICAgICAocmVzLml0ZW1zfHxbXSkuZm9yRWFjaChpdD0+ewogICAgICAgIG5vcm1hbGl6ZUxpc3QoaXQuYWxsb3dlZEdyb3VwcykuZm9yRWFjaChnPT57CiAgICAgICAgICBjb25zdCBnZz1TdHJpbmcoZ3x8IiIpLnRyaW0oKTsKICAgICAgICAgIGlmKGdnICYmIGdnLnRvVXBwZXJDYXNlKCkhPT0iQUxMIikgc2V0LmFkZChnZyk7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgICBncm91cHM9Wy4uLnNldF07CiAgICB9CiAgICAvLyBIZXBzaW5pIGJhxZ8gaGFyZiBiw7x5w7x0LCB5YXlnxLFuIGlzaW1sZXJpIG5vcm1hbGl6ZSBldAogICAgY29uc3Qgbm9ybU1hcD17ImNoYXQiOiJDaGF0IiwidGVsZXNhdMSxxZ8iOiJUZWxlc2F0xLHFnyIsInRlbGVzYXRpcyI6IlRlbGVzYXTEscWfIiwiecO2bmV0aW0iOiJZw7ZuZXRpbSIsInlvbmV0aW0iOiJZw7ZuZXRpbSIsInRla25payI6IlRla25payJ9OwogICAgZ3JvdXBzID0gZ3JvdXBzLm1hcChnPT57CiAgICAgIGNvbnN0IGs9Zy50b0xvd2VyQ2FzZSgpOwogICAgICByZXR1cm4gbm9ybU1hcFtrXSB8fCAoZy5jaGFyQXQoMCkudG9VcHBlckNhc2UoKStnLnNsaWNlKDEpKTsKICAgIH0pOwoKICAgIGNvbnN0IG1lbnVzID0gKHJlcy5pdGVtc3x8W10pOwoKICAgIGNvbnN0IHJvd3NIdG1sID0gbWVudXMubWFwKG09PnsKICAgICAgY29uc3QgYWxsb3dlZCA9IG5vcm1hbGl6ZUxpc3QobS5hbGxvd2VkR3JvdXBzKTsKICAgICAgY29uc3QgZW5hYmxlZCA9ICEobS5lbmFibGVkID09PSBmYWxzZSB8fCBTdHJpbmcobS5lbmFibGVkKS50b1VwcGVyQ2FzZSgpPT09IkZBTFNFIik7CiAgICAgIGNvbnN0IGNlbGxzID0gZ3JvdXBzLm1hcChnPT57CiAgICAgICAgY29uc3QgY2hlY2tlZCA9IChhbGxvd2VkLmxlbmd0aD09PTAgfHwgYWxsb3dlZC5pbmRleE9mKCJBTEwiKT4tMSkgPyB0cnVlIDogKGFsbG93ZWQuaW5kZXhPZihnKT4tMSk7CiAgICAgICAgcmV0dXJuIGA8dGQgc3R5bGU9InRleHQtYWxpZ246Y2VudGVyIj4KICAgICAgICAgIDxpbnB1dCB0eXBlPSJjaGVja2JveCIgZGF0YS1taz0iJHttLmtleX0iIGRhdGEtZz0iJHtnfSIgJHtjaGVja2VkPydjaGVja2VkJzonJ30vPgogICAgICAgIDwvdGQ+YDsKICAgICAgfSkuam9pbignJyk7CiAgICAgIHJldHVybiBgPHRyPgogICAgICAgIDx0ZCBzdHlsZT0iZm9udC13ZWlnaHQ6NjAwIj4ke2VzY2FwZUh0bWwobS50aXRsZXx8bS5sYWJlbHx8bS5rZXkpfTwvdGQ+CiAgICAgICAgPHRkIHN0eWxlPSJ0ZXh0LWFsaWduOmNlbnRlciI+PGlucHV0IHR5cGU9ImNoZWNrYm94IiBkYXRhLWVuYWJsZWQ9IiR7bS5rZXl9IiAke2VuYWJsZWQ/J2NoZWNrZWQnOicnfS8+PC90ZD4KICAgICAgICAke2NlbGxzfQogICAgICA8L3RyPmA7CiAgICB9KS5qb2luKCcnKTsKCiAgICBjb25zdCB0YWJsZUh0bWwgPSBgCiAgICAgIDxkaXYgc3R5bGU9InRleHQtYWxpZ246bGVmdDttYXJnaW4tYm90dG9tOjEwcHg7Y29sb3I6IzQ0NCI+CiAgICAgICAgTWVuw7wvc2VrbWUgYmF6bMSxIOKAnGhhbmdpIGdydXAgZ8O2cnPDvG7igJ0gYXlhcsSxLiDEsMWfYXJldGxpIG9sbWF5YW4gZ3J1cGxhciBtZW7DvHnDvCBnw7ZybWV6LgogICAgICA8L2Rpdj4KICAgICAgPGRpdiBzdHlsZT0ibWF4LWhlaWdodDo0MjBweDtvdmVyZmxvdzphdXRvO2JvcmRlcjoxcHggc29saWQgcmdiYSgwLDAsMCwuMDgpO2JvcmRlci1yYWRpdXM6MTJweCI+CiAgICAgICAgPHRhYmxlIHN0eWxlPSJ3aWR0aDoxMDAlO2JvcmRlci1jb2xsYXBzZTpjb2xsYXBzZSI+CiAgICAgICAgICA8dGhlYWQgc3R5bGU9InBvc2l0aW9uOnN0aWNreTt0b3A6MDtiYWNrZ3JvdW5kOiNmN2Y3Zjc7ei1pbmRleDoxIj4KICAgICAgICAgICAgPHRyPgogICAgICAgICAgICAgIDx0aCBzdHlsZT0idGV4dC1hbGlnbjpsZWZ0O3BhZGRpbmc6MTJweCI+TWVuw7w8L3RoPgogICAgICAgICAgICAgIDx0aCBzdHlsZT0idGV4dC1hbGlnbjpjZW50ZXI7cGFkZGluZzoxMnB4O3dpZHRoOjkwcHgiPkFrdGlmPC90aD4KICAgICAgICAgICAgICAke2dyb3Vwcy5tYXAoZz0+YDx0aCBzdHlsZT0idGV4dC1hbGlnbjpjZW50ZXI7cGFkZGluZzoxMnB4Ij4ke2VzY2FwZUh0bWwoZyl9PC90aD5gKS5qb2luKCcnKX0KICAgICAgICAgICAgPC90cj4KICAgICAgICAgIDwvdGhlYWQ+CiAgICAgICAgICA8dGJvZHk+CiAgICAgICAgICAgICR7cm93c0h0bWx9CiAgICAgICAgICA8L3Rib2R5PgogICAgICAgIDwvdGFibGU+CiAgICAgIDwvZGl2PmA7CgogICAgU3dhbC5maXJlKHsKICAgICAgdGl0bGU6ICJZZXRraSBZw7ZuZXRpbWkiLAogICAgICBodG1sOiB0YWJsZUh0bWwsCiAgICAgIHdpZHRoOiA5ODAsCiAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAiS2F5ZGV0IiwKICAgICAgY2FuY2VsQnV0dG9uVGV4dDogIlZhemdlw6ciLAogICAgICBwcmVDb25maXJtOiAoKT0+ewogICAgICAgIGNvbnN0IG91dCA9IHt9OwogICAgICAgIG1lbnVzLmZvckVhY2gobT0+eyBvdXRbbS5rZXldID0geyBhbGxvd2VkR3JvdXBzOiBbXSwgZW5hYmxlZDogdHJ1ZSB9OyB9KTsKICAgICAgICAvLyBlbmFibGVkCiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnaW5wdXRbdHlwZT0iY2hlY2tib3giXVtkYXRhLWVuYWJsZWRdJykuZm9yRWFjaChjYj0+ewogICAgICAgICAgY29uc3Qgaz1jYi5nZXRBdHRyaWJ1dGUoJ2RhdGEtZW5hYmxlZCcpOwogICAgICAgICAgaWYob3V0W2tdKSBvdXRba10uZW5hYmxlZCA9ICEhY2IuY2hlY2tlZDsKICAgICAgICB9KTsKICAgICAgICAvLyBncm91cHMKICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dFt0eXBlPSJjaGVja2JveCJdW2RhdGEtbWtdJykuZm9yRWFjaChjYj0+ewogICAgICAgICAgY29uc3Qgaz1jYi5nZXRBdHRyaWJ1dGUoJ2RhdGEtbWsnKTsKICAgICAgICAgIGNvbnN0IGc9Y2IuZ2V0QXR0cmlidXRlKCdkYXRhLWcnKTsKICAgICAgICAgIGlmKGNiLmNoZWNrZWQgJiYgb3V0W2tdKSBvdXRba10uYWxsb3dlZEdyb3Vwcy5wdXNoKGcpOwogICAgICAgIH0pOwogICAgICAgIC8vIEhlcHNpIHNlw6dpbGl5c2UgIkFMTCIgb2xhcmFrIHlheiAoZGFoYSB0ZW1peikKICAgICAgICBPYmplY3Qua2V5cyhvdXQpLmZvckVhY2goaz0+ewogICAgICAgICAgY29uc3QgYXJyID0gb3V0W2tdLmFsbG93ZWRHcm91cHN8fFtdOwogICAgICAgICAgaWYoYXJyLmxlbmd0aD09PWdyb3Vwcy5sZW5ndGgpewogICAgICAgICAgICBvdXRba10uYWxsb3dlZEdyb3VwcyA9IFsiQUxMIl07CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIG91dDsKICAgICAgfQogICAgfSkudGhlbihyPT57CiAgICAgIGlmKCFyLmlzQ29uZmlybWVkKSByZXR1cm47CiAgICAgIGNvbnN0IHBheWxvYWQgPSByLnZhbHVlIHx8IHt9OwogICAgICBhcGlDYWxsKCJzZXRNZW51UGVybWlzc2lvbnMiLHsgaXRlbXM6IHBheWxvYWQgfSkudGhlbihzdj0+ewogICAgICAgIGlmKHN2ICYmIHN2LnJlc3VsdD09PSJzdWNjZXNzIil7CiAgICAgICAgICBTd2FsLmZpcmUoIktheWRlZGlsZGkiLCJZZXRraWxlciBnw7xuY2VsbGVuZGkuIiwic3VjY2VzcyIpOwogICAgICAgICAgbG9hZE1lbnVQZXJtaXNzaW9ucygpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBTd2FsLmZpcmUoIkhhdGEiLCAoc3YmJnN2Lm1lc3NhZ2UpfHwiS2F5ZGVkaWxlbWVkaSIsICJlcnJvciIpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9KTsKICB9KTsKfQovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpsZXQgaXNBZG1pbk1vZGUgPSBmYWxzZTsKbGV0IGlzTG9jQWRtaW4gPSBmYWxzZTsKbGV0IGlzRWRpdGluZ0FjdGl2ZSA9IGZhbHNlOwpsZXQgc2Vzc2lvblRpbWVvdXQ7CmxldCBhY3RpdmVDYXJkcyA9IFtdOwpsZXQgY3VycmVudENhdGVnb3J5ID0gImhvbWUiOwpsZXQgYWRtaW5Vc2VyTGlzdCA9IFtdOwpsZXQgYWxsRXZhbHVhdGlvbnNEYXRhID0gW107CmxldCB3aXphcmRTdGVwc0RhdGEgPSB7fTsKbGV0IHRyYWluaW5nRGF0YSA9IFtdOwovLyBZRU7EsDogQ2hhcnQgaW5zdGFuY2UnxLEgdHV0bWFrIGnDp2luCmxldCBkYXNoYm9hcmRDaGFydCA9IG51bGw7Ci8vIFlFTsSwOiBGZWVkYmFjayBMb2cgVmVyaXNpIChNYW51ZWwga2F5xLF0IGRldGF5bGFyxLEgacOnaW4pCmxldCBmZWVkYmFja0xvZ3NEYXRhID0gW107Ci8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gLS0tIEtBTMSwVEUgUFVBTkxBTUEgTE9HxLDEnsSwOiBDSEFUIChCVVRPTiBUQUJBTkxJKSAtLS0KLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQp3aW5kb3cuc2V0QnV0dG9uU2NvcmUgPSBmdW5jdGlvbihpbmRleCwgc2NvcmUsIG1heCkgewogICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHJvdy0ke2luZGV4fWApOwogICAgY29uc3QgYmFkZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgYmFkZ2UtJHtpbmRleH1gKTsKICAgIGNvbnN0IG5vdGVJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBub3RlLSR7aW5kZXh9YCk7CiAgICBjb25zdCBidXR0b25zID0gcm93LnF1ZXJ5U2VsZWN0b3JBbGwoJy5ldmFsLWJ1dHRvbicpOwogICAgCiAgICBidXR0b25zLmZvckVhY2goYiA9PiBiLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpKTsKICAgIAogICAgY29uc3QgYWN0aXZlQnRuID0gcm93LnF1ZXJ5U2VsZWN0b3IoJy5ldmFsLWJ1dHRvbltkYXRhLXNjb3JlPSInICsgc2NvcmUgKyAnIl0nKTsKICAgIGlmIChhY3RpdmVCdG4pIGFjdGl2ZUJ0bi5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgIAogICAgYmFkZ2UuaW5uZXJUZXh0ID0gc2NvcmU7CiAgICAKICAgIGlmIChzY29yZSA8IG1heCkgewogICAgICAgIG5vdGVJbnB1dC5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICBiYWRnZS5zdHlsZS5iYWNrZ3JvdW5kID0gJyNkMzJmMmYnOyAKICAgICAgICByb3cuc3R5bGUuYm9yZGVyQ29sb3IgPSAnI2ZmY2RkMic7CiAgICAgICAgcm93LnN0eWxlLmJhY2tncm91bmQgPSAnI2ZmZjVmNSc7CiAgICB9IGVsc2UgewogICAgICAgIG5vdGVJbnB1dC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgIG5vdGVJbnB1dC52YWx1ZSA9ICcnOyAKICAgICAgICBiYWRnZS5zdHlsZS5iYWNrZ3JvdW5kID0gJyMyZTdkMzInOyAKICAgICAgICByb3cuc3R5bGUuYm9yZGVyQ29sb3IgPSAnI2VlZSc7CiAgICAgICAgcm93LnN0eWxlLmJhY2tncm91bmQgPSAnI2ZmZic7CiAgICB9CiAgICB3aW5kb3cucmVjYWxjVG90YWxTY29yZSgpOwp9Owp3aW5kb3cucmVjYWxjVG90YWxTY29yZSA9IGZ1bmN0aW9uKCkgewogICAgbGV0IGN1cnJlbnRUb3RhbCA9IDA7CiAgICBsZXQgbWF4VG90YWwgPSAwOwogICAgCiAgICBjb25zdCBzY29yZUJhZGdlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zY29yZS1iYWRnZScpOwogICAgc2NvcmVCYWRnZXMuZm9yRWFjaChiID0+IHsgY3VycmVudFRvdGFsICs9IHBhcnNlSW50KGIuaW5uZXJUZXh0KSB8fCAwOyB9KTsKICAgIAogICAgY29uc3QgbWF4U2NvcmVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNyaXRlcmlhLXJvdycpOwogICAgbWF4U2NvcmVzLmZvckVhY2gocm93ID0+IHsgbWF4VG90YWwgKz0gcGFyc2VJbnQocm93LmdldEF0dHJpYnV0ZSgnZGF0YS1tYXgtc2NvcmUnKSkgfHwgMDsgfSk7CiAgICAKICAgIGNvbnN0IGxpdmVTY29yZUVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xpdmUtc2NvcmUnKTsKICAgIGNvbnN0IHJpbmdFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY29yZS1yaW5nJyk7CiAgICAKICAgIGlmKGxpdmVTY29yZUVsKSBsaXZlU2NvcmVFbC5pbm5lclRleHQgPSBjdXJyZW50VG90YWw7CiAgICBpZihyaW5nRWwpIHsKICAgICAgICBsZXQgY29sb3IgPSAnIzJlN2QzMic7CiAgICAgICAgbGV0IHJhdGlvID0gbWF4VG90YWwgPiAwID8gKGN1cnJlbnRUb3RhbCAvIG1heFRvdGFsKSAqIDEwMCA6IDA7CiAgICAgICAgaWYocmF0aW8gPCA1MCkgY29sb3IgPSAnI2QzMmYyZic7CiAgICAgICAgZWxzZSBpZihyYXRpbyA8IDg1KSBjb2xvciA9ICcjZWQ2YzAyJzsKICAgICAgICBlbHNlIGlmKHJhdGlvIDwgOTUpIGNvbG9yID0gJyNmYWJiMDAnOwogICAgICAgIHJpbmdFbC5zdHlsZS5iYWNrZ3JvdW5kID0gYGNvbmljLWdyYWRpZW50KCR7Y29sb3J9ICR7cmF0aW99JSwgIzQ0NCAke3JhdGlvfSUpYDsKICAgIH0KfTsKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyAtLS0gS0FMxLBURSBQVUFOTEFNQSBMT0fEsMSexLA6IFRFTEUgU0FUScWeIChTTElERVIgVEFCQU5MSSkgLS0tCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0Kd2luZG93LnVwZGF0ZVJvd1NsaWRlclNjb3JlID0gZnVuY3Rpb24oaW5kZXgsIG1heCkgewogICAgY29uc3Qgc2xpZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHNsaWRlci0ke2luZGV4fWApOwogICAgY29uc3QgYmFkZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgYmFkZ2UtJHtpbmRleH1gKTsKICAgIGNvbnN0IG5vdGVJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBub3RlLSR7aW5kZXh9YCk7CiAgICBjb25zdCByb3cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgcm93LSR7aW5kZXh9YCk7CiAgICBpZighc2xpZGVyKSByZXR1cm47CiAgICBjb25zdCB2YWwgPSBwYXJzZUludChzbGlkZXIudmFsdWUpOwogICAgYmFkZ2UuaW5uZXJUZXh0ID0gdmFsOwogICAgCiAgICBpZiAodmFsIDwgbWF4KSB7CiAgICAgICAgbm90ZUlucHV0LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgIGJhZGdlLnN0eWxlLmJhY2tncm91bmQgPSAnI2QzMmYyZic7CiAgICAgICAgcm93LnN0eWxlLmJvcmRlckNvbG9yID0gJyNmZmNkZDInOwogICAgICAgIHJvdy5zdHlsZS5iYWNrZ3JvdW5kID0gJyNmZmY1ZjUnOwogICAgfSBlbHNlIHsKICAgICAgICBub3RlSW5wdXQuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICBub3RlSW5wdXQudmFsdWUgPSAnJzsKICAgICAgICBiYWRnZS5zdHlsZS5iYWNrZ3JvdW5kID0gJyMyZTdkMzInOwogICAgICAgIHJvdy5zdHlsZS5ib3JkZXJDb2xvciA9ICcjZWVlJzsKICAgICAgICByb3cuc3R5bGUuYmFja2dyb3VuZCA9ICcjZmZmJzsKICAgIH0KICAgIHdpbmRvdy5yZWNhbGNUb3RhbFNsaWRlclNjb3JlKCk7Cn07CndpbmRvdy5yZWNhbGNUb3RhbFNsaWRlclNjb3JlID0gZnVuY3Rpb24oKSB7CiAgICBsZXQgY3VycmVudFRvdGFsID0gMDsKICAgIGxldCBtYXhUb3RhbCA9IDA7CiAgICBjb25zdCBzbGlkZXJzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnNsaWRlci1pbnB1dCcpOwogICAgCiAgICBzbGlkZXJzLmZvckVhY2gocyA9PiB7CiAgICAgICAgY3VycmVudFRvdGFsICs9IHBhcnNlSW50KHMudmFsdWUpIHx8IDA7CiAgICAgICAgbWF4VG90YWwgKz0gcGFyc2VJbnQocy5nZXRBdHRyaWJ1dGUoJ21heCcpKSB8fCAwOwogICAgfSk7CiAgICBjb25zdCBsaXZlU2NvcmVFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsaXZlLXNjb3JlJyk7CiAgICBjb25zdCByaW5nRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NvcmUtcmluZycpOwogICAgCiAgICBpZihsaXZlU2NvcmVFbCkgbGl2ZVNjb3JlRWwuaW5uZXJUZXh0ID0gY3VycmVudFRvdGFsOwogICAgaWYocmluZ0VsKSB7CiAgICAgICAgbGV0IGNvbG9yID0gJyMyZTdkMzInOwogICAgICAgIGxldCByYXRpbyA9IG1heFRvdGFsID4gMCA/IChjdXJyZW50VG90YWwgLyBtYXhUb3RhbCkgKiAxMDAgOiAwOwogICAgICAgIGlmKHJhdGlvIDwgNTApIGNvbG9yID0gJyNkMzJmMmYnOwogICAgICAgIGVsc2UgaWYocmF0aW8gPCA4NSkgY29sb3IgPSAnI2VkNmMwMic7CiAgICAgICAgZWxzZSBpZihyYXRpbyA8IDk1KSBjb2xvciA9ICcjZmFiYjAwJzsKICAgICAgICByaW5nRWwuc3R5bGUuYmFja2dyb3VuZCA9IGBjb25pYy1ncmFkaWVudCgke2NvbG9yfSAke3JhdGlvfSUsICM0NDQgJHtyYXRpb30lKWA7CiAgICB9Cn07Ci8vIC0tLSBZQVJESU1DSSBGT05LU8SwWU9OTEFSIC0tLQpmdW5jdGlvbiBnZXRUb2tlbigpIHsgcmV0dXJuIGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJzU3BvcnRUb2tlbiIpOyB9CmZ1bmN0aW9uIHNldEhvbWVXZWxjb21lVXNlcihuYW1lKXsKICB0cnl7CiAgICBjb25zdCBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJob21lLXdlbGNvbWUtdXNlciIpOwogICAgaWYoZWwpIGVsLnRleHRDb250ZW50ID0gKG5hbWV8fCJNaXNhZmlyIik7CiAgfWNhdGNoKGUpe30KfQoKZnVuY3Rpb24gZ2V0RmF2cygpIHsgcmV0dXJuIEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3NTcG9ydEZhdnMnKSB8fCAnW10nKTsgfQpmdW5jdGlvbiB0b2dnbGVGYXZvcml0ZSh0aXRsZSkgewogICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICBsZXQgZmF2cyA9IGdldEZhdnMoKTsKICAgIGlmIChmYXZzLmluY2x1ZGVzKHRpdGxlKSkgeyBmYXZzID0gZmF2cy5maWx0ZXIodCA9PiB0ICE9PSB0aXRsZSk7IH0gCiAgICBlbHNlIHsgZmF2cy5wdXNoKHRpdGxlKTsgfQogICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3NTcG9ydEZhdnMnLCBKU09OLnN0cmluZ2lmeShmYXZzKSk7CiAgICB0cnkgewogICAgICAgIGNvbnN0IGFkZGVkID0gZmF2cy5pbmNsdWRlcyh0aXRsZSk7CiAgICAgICAgU3dhbC5maXJlKHt0b2FzdDp0cnVlLCBwb3NpdGlvbjondG9wLWVuZCcsIGljb246IGFkZGVkID8gJ3N1Y2Nlc3MnIDogJ2luZm8nLCB0aXRsZTogYWRkZWQgPyAnRmF2b3JpbGVyZSBla2xlbmRpJyA6ICdGYXZvcmlsZXJkZW4ga2FsZMSxcsSxbGTEsScsIHNob3dDb25maXJtQnV0dG9uOmZhbHNlLCB0aW1lcjoxMjAwfSk7CiAgICB9IGNhdGNoKGUpIHt9CgogICAgaWYgKGN1cnJlbnRDYXRlZ29yeSA9PT0gJ2ZhdicpIHsgZmlsdGVyQ2F0ZWdvcnkoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJ0bi1mYXYnKSwgJ2ZhdicpOyB9IAogICAgZWxzZSB7IHJlbmRlckNhcmRzKGFjdGl2ZUNhcmRzKTsgfQogICAgdHJ5IHsgdXBkYXRlU2VhcmNoUmVzdWx0Q291bnQoYWN0aXZlQ2FyZHMubGVuZ3RoIHx8IDAsIGRhdGFiYXNlLmxlbmd0aCk7IH0gY2F0Y2goZSkge30KfQpmdW5jdGlvbiBpc0Zhdih0aXRsZSkgeyByZXR1cm4gZ2V0RmF2cygpLmluY2x1ZGVzKHRpdGxlKTsgfQpmdW5jdGlvbiBmb3JtYXREYXRlVG9ERE1NWVlZWShkYXRlU3RyaW5nKSB7CiAgICBpZiAoIWRhdGVTdHJpbmcpIHJldHVybiAnTi9BJzsKICAgIC8vIEXEn2VyIGZvcm1hdCBkZC5NTS55eXl5IG9sYXJhayBnZWxpeW9yc2EgZGlyZWt0IGTDtm4KICAgIGlmIChkYXRlU3RyaW5nLm1hdGNoKC9eXGR7Mn1cLlxkezJ9XC5cZHs0fS8pKSB7IHJldHVybiBkYXRlU3RyaW5nLnNwbGl0KCcgJylbMF07IH0KICAgIHRyeSB7CiAgICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKGRhdGVTdHJpbmcpOwogICAgICAgIGlmIChpc05hTihkYXRlLmdldFRpbWUoKSkpIHsgcmV0dXJuIGRhdGVTdHJpbmc7IH0KICAgICAgICBjb25zdCBkYXkgPSBTdHJpbmcoZGF0ZS5nZXREYXRlKCkpLnBhZFN0YXJ0KDIsICcwJyk7CiAgICAgICAgY29uc3QgbW9udGggPSBTdHJpbmcoZGF0ZS5nZXRNb250aCgpICsgMSkucGFkU3RhcnQoMiwgJzAnKTsKICAgICAgICBjb25zdCB5ZWFyID0gZGF0ZS5nZXRGdWxsWWVhcigpOwogICAgICAgIHJldHVybiBgJHtkYXl9LiR7bW9udGh9LiR7eWVhcn1gOwogICAgfSBjYXRjaCAoZSkgeyByZXR1cm4gZGF0ZVN0cmluZzsgfQp9CgpmdW5jdGlvbiBwYXJzZURhdGVUUlRvVFMocyl7CiAgICB0cnl7CiAgICAgICAgaWYoIXMpIHJldHVybiAwOwogICAgICAgIGNvbnN0IGNsZWFuID0gU3RyaW5nKHMpLnNwbGl0KCcgJylbMF07CiAgICAgICAgaWYoY2xlYW4uaW5jbHVkZXMoJy4nKSl7CiAgICAgICAgICAgIGNvbnN0IHBhcnRzID0gY2xlYW4uc3BsaXQoJy4nKTsKICAgICAgICAgICAgaWYocGFydHMubGVuZ3RoID49IDMpewogICAgICAgICAgICAgICAgY29uc3QgZGQgPSBwYXJzZUludChwYXJ0c1swXSwxMCk7CiAgICAgICAgICAgICAgICBjb25zdCBtbSA9IHBhcnNlSW50KHBhcnRzWzFdLDEwKTsKICAgICAgICAgICAgICAgIGNvbnN0IHl5ID0gcGFyc2VJbnQocGFydHNbMl0sMTApOwogICAgICAgICAgICAgICAgY29uc3QgZCA9IG5ldyBEYXRlKHl5LCBtbS0xLCBkZCk7CiAgICAgICAgICAgICAgICByZXR1cm4gZC5nZXRUaW1lKCkgfHwgMDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjb25zdCBkID0gbmV3IERhdGUocyk7CiAgICAgICAgcmV0dXJuIGQuZ2V0VGltZSgpIHx8IDA7CiAgICB9Y2F0Y2goZSl7IHJldHVybiAwOyB9Cn0KCmZ1bmN0aW9uIGlzTmV3KGRhdGVTdHIpIHsKICAgIGlmICghZGF0ZVN0cikgcmV0dXJuIGZhbHNlOwogICAgbGV0IGRhdGU7CiAgICBpZiAoZGF0ZVN0ci5pbmRleE9mKCcuJykgPiAtMSkgewogICAgICAgIGNvbnN0IGNsZWFuRGF0ZSA9IGRhdGVTdHIuc3BsaXQoJyAnKVswXTsKICAgICAgICBjb25zdCBwYXJ0cyA9IGNsZWFuRGF0ZS5zcGxpdCgnLicpOwogICAgICAgIC8vIEdHLkFBLllZWVkgLT4gWVlZWS1BQS1HRyBmb3JtYXTEsW5hIMOnZXZpcgogICAgICAgIGRhdGUgPSBuZXcgRGF0ZShwYXJ0c1syXSwgcGFydHNbMV0gLSAxLCBwYXJ0c1swXSk7CiAgICB9IGVsc2UgewogICAgICAgIGRhdGUgPSBuZXcgRGF0ZShkYXRlU3RyKTsKICAgIH0KICAgIGlmIChpc05hTihkYXRlLmdldFRpbWUoKSkpIHJldHVybiBmYWxzZTsKICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7CiAgICBjb25zdCBkaWZmVGltZSA9IE1hdGguYWJzKG5vdyAtIGRhdGUpOwogICAgY29uc3QgZGlmZkRheXMgPSBNYXRoLmNlaWwoZGlmZlRpbWUgLyAoMTAwMCAqIDYwICogNjAgKiAyNCkpOwogICAgcmV0dXJuIGRpZmZEYXlzIDw9IDM7Cn0KZnVuY3Rpb24gZ2V0Q2F0ZWdvcnlTZWxlY3RIdG1sKGN1cnJlbnRDYXRlZ29yeSwgaWQpIHsKICAgIGxldCBvcHRpb25zID0gVkFMSURfQ0FURUdPUklFUy5tYXAoY2F0ID0+IGA8b3B0aW9uIHZhbHVlPSIke2NhdH0iICR7Y2F0ID09PSBjdXJyZW50Q2F0ZWdvcnkgPyAnc2VsZWN0ZWQnIDogJyd9PiR7Y2F0fTwvb3B0aW9uPmApLmpvaW4oJycpOwogICAgaWYgKGN1cnJlbnRDYXRlZ29yeSAmJiAhVkFMSURfQ0FURUdPUklFUy5pbmNsdWRlcyhjdXJyZW50Q2F0ZWdvcnkpKSB7CiAgICAgICAgb3B0aW9ucyA9IGA8b3B0aW9uIHZhbHVlPSIke2N1cnJlbnRDYXRlZ29yeX0iIHNlbGVjdGVkPiR7Y3VycmVudENhdGVnb3J5fSAoSGF0YSk8L29wdGlvbj5gICsgb3B0aW9uczsKICAgIH0KICAgIHJldHVybiBgPHNlbGVjdCBpZD0iJHtpZH0iIGNsYXNzPSJzd2FsMi1pbnB1dCIgc3R5bGU9IndpZHRoOjEwMCU7IG1hcmdpbi10b3A6NXB4OyI+JHtvcHRpb25zfTwvc2VsZWN0PmA7Cn0KZnVuY3Rpb24gZXNjYXBlRm9ySnNTdHJpbmcodGV4dCkgewogICAgaWYgKCF0ZXh0KSByZXR1cm4gIiI7CiAgICByZXR1cm4gdGV4dC50b1N0cmluZygpLnJlcGxhY2UoL1xcL2csICdcXFxcJykucmVwbGFjZSgvJy9nLCAnXFxcJycpLnJlcGxhY2UoLyIvZywgJ1xcIicpLnJlcGxhY2UoL1xuL2csICdcXG4nKS5yZXBsYWNlKC9cci9nLCAnJyk7Cn0KZnVuY3Rpb24gY29weVNjcmlwdENvbnRlbnQoZW5jb2RlZFRleHQpIHsKICAgIGNvbnN0IHRleHQgPSBkZWNvZGVVUklDb21wb25lbnQoZW5jb2RlZFRleHQpOwogICAgY29weVRleHQodGV4dCk7Cn0KZnVuY3Rpb24gY29weVRleHQodCkgewogICAgLy8gbmF2aWdhdG9yLmNsaXBib2FyZC53cml0ZVRleHQgeWVyaW5lIGV4ZWNDb21tYW5kIGt1bGxhbsSxbGTEsSAoaUZyYW1lIHV5dW1sdWx1xJ91IGnDp2luKQogICAgY29uc3QgdGV4dGFyZWEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZXh0YXJlYScpOwogICAgdGV4dGFyZWEudmFsdWUgPSB0LnJlcGxhY2UoL1xcbi9nLCAnXG4nKTsKICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGV4dGFyZWEpOwogICAgdGV4dGFyZWEuc2VsZWN0KCk7CiAgICB0cnkgewogICAgICAgIGRvY3VtZW50LmV4ZWNDb21tYW5kKCdjb3B5Jyk7CiAgICAgICAgU3dhbC5maXJlKHtpY29uOidzdWNjZXNzJywgdGl0bGU6J0tvcHlhbGFuZMSxJywgdG9hc3Q6dHJ1ZSwgcG9zaXRpb246J3RvcC1lbmQnLCBzaG93Q29uZmlybUJ1dHRvbjpmYWxzZSwgdGltZXI6MTUwMH0pOwogICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgU3dhbC5maXJlKHtpY29uOidlcnJvcicsIHRpdGxlOidLb3B5YWxhbmFtYWTEsScsIHRleHQ6J0zDvHRmZW4gbWFudWVsIGtvcHlhbGF5xLFuLicsIHRvYXN0OnRydWUsIHBvc2l0aW9uOid0b3AtZW5kJywgc2hvd0NvbmZpcm1CdXR0b246ZmFsc2UsIHRpbWVyOjI1MDB9KTsKICAgIH0KICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQodGV4dGFyZWEpOwp9CmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NvbnRleHRtZW51JywgZXZlbnQgPT4gZXZlbnQucHJldmVudERlZmF1bHQoKSk7CmRvY3VtZW50Lm9ua2V5ZG93biA9IGZ1bmN0aW9uKGUpIHsgaWYoZS5rZXlDb2RlID09IDEyMykgcmV0dXJuIGZhbHNlOyB9CmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoKSA9PiB7IGNoZWNrU2Vzc2lvbigpOyB9KTsKLy8gLS0tIFNFU1NJT04gJiBMT0dJTiAtLS0KZnVuY3Rpb24gY2hlY2tTZXNzaW9uKCkgewogICAgY29uc3Qgc2F2ZWRVc2VyID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oInNTcG9ydFVzZXIiKTsKICAgIGNvbnN0IHNhdmVkVG9rZW4gPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgic1Nwb3J0VG9rZW4iKTsKICAgIGNvbnN0IHNhdmVkUm9sZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJzU3BvcnRSb2xlIik7CiAgICBjb25zdCBzYXZlZEdyb3VwID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oInNTcG9ydEdyb3VwIik7CgogICAgLy8g4pyFIE90dXJ1bXVuIHRhcmF5xLFjxLEvUEMga2FwYXQtYcOnIHNvbnJhc8SxIGVydGVzaSBnw7xuZSBzYXJrbWFtYXPEsSBpw6dpbjoKICAgIC8vIC0gQXluxLEgZ8O8biBkZcSfaWxzZSBvdG9tYXRpayDDp8Sxa8SxxZ8KICAgIC8vIC0gQXlyxLFjYSAxMiBzYWF0aSBnZcOndGl5c2Ugb3RvbWF0aWsgw6fEsWvEscWfCiAgICBjb25zdCB0b2RheUtleSA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zbGljZSgwLCAxMCk7IC8vIFlZWVktTU0tREQKICAgIGNvbnN0IHNlc3Npb25EYXkgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgic1Nwb3J0U2Vzc2lvbkRheSIpIHx8ICIiOwogICAgY29uc3QgbG9naW5BdCA9IHBhcnNlSW50KGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJzU3BvcnRMb2dpbkF0IikgfHwgIjAiLCAxMCk7CiAgICBjb25zdCBtYXhBZ2VNcyA9IDEyICogNjAgKiA2MCAqIDEwMDA7IC8vIDEyIHNhYXQKCiAgICBpZiAoc2F2ZWRVc2VyICYmIHNhdmVkVG9rZW4pIHsKICAgICAgICBjb25zdCBpc090aGVyRGF5ID0gKCFzZXNzaW9uRGF5IHx8IHNlc3Npb25EYXkgIT09IHRvZGF5S2V5KTsKICAgICAgICBjb25zdCBpc1Rvb09sZCA9ICghbG9naW5BdCB8fCAoRGF0ZS5ub3coKSAtIGxvZ2luQXQpID4gbWF4QWdlTXMpOwoKICAgICAgICBpZiAoaXNPdGhlckRheSB8fCBpc1Rvb09sZCkgewogICAgICAgICAgICB0cnkgeyBsb2dvdXQoKTsgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oInNTcG9ydFVzZXIiKTsKICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCJzU3BvcnRUb2tlbiIpOwogICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oInNTcG9ydFJvbGUiKTsKICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCJzU3BvcnRHcm91cCIpOwogICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oInNTcG9ydFNlc3Npb25EYXkiKTsKICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCJzU3BvcnRMb2dpbkF0Iik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgY3VycmVudFVzZXIgPSBzYXZlZFVzZXI7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImxvZ2luLXNjcmVlbiIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVzZXItZGlzcGxheSIpLmlubmVyVGV4dCA9IGN1cnJlbnRVc2VyOwogICAgICAgIHNldEhvbWVXZWxjb21lVXNlcihjdXJyZW50VXNlcik7CgogICAgICAgIGNoZWNrQWRtaW4oc2F2ZWRSb2xlKTsKCiAgICAgICAgdHJ5ewogICAgICAgICAgICBpZihzYXZlZEdyb3VwKXsKICAgICAgICAgICAgICAgIGNvbnN0IGVsPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ0LXNpZGUtcm9sZSIpOyBpZihlbCkgZWwudGV4dENvbnRlbnQ9c2F2ZWRHcm91cDsKICAgICAgICAgICAgICAgIGNvbnN0IGVsMj1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidGVjaC1zaWRlLXJvbGUiKTsgaWYoZWwyKSBlbDIudGV4dENvbnRlbnQ9c2F2ZWRHcm91cDsKICAgICAgICAgICAgfQogICAgICAgIH1jYXRjaChlKXt9CgogICAgICAgIHN0YXJ0U2Vzc2lvblRpbWVyKCk7CgogICAgICAgIC8vIOKchSBZRU7EsDogWWVuaWxlbWVkZSBkZSBtZW7DvC9ibG9rIHlldGtpbGVyaW5pIHV5Z3VsYQogICAgICAgIHRyeXsgbG9hZE1lbnVQZXJtaXNzaW9ucygpOyB9Y2F0Y2goZSl7fQogICAgICAgIHRyeXsgbG9hZEhvbWVCbG9ja3MoKTsgfWNhdGNoKGUpe30KCiAgICAgICAgaWYgKEJBS0lNX01PRFUpIHsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1haW50ZW5hbmNlLXNjcmVlbiIpLnN0eWxlLmRpc3BsYXkgPSAiZmxleCI7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1haW4tYXBwIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CgogICAgICAgICAgICBsb2FkQ29udGVudERhdGEoKTsKICAgICAgICAgICAgbG9hZFdpemFyZERhdGEoKTsKICAgICAgICAgICAgbG9hZFRlY2hXaXphcmREYXRhKCk7CgogICAgICAgICAgICAvLyBFxJ9lciBxdXNlcnMgcm9sw7xuZGV5c2UsIGFuYSBpw6dlcmnEn2kgZ2l6bGUgdmUga2FsaXRlIG1vZMO8bMO8bsO8IGHDpwogICAgICAgICAgICBpZiAoc2F2ZWRSb2xlID09PSAncXVzZXJzJykgewogICAgICAgICAgICAgICAgY29uc3QgZ3JpZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYXJkR3JpZCcpOyBpZiAoZ3JpZCkgZ3JpZC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICAgICAgY29uc3QgY29udHJvbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY29udHJvbC13cmFwcGVyJyk7IGlmIChjb250cm9scykgY29udHJvbHMuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgICAgIGNvbnN0IHRpY2tlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5uZXdzLXRpY2tlci1ib3gnKTsgaWYgKHRpY2tlcikgdGlja2VyLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CgogICAgICAgICAgICAgICAgb3BlblF1YWxpdHlBcmVhKCk7IC8vIFllbmkgRnVsbCBTY3JlZW4gTW9kw7xsCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KZnVuY3Rpb24gZW50ZXJCYXMoZSkgeyBpZiAoZS5rZXkgPT09ICJFbnRlciIpIGdpcmlzWWFwKCk7IH0KZnVuY3Rpb24gZ2lyaXNZYXAoKSB7CiAgICBjb25zdCB1TmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ1c2VybmFtZUlucHV0IikudmFsdWUudHJpbSgpOwogICAgY29uc3QgdVBhc3MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicGFzc0lucHV0IikudmFsdWUudHJpbSgpOwogICAgY29uc3QgbG9hZGluZ01zZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsb2FkaW5nLW1zZyIpOwogICAgY29uc3QgZXJyb3JNc2cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZXJyb3ItbXNnIik7CiAgICBpZighdU5hbWUgfHwgIXVQYXNzKSB7IGVycm9yTXNnLmlubmVyVGV4dCA9ICJMw7x0ZmVuIGJpbGdpbGVyaSBnaXJpbml6LiI7IGVycm9yTXNnLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOyByZXR1cm47IH0KICAgIAogICAgbG9hZGluZ01zZy5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKICAgIGxvYWRpbmdNc2cuaW5uZXJUZXh0ID0gIkRvxJ9ydWxhbsSxeW9yLi4uIjsKICAgIGVycm9yTXNnLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubG9naW4tYnRuJykuZGlzYWJsZWQgPSB0cnVlOwogICAgCiAgICBjb25zdCBoYXNoZWRQYXNzID0gQ3J5cHRvSlMuU0hBMjU2KHVQYXNzKS50b1N0cmluZygpOwogICAgZmV0Y2goU0NSSVBUX1VSTCwgewogICAgICAgIG1ldGhvZDogJ1BPU1QnLAogICAgICAgIGhlYWRlcnM6IHsgIkNvbnRlbnQtVHlwZSI6ICJ0ZXh0L3BsYWluO2NoYXJzZXQ9dXRmLTgiIH0sCiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBhY3Rpb246ICJsb2dpbiIsIHVzZXJuYW1lOiB1TmFtZSwgcGFzc3dvcmQ6IGhhc2hlZFBhc3MgfSkKICAgIH0pLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuanNvbigpKQogICAgLnRoZW4oZGF0YSA9PiB7CiAgICAgICAgbG9hZGluZ01zZy5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5sb2dpbi1idG4nKS5kaXNhYmxlZCA9IGZhbHNlOwogICAgICAgIAogICAgICAgIGlmIChkYXRhLnJlc3VsdCA9PT0gInN1Y2Nlc3MiKSB7CiAgICAgICAgICAgIGN1cnJlbnRVc2VyID0gZGF0YS51c2VybmFtZTsKICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oInNTcG9ydFVzZXIiLCBjdXJyZW50VXNlcik7CiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJzU3BvcnRUb2tlbiIsIGRhdGEudG9rZW4pOwogICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgic1Nwb3J0Um9sZSIsIGRhdGEucm9sZSk7CiAgICAgICAgICAgIGlmIChkYXRhLmdyb3VwKSBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgic1Nwb3J0R3JvdXAiLCBkYXRhLmdyb3VwKTsKICAgICAgICAgICAgLy8g4pyFIE90dXJ1bSB6YW1hbiBkYW1nYXPEsSAoZXJ0ZXNpIGfDvG4gb3RvbWF0aWsgw6fEsWvEscWfIGnDp2luKQogICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgic1Nwb3J0U2Vzc2lvbkRheSIsIG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zbGljZSgwLCAxMCkpOwogICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgic1Nwb3J0TG9naW5BdCIsIFN0cmluZyhEYXRlLm5vdygpKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBzYXZlZFJvbGUgPSBkYXRhLnJvbGU7CiAgICAgICAgICAgIGlmIChkYXRhLmZvcmNlQ2hhbmdlID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgICBTd2FsLmZpcmUoewogICAgICAgICAgICAgICAgICAgIGljb246ICd3YXJuaW5nJywgdGl0bGU6ICcg4pqg77iPICBHw7x2ZW5saWsgVXlhcsSxc8SxJywKICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnxLBsayBnaXJpxZ9pbml6LiBMw7x0ZmVuIMWfaWZyZW5pemkgZGXEn2nFn3RpcmluLicsCiAgICAgICAgICAgICAgICAgICAgYWxsb3dPdXRzaWRlQ2xpY2s6IGZhbHNlLCBhbGxvd0VzY2FwZUtleTogZmFsc2UsIGNvbmZpcm1CdXR0b25UZXh0OiAnxZ5pZnJlbWkgRGXEn2nFn3RpcicKICAgICAgICAgICAgICAgIH0pLnRoZW4oKCkgPT4geyBjaGFuZ2VQYXNzd29yZFBvcHVwKHRydWUpOyB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsb2dpbi1zY3JlZW4iKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVzZXItZGlzcGxheSIpLmlubmVyVGV4dCA9IGN1cnJlbnRVc2VyOwogICAgICAgICAgICAgICAgc2V0SG9tZVdlbGNvbWVVc2VyKGN1cnJlbnRVc2VyKTsKICAgICAgICAgICAgICAgIGNvbnN0IHNhdmVkR3JvdXAgPSBkYXRhLmdyb3VwIHx8IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdzU3BvcnRHcm91cCcpIHx8ICcnOwogICAgICAgICAgICAgICAgY2hlY2tBZG1pbihzYXZlZFJvbGUpOwogICAgICAgICAgICAgICAgc3RhcnRTZXNzaW9uVGltZXIoKTsKICAgICAgICAgICAgICAgIC8vIE1lbsO8IHlldGtpbGVyaW5pIHZlIGFuYSBzYXlmYSBibG9rbGFyxLFuxLEgbG9naW4gc29ucmFzxLEgecO8a2xlCiAgICAgICAgICAgICAgICB0cnl7IGxvYWRNZW51UGVybWlzc2lvbnMoKTsgfWNhdGNoKGUpe30KICAgICAgICAgICAgICAgIHRyeXsgbG9hZEhvbWVCbG9ja3MoKTsgfWNhdGNoKGUpe30KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKEJBS0lNX01PRFUpIHsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibWFpbnRlbmFuY2Utc2NyZWVuIikuc3R5bGUuZGlzcGxheSA9ICJmbGV4IjsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1haW4tYXBwIikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CiAgICAgICAgICAgICAgICAgICAgbG9hZENvbnRlbnREYXRhKCk7CiAgICAgICAgICAgICAgICAgICAgbG9hZFdpemFyZERhdGEoKTsKICAgICAgICAgICAgICAgICAgICBsb2FkVGVjaFdpemFyZERhdGEoKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiAoc2F2ZWRSb2xlID09PSAncXVzZXJzJykgeyAKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZ3JpZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYXJkR3JpZCcpOyBpZiAoZ3JpZCkgZ3JpZC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjb250cm9scyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jb250cm9sLXdyYXBwZXInKTsgaWYgKGNvbnRyb2xzKSBjb250cm9scy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0aWNrZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubmV3cy10aWNrZXItYm94Jyk7IGlmICh0aWNrZXIpIHRpY2tlci5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICAgICAgICAgICAgICBvcGVuUXVhbGl0eUFyZWEoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBlcnJvck1zZy5pbm5lclRleHQgPSBkYXRhLm1lc3NhZ2UgfHwgIkhhdGFsxLEgZ2lyacWfISI7CiAgICAgICAgICAgIGVycm9yTXNnLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwogICAgICAgIH0KICAgIH0pLmNhdGNoKGVycm9yID0+IHsKICAgICAgICBsb2FkaW5nTXNnLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmxvZ2luLWJ0bicpLmRpc2FibGVkID0gZmFsc2U7CiAgICAgICAgZXJyb3JNc2cuaW5uZXJUZXh0ID0gIlN1bnVjdSBoYXRhc8SxISBMw7x0ZmVuIHNheWZhecSxIHllbmlsZXlpbi4iOwogICAgICAgIGVycm9yTXNnLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwogICAgfSk7Cn0KZnVuY3Rpb24gY2hlY2tBZG1pbihyb2xlKSB7CiAgICBjb25zdCBhZGRDYXJkRHJvcGRvd24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHJvcGRvd25BZGRDYXJkJyk7CiAgICBjb25zdCBxdWlja0VkaXREcm9wZG93biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkcm9wZG93blF1aWNrRWRpdCcpOwogICAgCiAgICBpc0FkbWluTW9kZSA9IChyb2xlID09PSAiYWRtaW4iIHx8IHJvbGUgPT09ICJsb2NhZG1pbiIpOwogICAgaXNMb2NBZG1pbiA9IChyb2xlID09PSAibG9jYWRtaW4iKTsKICAgIGlzRWRpdGluZ0FjdGl2ZSA9IGZhbHNlOwogICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QucmVtb3ZlKCdlZGl0aW5nJyk7CiAgICAKICAgIGNvbnN0IGlzUXVhbGl0eVVzZXIgPSAocm9sZSA9PT0gJ3F1c2VycycpOwogICAgY29uc3QgZmlsdGVyQnV0dG9ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5maWx0ZXItYnRuOm5vdCguYnRuLWZhdiknKTsgCiAgICAKICAgIGlmIChpc1F1YWxpdHlVc2VyKSB7CiAgICAgICAgZmlsdGVyQnV0dG9ucy5mb3JFYWNoKGJ0biA9PiB7CiAgICAgICAgICAgIGlmIChidG4uaW5uZXJUZXh0LmluZGV4T2YoJ0thbGl0ZScpID09PSAtMSkgewogICAgICAgICAgICAgICAgYnRuLnN0eWxlLm9wYWNpdHkgPSAnMC41JzsKICAgICAgICAgICAgICAgIGJ0bi5zdHlsZS5wb2ludGVyRXZlbnRzID0gJ25vbmUnOwogICAgICAgICAgICAgICAgYnRuLnN0eWxlLmZpbHRlciA9ICdncmF5c2NhbGUoMTAwJSknOwogICAgICAgICAgICB9IGVsc2UgeyBidG4uc3R5bGUuZmlsdGVyID0gJ25vbmUnOyB9CiAgICAgICAgfSk7CiAgICAgICAgY29uc3Qgc2VhcmNoSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VhcmNoSW5wdXQnKTsKICAgICAgICBpZiAoc2VhcmNoSW5wdXQpIHsgc2VhcmNoSW5wdXQuZGlzYWJsZWQgPSB0cnVlOyBzZWFyY2hJbnB1dC5wbGFjZWhvbGRlciA9ICJBcmFtYSBkZXZyZSBkxLHFn8SxIChLYWxpdGUgTW9kdSkiOyBzZWFyY2hJbnB1dC5zdHlsZS5vcGFjaXR5ID0gJzAuNic7IH0KICAgIH0gZWxzZSB7CiAgICAgICAgZmlsdGVyQnV0dG9ucy5mb3JFYWNoKGJ0biA9PiB7CiAgICAgICAgICAgIGJ0bi5zdHlsZS5vcGFjaXR5ID0gJzEnOwogICAgICAgICAgICBidG4uc3R5bGUucG9pbnRlckV2ZW50cyA9ICdhdXRvJzsKICAgICAgICAgICAgYnRuLnN0eWxlLmZpbHRlciA9ICdub25lJzsKICAgICAgICB9KTsKICAgICAgICBjb25zdCBzZWFyY2hJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZWFyY2hJbnB1dCcpOwogICAgICAgIGlmIChzZWFyY2hJbnB1dCkgeyBzZWFyY2hJbnB1dC5kaXNhYmxlZCA9IGZhbHNlOyBzZWFyY2hJbnB1dC5wbGFjZWhvbGRlciA9ICLEsMOnZXJpa2xlcmRlIGjEsXpsxLEgYXJhLi4uIjsgc2VhcmNoSW5wdXQuc3R5bGUub3BhY2l0eSA9ICcxJzsgfQogICAgfQogICAgCiAgICBpZihpc0FkbWluTW9kZSkgewogICAgICAgIGlmKGFkZENhcmREcm9wZG93bikgYWRkQ2FyZERyb3Bkb3duLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7CiAgICAgICAgaWYocXVpY2tFZGl0RHJvcGRvd24pIHsKICAgICAgICAgICAgcXVpY2tFZGl0RHJvcGRvd24uc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsKICAgICAgICAgICAgLy8gxLBzdGVrOiBZZXRraSBZw7ZuZXRpbWkgc2FkZWNlIExvY0FkbWluIHJvbMO8bmRlIGfDtnLDvG5zw7xuCiAgICAgICAgICAgIGNvbnN0IHBlcm1zID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Ryb3Bkb3duUGVybXMnKTsKICAgICAgICAgICAgaWYocGVybXMpIHBlcm1zLnN0eWxlLmRpc3BsYXkgPSAoaXNMb2NBZG1pbiA/ICdmbGV4JyA6ICdub25lJyk7CiAgICAgICAgICAgIHF1aWNrRWRpdERyb3Bkb3duLmlubmVySFRNTCA9ICc8aSBjbGFzcz0iZmFzIGZhLXBlbiIgc3R5bGU9ImNvbG9yOnZhcigtLXNlY29uZGFyeSk7Ij48L2k+IETDvHplbmxlbWV5aSBBw6cnOwogICAgICAgICAgICBxdWlja0VkaXREcm9wZG93bi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICB9CiAgICB9IGVsc2UgewogICAgICAgIGlmKGFkZENhcmREcm9wZG93bikgYWRkQ2FyZERyb3Bkb3duLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgaWYocXVpY2tFZGl0RHJvcGRvd24pIHF1aWNrRWRpdERyb3Bkb3duLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgY29uc3QgcGVybXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHJvcGRvd25QZXJtcycpOwogICAgICAgIGlmKHBlcm1zKSBwZXJtcy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgfQp9CmZ1bmN0aW9uIGxvZ291dCgpIHsKICAgIGN1cnJlbnRVc2VyID0gIiI7IGlzQWRtaW5Nb2RlID0gZmFsc2U7IGlzRWRpdGluZ0FjdGl2ZSA9IGZhbHNlOwogICAgdHJ5eyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidXNlci1kaXNwbGF5IikuaW5uZXJUZXh0ID0gIk1pc2FmaXIiOyB9Y2F0Y2goZSl7fQogICAgc2V0SG9tZVdlbGNvbWVVc2VyKCJNaXNhZmlyIik7CiAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5yZW1vdmUoJ2VkaXRpbmcnKTsKICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCJzU3BvcnRVc2VyIik7IGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCJzU3BvcnRUb2tlbiIpOyBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgic1Nwb3J0Um9sZSIpOyBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgic1Nwb3J0R3JvdXAiKTsgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oInNTcG9ydFNlc3Npb25EYXkiKTsgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oInNTcG9ydExvZ2luQXQiKTsKICAgIGlmIChzZXNzaW9uVGltZW91dCkgY2xlYXJUaW1lb3V0KHNlc3Npb25UaW1lb3V0KTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtYWluLWFwcCIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibG9naW4tc2NyZWVuIikuc3R5bGUuZGlzcGxheSA9ICJmbGV4IjsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwYXNzSW5wdXQiKS52YWx1ZSA9ICIiOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVzZXJuYW1lSW5wdXQiKS52YWx1ZSA9ICIiOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVycm9yLW1zZyIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAKICAgIC8vIEZ1bGxzY3JlZW4naSBrYXBhdAogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1YWxpdHktZnVsbHNjcmVlbicpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICB0cnl7IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0ZWNoLWZ1bGxzY3JlZW4nKS5zdHlsZS5kaXNwbGF5PSdub25lJzsgfWNhdGNoKGUpe30KICAgIHRyeXsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RlbGVzYWxlcy1mdWxsc2NyZWVuJykuc3R5bGUuZGlzcGxheT0nbm9uZSc7IH1jYXRjaChlKXt9Cn0KZnVuY3Rpb24gc3RhcnRTZXNzaW9uVGltZXIoKSB7CiAgICBpZiAoc2Vzc2lvblRpbWVvdXQpIGNsZWFyVGltZW91dChzZXNzaW9uVGltZW91dCk7CiAgICAvLyA4IHNhYXQgKDI4ODAwMDAwIG1zKQogICAgc2Vzc2lvblRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICBTd2FsLmZpcmUoeyBpY29uOiAnd2FybmluZycsIHRpdGxlOiAnT3R1cnVtIFPDvHJlc2kgRG9sZHUnLCB0ZXh0OiAnR8O8dmVubGlrIG5lZGVuaXlsZSBvdG9tYXRpayDDp8Sxa8SxxZ8geWFwxLFsZMSxLicsIGNvbmZpcm1CdXR0b25UZXh0OiAnVGFtYW0nIH0pLnRoZW4oKCkgPT4geyBsb2dvdXQoKTsgfSk7CiAgICB9LCAgMjg4MDAwMDApOyAKfQpmdW5jdGlvbiBvcGVuVXNlck1lbnUoKSB7IHRvZ2dsZVVzZXJEcm9wZG93bigpOyB9CmFzeW5jIGZ1bmN0aW9uIGNoYW5nZVBhc3N3b3JkUG9wdXAoaXNNYW5kYXRvcnkgPSBmYWxzZSkgewogICAgY29uc3QgeyB2YWx1ZTogZm9ybVZhbHVlcyB9ID0gYXdhaXQgU3dhbC5maXJlKHsKICAgICAgICB0aXRsZTogaXNNYW5kYXRvcnkgPyAnWWVuaSDFnmlmcmUgQmVsaXJsZXlpbicgOiAnxZ5pZnJlIERlxJ9pxZ90aXInLAogICAgICAgIGh0bWw6IGAke2lzTWFuZGF0b3J5ID8gJzxwIHN0eWxlPSJmb250LXNpemU6MC45cmVtOyBjb2xvcjojZDMyZjJmOyI+xLBsayBnaXJpxZ8gxZ9pZnJlbml6aSBkZcSfacWfdGlybWVkZW4gZGV2YW0gZWRlbWV6c2luaXouPC9wPicgOiAnJ308aW5wdXQgaWQ9InN3YWwtb2xkLXBhc3MiIHR5cGU9InBhc3N3b3JkIiBjbGFzcz0ic3dhbDItaW5wdXQiIHBsYWNlaG9sZGVyPSJFc2tpIMWeaWZyZSAoTWV2Y3V0KSI+PGlucHV0IGlkPSJzd2FsLW5ldy1wYXNzIiB0eXBlPSJwYXNzd29yZCIgY2xhc3M9InN3YWwyLWlucHV0IiBwbGFjZWhvbGRlcj0iWWVuaSDFnmlmcmUiPmAsCiAgICAgICAgZm9jdXNDb25maXJtOiBmYWxzZSwgc2hvd0NhbmNlbEJ1dHRvbjogIWlzTWFuZGF0b3J5LCBhbGxvd091dHNpZGVDbGljazogIWlzTWFuZGF0b3J5LCBhbGxvd0VzY2FwZUtleTogIWlzTWFuZGF0b3J5LAogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAnRGXEn2nFn3RpcicsIGNhbmNlbEJ1dHRvblRleHQ6ICfEsHB0YWwnLAogICAgICAgIHByZUNvbmZpcm06ICgpID0+IHsKICAgICAgICAgICAgY29uc3QgbyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLW9sZC1wYXNzJykudmFsdWU7CiAgICAgICAgICAgIGNvbnN0IG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC1uZXctcGFzcycpLnZhbHVlOwogICAgICAgICAgICBpZighbyB8fCAhbikgeyBTd2FsLnNob3dWYWxpZGF0aW9uTWVzc2FnZSgnQWxhbmxhciBib8WfIGLEsXJha8SxbGFtYXonKTsgfQogICAgICAgICAgICByZXR1cm4gWyBvLCBuIF0KICAgICAgICB9CiAgICB9KTsKICAgIGlmIChmb3JtVmFsdWVzKSB7CiAgICAgICAgU3dhbC5maXJlKHsgdGl0bGU6ICfEsMWfbGVuaXlvci4uLicsIGRpZE9wZW46ICgpID0+IHsgU3dhbC5zaG93TG9hZGluZygpIH0gfSk7CiAgICAgICAgZmV0Y2goU0NSSVBUX1VSTCwgewogICAgICAgICAgICBtZXRob2Q6ICdQT1NUJywKICAgICAgICAgICAgaGVhZGVyczogeyAiQ29udGVudC1UeXBlIjogInRleHQvcGxhaW47Y2hhcnNldD11dGYtOCIgfSwKICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoewogICAgICAgICAgICAgICAgYWN0aW9uOiAiY2hhbmdlUGFzc3dvcmQiLCB1c2VybmFtZTogY3VycmVudFVzZXIsCiAgICAgICAgICAgICAgICBvbGRQYXNzOiBDcnlwdG9KUy5TSEEyNTYoZm9ybVZhbHVlc1swXSkudG9TdHJpbmcoKSwKICAgICAgICAgICAgICAgIG5ld1Bhc3M6IENyeXB0b0pTLlNIQTI1Nihmb3JtVmFsdWVzWzFdKS50b1N0cmluZygpLAogICAgICAgICAgICAgICAgdG9rZW46IGdldFRva2VuKCkKICAgICAgICAgICAgfSkKICAgICAgICB9KS50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLmpzb24oKSkudGhlbihkYXRhID0+IHsKICAgICAgICAgICAgaWYoZGF0YS5yZXN1bHQgPT09ICJzdWNjZXNzIikgewogICAgICAgICAgICAgICAgU3dhbC5maXJlKCdCYcWfYXLEsWzEsSEnLCAnxZ5pZnJlbml6IGfDvG5jZWxsZW5kaS4gWWVuaWRlbiBnaXJpxZ8geWFwxLFuxLF6LicsICdzdWNjZXNzJykudGhlbigoKSA9PiB7IGxvZ291dCgpOyB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIFN3YWwuZmlyZSgnSGF0YScsIGRhdGEubWVzc2FnZSB8fCAnxLDFn2xlbSBiYcWfYXLEsXPEsXouJywgJ2Vycm9yJykudGhlbigoKSA9PiB7IGlmKGlzTWFuZGF0b3J5KSBjaGFuZ2VQYXNzd29yZFBvcHVwKHRydWUpOyB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0pLmNhdGNoKGVyciA9PiB7IFN3YWwuZmlyZSgnSGF0YScsICdTdW51Y3UgaGF0YXPEsS4nLCAnZXJyb3InKTsgaWYoaXNNYW5kYXRvcnkpIGNoYW5nZVBhc3N3b3JkUG9wdXAodHJ1ZSk7IH0pOwogICAgfSBlbHNlIGlmIChpc01hbmRhdG9yeSkgeyBjaGFuZ2VQYXNzd29yZFBvcHVwKHRydWUpOyB9Cn0KLy8gLS0tIERBVEEgRkVUQ0hJTkcgLS0tCmZ1bmN0aW9uIGxvYWRDb250ZW50RGF0YSgpIHsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nJykuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICBmZXRjaChTQ1JJUFRfVVJMLCB7CiAgICAgICAgbWV0aG9kOiAnUE9TVCcsCiAgICAgICAgaGVhZGVyczogeyAiQ29udGVudC1UeXBlIjogInRleHQvcGxhaW47Y2hhcnNldD11dGYtOCIgfSwKICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGFjdGlvbjogImZldGNoRGF0YSIgfSkKICAgIH0pLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuanNvbigpKS50aGVuKGRhdGEgPT4gewogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICBpZiAoZGF0YS5yZXN1bHQgPT09ICJzdWNjZXNzIikgewogICAgICAgICAgICBjb25zdCByYXdEYXRhID0gZGF0YS5kYXRhOwogICAgICAgICAgICBkYXRhYmFzZSA9IHJhd0RhdGEuZmlsdGVyKGkgPT4gWydjYXJkJywnYmlsZ2knLCd0ZWtuaWsnLCdrYW1wYW55YScsJ2lrbmEnXS5pbmNsdWRlcyhpLlR5cGUudG9Mb3dlckNhc2UoKSkpLm1hcChpID0+ICh7CiAgICAgICAgICAgICAgICB0aXRsZTogaS5UaXRsZSwgY2F0ZWdvcnk6IGkuQ2F0ZWdvcnksIHRleHQ6IGkuVGV4dCwgc2NyaXB0OiBpLlNjcmlwdCwgY29kZTogaS5Db2RlLCBsaW5rOiBpLkxpbmssIGRhdGU6IGZvcm1hdERhdGVUb0RETU1ZWVlZKGkuRGF0ZSkKICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAvLyBZZW5pIGVrbGVuZW5sZXJpIMO8c3R0ZSBnw7ZzdGVybWVrIGnDp2luIHRhcmloZSBnw7ZyZSAoYXphbGFuKSBzxLFyYWxhCiAgICAgICAgICAgIGRhdGFiYXNlLnNvcnQoKGEsYikgPT4gcGFyc2VEYXRlVFJUb1RTKGIuZGF0ZSkgLSBwYXJzZURhdGVUUlRvVFMoYS5kYXRlKSk7CiAgICAgICAgICAgIG5ld3NEYXRhID0gcmF3RGF0YS5maWx0ZXIoaSA9PiBpLlR5cGUudG9Mb3dlckNhc2UoKSA9PT0gJ25ld3MnKS5tYXAoaSA9PiAoewogICAgICAgICAgICAgICAgZGF0ZTogZm9ybWF0RGF0ZVRvRERNTVlZWVkoaS5EYXRlKSwgdGl0bGU6IGkuVGl0bGUsIGRlc2M6IGkuVGV4dCwgdHlwZTogaS5DYXRlZ29yeSwgc3RhdHVzOiBpLlN0YXR1cwogICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIHNwb3J0c0RhdGEgPSByYXdEYXRhLmZpbHRlcihpID0+IGkuVHlwZS50b0xvd2VyQ2FzZSgpID09PSAnc3BvcnQnKS5tYXAoaSA9PiAoewogICAgICAgICAgICAgICAgdGl0bGU6IGkuVGl0bGUsIGljb246IGkuSWNvbiwgZGVzYzogaS5UZXh0LCB0aXA6IGkuVGlwLCBkZXRhaWw6IGkuRGV0YWlsLCBwcm9udW5jaWF0aW9uOiBpLlByb251bmNpYXRpb24KICAgICAgICAgICAgfSkpOwogICAgICAgICAgICB0cnl7IGFwcGx5U3BvcnRzUmlnaHRzKCk7IH1jYXRjaChlKXt9CgogICAgICAgICAgICBzYWxlc1NjcmlwdHMgPSByYXdEYXRhLmZpbHRlcihpID0+IGkuVHlwZS50b0xvd2VyQ2FzZSgpID09PSAnc2FsZXMnKS5tYXAoaSA9PiAoeyB0aXRsZTogaS5UaXRsZSwgdGV4dDogaS5UZXh0IH0pKTsKICAgICAgICAgICAgcXVpelF1ZXN0aW9ucyA9IHJhd0RhdGEuZmlsdGVyKGkgPT4gaS5UeXBlLnRvTG93ZXJDYXNlKCkgPT09ICdxdWl6JykubWFwKGkgPT4gKHsKICAgICAgICAgICAgICAgIHE6IGkuVGV4dCwgb3B0czogaS5RdWl6T3B0aW9ucyA/IGkuUXVpek9wdGlvbnMuc3BsaXQoJywnKS5tYXAobyA9PiBvLnRyaW0oKSkgOiBbXSwgYTogcGFyc2VJbnQoaS5RdWl6QW5zd2VyKQogICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIC8vIEjEsXpsxLEgS2FyYXIgc29ydWxhcsSxIChHb29nbGUgU2hlZXQndGVuKTogVHlwZSA9IHF1aWNrZGVjaXNpb24KICAgICAgICAgICAgLy8gQmVrbGVuZW46IFRleHQgfCBRdWl6T3B0aW9ucyAofCBpbGUgYXlyxLFsbcSxxZ8pIHwgUXVpekFuc3dlciAoMC1iYXNlZCBpbmRleCkgfCBEZXRhaWwgKG9wc2l5b25lbCkKICAgICAgICAgICAgcXVpY2tEZWNpc2lvblF1ZXN0aW9ucyA9IHJhd0RhdGEKICAgICAgICAgICAgICAgIC5maWx0ZXIoaSA9PiAoaS5UeXBlIHx8ICcnKS50b0xvd2VyQ2FzZSgpID09PSAncXVpY2tkZWNpc2lvbicpCiAgICAgICAgICAgICAgICAubWFwKGkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IG9wdHMgPSBTdHJpbmcoaS5RdWl6T3B0aW9ucyB8fCAnJykuc3BsaXQoJ3wnKS5tYXAoeCA9PiB4LnRyaW0oKSkuZmlsdGVyKEJvb2xlYW4pOwogICAgICAgICAgICAgICAgICAgIGxldCBhID0gcGFyc2VJbnQoaS5RdWl6QW5zd2VyLCAxMCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTmFOKGEpKSBhID0gMDsKICAgICAgICAgICAgICAgICAgICBpZiAoYSA8IDApIGEgPSAwOwogICAgICAgICAgICAgICAgICAgIGlmIChvcHRzLmxlbmd0aCAmJiBhID49IG9wdHMubGVuZ3RoKSBhID0gb3B0cy5sZW5ndGggLSAxOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGV4cCA9IChpLkRldGFpbCB8fCAnJykudG9TdHJpbmcoKS50cmltKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgcTogKGkuVGV4dCB8fCAnJykudG9TdHJpbmcoKS50cmltKCksIG9wdHMsIGEsIGV4cCB9OwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC5maWx0ZXIoeCA9PiB4LnEgJiYgQXJyYXkuaXNBcnJheSh4Lm9wdHMpICYmIHgub3B0cy5sZW5ndGggPj0gMik7CgogICAgICAgICAgICAKICAgICAgICAgICAgaWYoY3VycmVudENhdGVnb3J5ID09PSAnZmF2JykgeyBmaWx0ZXJDYXRlZ29yeShkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYnRuLWZhdicpLCAnZmF2Jyk7IH0gCiAgICAgICAgICAgIGVsc2UgeyBhY3RpdmVDYXJkcyA9IGRhdGFiYXNlOyBpZihjdXJyZW50Q2F0ZWdvcnk9PT0naG9tZScpeyBzaG93SG9tZVNjcmVlbigpOyB9IGVsc2UgeyBoaWRlSG9tZVNjcmVlbigpOyByZW5kZXJDYXJkcyhkYXRhYmFzZSk7IH0gfQogICAgICAgICAgICBzdGFydFRpY2tlcigpOwogICAgICAgICAgICB0cnkgeyB1cGRhdGVTZWFyY2hSZXN1bHRDb3VudChhY3RpdmVDYXJkcy5sZW5ndGggfHwgZGF0YWJhc2UubGVuZ3RoLCBkYXRhYmFzZS5sZW5ndGgpOyB9IGNhdGNoKGUpIHt9CiAgICAgICAgfSBlbHNlIHsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRpbmcnKS5pbm5lckhUTUwgPSBgVmVyaWxlciBhbMSxbmFtYWTEsTogJHtkYXRhLm1lc3NhZ2UgfHwgJ0JpbGlubWV5ZW4gSGF0YSd9YDsgfQogICAgfSkuY2F0Y2goZXJyb3IgPT4geyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZycpLmlubmVySFRNTCA9ICdCYcSfbGFudMSxIEhhdGFzxLEhIFN1bnVjdXlhIHVsYcWfxLFsYW3EsXlvci4nOyB9KS5maW5hbGx5KCgpPT57IHRyeXsgX19kYXRhTG9hZGVkUmVzb2x2ZSAmJiBfX2RhdGFMb2FkZWRSZXNvbHZlKCk7IH1jYXRjaChlKXt9IH0pOwogICAgICAgICAgICBjYXJkc0RhdGEgPSBkYXRhYmFzZTsgLy8gZ2VyaXllIGTDtm7DvGsgdXl1bWx1bHVrCgp9CmZ1bmN0aW9uIGxvYWRXaXphcmREYXRhKCkgewogICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgICBmZXRjaChTQ1JJUFRfVVJMLCB7CiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLCBoZWFkZXJzOiB7ICJDb250ZW50LVR5cGUiOiAidGV4dC9wbGFpbjtjaGFyc2V0PXV0Zi04IiB9LAogICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGFjdGlvbjogImdldFdpemFyZERhdGEiIH0pCiAgICAgICAgfSkudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkpLnRoZW4oZGF0YSA9PiB7CiAgICAgICAgICAgIGlmIChkYXRhLnJlc3VsdCA9PT0gInN1Y2Nlc3MiICYmIGRhdGEuc3RlcHMpIHsgd2l6YXJkU3RlcHNEYXRhID0gZGF0YS5zdGVwczsgcmVzb2x2ZSgpOyB9IAogICAgICAgICAgICBlbHNlIHsgd2l6YXJkU3RlcHNEYXRhID0ge307IHJlamVjdChuZXcgRXJyb3IoIldpemFyZCB2ZXJpc2kgecO8a2xlbmVtZWRpLiIpKTsgfQogICAgICAgIH0pLmNhdGNoKGVycm9yID0+IHsgd2l6YXJkU3RlcHNEYXRhID0ge307IHJlamVjdChlcnJvcik7IH0pOwogICAgfSk7Cn0KZnVuY3Rpb24gbG9hZFRlY2hXaXphcmREYXRhKCkgewogICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgICBmZXRjaChTQ1JJUFRfVVJMLCB7CiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLCBoZWFkZXJzOiB7ICJDb250ZW50LVR5cGUiOiAidGV4dC9wbGFpbjtjaGFyc2V0PXV0Zi04IiB9LAogICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGFjdGlvbjogImdldFRlY2hXaXphcmREYXRhIiB9KQogICAgICAgIH0pLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuanNvbigpKS50aGVuKGRhdGEgPT4gewogICAgICAgICAgICBpZiAoZGF0YS5yZXN1bHQgPT09ICJzdWNjZXNzIiAmJiBkYXRhLnN0ZXBzKSB7IHRlY2hXaXphcmREYXRhID0gZGF0YS5zdGVwczsgcmVzb2x2ZSgpOyB9IAogICAgICAgICAgICBlbHNlIHsgdGVjaFdpemFyZERhdGEgPSB7fTsgfQogICAgICAgIH0pLmNhdGNoKGVycm9yID0+IHsgdGVjaFdpemFyZERhdGEgPSB7fTsgfSk7CiAgICB9KTsKfQovLyAtLS0gUkVOREVSICYgRklMVEVSSU5HIC0tLQpmdW5jdGlvbiByZW5kZXJDYXJkcyhkYXRhKSB7CiAgICB0cnkgewogICAgICAgIGFjdGl2ZUNhcmRzID0gZGF0YTsKICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FyZEdyaWQnKTsKICAgICAgICBpZiAoIWNvbnRhaW5lcikgewogICAgICAgICAgICBpZiAodHlwZW9mIGNvbnNvbGUgIT09ICd1bmRlZmluZWQnKSBjb25zb2xlLmVycm9yKCdjYXJkR3JpZCBidWx1bmFtYWTEsScpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSAnJzsKCiAgICAKICAgIGlmIChkYXRhLmxlbmd0aCA9PT0gMCkgeyBjb250YWluZXIuaW5uZXJIVE1MID0gJzxkaXYgc3R5bGU9ImdyaWQtY29sdW1uOjEvLTE7IHRleHQtYWxpZ246Y2VudGVyOyBwYWRkaW5nOjIwcHg7IGNvbG9yOiM3Nzc7Ij5LYXnEsXQgYnVsdW5hbWFkxLEuPC9kaXY+JzsgcmV0dXJuOyB9CiAgICBkYXRhLmZvckVhY2goKGl0ZW0sIGluZGV4KSA9PiB7CiAgICAgICAgY29uc3Qgc2FmZVRpdGxlID0gZXNjYXBlRm9ySnNTdHJpbmcoaXRlbS50aXRsZSk7CiAgICAgICAgY29uc3QgaXNGYXZvcml0ZSA9IGlzRmF2KGl0ZW0udGl0bGUpOwogICAgICAgIGNvbnN0IGZhdkNsYXNzID0gaXNGYXZvcml0ZSA/ICdmYXMgZmEtc3RhciBhY3RpdmUnIDogJ2ZhciBmYS1zdGFyJzsKICAgICAgICBjb25zdCBuZXdCYWRnZSA9IGlzTmV3KGl0ZW0uZGF0ZSkgPyAnPHNwYW4gY2xhc3M9Im5ldy1iYWRnZSI+WUVOxLA8L3NwYW4+JyA6ICcnOwogICAgICAgIGNvbnN0IGVkaXRJY29uSHRtbCA9IChpc0FkbWluTW9kZSAmJiBpc0VkaXRpbmdBY3RpdmUpID8gYDxpIGNsYXNzPSJmYXMgZmEtcGVuY2lsLWFsdCBlZGl0LWljb24iIG9uY2xpY2s9ImVkaXRDb250ZW50KCR7aW5kZXh9KSIgc3R5bGU9ImRpc3BsYXk6YmxvY2s7Ij48L2k+YCA6ICcnOwogICAgICAgIGxldCBmb3JtYXR0ZWRUZXh0ID0gKGl0ZW0udGV4dCB8fCAiIikucmVwbGFjZSgvXG4vZywgJzxicj4nKS5yZXBsYWNlKC9cKiguKj8pXCovZywgJzxiPiQxPC9iPicpOwogICAgICAgIAogICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgKz0gYDxkaXYgY2xhc3M9ImNhcmQgJHtpdGVtLmNhdGVnb3J5fSI+JHtuZXdCYWRnZX0KICAgICAgICAgICAgPGRpdiBjbGFzcz0iaWNvbi13cmFwcGVyIj4ke2VkaXRJY29uSHRtbH08aSBjbGFzcz0iJHtmYXZDbGFzc30gZmF2LWljb24iIG9uY2xpY2s9InRvZ2dsZUZhdm9yaXRlKCcke3NhZmVUaXRsZX0nKSI+PC9pPjwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJjYXJkLWhlYWRlciI+PGgzIGNsYXNzPSJjYXJkLXRpdGxlIj4ke2hpZ2hsaWdodFRleHQoaXRlbS50aXRsZSl9PC9oMz48c3BhbiBjbGFzcz0iYmFkZ2UiPiR7aXRlbS5jYXRlZ29yeX08L3NwYW4+PC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNhcmQtY29udGVudCIgb25jbGljaz0ic2hvd0NhcmREZXRhaWwoJyR7c2FmZVRpdGxlfScsICcke2VzY2FwZUZvckpzU3RyaW5nKGl0ZW0udGV4dCl9JykiPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2FyZC10ZXh0LXRydW5jYXRlIj4ke2hpZ2hsaWdodFRleHQoZm9ybWF0dGVkVGV4dCl9PC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJmb250LXNpemU6MC44cmVtOyBjb2xvcjojOTk5OyBtYXJnaW4tdG9wOjVweDsgdGV4dC1hbGlnbjpyaWdodDsiPihUYW1hbcSxbsSxIG9rdSk8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InNjcmlwdC1ib3giPiR7aGlnaGxpZ2h0VGV4dChpdGVtLnNjcmlwdCl9PC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNhcmQtYWN0aW9ucyI+CiAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4gYnRuLWNvcHkiIG9uY2xpY2s9ImNvcHlUZXh0KCcke2VzY2FwZUZvckpzU3RyaW5nKGl0ZW0uc2NyaXB0KX0nKSI+PGkgY2xhc3M9ImZhcyBmYS1jb3B5Ij48L2k+IEtvcHlhbGE8L2J1dHRvbj4KICAgICAgICAgICAgICAgICR7aXRlbS5jb2RlID8gYDxidXR0b24gY2xhc3M9ImJ0biBidG4tY29weSIgc3R5bGU9ImJhY2tncm91bmQ6dmFyKC0tc2Vjb25kYXJ5KTsgY29sb3I6IzMzMzsiIG9uY2xpY2s9ImNvcHlUZXh0KCcke2VzY2FwZUZvckpzU3RyaW5nKGl0ZW0uY29kZSl9JykiPktvZDwvYnV0dG9uPmAgOiAnJ30KICAgICAgICAgICAgICAgICR7aXRlbS5saW5rID8gYDxhIGhyZWY9IiR7aXRlbS5saW5rfSIgdGFyZ2V0PSJfYmxhbmsiIGNsYXNzPSJidG4gYnRuLWxpbmsiPjxpIGNsYXNzPSJmYXMgZmEtZXh0ZXJuYWwtbGluay1hbHQiPjwvaT4gTGluazwvYT5gIDogJyd9CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PmA7CiAgICB9KTsKCiAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKHR5cGVvZiBzaG93R2xvYmFsRXJyb3IgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgICAgIHNob3dHbG9iYWxFcnJvcignS2FydGxhciB5w7xrbGVuZW1lZGk6ICcgKyAoZSAmJiBlLm1lc3NhZ2UgPyBlLm1lc3NhZ2UgOiBTdHJpbmcoZSkpKTsKICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKF8pIHt9CiAgICAgICAgaWYgKHR5cGVvZiBjb25zb2xlICE9PSAndW5kZWZpbmVkJykgY29uc29sZS5lcnJvcignW3JlbmRlckNhcmRzXScsIGUpOwogICAgfQp9CmZ1bmN0aW9uIGhpZ2hsaWdodFRleHQoaHRtbENvbnRlbnQpIHsKICAgIGlmICghaHRtbENvbnRlbnQpIHJldHVybiAiIjsKICAgIGNvbnN0IHNlYXJjaFRlcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VhcmNoSW5wdXQnKS52YWx1ZS50b0xvY2FsZUxvd2VyQ2FzZSgndHItVFInKS50cmltKCk7CiAgICBpZiAoIXNlYXJjaFRlcm0pIHJldHVybiBodG1sQ29udGVudDsKICAgIHRyeSB7IGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChgKCR7c2VhcmNoVGVybX0pYCwgImdpIik7IHJldHVybiBodG1sQ29udGVudC50b1N0cmluZygpLnJlcGxhY2UocmVnZXgsICc8c3BhbiBjbGFzcz0iaGlnaGxpZ2h0Ij4kMTwvc3Bhbj4nKTsgfSBjYXRjaChlKSB7IHJldHVybiBodG1sQ29udGVudDsgfQp9CgpmdW5jdGlvbiB1cGRhdGVTZWFyY2hSZXN1bHRDb3VudChjb3VudCwgdG90YWwpIHsKICAgIGNvbnN0IGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlYXJjaFJlc3VsdENvdW50Jyk7CiAgICBpZighZWwpIHJldHVybjsKICAgIC8vIHNhZGVjZSBhcmFtYSB5YXrEsWxkxLHEn8SxbmRhIHZleWEgZmlsdHJlIGZhdi90ZWtpbCBzZcOnaWxkacSfaW5kZSBnw7ZzdGVyCiAgICBjb25zdCBzZWFyY2ggPSAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlYXJjaElucHV0Jyk/LnZhbHVlIHx8ICcnKS50cmltKCk7CiAgICBjb25zdCBzaG93ID0gISFzZWFyY2ggfHwgKGN1cnJlbnRDYXRlZ29yeSAmJiBjdXJyZW50Q2F0ZWdvcnkgIT09ICdhbGwnKTsKICAgIGlmKCFzaG93KSB7IGVsLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7IGVsLmlubmVyVGV4dCA9ICcnOyByZXR1cm47IH0KICAgIGVsLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgZWwuaW5uZXJUZXh0ID0gYPCflI4gJHtjb3VudH0gc29udcOnJHt0b3RhbCAhPSBudWxsID8gJyAvICcgKyB0b3RhbCA6ICcnfWA7Cn0KCgoKZnVuY3Rpb24gZmlsdGVyQ2F0ZWdvcnkoYnRuLCBjYXQpIHsKICAgIC8vIEFuYSBTYXlmYSDDtnplbCBla3JhbgogICAgaWYgKGNhdCA9PT0gImhvbWUiKSB7CiAgICAgICAgY3VycmVudENhdGVnb3J5ID0gImhvbWUiOwogICAgICAgIHNldEFjdGl2ZUZpbHRlckJ1dHRvbihidG4pOwogICAgICAgIHNob3dIb21lU2NyZWVuKCk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKCiAgICAvLyBUYW0gZWtyYW4gbW9kw7xsbGVyCiAgICBjb25zdCBjYXROb3JtID0gU3RyaW5nKGNhdHx8JycpLnRvTG93ZXJDYXNlKCk7CiAgICBpZiAoY2F0Tm9ybS5pbmNsdWRlcygndGVrbmlrJykpIHsKICAgICAgICBoaWRlSG9tZVNjcmVlbigpOwogICAgICAgIG9wZW5UZWNoQXJlYSgnYnJvYWRjYXN0Jyk7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKGNhdE5vcm0uaW5jbHVkZXMoJ3RlbGVzYXQnKSkgewogICAgICAgIGhpZGVIb21lU2NyZWVuKCk7CiAgICAgICAgb3BlblRlbGVzYWxlc0FyZWEoKTsKICAgICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoY2F0Tm9ybS5pbmNsdWRlcygna2FsaXRlJykpIHsKICAgICAgICBoaWRlSG9tZVNjcmVlbigpOwogICAgICAgIC8vIGthbGl0ZSBpw6dpbiBtZXZjdXQgZGF2cmFuxLHFnzogY2FyZCBsaXN0ICh2YXJzYSkgLSBidXJhZGEgw7Z6ZWwgbW9kw7xsIHlva3NhIGRldmFtCiAgICB9CiAgICBjdXJyZW50Q2F0ZWdvcnkgPSBjYXQ7CiAgICBoaWRlSG9tZVNjcmVlbigpOwoKICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5maWx0ZXItYnRuJykuZm9yRWFjaChiID0+IGIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJykpOwogICAgYnRuLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgZmlsdGVyQ29udGVudCgpOwp9CmZ1bmN0aW9uIGZpbHRlckNvbnRlbnQoKSB7CiAgICBjb25zdCBzZWFyY2ggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VhcmNoSW5wdXQnKS52YWx1ZS50b0xvY2FsZUxvd2VyQ2FzZSgndHItVFInKS50cmltKCk7CiAgICAvLyBBbmEgc2F5ZmEgKGhvbWUpIMO2emVsIGVrcmFuOgogICAgLy8gLSBBcmFtYSBib8Wfc2EgYW5hIHNheWZhIGthcnRsYXLEsSBnw7Zyw7xuw7xyIChob21lLXNjcmVlbikKICAgIC8vIC0gQXJhbWEgeWFwxLFsxLFyc2EgYW5hIHNheWZhZGFuIMOnxLFrxLFwIGthcnRsYXIgw7x6ZXJpbmRlIGZpbHRyZSB1eWd1bGFuxLFyCiAgICBpZiAoY3VycmVudENhdGVnb3J5ID09PSAnaG9tZScpIHsKICAgICAgICBpZiAoIXNlYXJjaCkgewogICAgICAgICAgICB1cGRhdGVTZWFyY2hSZXN1bHRDb3VudChkYXRhYmFzZS5sZW5ndGgsIGRhdGFiYXNlLmxlbmd0aCk7CiAgICAgICAgICAgIHNob3dIb21lU2NyZWVuKCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgLy8gQXJhbWEgdmFyc2E6IGhvbWUgZWtyYW7EsW7EsSBnaXpsZSB2ZSB0w7xtIGthcnRsYXIgacOnaW5kZSBhcmEKICAgICAgICBoaWRlSG9tZVNjcmVlbigpOwogICAgfQoKICAgIGxldCBmaWx0ZXJlZCA9IGRhdGFiYXNlOwogICAgaWYgKGN1cnJlbnRDYXRlZ29yeSA9PT0gJ2ZhdicpIHsgZmlsdGVyZWQgPSBmaWx0ZXJlZC5maWx0ZXIoaSA9PiBpc0ZhdihpLnRpdGxlKSk7IH0KICAgIGVsc2UgaWYgKGN1cnJlbnRDYXRlZ29yeSAhPT0gJ2FsbCcgJiYgY3VycmVudENhdGVnb3J5ICE9PSAnaG9tZScpIHsgZmlsdGVyZWQgPSBmaWx0ZXJlZC5maWx0ZXIoaSA9PiBpLmNhdGVnb3J5ID09PSBjdXJyZW50Q2F0ZWdvcnkpOyB9CiAgICAKICAgIGlmIChzZWFyY2gpIHsKICAgICAgICBmaWx0ZXJlZCA9IGZpbHRlcmVkLmZpbHRlcihpdGVtID0+IHsKICAgICAgICAgICAgY29uc3QgdGl0bGUgPSAoaXRlbS50aXRsZSB8fCAiIikudG9TdHJpbmcoKS50b0xvY2FsZUxvd2VyQ2FzZSgndHItVFInKTsKICAgICAgICAgICAgY29uc3QgdGV4dCA9IChpdGVtLnRleHQgfHwgIiIpLnRvU3RyaW5nKCkudG9Mb2NhbGVMb3dlckNhc2UoJ3RyLVRSJyk7CiAgICAgICAgICAgIGNvbnN0IHNjcmlwdCA9IChpdGVtLnNjcmlwdCB8fCAiIikudG9TdHJpbmcoKS50b0xvY2FsZUxvd2VyQ2FzZSgndHItVFInKTsKICAgICAgICAgICAgY29uc3QgY29kZSA9IChpdGVtLmNvZGUgfHwgIiIpLnRvU3RyaW5nKCkudG9Mb2NhbGVMb3dlckNhc2UoJ3RyLVRSJyk7CiAgICAgICAgICAgIHJldHVybiB0aXRsZS5pbmNsdWRlcyhzZWFyY2gpIHx8IHRleHQuaW5jbHVkZXMoc2VhcmNoKSB8fCBzY3JpcHQuaW5jbHVkZXMoc2VhcmNoKSB8fCBjb2RlLmluY2x1ZGVzKHNlYXJjaCk7CiAgICAgICAgfSk7CiAgICB9CiAgICBhY3RpdmVDYXJkcyA9IGZpbHRlcmVkOwogICAgdXBkYXRlU2VhcmNoUmVzdWx0Q291bnQoZmlsdGVyZWQubGVuZ3RoLCBkYXRhYmFzZS5sZW5ndGgpOwogICAgcmVuZGVyQ2FyZHMoZmlsdGVyZWQpOwp9CmZ1bmN0aW9uIHNob3dDYXJkRGV0YWlsKHRpdGxlLCB0ZXh0KSB7CiAgICAvLyBHZXJpeWUgZMO2bsO8ayB1eXVtbHVsdWs6IHNob3dDYXJkRGV0YWlsKGNhcmRPYmopIMOnYcSfcsSxc8SxbsSxIGRhIGRlc3Rla2xlCiAgICBpZiAodGl0bGUgJiYgdHlwZW9mIHRpdGxlID09PSAnb2JqZWN0JykgewogICAgICAgIGNvbnN0IGMgPSB0aXRsZTsKICAgICAgICBjb25zdCB0ID0gYy50aXRsZSB8fCBjLm5hbWUgfHwgJ0RldGF5JzsKICAgICAgICBjb25zdCBib2R5ID0gKGMudGV4dCB8fCBjLmRlc2MgfHwgJycpLnRvU3RyaW5nKCk7CiAgICAgICAgY29uc3Qgc2NyaXB0ID0gKGMuc2NyaXB0IHx8ICcnKS50b1N0cmluZygpOwogICAgICAgIGNvbnN0IGFsZXJ0VHh0ID0gKGMuYWxlcnQgfHwgJycpLnRvU3RyaW5nKCk7CiAgICAgICAgY29uc3QgbGluayA9IChjLmxpbmsgfHwgJycpLnRvU3RyaW5nKCk7CiAgICAgICAgY29uc3QgaHRtbCA9IGAKICAgICAgICAgIDxkaXYgc3R5bGU9InRleHQtYWxpZ246bGVmdDsgZm9udC1zaXplOjFyZW07IGxpbmUtaGVpZ2h0OjEuNjsgd2hpdGUtc3BhY2U6cHJlLWxpbmU7Ij4KICAgICAgICAgICAgJHtlc2NhcGVIdG1sKGJvZHkpLnJlcGxhY2UoL1xuL2csJzxicj4nKX0KICAgICAgICAgICAgJHtsaW5rID8gYDxkaXYgc3R5bGU9Im1hcmdpbi10b3A6MTJweCI+PGEgaHJlZj0iJHtlc2NhcGVIdG1sKGxpbmspfSIgdGFyZ2V0PSJfYmxhbmsiIHJlbD0ibm9yZWZlcnJlciIgc3R5bGU9ImZvbnQtd2VpZ2h0OjgwMDtjb2xvcjp2YXIoLS1pbmZvKTt0ZXh0LWRlY29yYXRpb246bm9uZSI+PGkgY2xhc3M9XCJmYXMgZmEtbGlua1wiPjwvaT4gTGluazwvYT48L2Rpdj5gIDogJyd9CiAgICAgICAgICAgICR7c2NyaXB0ID8gYDxkaXYgY2xhc3M9InRlY2gtc2NyaXB0LWJveCIgc3R5bGU9Im1hcmdpbi10b3A6MTJweCI+CiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0idGVjaC1zY3JpcHQtbGFiZWwiPk3DvMWfdGVyaXllIGlsZXRpbGVjZWs6PC9zcGFuPiR7ZXNjYXBlSHRtbChzY3JpcHQpLnJlcGxhY2UoL1xuL2csJzxicj4nKX0KICAgICAgICAgICAgICA8L2Rpdj5gIDogJyd9CiAgICAgICAgICAgICR7YWxlcnRUeHQgPyBgPGRpdiBjbGFzcz0idGVjaC1hbGVydCIgc3R5bGU9Im1hcmdpbi10b3A6MTJweCI+JHtlc2NhcGVIdG1sKGFsZXJ0VHh0KS5yZXBsYWNlKC9cbi9nLCc8YnI+Jyl9PC9kaXY+YCA6ICcnfQogICAgICAgICAgPC9kaXY+YDsKICAgICAgICBTd2FsLmZpcmUoeyB0aXRsZTogdCwgaHRtbCwgc2hvd0Nsb3NlQnV0dG9uOiB0cnVlLCBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsIHdpZHRoOiAnODIwcHgnLCBiYWNrZ3JvdW5kOiAnI2Y4ZjlmYScgfSk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGNvbnN0IHNhZmVUZXh0ID0gKHRleHQgPz8gJycpLnRvU3RyaW5nKCk7CiAgICBTd2FsLmZpcmUoewogICAgICAgIHRpdGxlOiB0aXRsZSwKICAgICAgICBodG1sOiBgPGRpdiBzdHlsZT0idGV4dC1hbGlnbjpsZWZ0OyBmb250LXNpemU6MXJlbTsgbGluZS1oZWlnaHQ6MS42OyI+JHtlc2NhcGVIdG1sKHNhZmVUZXh0KS5yZXBsYWNlKC9cbi9nLCc8YnI+Jyl9PC9kaXY+YCwKICAgICAgICBzaG93Q2xvc2VCdXR0b246IHRydWUsIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwgd2lkdGg6ICc2MDBweCcsIGJhY2tncm91bmQ6ICcjZjhmOWZhJwogICAgfSk7Cn0KCmZ1bmN0aW9uIHRvZ2dsZUVkaXRNb2RlKCkgewogICAgaWYgKCFpc0FkbWluTW9kZSkgcmV0dXJuOwogICAgaXNFZGl0aW5nQWN0aXZlID0gIWlzRWRpdGluZ0FjdGl2ZTsKICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnRvZ2dsZSgnZWRpdGluZycsIGlzRWRpdGluZ0FjdGl2ZSk7CiAgICAKICAgIGNvbnN0IGJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkcm9wZG93blF1aWNrRWRpdCcpOwogICAgaWYoaXNFZGl0aW5nQWN0aXZlKSB7CiAgICAgICAgYnRuLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgIGJ0bi5pbm5lckhUTUwgPSAnPGkgY2xhc3M9ImZhcyBmYS10aW1lcyIgc3R5bGU9ImNvbG9yOnZhcigtLWFjY2VudCk7Ij48L2k+IETDvHplbmxlbWV5aSBLYXBhdCc7CiAgICAgICAgU3dhbC5maXJlKHsgaWNvbjogJ3N1Y2Nlc3MnLCB0aXRsZTogJ0TDvHplbmxlbWUgTW9kdSBBw4dJSycsIHRleHQ6ICdLYWxlbSBpa29ubGFyxLFuYSB0xLFrbGF5YXJhayBpw6dlcmlrbGVyaSBkw7x6ZW5sZXllYmlsaXJzaW5pei4nLCB0aW1lcjogMTUwMCwgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlIH0pOwogICAgfSBlbHNlIHsKICAgICAgICBidG4uY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgYnRuLmlubmVySFRNTCA9ICc8aSBjbGFzcz0iZmFzIGZhLXBlbiIgc3R5bGU9ImNvbG9yOnZhcigtLXNlY29uZGFyeSk7Ij48L2k+IETDvHplbmxlbWV5aSBBw6cnOwogICAgfQogICAgZmlsdGVyQ29udGVudCgpOwogICAgdHJ5eyBpZihjdXJyZW50Q2F0ZWdvcnk9PT0naG9tZScpIHJlbmRlckhvbWVQYW5lbHMoKTsgfWNhdGNoKGUpe30KICAgIGlmKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdndWlkZS1tb2RhbCcpLnN0eWxlLmRpc3BsYXkgPT09ICdmbGV4Jykgb3Blbkd1aWRlKCk7CiAgICBpZihkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2FsZXMtbW9kYWwnKS5zdHlsZS5kaXNwbGF5ID09PSAnZmxleCcpIG9wZW5TYWxlcygpOwogICAgaWYoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25ld3MtbW9kYWwnKS5zdHlsZS5kaXNwbGF5ID09PSAnZmxleCcpIG9wZW5OZXdzKCk7Cn0KZnVuY3Rpb24gc2VuZFVwZGF0ZShvLCBjLCB2LCB0PSdjYXJkJykgewogICAgaWYgKCFTd2FsLmlzVmlzaWJsZSgpKSBTd2FsLmZpcmUoeyB0aXRsZTogJ0theWRlZGlsaXlvci4uLicsIGRpZE9wZW46ICgpID0+IHsgU3dhbC5zaG93TG9hZGluZygpIH0gfSk7CiAgICBmZXRjaChTQ1JJUFRfVVJMLCB7CiAgICAgICAgbWV0aG9kOiAnUE9TVCcsIGhlYWRlcnM6IHsgJ0NvbnRlbnQtVHlwZSc6ICd0ZXh0L3BsYWluO2NoYXJzZXQ9dXRmLTgnIH0sCiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBhY3Rpb246ICJ1cGRhdGVDb250ZW50IiwgdGl0bGU6IG8sIGNvbHVtbjogYywgdmFsdWU6IHYsIHR5cGU6IHQsIG9yaWdpbmFsVGV4dDogbywgdXNlcm5hbWU6IGN1cnJlbnRVc2VyLCB0b2tlbjogZ2V0VG9rZW4oKSB9KQogICAgfSkudGhlbihyID0+IHIuanNvbigpKS50aGVuKGRhdGEgPT4gewogICAgICAgIGlmIChkYXRhLnJlc3VsdCA9PT0gInN1Y2Nlc3MiKSB7CiAgICAgICAgICAgIFN3YWwuZmlyZSh7aWNvbjogJ3N1Y2Nlc3MnLCB0aXRsZTogJ0JhxZ9hcsSxbMSxJywgdGltZXI6IDE1MDAsIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZX0pOwogICAgICAgICAgICBzZXRUaW1lb3V0KGxvYWRDb250ZW50RGF0YSwgMTYwMCk7CiAgICAgICAgfSBlbHNlIHsgU3dhbC5maXJlKCdIYXRhJywgJ0theWRlZGlsZW1lZGk6ICcgKyAoZGF0YS5tZXNzYWdlIHx8ICdCaWxpbm1leWVuIEhhdGEnKSwgJ2Vycm9yJyk7IH0KICAgIH0pLmNhdGNoKGVyciA9PiBTd2FsLmZpcmUoJ0hhdGEnLCAnU3VudWN1IGhhdGFzxLEuJywgJ2Vycm9yJykpOwp9Ci8vIC0tLSBDUlVEIE9QRVJBU1lPTkxBUkkgKEFETUlOKSAtLS0KYXN5bmMgZnVuY3Rpb24gYWRkTmV3Q2FyZFBvcHVwKCkgewogICAgY29uc3QgY2F0U2VsZWN0SFRNTCA9IGdldENhdGVnb3J5U2VsZWN0SHRtbCgnQmlsZ2knLCAnc3dhbC1uZXctY2F0Jyk7CiAgICBjb25zdCB7IHZhbHVlOiBmb3JtVmFsdWVzIH0gPSBhd2FpdCBTd2FsLmZpcmUoewogICAgICAgIHRpdGxlOiAnWWVuaSDEsMOnZXJpayBFa2xlJywKICAgICAgICBodG1sOiBgCiAgICAgICAgPGRpdiBzdHlsZT0ibWFyZ2luLWJvdHRvbToxNXB4OyB0ZXh0LWFsaWduOmxlZnQ7Ij4KICAgICAgICAgICAgPGxhYmVsIHN0eWxlPSJmb250LXdlaWdodDpib2xkOyBmb250LXNpemU6MC45cmVtOyI+TmUgRWtsZXllY2Vrc2luPzwvbGFiZWw+CiAgICAgICAgICAgIDxzZWxlY3QgaWQ9InN3YWwtdHlwZS1zZWxlY3QiIGNsYXNzPSJzd2FsMi1pbnB1dCIgc3R5bGU9IndpZHRoOjEwMCU7IG1hcmdpbi10b3A6NXB4OyBoZWlnaHQ6MzVweDsgZm9udC1zaXplOjAuOXJlbTsiIG9uY2hhbmdlPSJ0b2dnbGVBZGRGaWVsZHMoKSI+CiAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJjYXJkIj4g8J+TjCAgQmlsZ2kgS2FydMSxPC9vcHRpb24+CiAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJuZXdzIj4g8J+ToiAgRHV5dXJ1PC9vcHRpb24+CiAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJzYWxlcyI+IPCfk54gIFRlbGVzYXTEscWfIFNjcmlwdGk8L29wdGlvbj4KICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9InNwb3J0Ij4g8J+PhiAgU3BvciDEsMOnZXJpxJ9pPC9vcHRpb24+CiAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJxdWl6Ij4g4p2TICBRdWl6IFNvcnVzdTwvb3B0aW9uPgogICAgICAgICAgICA8L3NlbGVjdD4KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2IGlkPSJwcmV2aWV3LWNhcmQiIGNsYXNzPSJjYXJkIEJpbGdpIiBzdHlsZT0idGV4dC1hbGlnbjpsZWZ0OyBib3gtc2hhZG93Om5vbmU7IGJvcmRlcjoxcHggc29saWQgI2UwZTBlMDsgbWFyZ2luLXRvcDoxMHB4OyI+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNhcmQtaGVhZGVyIiBzdHlsZT0iYWxpZ24taXRlbXM6IGNlbnRlcjsgZ2FwOiAxMHB4OyI+CiAgICAgICAgICAgICAgICA8aW5wdXQgaWQ9InN3YWwtbmV3LXRpdGxlIiBjbGFzcz0ic3dhbDItaW5wdXQiIHN0eWxlPSJtYXJnaW46MDsgaGVpZ2h0OjQwcHg7IGZsZXgtZ3JvdzoxOyBib3JkZXI6bm9uZTsgYm9yZGVyLWJvdHRvbToycHggc29saWQgI2VlZTsgcGFkZGluZzowIDVweDsgZm9udC13ZWlnaHQ6Ym9sZDsgY29sb3I6IzBlMWI0MjsiIHBsYWNlaG9sZGVyPSJCYcWfbMSxayBHaXJpbml6Li4uIj4KICAgICAgICAgICAgICAgIDxkaXYgaWQ9ImNhdC1jb250YWluZXIiIHN0eWxlPSJ3aWR0aDogMTEwcHg7Ij4ke2NhdFNlbGVjdEhUTUx9PC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJjYXJkLWNvbnRlbnQiIHN0eWxlPSJtYXJnaW4tYm90dG9tOjEwcHg7Ij4KICAgICAgICAgICAgICAgIDx0ZXh0YXJlYSBpZD0ic3dhbC1uZXctdGV4dCIgY2xhc3M9InN3YWwyLXRleHRhcmVhIiBzdHlsZT0ibWFyZ2luOjA7IHdpZHRoOjEwMCU7IGJveC1zaXppbmc6Ym9yZGVyLWJveDsgYm9yZGVyOm5vbmU7IHJlc2l6ZTpub25lOyBmb250LWZhbWlseTppbmhlcml0OyBtaW4taGVpZ2h0OjEwMHB4OyBwYWRkaW5nOjEwcHg7IGJhY2tncm91bmQ6I2Y5ZjlmOTsiIHBsYWNlaG9sZGVyPSLEsMOnZXJpayBtZXRuaS4uLiI+PC90ZXh0YXJlYT4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgaWQ9InNjcmlwdC1jb250YWluZXIiIGNsYXNzPSJzY3JpcHQtYm94IiBzdHlsZT0icGFkZGluZzowOyBib3JkZXI6MXB4IHNvbGlkICNmMGU2OGM7Ij4KICAgICAgICAgICAgICAgIDx0ZXh0YXJlYSBpZD0ic3dhbC1uZXctc2NyaXB0IiBjbGFzcz0ic3dhbDItdGV4dGFyZWEiIHN0eWxlPSJtYXJnaW46MDsgd2lkdGg6MTAwJTsgYm94LXNpemluZzpib3JkZXItYm94OyBib3JkZXI6bm9uZTsgYmFja2dyb3VuZDp0cmFuc3BhcmVudDsgZm9udC1zdHlsZTppdGFsaWM7IG1pbi1oZWlnaHQ6ODBweDsgZm9udC1zaXplOjAuOXJlbTsiIHBsYWNlaG9sZGVyPSJTY3JpcHQgbWV0bmkgKMSwc3RlxJ9lIGJhxJ9sxLEpLi4uIj48L3RleHRhcmVhPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBpZD0iZXh0cmEtY29udGFpbmVyIiBjbGFzcz0iY2FyZC1hY3Rpb25zIiBzdHlsZT0ibWFyZ2luLXRvcDoxNXB4OyBkaXNwbGF5OmdyaWQ7IGdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIDFmcjsgZ2FwOjEwcHg7Ij4KICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9InBvc2l0aW9uOnJlbGF0aXZlOyI+PGkgY2xhc3M9ImZhcyBmYS1jb2RlIiBzdHlsZT0icG9zaXRpb246YWJzb2x1dGU7IGxlZnQ6MTBweDsgdG9wOjEwcHg7IGNvbG9yOiNhYWE7Ij48L2k+PGlucHV0IGlkPSJzd2FsLW5ldy1jb2RlIiBjbGFzcz0ic3dhbDItaW5wdXQiIHN0eWxlPSJtYXJnaW46MDsgaGVpZ2h0OjM1cHg7IGZvbnQtc2l6ZTowLjg1cmVtOyBwYWRkaW5nLWxlZnQ6MzBweDsiIHBsYWNlaG9sZGVyPSJLb2QiPjwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0icG9zaXRpb246cmVsYXRpdmU7Ij48aSBjbGFzcz0iZmFzIGZhLWxpbmsiIHN0eWxlPSJwb3NpdGlvbjphYnNvbHV0ZTsgbGVmdDoxMHB4OyB0b3A6MTBweDsgY29sb3I6I2FhYTsiPjwvaT48aW5wdXQgaWQ9InN3YWwtbmV3LWxpbmsiIGNsYXNzPSJzd2FsMi1pbnB1dCIgc3R5bGU9Im1hcmdpbjowOyBoZWlnaHQ6MzVweDsgZm9udC1zaXplOjAuODVyZW07IHBhZGRpbmctbGVmdDozMHB4OyIgcGxhY2Vob2xkZXI9IkxpbmsiPjwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBpZD0ic3BvcnQtZXh0cmEiIHN0eWxlPSJkaXNwbGF5Om5vbmU7IHBhZGRpbmc6MTBweDsiPgogICAgICAgICAgICAgICAgPGxhYmVsIHN0eWxlPSJmb250LXdlaWdodDpib2xkOyI+S8Sxc2EgQcOnxLFrbGFtYSAoRGVzYyk8L2xhYmVsPjxpbnB1dCBpZD0ic3dhbC1zcG9ydC10aXAiIGNsYXNzPSJzd2FsMi1pbnB1dCIgcGxhY2Vob2xkZXI9IkvEsXNhIMSwcHVjdS9UaXAiPgogICAgICAgICAgICAgICAgPGxhYmVsIHN0eWxlPSJmb250LXdlaWdodDpib2xkOyI+RGV0YXlsxLEgTWV0aW4gKERldGFpbCk8L2xhYmVsPjxpbnB1dCBpZD0ic3dhbC1zcG9ydC1kZXRhaWwiIGNsYXNzPSJzd2FsMi1pbnB1dCIgcGxhY2Vob2xkZXI9IkRldGF5bMSxIEHDp8Sxa2xhbWEgKEFsdCBNZXRpbikiPgogICAgICAgICAgICAgICAgPGxhYmVsIHN0eWxlPSJmb250LXdlaWdodDpib2xkOyI+T2t1bnXFn3UgKFByb251bmNpYXRpb24pPC9sYWJlbD48aW5wdXQgaWQ9InN3YWwtc3BvcnQtcHJvbiIgY2xhc3M9InN3YWwyLWlucHV0IiBwbGFjZWhvbGRlcj0iT2t1bnXFn3UiPgogICAgICAgICAgICAgICAgPGxhYmVsIHN0eWxlPSJmb250LXdlaWdodDpib2xkOyI+xLBrb24gU8SxbsSxZsSxIChJY29uKTwvbGFiZWw+PGlucHV0IGlkPSJzd2FsLXNwb3J0LWljb24iIGNsYXNzPSJzd2FsMi1pbnB1dCIgcGxhY2Vob2xkZXI9IkZvbnRBd2Vzb21lIMSwa29uIFPEsW7EsWbEsSAoZS5nLiwgZmEtZnV0Ym9sKSI+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IGlkPSJuZXdzLWV4dHJhIiBzdHlsZT0iZGlzcGxheTpub25lOyBwYWRkaW5nOjEwcHg7Ij4KICAgICAgICAgICAgICAgIDxsYWJlbCBzdHlsZT0iZm9udC13ZWlnaHQ6Ym9sZDsiPkR1eXVydSBUaXBpPC9sYWJlbD48c2VsZWN0IGlkPSJzd2FsLW5ld3MtdHlwZSIgY2xhc3M9InN3YWwyLWlucHV0Ij48b3B0aW9uIHZhbHVlPSJpbmZvIj5CaWxnaTwvb3B0aW9uPjxvcHRpb24gdmFsdWU9InVwZGF0ZSI+RGXEn2nFn2lrbGlrPC9vcHRpb24+PG9wdGlvbiB2YWx1ZT0iZml4Ij7Dh8O2esO8bGTDvDwvb3B0aW9uPjwvc2VsZWN0PgogICAgICAgICAgICAgICAgPGxhYmVsIHN0eWxlPSJmb250LXdlaWdodDpib2xkOyI+RHVydW08L2xhYmVsPjxzZWxlY3QgaWQ9InN3YWwtbmV3cy1zdGF0dXMiIGNsYXNzPSJzd2FsMi1pbnB1dCI+PG9wdGlvbiB2YWx1ZT0iQWt0aWYiPkFrdGlmPC9vcHRpb24+PG9wdGlvbiB2YWx1ZT0iUGFzaWYiPlBhc2lmIChHaXpsZSk8L29wdGlvbj48L3NlbGVjdD4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgaWQ9InF1aXotZXh0cmEiIHN0eWxlPSJkaXNwbGF5Om5vbmU7IHBhZGRpbmc6MTBweDsiPgogICAgICAgICAgICAgICAgPGxhYmVsIHN0eWxlPSJmb250LXdlaWdodDpib2xkOyI+U29ydSBNZXRuaSAoVGV4dCk8L2xhYmVsPjx0ZXh0YXJlYSBpZD0ic3dhbC1xdWl6LXEiIGNsYXNzPSJzd2FsMi10ZXh0YXJlYSIgcGxhY2Vob2xkZXI9IlF1aXogc29ydXN1Li4uIj48L3RleHRhcmVhPgogICAgICAgICAgICAgICAgPGxhYmVsIHN0eWxlPSJmb250LXdlaWdodDpib2xkOyI+U2XDp2VuZWtsZXIgKFZpcmfDvGxsZSBBecSxcsSxbik8L2xhYmVsPjxpbnB1dCBpZD0ic3dhbC1xdWl6LW9wdHMiIGNsYXNzPSJzd2FsMi1pbnB1dCIgcGxhY2Vob2xkZXI9IsOWcm46IMWfxLFrIEEsxZ/EsWsgQizFn8SxayBDLMWfxLFrIEQiPgogICAgICAgICAgICAgICAgPGxhYmVsIHN0eWxlPSJmb250LXdlaWdodDpib2xkOyI+RG/En3J1IENldmFwIMSwbmRla3NpPC9sYWJlbD48aW5wdXQgaWQ9InN3YWwtcXVpei1hbnMiIHR5cGU9Im51bWJlciIgY2xhc3M9InN3YWwyLWlucHV0IiBwbGFjZWhvbGRlcj0iMCAoQSksIDEgKEIpLCAyIChDKSB2ZXlhIDMgKEQpIiBtaW49IjAiIG1heD0iMyI+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PmAsCiAgICAgICAgd2lkdGg6ICc3MDBweCcsIHNob3dDYW5jZWxCdXR0b246IHRydWUsIGNvbmZpcm1CdXR0b25UZXh0OiAnPGkgY2xhc3M9ImZhcyBmYS1wbHVzIj48L2k+IEVrbGUnLCBjYW5jZWxCdXR0b25UZXh0OiAnxLBwdGFsJywgZm9jdXNDb25maXJtOiBmYWxzZSwKICAgICAgICBkaWRPcGVuOiAoKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHNlbGVjdEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N3YWwtbmV3LWNhdCcpOwogICAgICAgICAgICBjb25zdCBjYXJkRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJldmlldy1jYXJkJyk7CiAgICAgICAgICAgIHNlbGVjdEVsLnN0eWxlLm1hcmdpbiA9ICIwIjsgc2VsZWN0RWwuc3R5bGUuaGVpZ2h0ID0gIjMwcHgiOyBzZWxlY3RFbC5zdHlsZS5mb250U2l6ZSA9ICIwLjhyZW0iOyBzZWxlY3RFbC5zdHlsZS5wYWRkaW5nID0gIjAgNXB4IjsKICAgICAgICAgICAgc2VsZWN0RWwuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZnVuY3Rpb24oKSB7IGNhcmRFbC5jbGFzc05hbWUgPSAnY2FyZCAnICsgdGhpcy52YWx1ZTsgfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICB3aW5kb3cudG9nZ2xlQWRkRmllbGRzID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0eXBlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N3YWwtdHlwZS1zZWxlY3QnKS52YWx1ZTsKICAgICAgICAgICAgICAgIGNvbnN0IGNhdENvbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2F0LWNvbnRhaW5lcicpOwogICAgICAgICAgICAgICAgY29uc3Qgc2NyaXB0Q29udCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY3JpcHQtY29udGFpbmVyJyk7CiAgICAgICAgICAgICAgICBjb25zdCBleHRyYUNvbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXh0cmEtY29udGFpbmVyJyk7CiAgICAgICAgICAgICAgICBjb25zdCBzcG9ydEV4dHJhID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Nwb3J0LWV4dHJhJyk7CiAgICAgICAgICAgICAgICBjb25zdCBuZXdzRXh0cmEgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmV3cy1leHRyYScpOwogICAgICAgICAgICAgICAgY29uc3QgcXVpekV4dHJhID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1aXotZXh0cmEnKTsKICAgICAgICAgICAgICAgIGNvbnN0IGNhcmRQcmV2aWV3ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ByZXZpZXctY2FyZCcpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjYXRDb250LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7IHNjcmlwdENvbnQuc3R5bGUuZGlzcGxheSA9ICdub25lJzsgZXh0cmFDb250LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgICAgICBzcG9ydEV4dHJhLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7IG5ld3NFeHRyYS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOyBxdWl6RXh0cmEuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLW5ldy10aXRsZScpLnZhbHVlID0gJyc7IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLW5ldy10ZXh0JykudmFsdWUgPSAnJzsKICAgICAgICAgICAgICAgIGNhcmRQcmV2aWV3LnN0eWxlLmJvcmRlckxlZnQgPSAiNXB4IHNvbGlkIHZhcigtLWluZm8pIjsgY2FyZFByZXZpZXcuY2xhc3NOYW1lID0gJ2NhcmQgQmlsZ2knOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gJ2NhcmQnKSB7CiAgICAgICAgICAgICAgICAgICAgY2F0Q29udC5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsgc2NyaXB0Q29udC5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsgZXh0cmFDb250LnN0eWxlLmRpc3BsYXkgPSAnZ3JpZCc7CiAgICAgICAgICAgICAgICAgICAgY2FyZFByZXZpZXcuY2xhc3NOYW1lID0gJ2NhcmQgJyArIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLW5ldy1jYXQnKS52YWx1ZTsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC1uZXctdGl0bGUnKS5wbGFjZWhvbGRlciA9ICJCYcWfbMSxayBHaXJpbml6Li4uIjsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N3YWwtbmV3LXRleHQnKS5wbGFjZWhvbGRlciA9ICLEsMOnZXJpayBtZXRuaS4uLiI7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdzYWxlcycpIHsKICAgICAgICAgICAgICAgICAgICBzY3JpcHRDb250LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLW5ldy1zY3JpcHQnKS5wbGFjZWhvbGRlciA9ICJTYXTEscWfIE1ldG5pLi4uIjsKICAgICAgICAgICAgICAgICAgICBjYXJkUHJldmlldy5zdHlsZS5ib3JkZXJMZWZ0ID0gIjVweCBzb2xpZCB2YXIoLS1zYWxlcykiOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLW5ldy10aXRsZScpLnBsYWNlaG9sZGVyID0gIlNjcmlwdCBCYcWfbMSxxJ/EsS4uLiI7IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLW5ldy10ZXh0JykucGxhY2Vob2xkZXIgPSAiU2FkZWNlIGJ1cmF5YSBtZXRpbiBnaXJpbGVjZWsuIjsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ3Nwb3J0JykgewogICAgICAgICAgICAgICAgICAgIHNwb3J0RXh0cmEuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgICAgICAgICAgICAgY2FyZFByZXZpZXcuc3R5bGUuYm9yZGVyTGVmdCA9ICI1cHggc29saWQgdmFyKC0tcHJpbWFyeSkiOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLW5ldy10aXRsZScpLnBsYWNlaG9sZGVyID0gIlNwb3IgVGVyaW1pIEJhxZ9sxLHEn8SxLi4uIjsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N3YWwtbmV3LXRleHQnKS5wbGFjZWhvbGRlciA9ICJLxLFzYSBBw6fEsWtsYW1hIChEZXNjKS4uLiI7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICduZXdzJykgewogICAgICAgICAgICAgICAgICAgIG5ld3NFeHRyYS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICAgICAgICAgICAgICBjYXJkUHJldmlldy5zdHlsZS5ib3JkZXJMZWZ0ID0gIjVweCBzb2xpZCB2YXIoLS1zZWNvbmRhcnkpIjsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC1uZXctdGl0bGUnKS5wbGFjZWhvbGRlciA9ICJEdXl1cnUgQmHFn2zEscSfxLEuLi4iOyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC1uZXctdGV4dCcpLnBsYWNlaG9sZGVyID0gIkR1eXVydSBNZXRuaSAoRGVzYykuLi4iOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAncXVpeicpIHsKICAgICAgICAgICAgICAgICAgICBxdWl6RXh0cmEuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N3YWwtbmV3LXRpdGxlJykucGxhY2Vob2xkZXIgPSAiUXVpeiBCYcWfbMSxxJ/EsSAow5ZybjogU29ydSAxKSI7IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLW5ldy10ZXh0JykucGxhY2Vob2xkZXIgPSAiQnUgYWxhbiBib8WfIGLEsXJha8SxbGFjYWsuIjsKICAgICAgICAgICAgICAgICAgICBjYXJkUHJldmlldy5zdHlsZS5ib3JkZXJMZWZ0ID0gIjVweCBzb2xpZCB2YXIoLS1xdWl6KSI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgfSwKICAgICAgICBwcmVDb25maXJtOiAoKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHR5cGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC10eXBlLXNlbGVjdCcpLnZhbHVlOwogICAgICAgICAgICBjb25zdCB0b2RheSA9IG5ldyBEYXRlKCk7CiAgICAgICAgICAgIGNvbnN0IGRhdGVTdHIgPSB0b2RheS5nZXREYXRlKCkgKyAiLiIgKyAodG9kYXkuZ2V0TW9udGgoKSsxKSArICIuIiArIHRvZGF5LmdldEZ1bGxZZWFyKCk7CiAgICAgICAgICAgIGNvbnN0IHF1aXpPcHRzID0gdHlwZSA9PT0gJ3F1aXonID8gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N3YWwtcXVpei1vcHRzJykudmFsdWUgOiAnJzsKICAgICAgICAgICAgY29uc3QgcXVpekFucyA9IHR5cGUgPT09ICdxdWl6JyA/IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLXF1aXotYW5zJykudmFsdWUgOiAnJzsKICAgICAgICAgICAgY29uc3QgcXVpelEgPSB0eXBlID09PSAncXVpeicgPyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC1xdWl6LXEnKS52YWx1ZSA6ICcnOwogICAgICAgICAgICBpZiAodHlwZSA9PT0gJ3F1aXonICYmICghcXVpelEgfHwgIXF1aXpPcHRzIHx8IHF1aXpBbnMgPT09ICcnKSkgeyBTd2FsLnNob3dWYWxpZGF0aW9uTWVzc2FnZSgnUXVpeiBzb3J1c3UgacOnaW4gdMO8bSBhbGFubGFyIHpvcnVubHVkdXIuJyk7IHJldHVybiBmYWxzZTsgfQogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgY2FyZFR5cGU6IHR5cGUsCiAgICAgICAgICAgICAgICBjYXRlZ29yeTogdHlwZSA9PT0gJ2NhcmQnID8gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N3YWwtbmV3LWNhdCcpLnZhbHVlIDogKHR5cGUgPT09ICduZXdzJyA/IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLW5ld3MtdHlwZScpLnZhbHVlIDogJycpLAogICAgICAgICAgICAgICAgdGl0bGU6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLW5ldy10aXRsZScpLnZhbHVlLAogICAgICAgICAgICAgICAgdGV4dDogdHlwZSA9PT0gJ3F1aXonID8gcXVpelEgOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC1uZXctdGV4dCcpLnZhbHVlLAogICAgICAgICAgICAgICAgc2NyaXB0OiAodHlwZSA9PT0gJ2NhcmQnIHx8IHR5cGUgPT09ICdzYWxlcycpID8gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N3YWwtbmV3LXNjcmlwdCcpLnZhbHVlIDogJycsCiAgICAgICAgICAgICAgICBjb2RlOiB0eXBlID09PSAnY2FyZCcgPyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC1uZXctY29kZScpLnZhbHVlIDogJycsCiAgICAgICAgICAgICAgICBzdGF0dXM6IHR5cGUgPT09ICduZXdzJyA/IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLW5ld3Mtc3RhdHVzJykudmFsdWUgOiAnJywKICAgICAgICAgICAgICAgIGxpbms6IHR5cGUgPT09ICdjYXJkJyA/IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLW5ldy1saW5rJykudmFsdWUgOiAnJywKICAgICAgICAgICAgICAgIHRpcDogdHlwZSA9PT0gJ3Nwb3J0JyA/IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLXNwb3J0LXRpcCcpLnZhbHVlIDogJycsCiAgICAgICAgICAgICAgICBkZXRhaWw6IHR5cGUgPT09ICdzcG9ydCcgPyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC1zcG9ydC1kZXRhaWwnKS52YWx1ZSA6ICcnLAogICAgICAgICAgICAgICAgcHJvbnVuY2lhdGlvbjogdHlwZSA9PT0gJ3Nwb3J0JyA/IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLXNwb3J0LXByb24nKS52YWx1ZSA6ICcnLAogICAgICAgICAgICAgICAgaWNvbjogdHlwZSA9PT0gJ3Nwb3J0JyA/IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLXNwb3J0LWljb24nKS52YWx1ZSA6ICcnLAogICAgICAgICAgICAgICAgZGF0ZTogZGF0ZVN0ciwgcXVpek9wdGlvbnM6IHF1aXpPcHRzLCBxdWl6QW5zd2VyOiBxdWl6QW5zCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9KTsKICAgIGlmIChmb3JtVmFsdWVzKSB7CiAgICAgICAgaWYoIWZvcm1WYWx1ZXMudGl0bGUpIHsgU3dhbC5maXJlKCdIYXRhJywgJ0JhxZ9sxLFrIHpvcnVubHUhJywgJ2Vycm9yJyk7IHJldHVybjsgfQogICAgICAgIFN3YWwuZmlyZSh7IHRpdGxlOiAnRWtsZW5peW9yLi4uJywgZGlkT3BlbjogKCkgPT4geyBTd2FsLnNob3dMb2FkaW5nKCkgfSB9KTsKICAgICAgICBmZXRjaChTQ1JJUFRfVVJMLCB7CiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLCBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAndGV4dC9wbGFpbjtjaGFyc2V0PXV0Zi04JyB9LAogICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGFjdGlvbjogImFkZENhcmQiLCB1c2VybmFtZTogY3VycmVudFVzZXIsIHRva2VuOiBnZXRUb2tlbigpLCAuLi5mb3JtVmFsdWVzIH0pCiAgICAgICAgfSkudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkpLnRoZW4oZGF0YSA9PiB7CiAgICAgICAgICAgIGlmIChkYXRhLnJlc3VsdCA9PT0gInN1Y2Nlc3MiKSB7CiAgICAgICAgICAgICAgICBTd2FsLmZpcmUoe2ljb246ICdzdWNjZXNzJywgdGl0bGU6ICdCYcWfYXLEsWzEsScsIHRleHQ6ICfEsMOnZXJpayBla2xlbmRpLicsIHRpbWVyOiAyMDAwLCBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2V9KTsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQobG9hZENvbnRlbnREYXRhLCAzNTAwKTsKICAgICAgICAgICAgfSBlbHNlIHsgU3dhbC5maXJlKCdIYXRhJywgZGF0YS5tZXNzYWdlIHx8ICdFa2xlbmVtZWRpLicsICdlcnJvcicpOyB9CiAgICAgICAgfSkuY2F0Y2goZXJyID0+IFN3YWwuZmlyZSgnSGF0YScsICdTdW51Y3UgaGF0YXPEsTogJyArIGVyciwgJ2Vycm9yJykpOwogICAgfQp9CmFzeW5jIGZ1bmN0aW9uIGVkaXRDb250ZW50KGluZGV4KSB7CiAgICBjb25zdCBpdGVtID0gYWN0aXZlQ2FyZHNbaW5kZXhdOwogICAgY29uc3QgY2F0U2VsZWN0SFRNTCA9IGdldENhdGVnb3J5U2VsZWN0SHRtbChpdGVtLmNhdGVnb3J5LCAnc3dhbC1jYXQnKTsKICAgIGNvbnN0IHsgdmFsdWU6IGZvcm1WYWx1ZXMgfSA9IGF3YWl0IFN3YWwuZmlyZSh7CiAgICAgICAgdGl0bGU6ICdLYXJ0xLEgRMO8emVubGUnLAogICAgICAgIGh0bWw6IGAKICAgICAgICA8ZGl2IGlkPSJwcmV2aWV3LWNhcmQtZWRpdCIgY2xhc3M9ImNhcmQgJHtpdGVtLmNhdGVnb3J5fSIgc3R5bGU9InRleHQtYWxpZ246bGVmdDsgYm94LXNoYWRvdzpub25lOyBib3JkZXI6MXB4IHNvbGlkICNlMGUwZTA7IG1hcmdpbi10b3A6MTBweDsiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJjYXJkLWhlYWRlciIgc3R5bGU9ImFsaWduLWl0ZW1zOiBjZW50ZXI7IGdhcDogMTBweDsiPgogICAgICAgICAgICAgICAgPGlucHV0IGlkPSJzd2FsLXRpdGxlIiBjbGFzcz0ic3dhbDItaW5wdXQiIHN0eWxlPSJtYXJnaW46MDsgaGVpZ2h0OjQwcHg7IGZsZXgtZ3JvdzoxOyBib3JkZXI6bm9uZTsgYm9yZGVyLWJvdHRvbToycHggc29saWQgI2VlZTsgcGFkZGluZzowIDVweDsgZm9udC13ZWlnaHQ6Ym9sZDsgY29sb3I6IzBlMWI0MjsiIHZhbHVlPSIke2l0ZW0udGl0bGV9IiBwbGFjZWhvbGRlcj0iQmHFn2zEsWsiPgogICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0id2lkdGg6IDExMHB4OyI+JHtjYXRTZWxlY3RIVE1MfTwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2FyZC1jb250ZW50IiBzdHlsZT0ibWFyZ2luLWJvdHRvbToxMHB4OyI+CiAgICAgICAgICAgICAgICA8dGV4dGFyZWEgaWQ9InN3YWwtdGV4dCIgY2xhc3M9InN3YWwyLXRleHRhcmVhIiBzdHlsZT0ibWFyZ2luOjA7IHdpZHRoOjEwMCU7IGJveC1zaXppbmc6Ym9yZGVyLWJveDsgYm9yZGVyOm5vbmU7IHJlc2l6ZTpub25lOyBmb250LWZhbWlseTppbmhlcml0OyBtaW4taGVpZ2h0OjEyMHB4OyBwYWRkaW5nOjEwcHg7IGJhY2tncm91bmQ6I2Y5ZjlmOTsiIHBsYWNlaG9sZGVyPSLEsMOnZXJpayBtZXRuaS4uLiI+JHsoaXRlbS50ZXh0IHx8ICcnKS50b1N0cmluZygpLnJlcGxhY2UoLzxicj4vZywnXG4nKX08L3RleHRhcmVhPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2NyaXB0LWJveCIgc3R5bGU9InBhZGRpbmc6MDsgYm9yZGVyOjFweCBzb2xpZCAjZjBlNjhjOyI+CiAgICAgICAgICAgICAgICA8dGV4dGFyZWEgaWQ9InN3YWwtc2NyaXB0IiBjbGFzcz0ic3dhbDItdGV4dGFyZWEiIHN0eWxlPSJtYXJnaW46MDsgd2lkdGg6MTAwJTsgYm94LXNpemluZzpib3JkZXItYm94OyBib3JkZXI6bm9uZTsgYmFja2dyb3VuZDp0cmFuc3BhcmVudDsgZm9udC1zdHlsZTppdGFsaWM7IG1pbi1oZWlnaHQ6ODBweDsgZm9udC1zaXplOjAuOXJlbTsiIHBsYWNlaG9sZGVyPSJTY3JpcHQgbWV0bmkuLi4iPiR7KGl0ZW0uc2NyaXB0IHx8ICcnKS50b1N0cmluZygpLnJlcGxhY2UoLzxicj4vZywnXG4nKX08L3RleHRhcmVhPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2FyZC1hY3Rpb25zIiBzdHlsZT0ibWFyZ2luLXRvcDoxNXB4OyBkaXNwbGF5OmdyaWQ7IGdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIDFmcjsgZ2FwOjEwcHg7Ij4KICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9InBvc2l0aW9uOnJlbGF0aXZlOyI+PGkgY2xhc3M9ImZhcyBmYS1jb2RlIiBzdHlsZT0icG9zaXRpb246YWJzb2x1dGU7IGxlZnQ6MTBweDsgdG9wOjEwcHg7IGNvbG9yOiNhYWE7Ij48L2k+PGlucHV0IGlkPSJzd2FsLWNvZGUiIGNsYXNzPSJzd2FsMi1pbnB1dCIgc3R5bGU9Im1hcmdpbjowOyBoZWlnaHQ6MzVweDsgZm9udC1zaXplOjAuODVyZW07IHBhZGRpbmctbGVmdDozMHB4OyIgdmFsdWU9IiR7aXRlbS5jb2RlIHx8ICcnfSIgcGxhY2Vob2xkZXI9IktvZCI+PC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJwb3NpdGlvbjpyZWxhdGl2ZTsiPjxpIGNsYXNzPSJmYXMgZmEtbGluayIgc3R5bGU9InBvc2l0aW9uOmFic29sdXRlOyBsZWZ0OjEwcHg7IHRvcDoxMHB4OyBjb2xvcjojYWFhOyI+PC9pPjxpbnB1dCBpZD0ic3dhbC1saW5rIiBjbGFzcz0ic3dhbDItaW5wdXQiIHN0eWxlPSJtYXJnaW46MDsgaGVpZ2h0OjM1cHg7IGZvbnQtc2l6ZTowLjg1cmVtOyBwYWRkaW5nLWxlZnQ6MzBweDsiIHZhbHVlPSIke2l0ZW0ubGluayB8fCAnJ30iIHBsYWNlaG9sZGVyPSJMaW5rIj48L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+YCwKICAgICAgICB3aWR0aDogJzcwMHB4Jywgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwgY29uZmlybUJ1dHRvblRleHQ6ICc8aSBjbGFzcz0iZmFzIGZhLXNhdmUiPjwvaT4gS2F5ZGV0JywgY2FuY2VsQnV0dG9uVGV4dDogJ8SwcHRhbCcsIGZvY3VzQ29uZmlybTogZmFsc2UsCiAgICAgICAgZGlkT3BlbjogKCkgPT4gewogICAgICAgICAgICBjb25zdCBzZWxlY3RFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLWNhdCcpOwogICAgICAgICAgICBjb25zdCBjYXJkRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJldmlldy1jYXJkLWVkaXQnKTsKICAgICAgICAgICAgc2VsZWN0RWwuc3R5bGUubWFyZ2luID0gIjAiOyBzZWxlY3RFbC5zdHlsZS5oZWlnaHQgPSAiMzBweCI7IHNlbGVjdEVsLnN0eWxlLmZvbnRTaXplID0gIjAuOHJlbSI7IHNlbGVjdEVsLnN0eWxlLnBhZGRpbmcgPSAiMCA1cHgiOwogICAgICAgICAgICBzZWxlY3RFbC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBmdW5jdGlvbigpIHsgY2FyZEVsLmNsYXNzTmFtZSA9ICdjYXJkICcgKyB0aGlzLnZhbHVlOyB9KTsKICAgICAgICB9LAogICAgICAgIHByZUNvbmZpcm06ICgpID0+IHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGNhdDogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N3YWwtY2F0JykudmFsdWUsCiAgICAgICAgICAgICAgICB0aXRsZTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N3YWwtdGl0bGUnKS52YWx1ZSwKICAgICAgICAgICAgICAgIHRleHQ6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLXRleHQnKS52YWx1ZSwKICAgICAgICAgICAgICAgIHNjcmlwdDogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N3YWwtc2NyaXB0JykudmFsdWUsCiAgICAgICAgICAgICAgICBjb2RlOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC1jb2RlJykudmFsdWUsCiAgICAgICAgICAgICAgICBsaW5rOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC1saW5rJykudmFsdWUKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0pOwogICAgaWYgKGZvcm1WYWx1ZXMpIHsKICAgICAgICBpZihmb3JtVmFsdWVzLmNhdCAhPT0gaXRlbS5jYXRlZ29yeSkgc2VuZFVwZGF0ZShpdGVtLnRpdGxlLCAiQ2F0ZWdvcnkiLCBmb3JtVmFsdWVzLmNhdCwgJ2NhcmQnKTsKICAgICAgICBpZihmb3JtVmFsdWVzLnRleHQgIT09IChpdGVtLnRleHQgfHwgJycpLnJlcGxhY2UoLzxicj4vZywnXG4nKSkgc2V0VGltZW91dCgoKSA9PiBzZW5kVXBkYXRlKGl0ZW0udGl0bGUsICJUZXh0IiwgZm9ybVZhbHVlcy50ZXh0LCAnY2FyZCcpLCA1MDApOwogICAgICAgIGlmKGZvcm1WYWx1ZXMuc2NyaXB0ICE9PSAoaXRlbS5zY3JpcHQgfHwgJycpLnJlcGxhY2UoLzxicj4vZywnXG4nKSkgc2V0VGltZW91dCgoKSA9PiBzZW5kVXBkYXRlKGl0ZW0udGl0bGUsICJTY3JpcHQiLCBmb3JtVmFsdWVzLnNjcmlwdCwgJ2NhcmQnKSwgMTAwMCk7CiAgICAgICAgaWYoZm9ybVZhbHVlcy5jb2RlICE9PSAoaXRlbS5jb2RlIHx8ICcnKSkgc2V0VGltZW91dCgoKSA9PiBzZW5kVXBkYXRlKGl0ZW0udGl0bGUsICJDb2RlIiwgZm9ybVZhbHVlcy5jb2RlLCAnY2FyZCcpLCAxNTAwKTsKICAgICAgICBpZihmb3JtVmFsdWVzLmxpbmsgIT09IChpdGVtLmxpbmsgfHwgJycpKSBzZXRUaW1lb3V0KCgpID0+IHNlbmRVcGRhdGUoaXRlbS50aXRsZSwgIkxpbmsiLCBmb3JtVmFsdWVzLmxpbmssICdjYXJkJyksIDIwMDApOwogICAgICAgIGlmKGZvcm1WYWx1ZXMudGl0bGUgIT09IGl0ZW0udGl0bGUpIHNldFRpbWVvdXQoKCkgPT4gc2VuZFVwZGF0ZShpdGVtLnRpdGxlLCAiVGl0bGUiLCBmb3JtVmFsdWVzLnRpdGxlLCAnY2FyZCcpLCAyNTAwKTsKICAgIH0KfQphc3luYyBmdW5jdGlvbiBlZGl0U3BvcnQodGl0bGUpIHsKICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwogICAgY29uc3QgcyA9IHNwb3J0c0RhdGEuZmluZChpdGVtID0+IGl0ZW0udGl0bGUgPT09IHRpdGxlKTsKICAgIGlmICghcykgcmV0dXJuIFN3YWwuZmlyZSgnSGF0YScsICfEsMOnZXJpayBidWx1bmFtYWTEsS4nLCAnZXJyb3InKTsKICAgIGNvbnN0IHsgdmFsdWU6IGZvcm1WYWx1ZXMgfSA9IGF3YWl0IFN3YWwuZmlyZSh7CiAgICAgICAgdGl0bGU6ICdTcG9yIMSww6dlcmnEn2luaSBEw7x6ZW5sZScsCiAgICAgICAgaHRtbDogYAogICAgICAgIDxkaXYgY2xhc3M9ImNhcmQiIHN0eWxlPSJ0ZXh0LWFsaWduOmxlZnQ7IGJvcmRlci1sZWZ0OiA1cHggc29saWQgdmFyKC0tcHJpbWFyeSk7IHBhZGRpbmc6MTVweDsgYmFja2dyb3VuZDojZjhmOWZhOyI+CiAgICAgICAgICAgIDxsYWJlbCBzdHlsZT0iZm9udC13ZWlnaHQ6Ym9sZDsiPkJhxZ9sxLFrPC9sYWJlbD48aW5wdXQgaWQ9InN3YWwtdGl0bGUiIGNsYXNzPSJzd2FsMi1pbnB1dCIgc3R5bGU9IndpZHRoOjEwMCU7IG1hcmdpbi1ib3R0b206MTBweDsiIHZhbHVlPSIke3MudGl0bGV9Ij4KICAgICAgICAgICAgPGxhYmVsIHN0eWxlPSJmb250LXdlaWdodDpib2xkOyI+QcOnxLFrbGFtYSAoS8Sxc2EpPC9sYWJlbD48dGV4dGFyZWEgaWQ9InN3YWwtZGVzYyIgY2xhc3M9InN3YWwyLXRleHRhcmVhIiBzdHlsZT0ibWFyZ2luLWJvdHRvbToxMHB4OyI+JHtzLmRlc2MgfHwgJyd9PC90ZXh0YXJlYT4KICAgICAgICAgICAgPGxhYmVsIHN0eWxlPSJmb250LXdlaWdodDpib2xkOyI+xLBwdWN1IChUaXApPC9sYWJlbD48aW5wdXQgaWQ9InN3YWwtdGlwIiBjbGFzcz0ic3dhbDItaW5wdXQiIHN0eWxlPSJ3aWR0aDoxMDAlOyBtYXJnaW4tYm90dG9tOjEwcHg7IiB2YWx1ZT0iJHtzLnRpcCB8fCAnJ30iPgogICAgICAgICAgICA8bGFiZWwgc3R5bGU9ImZvbnQtd2VpZ2h0OmJvbGQ7Ij5EZXRheSAoQWx0IE1ldGluKTwvbGFiZWw+PHRleHRhcmVhIGlkPSJzd2FsLWRldGFpbCIgY2xhc3M9InN3YWwyLXRleHRhcmVhIiBzdHlsZT0ibWFyZ2luLWJvdHRvbToxMHB4OyI+JHtzLmRldGFpbCB8fCAnJ308L3RleHRhcmVhPgogICAgICAgICAgICA8bGFiZWwgc3R5bGU9ImZvbnQtd2VpZ2h0OmJvbGQ7Ij5Pa3VudcWfdTwvbGFiZWw+PGlucHV0IGlkPSJzd2FsLXByb24iIGNsYXNzPSJzd2FsMi1pbnB1dCIgc3R5bGU9IndpZHRoOjEwMCU7IG1hcmdpbi1ib3R0b206MTBweDsiIHZhbHVlPSIke3MucHJvbnVuY2lhdGlvbiB8fCAnJ30iPgogICAgICAgICAgICA8bGFiZWwgc3R5bGU9ImZvbnQtd2VpZ2h0OmJvbGQ7Ij7EsGtvbiBTxLFuxLFmxLE8L2xhYmVsPjxpbnB1dCBpZD0ic3dhbC1pY29uIiBjbGFzcz0ic3dhbDItaW5wdXQiIHN0eWxlPSJ3aWR0aDoxMDAlOyIgdmFsdWU9IiR7cy5pY29uIHx8ICcnfSI+CiAgICAgICAgPC9kaXY+YCwKICAgICAgICB3aWR0aDogJzcwMHB4Jywgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwgY29uZmlybUJ1dHRvblRleHQ6ICdLYXlkZXQnLAogICAgICAgIHByZUNvbmZpcm06ICgpID0+IFsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N3YWwtdGl0bGUnKS52YWx1ZSwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N3YWwtZGVzYycpLnZhbHVlLCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC10aXAnKS52YWx1ZSwKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N3YWwtZGV0YWlsJykudmFsdWUsIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLXByb24nKS52YWx1ZSwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N3YWwtaWNvbicpLnZhbHVlCiAgICAgICAgXQogICAgfSk7CiAgICBpZiAoZm9ybVZhbHVlcykgewogICAgICAgIGNvbnN0IG9yaWdpbmFsVGl0bGUgPSBzLnRpdGxlOwogICAgICAgIGlmKGZvcm1WYWx1ZXNbMV0gIT09IHMuZGVzYykgc2VuZFVwZGF0ZShvcmlnaW5hbFRpdGxlLCAiVGV4dCIsIGZvcm1WYWx1ZXNbMV0sICdzcG9ydCcpOwogICAgICAgIGlmKGZvcm1WYWx1ZXNbMl0gIT09IHMudGlwKSBzZXRUaW1lb3V0KCgpID0+IHNlbmRVcGRhdGUob3JpZ2luYWxUaXRsZSwgIlRpcCIsIGZvcm1WYWx1ZXNbMl0sICdzcG9ydCcpLCA1MDApOwogICAgICAgIGlmKGZvcm1WYWx1ZXNbM10gIT09IHMuZGV0YWlsKSBzZXRUaW1lb3V0KCgpID0+IHNlbmRVcGRhdGUob3JpZ2luYWxUaXRsZSwgIkRldGFpbCIsIGZvcm1WYWx1ZXNbM10sICdzcG9ydCcpLCAxMDAwKTsKICAgICAgICBpZihmb3JtVmFsdWVzWzRdICE9PSBzLnByb251bmNpYXRpb24pIHNldFRpbWVvdXQoKCkgPT4gc2VuZFVwZGF0ZShvcmlnaW5hbFRpdGxlLCAiUHJvbnVuY2lhdGlvbiIsIGZvcm1WYWx1ZXNbNF0sICdzcG9ydCcpLCAxNTAwKTsKICAgICAgICBpZihmb3JtVmFsdWVzWzVdICE9PSBzLmljb24pIHNldFRpbWVvdXQoKCkgPT4gc2VuZFVwZGF0ZShvcmlnaW5hbFRpdGxlLCAiSWNvbiIsIGZvcm1WYWx1ZXNbNV0sICdzcG9ydCcpLCAyMDAwKTsKICAgICAgICBpZihmb3JtVmFsdWVzWzBdICE9PSBvcmlnaW5hbFRpdGxlKSBzZXRUaW1lb3V0KCgpID0+IHNlbmRVcGRhdGUob3JpZ2luYWxUaXRsZSwgIlRpdGxlIiwgZm9ybVZhbHVlc1swXSwgJ3Nwb3J0JyksIDI1MDApOwogICAgfQp9CmFzeW5jIGZ1bmN0aW9uIGVkaXRTYWxlcyh0aXRsZSkgewogICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICBjb25zdCBzID0gc2FsZXNTY3JpcHRzLmZpbmQoaXRlbSA9PiBpdGVtLnRpdGxlID09PSB0aXRsZSk7CiAgICBpZiAoIXMpIHJldHVybiBTd2FsLmZpcmUoJ0hhdGEnLCAnxLDDp2VyaWsgYnVsdW5hbWFkxLEuJywgJ2Vycm9yJyk7CiAgICBjb25zdCB7IHZhbHVlOiBmb3JtVmFsdWVzIH0gPSBhd2FpdCBTd2FsLmZpcmUoewogICAgICAgIHRpdGxlOiAnU2F0xLHFnyBNZXRuaW5pIETDvHplbmxlJywKICAgICAgICBodG1sOiBgPGRpdiBjbGFzcz0iY2FyZCIgc3R5bGU9InRleHQtYWxpZ246bGVmdDsgYm9yZGVyLWxlZnQ6IDVweCBzb2xpZCB2YXIoLS1zYWxlcyk7IHBhZGRpbmc6MTVweDsgYmFja2dyb3VuZDojZWNmZGY1OyI+PGxhYmVsIHN0eWxlPSJmb250LXdlaWdodDpib2xkOyI+QmHFn2zEsWs8L2xhYmVsPjxpbnB1dCBpZD0ic3dhbC10aXRsZSIgY2xhc3M9InN3YWwyLWlucHV0IiBzdHlsZT0id2lkdGg6MTAwJTsgbWFyZ2luLWJvdHRvbToxMHB4OyIKICAgICAgICB2YWx1ZT0iJHtzLnRpdGxlfSI+PGxhYmVsIHN0eWxlPSJmb250LXdlaWdodDpib2xkOyI+TWV0aW48L2xhYmVsPjx0ZXh0YXJlYSBpZD0ic3dhbC10ZXh0IiBjbGFzcz0ic3dhbDItdGV4dGFyZWEiIHN0eWxlPSJtaW4taGVpZ2h0OjE1MHB4OyI+JHtzLnRleHQgfHwgJyd9PC90ZXh0YXJlYT48L2Rpdj5gLAogICAgICAgIHdpZHRoOiAnNzAwcHgnLCBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLCBjb25maXJtQnV0dG9uVGV4dDogJ0theWRldCcsCiAgICAgICAgcHJlQ29uZmlybTogKCkgPT4gWyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC10aXRsZScpLnZhbHVlLCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC10ZXh0JykudmFsdWUgXQogICAgfSk7CiAgICBpZiAoZm9ybVZhbHVlcykgewogICAgICAgIGNvbnN0IG9yaWdpbmFsVGl0bGUgPSBzLnRpdGxlOwogICAgICAgIGlmKGZvcm1WYWx1ZXNbMV0gIT09IHMudGV4dCkgc2VuZFVwZGF0ZShvcmlnaW5hbFRpdGxlLCAiVGV4dCIsIGZvcm1WYWx1ZXNbMV0sICdzYWxlcycpOwogICAgICAgIGlmKGZvcm1WYWx1ZXNbMF0gIT09IG9yaWdpbmFsVGl0bGUpIHNldFRpbWVvdXQoKCkgPT4gc2VuZFVwZGF0ZShvcmlnaW5hbFRpdGxlLCAiVGl0bGUiLCBmb3JtVmFsdWVzWzBdLCAnc2FsZXMnKSwgNTAwKTsKICAgIH0KfQphc3luYyBmdW5jdGlvbiBlZGl0TmV3cyhpbmRleCkgewogICAgY29uc3QgaSA9IG5ld3NEYXRhW2luZGV4XTsKICAgIGxldCBzdGF0dXNPcHRpb25zID0gYDxvcHRpb24gdmFsdWU9IkFrdGlmIiAke2kuc3RhdHVzICE9PSAnUGFzaWYnID8gJ3NlbGVjdGVkJyA6ICcnfT5Ba3RpZjwvb3B0aW9uPjxvcHRpb24gdmFsdWU9IlBhc2lmIiAke2kuc3RhdHVzID09PSAnUGFzaWYnID8gJ3NlbGVjdGVkJyA6ICcnfT5QYXNpZjwvb3B0aW9uPmA7CiAgICBsZXQgdHlwZU9wdGlvbnMgPSBgPG9wdGlvbiB2YWx1ZT0iaW5mbyIgJHtpLnR5cGUgPT09ICdpbmZvJyA/ICdzZWxlY3RlZCcgOiAnJ30+QmlsZ2k8L29wdGlvbj48b3B0aW9uIHZhbHVlPSJ1cGRhdGUiICR7aS50eXBlID09PSAndXBkYXRlJyA/ICdzZWxlY3RlZCcgOiAnJ30+RGXEn2nFn2lrbGlrPC9vcHRpb24+PG9wdGlvbiB2YWx1ZT0iZml4IiAke2kudHlwZSA9PT0gJ2ZpeCcgPyAnc2VsZWN0ZWQnIDogJyd9PsOHw7Z6w7xsZMO8PC9vcHRpb24+YDsKICAgIAogICAgY29uc3QgeyB2YWx1ZTogZm9ybVZhbHVlcyB9ID0gYXdhaXQgU3dhbC5maXJlKHsKICAgICAgICB0aXRsZTogJ0R1eXVydXl1IETDvHplbmxlJywKICAgICAgICBodG1sOiBgPGRpdiBjbGFzcz0iY2FyZCIgc3R5bGU9InRleHQtYWxpZ246bGVmdDsgYm9yZGVyLWxlZnQ6IDVweCBzb2xpZCB2YXIoLS1zZWNvbmRhcnkpOyBwYWRkaW5nOjE1cHg7IGJhY2tncm91bmQ6I2ZmZjhlMTsiPjxsYWJlbCBzdHlsZT0iZm9udC13ZWlnaHQ6Ym9sZDsiPkJhxZ9sxLFrPC9sYWJlbD48aW5wdXQgaWQ9InN3YWwtdGl0bGUiIGNsYXNzPSJzd2FsMi1pbnB1dCIgc3R5bGU9IndpZHRoOjEwMCU7IG1hcmdpbi1ib3R0b206MTBweDsiCiAgICAgICAgdmFsdWU9IiR7aS50aXRsZSB8fCAnJ30iPjxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDsgZ2FwOjEwcHg7IG1hcmdpbi1ib3R0b206MTBweDsiPjxkaXYgc3R5bGU9ImZsZXg6MTsiPjxsYWJlbCBzdHlsZT0iZm9udC13ZWlnaHQ6Ym9sZDsiPlRhcmloPC9sYWJlbD48aW5wdXQgaWQ9InN3YWwtZGF0ZSIgY2xhc3M9InN3YWwyLWlucHV0IiBzdHlsZT0id2lkdGg6MTAwJTsiCiAgICAgICAgdmFsdWU9IiR7aS5kYXRlIHx8ICcnfSI+PC9kaXY+PGRpdiBzdHlsZT0iZmxleDoxOyI+PGxhYmVsIHN0eWxlPSJmb250LXdlaWdodDpib2xkOyI+VMO8cjwvbGFiZWw+PHNlbGVjdCBpZD0ic3dhbC10eXBlIiBjbGFzcz0ic3dhbDItaW5wdXQiIHN0eWxlPSJ3aWR0aDoxMDAlOyI+JHt0eXBlT3B0aW9uc308L3NlbGVjdD48L2Rpdj48L2Rpdj48bGFiZWwgc3R5bGU9ImZvbnQtd2VpZ2h0OmJvbGQ7Ij5NZXRpbjwvbGFiZWw+PHRleHRhcmVhIGlkPSJzd2FsLWRlc2MiIGNsYXNzPSJzd2FsMi10ZXh0YXJlYSIgc3R5bGU9Im1hcmdpbi1ib3R0b206MTBweDsiPiR7aS5kZXNjIHx8ICcnfTwvdGV4dGFyZWE+PGxhYmVsIHN0eWxlPSJmb250LXdlaWdodDpib2xkOyI+RHVydW08L2xhYmVsPjxzZWxlY3QgaWQ9InN3YWwtc3RhdHVzIiBjbGFzcz0ic3dhbDItaW5wdXQiIHN0eWxlPSJ3aWR0aDoxMDAlOyI+JHtzdGF0dXNPcHRpb25zfTwvc2VsZWN0PjwvZGl2PmAsCiAgICAgICAgd2lkdGg6ICc2MDBweCcsIHNob3dDYW5jZWxCdXR0b246IHRydWUsIGNvbmZpcm1CdXR0b25UZXh0OiAnS2F5ZGV0JywKICAgICAgICBwcmVDb25maXJtOiAoKSA9PiBbCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLXRpdGxlJykudmFsdWUsIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLWRhdGUnKS52YWx1ZSwKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N3YWwtZGVzYycpLnZhbHVlLCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC10eXBlJykudmFsdWUsIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLXN0YXR1cycpLnZhbHVlCiAgICAgICAgXQogICAgfSk7CiAgICBpZiAoZm9ybVZhbHVlcykgewogICAgICAgIGNvbnN0IG9yaWdpbmFsVGl0bGUgPSBpLnRpdGxlOwogICAgICAgIGlmKGZvcm1WYWx1ZXNbMV0gIT09IGkuZGF0ZSkgc2VuZFVwZGF0ZShvcmlnaW5hbFRpdGxlLCAiRGF0ZSIsIGZvcm1WYWx1ZXNbMV0sICduZXdzJyk7CiAgICAgICAgaWYoZm9ybVZhbHVlc1syXSAhPT0gaS5kZXNjKSBzZXRUaW1lb3V0KCgpID0+IHNlbmRVcGRhdGUob3JpZ2luYWxUaXRsZSwgIlRleHQiLCBmb3JtVmFsdWVzWzJdLCAnbmV3cycpLCA1MDApOwogICAgICAgIGlmKGZvcm1WYWx1ZXNbM10gIT09IGkudHlwZSkgc2V0VGltZW91dCgoKSA9PiBzZW5kVXBkYXRlKG9yaWdpbmFsVGl0bGUsICJDYXRlZ29yeSIsIGZvcm1WYWx1ZXNbM10sICduZXdzJyksIDEwMDApOwogICAgICAgIGlmKGZvcm1WYWx1ZXNbNF0gIT09IGkuc3RhdHVzKSBzZXRUaW1lb3V0KCgpID0+IHNlbmRVcGRhdGUob3JpZ2luYWxUaXRsZSwgIlN0YXR1cyIsIGZvcm1WYWx1ZXNbNF0sICduZXdzJyksIDE1MDApOwogICAgICAgIGlmKGZvcm1WYWx1ZXNbMF0gIT09IG9yaWdpbmFsVGl0bGUpIHNldFRpbWVvdXQoKCkgPT4gc2VuZFVwZGF0ZShvcmlnaW5hbFRpdGxlLCAiVGl0bGUiLCBmb3JtVmFsdWVzWzBdLCAnbmV3cycpLCAyMDAwKTsKICAgIH0KfQovLyAtLS0gU1RBTkRBUkQgTU9EQUxTIChUSUNLRVIsIE5FV1MsIEdVSURFLCBTQUxFUykgLS0tCmZ1bmN0aW9uIGNsb3NlTW9kYWwoaWQpIHsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7IH0KZnVuY3Rpb24gc3RhcnRUaWNrZXIoKSB7CiAgICBjb25zdCB0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RpY2tlci1jb250ZW50Jyk7CiAgICBjb25zdCBhY3RpdmVOZXdzID0gbmV3c0RhdGEuZmlsdGVyKGkgPT4gaS5zdGF0dXMgIT09ICdQYXNpZicpOwogICAgaWYoYWN0aXZlTmV3cy5sZW5ndGggPT09IDApIHsgdC5pbm5lckhUTUwgPSAiR8O8bmNlbCBkdXl1cnUgeW9rLiI7IHQuc3R5bGUuYW5pbWF0aW9uID0gJ25vbmUnOyByZXR1cm47IH0KICAgIAogICAgbGV0IHRpY2tlclRleHQgPSBhY3RpdmVOZXdzLm1hcChpID0+IHsKICAgICAgICByZXR1cm4gYDxzcGFuIHN0eWxlPSJjb2xvcjojZmFiYjAwOyBmb250LXdlaWdodDpib2xkOyI+WyR7aS5kYXRlfV08L3NwYW4+IDxzcGFuIHN0eWxlPSJjb2xvcjojZmZmOyI+JHtpLnRpdGxlfTo8L3NwYW4+IDxzcGFuIHN0eWxlPSJjb2xvcjojZGRkOyI+JHtpLmRlc2N9PC9zcGFuPmA7CiAgICB9KS5qb2luKCcgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7IOKAoiAmbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDsgJyk7CiAgICB0LmlubmVySFRNTCA9IHRpY2tlclRleHQgKyAnICZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwOyDigKIgJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7ICcgKyB0aWNrZXJUZXh0OwogICAgdC5zdHlsZS5hbmltYXRpb24gPSAndGlja2VyLXNjcm9sbCAxOTBzIGxpbmVhciBpbmZpbml0ZSc7Cn0KZnVuY3Rpb24gb3Blbk5ld3MoKSB7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmV3cy1tb2RhbCcpLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7CiAgICBjb25zdCBjID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25ld3MtY29udGFpbmVyJyk7CiAgICBjLmlubmVySFRNTCA9ICcnOwogICAgbmV3c0RhdGEuZm9yRWFjaCgoaSwgaW5kZXgpID0+IHsKICAgICAgICBsZXQgY2wgPSBpLnR5cGUgPT09ICdmaXgnID8gJ3RhZy1maXgnIDogKGkudHlwZSA9PT0gJ3VwZGF0ZScgPyAndGFnLXVwZGF0ZScgOiAndGFnLWluZm8nKTsKICAgICAgICBsZXQgdHggPSBpLnR5cGUgPT09ICdmaXgnID8gJ8OHw7Z6w7xsZMO8JyA6IChpLnR5cGUgPT09ICd1cGRhdGUnID8gJ0RlxJ9pxZ9pa2xpaycgOiAnQmlsZ2knKTsKICAgICAgICBsZXQgcGFzc2l2ZVN0eWxlID0gaS5zdGF0dXMgPT09ICdQYXNpZicgPyAnb3BhY2l0eTowLjU7IGJhY2tncm91bmQ6I2VlZTsnIDogJyc7CiAgICAgICAgbGV0IHBhc3NpdmVCYWRnZSA9IGkuc3RhdHVzID09PSAnUGFzaWYnID8gJzxzcGFuIGNsYXNzPSJuZXdzLXRhZyIgc3R5bGU9ImJhY2tncm91bmQ6IzU1NTsgY29sb3I6d2hpdGU7Ij5QQVPEsEY8L3NwYW4+JyA6ICcnOwogICAgICAgIGxldCBlZGl0QnRuID0gKGlzQWRtaW5Nb2RlICYmIGlzRWRpdGluZ0FjdGl2ZSkgPyBgPGkgY2xhc3M9ImZhcyBmYS1wZW5jaWwtYWx0IGVkaXQtaWNvbiIgc3R5bGU9InRvcDowOyByaWdodDowOyBmb250LXNpemU6MC45cmVtOyBwYWRkaW5nOjRweDsiIG9uY2xpY2s9ImV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOyBlZGl0TmV3cygke2luZGV4fSkiPjwvaT5gIDogJyc7CiAgICAgICAgYy5pbm5lckhUTUwgKz0gYDxkaXYgY2xhc3M9Im5ld3MtaXRlbSIgc3R5bGU9IiR7cGFzc2l2ZVN0eWxlfSI+JHtlZGl0QnRufTxzcGFuIGNsYXNzPSJuZXdzLWRhdGUiPiR7aS5kYXRlfTwvc3Bhbj48c3BhbiBjbGFzcz0ibmV3cy10aXRsZSI+JHtpLnRpdGxlfSAke3Bhc3NpdmVCYWRnZX08L3NwYW4+PGRpdiBjbGFzcz0ibmV3cy1kZXNjIj4ke2kuZGVzY308L2Rpdj48c3BhbiBjbGFzcz0ibmV3cy10YWcgJHtjbH0iPiR7dHh9PC9zcGFuPjwvZGl2PmA7CiAgICB9KTsKfQoKCi8vID09PT09PT09PT09PT09PT09PT09PT09PT0KLy8g4pyFIFlhecSxbiBBa8SxxZ/EsSAoRS1UYWJsbydkYW4pCi8vID09PT09PT09PT09PT09PT09PT09PT09PT0KYXN5bmMgZnVuY3Rpb24gZmV0Y2hCcm9hZGNhc3RGbG93KCkgewogICAgY29uc3QgciA9IGF3YWl0IGZldGNoKFNDUklQVF9VUkwsIHsKICAgICAgICBtZXRob2Q6ICJQT1NUIiwKICAgICAgICBoZWFkZXJzOiB7ICJDb250ZW50LVR5cGUiOiAidGV4dC9wbGFpbjtjaGFyc2V0PXV0Zi04IiB9LAogICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsKICAgICAgICAgICAgYWN0aW9uOiAiZ2V0QnJvYWRjYXN0RmxvdyIsCiAgICAgICAgICAgIHVzZXJuYW1lOiAodHlwZW9mIGN1cnJlbnRVc2VyICE9PSAidW5kZWZpbmVkIiA/IGN1cnJlbnRVc2VyIDogIiIpLAogICAgICAgICAgICB0b2tlbjogKHR5cGVvZiBnZXRUb2tlbiA9PT0gImZ1bmN0aW9uIiA/IGdldFRva2VuKCkgOiAiIikKICAgICAgICB9KQogICAgfSk7CgogICAgY29uc3QgZCA9IGF3YWl0IHIuanNvbigpOwogICAgaWYgKCFkIHx8IGQucmVzdWx0ICE9PSAic3VjY2VzcyIpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoKGQgJiYgZC5tZXNzYWdlKSA/IGQubWVzc2FnZSA6ICJZYXnEsW4gYWvEscWfxLEgYWzEsW5hbWFkxLEuIik7CiAgICB9CiAgICByZXR1cm4gZC5pdGVtcyB8fCBbXTsKfQoKYXN5bmMgZnVuY3Rpb24gb3BlbkJyb2FkY2FzdEZsb3coKSB7CiAgU3dhbC5maXJlKHsKICAgIHRpdGxlOiAiWWF5xLFuIEFrxLHFn8SxIiwKICAgIGRpZE9wZW46ICgpID0+IFN3YWwuc2hvd0xvYWRpbmcoKSwKICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZQogIH0pOwoKICB0cnkgewogICAgY29uc3QgaXRlbXNSYXcgPSBhd2FpdCBmZXRjaEJyb2FkY2FzdEZsb3coKTsKCiAgICBpZiAoIWl0ZW1zUmF3IHx8ICFpdGVtc1Jhdy5sZW5ndGgpIHsKICAgICAgU3dhbC5maXJlKCJZYXnEsW4gQWvEscWfxLEiLCAiS2F5xLF0IGJ1bHVuYW1hZMSxLiIsICJpbmZvIik7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyDinIUgU8SxcmFsYW1hIChlcG9jaCB2YXJzYSBrZXNpbiwgeW9rc2EgdGFyaWgrc2FhdGUgZ8O2cmUpCiAgICBjb25zdCBpdGVtcyA9IFsuLi5pdGVtc1Jhd10uc29ydCgoYSwgYikgPT4gewogICAgICBjb25zdCBhZSA9IE51bWJlcihhPy5zdGFydEVwb2NoIHx8IDApOwogICAgICBjb25zdCBiZSA9IE51bWJlcihiPy5zdGFydEVwb2NoIHx8IDApOwogICAgICBpZiAoYWUgJiYgYmUpIHJldHVybiBhZSAtIGJlOwoKICAgICAgY29uc3QgYWsgPSBTdHJpbmcoYT8uZGF0ZUlTTyB8fCBhPy5kYXRlIHx8ICIiKSArICIgIiArIFN0cmluZyhhPy50aW1lIHx8ICIiKTsKICAgICAgY29uc3QgYmsgPSBTdHJpbmcoYj8uZGF0ZUlTTyB8fCBiPy5kYXRlIHx8ICIiKSArICIgIiArIFN0cmluZyhiPy50aW1lIHx8ICIiKTsKICAgICAgcmV0dXJuIGFrLmxvY2FsZUNvbXBhcmUoYmspOwogICAgfSk7CgogICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTsKCiAgICAvLyDinIUgVGFyaWhlIGfDtnJlIGdydXBsYSAoZGF0ZUlTTykKICAgIGNvbnN0IGJ5RGF0ZSA9IHt9OwogICAgY29uc3QgZGF0ZUxhYmVsQnlLZXkgPSB7fTsKICAgIGl0ZW1zLmZvckVhY2goaXQgPT4gewogICAgICBjb25zdCBrZXkgPSBTdHJpbmcoaXQ/LmRhdGVJU08gfHwgaXQ/LmRhdGUgfHwgIlRhcmloIFlvayIpOwogICAgICBpZiAoIWJ5RGF0ZVtrZXldKSBieURhdGVba2V5XSA9IFtdOwogICAgICBieURhdGVba2V5XS5wdXNoKGl0KTsKCiAgICAgIGlmICghZGF0ZUxhYmVsQnlLZXlba2V5XSkgewogICAgICAgIGRhdGVMYWJlbEJ5S2V5W2tleV0gPSBTdHJpbmcoaXQ/LmRhdGVMYWJlbFRyIHx8ICIiKTsKICAgICAgfQogICAgfSk7CgogICAgLy8g4pyFIFBvcHVwIENTUyAoU3dhbCBpw6dpKQogICAgY29uc3QgY3NzID0gYAogICAgICA8c3R5bGU+CiAgICAgICAgLmJhLXdyYXB7IHRleHQtYWxpZ246bGVmdDsgbWF4LWhlaWdodDo2MnZoOyBvdmVyZmxvdzphdXRvOyBwYWRkaW5nLXJpZ2h0OjZweDsgfQogICAgICAgIC5iYS1kYXl7IG1hcmdpbjoxNHB4IDAgOHB4OyBmb250LXdlaWdodDo5MDA7IGNvbG9yOiMwZTFiNDI7IGRpc3BsYXk6ZmxleDsgYWxpZ24taXRlbXM6Y2VudGVyOyBnYXA6MTBweDsgfQoKICAgICAgICAuYmEtc2VjdGlvbnsgbWFyZ2luOjE2cHggMCA4cHg7IGZvbnQtd2VpZ2h0OjkwMDsgY29sb3I6IzBlMWI0MjsgZm9udC1zaXplOjFyZW07IH0KICAgICAgICAuYmEtZGl2aWRlcnsgbWFyZ2luOjE0cHggMDsgaGVpZ2h0OjFweDsgYmFja2dyb3VuZDojZTllOWU5OyB9CiAgICAgICAgLmJhLWVtcHR5eyBwYWRkaW5nOjEwcHggMTJweDsgYm9yZGVyOjFweCBkYXNoZWQgI2RkZDsgYm9yZGVyLXJhZGl1czoxMnB4OyBiYWNrZ3JvdW5kOiNmYWZhZmE7IGNvbG9yOiM2NjY7IG1hcmdpbjoxMHB4IDA7IGZvbnQtd2VpZ2h0OjcwMDsgfQogICAgICAgIC5iYS1iYWRnZXsgZm9udC1zaXplOi43NXJlbTsgcGFkZGluZzo0cHggOHB4OyBib3JkZXItcmFkaXVzOjk5OXB4OyBib3JkZXI6MXB4IHNvbGlkICNlOWU5ZTk7IGJhY2tncm91bmQ6I2Y4ZjhmODsgY29sb3I6IzQ0NDsgfQogICAgICAgIC5iYS1ncmlkeyBkaXNwbGF5OmdyaWQ7IGdhcDo4cHg7IH0KICAgICAgICAuYmEtcm93ewogICAgICAgICAgYm9yZGVyOjFweCBzb2xpZCAjZWVlOwogICAgICAgICAgYm9yZGVyLWxlZnQ6NHB4IHNvbGlkIHZhcigtLXNlY29uZGFyeSk7CiAgICAgICAgICBib3JkZXItcmFkaXVzOjEycHg7CiAgICAgICAgICBwYWRkaW5nOjEwcHggMTJweDsKICAgICAgICAgIGJhY2tncm91bmQ6I2ZmZjsKICAgICAgICB9CiAgICAgICAgLmJhLXJvdy5wYXN0ewogICAgICAgICAgYm9yZGVyLWxlZnQtY29sb3I6I2Q5NTM0ZjsKICAgICAgICAgIGJhY2tncm91bmQ6I2ZmZjVmNTsKICAgICAgICB9CiAgICAgICAgLmJhLXRvcHsgZGlzcGxheTpmbGV4OyBqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2VlbjsgZ2FwOjEycHg7IGFsaWduLWl0ZW1zOmZsZXgtc3RhcnQ7IH0KICAgICAgICAuYmEtdGl0bGV7IGZvbnQtd2VpZ2h0OjkwMDsgY29sb3I6IzIyMjsgbGluZS1oZWlnaHQ6MS4yNTsgfQogICAgICAgIC5iYS10aW1leyBmb250LXdlaWdodDo5MDA7IGNvbG9yOiMwZTFiNDI7IHdoaXRlLXNwYWNlOm5vd3JhcDsgfQogICAgICAgIC5iYS1zdWJ7IG1hcmdpbi10b3A6NnB4OyBmb250LXNpemU6Ljg2cmVtOyBjb2xvcjojNjY2OyBkaXNwbGF5OmZsZXg7IGdhcDoxNHB4OyBmbGV4LXdyYXA6d3JhcDsgfQogICAgICAgIC5iYS1sZWdlbmR7IGRpc3BsYXk6ZmxleDsgZ2FwOjEwcHg7IGZsZXgtd3JhcDp3cmFwOyBtYXJnaW46NnB4IDAgMTBweDsgfQogICAgICAgIC5iYS1kb3R7IGRpc3BsYXk6aW5saW5lLWZsZXg7IGFsaWduLWl0ZW1zOmNlbnRlcjsgZ2FwOjZweDsgZm9udC1zaXplOi44cmVtOyBjb2xvcjojNDQ0OyB9CiAgICAgICAgLmJhLWRvdCBpeyB3aWR0aDoxMHB4OyBoZWlnaHQ6MTBweDsgYm9yZGVyLXJhZGl1czo1MCU7IGRpc3BsYXk6aW5saW5lLWJsb2NrOyB9CiAgICAgICAgLmJhLWRvdCAudXB7IGJhY2tncm91bmQ6dmFyKC0tc2Vjb25kYXJ5KTsgfQogICAgICAgIC5iYS1kb3QgLnBheyBiYWNrZ3JvdW5kOiNkOTUzNGY7IH0KICAgICAgPC9zdHlsZT4KICAgIGA7CgogICAgbGV0IGh0bWwgPSBgJHtjc3N9PGRpdiBjbGFzcz0iYmEtd3JhcCI+YDsKICAgIGh0bWwgKz0gYAogICAgICA8ZGl2IGNsYXNzPSJiYS1sZWdlbmQiPgogICAgICAgIDxzcGFuIGNsYXNzPSJiYS1kb3QiPjxpIGNsYXNzPSJ1cCI+PC9pPiBZYWtsYcWfYW4gLyBHZWxlY2VrPC9zcGFuPgogICAgICAgIDxzcGFuIGNsYXNzPSJiYS1kb3QiPjxpIGNsYXNzPSJwYSI+PC9pPiBUYXJpaGkgR2XDp21pxZ88L3NwYW4+CiAgICAgIDwvZGl2PgogICAgYDsKCiAgICAgICAgLy8g4pyFIFlha2xhxZ9hbiAvIEdlbGVjZWsgdmUgR2XDp21pxZ8gb2xhcmFrIGF5xLFyCiAgICBjb25zdCB1cGNvbWluZ0J5RGF0ZSA9IHt9OwogICAgY29uc3QgcGFzdEJ5RGF0ZSA9IHt9OwogICAgY29uc3QgZGF0ZUtleXMgPSBPYmplY3Qua2V5cyhieURhdGUpOwoKICAgIGRhdGVLZXlzLmZvckVhY2goa2V5ID0+IHsKICAgICAgY29uc3QgYXJyID0gYnlEYXRlW2tleV0gfHwgW107CiAgICAgIGFyci5mb3JFYWNoKGl0ID0+IHsKICAgICAgICBjb25zdCBzdGFydEVwb2NoID0gTnVtYmVyKGl0Py5zdGFydEVwb2NoIHx8IDApOwogICAgICAgIGNvbnN0IGlzUGFzdCA9IHN0YXJ0RXBvY2ggPyAoc3RhcnRFcG9jaCA8IG5vdykgOiBmYWxzZTsKICAgICAgICBjb25zdCBidWNrZXQgPSBpc1Bhc3QgPyBwYXN0QnlEYXRlIDogdXBjb21pbmdCeURhdGU7CiAgICAgICAgaWYgKCFidWNrZXRba2V5XSkgYnVja2V0W2tleV0gPSBbXTsKICAgICAgICBidWNrZXRba2V5XS5wdXNoKGl0KTsKICAgICAgfSk7CiAgICB9KTsKCiAgICBjb25zdCByZW5kZXJTZWN0aW9uID0gKHRpdGxlLCBidWNrZXQsIGVtcHR5VGV4dCkgPT4gewogICAgICBjb25zdCBrZXlzID0gZGF0ZUtleXMuZmlsdGVyKGsgPT4gKGJ1Y2tldFtrXSAmJiBidWNrZXRba10ubGVuZ3RoKSk7CiAgICAgIGlmICgha2V5cy5sZW5ndGgpIHsKICAgICAgICBodG1sICs9IGA8ZGl2IGNsYXNzPSJiYS1lbXB0eSI+JHtlc2NhcGVIdG1sKGVtcHR5VGV4dCl9PC9kaXY+YDsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaHRtbCArPSBgPGRpdiBjbGFzcz0iYmEtc2VjdGlvbiI+JHtlc2NhcGVIdG1sKHRpdGxlKX08L2Rpdj5gOwogICAgICBrZXlzLmZvckVhY2goa2V5ID0+IHsKICAgICAgICBjb25zdCBsYWJlbCA9IGRhdGVMYWJlbEJ5S2V5W2tleV0gfHwgX2Zvcm1hdEJyb2FkY2FzdERhdGVUcih7IGRhdGVJU086IGtleSB9KTsKICAgICAgICBodG1sICs9IGA8ZGl2IGNsYXNzPSJiYS1kYXkiPiR7ZXNjYXBlSHRtbChsYWJlbCl9PC9kaXY+YDsKICAgICAgICBodG1sICs9IGA8ZGl2IGNsYXNzPSJiYS1ncmlkIj5gOwoKICAgICAgICBidWNrZXRba2V5XS5mb3JFYWNoKGl0ID0+IHsKICAgICAgICAgIGNvbnN0IHN0YXJ0RXBvY2ggPSBOdW1iZXIoaXQ/LnN0YXJ0RXBvY2ggfHwgMCk7CiAgICAgICAgICBjb25zdCBpc1Bhc3QgPSBzdGFydEVwb2NoID8gKHN0YXJ0RXBvY2ggPCBub3cpIDogZmFsc2U7CgogICAgICAgICAgY29uc3QgdGltZSA9IFN0cmluZyhpdD8udGltZSB8fCAiIikudHJpbSgpOwogICAgICAgICAgY29uc3QgZXZlbnQgPSBTdHJpbmcoaXQ/LmV2ZW50IHx8ICIiKS50cmltKCk7CiAgICAgICAgICBjb25zdCBhbm5vdW5jZXIgPSBTdHJpbmcoaXQ/LmFubm91bmNlciB8fCAiIikudHJpbSgpOwoKICAgICAgICAgIGh0bWwgKz0gYAogICAgICAgICAgICA8ZGl2IGNsYXNzPSJiYS1yb3cgJHtpc1Bhc3QgPyAicGFzdCIgOiAiIn0iPgogICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImJhLXRvcCI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJiYS10aXRsZSI+JHtlc2NhcGVIdG1sKGV2ZW50IHx8ICItIil9PC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJiYS10aW1lIj4ke2VzY2FwZUh0bWwodGltZSB8fCAiIil9PC9kaXY+CiAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYmEtc3ViIj4KICAgICAgICAgICAgICAgIDxzcGFuPjxpIGNsYXNzPSJmYXMgZmEtbWljcm9waG9uZSI+PC9pPiAke2VzY2FwZUh0bWwoYW5ub3VuY2VyIHx8ICItIil9PC9zcGFuPgogICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj5gOwogICAgICAgIH0pOwoKICAgICAgICBodG1sICs9IGA8L2Rpdj5gOwogICAgICB9KTsKICAgIH07CgogICAgLy8g4pyFIMOWbmNlIHlha2xhxZ9hbmxhciwgc29ucmEgZ2XDp21pxZ9sZXIKICAgIHJlbmRlclNlY3Rpb24oIllha2xhxZ9hbiAvIEdlbGVjZWsiLCB1cGNvbWluZ0J5RGF0ZSwgIllha2xhxZ9hbiB5YXnEsW4gYnVsdW5hbWFkxLEuIik7CiAgICBodG1sICs9IGA8ZGl2IGNsYXNzPSJiYS1kaXZpZGVyIj48L2Rpdj5gOwogICAgcmVuZGVyU2VjdGlvbigiR2XDp21pxZ8iLCBwYXN0QnlEYXRlLCAiR2XDp21pxZ8geWF5xLFuIGJ1bHVuYW1hZMSxLiIpOwoKICAgIGh0bWwgKz0gYDwvZGl2PmA7CgogICAgU3dhbC5maXJlKHsKICAgICAgdGl0bGU6ICJZYXnEsW4gQWvEscWfxLEiLAogICAgICBodG1sLAogICAgICB3aWR0aDogOTgwLAogICAgICBjb25maXJtQnV0dG9uVGV4dDogIkthcGF0IgogICAgfSk7CgogIH0gY2F0Y2ggKGVycikgewogICAgU3dhbC5maXJlKCJIYXRhIiwgZXJyPy5tZXNzYWdlIHx8ICJZYXnEsW4gYWvEscWfxLEgYWzEsW5hbWFkxLEuIiwgImVycm9yIik7CiAgfQp9CgovLyBYU1Mga29ydW1hc8SxCgpmdW5jdGlvbiBfZm9ybWF0QnJvYWRjYXN0RGF0ZVRyKGl0KSB7CiAgICAvLyBCYWNrZW5kIHllbmkgYWxhbmxhcsSxIGfDtm5kZXJpeW9yc2Ega3VsbGFuCiAgICBpZiAoaXQgJiYgaXQuZGF0ZUxhYmVsVHIpIHJldHVybiBTdHJpbmcoaXQuZGF0ZUxhYmVsVHIpOwoKICAgIC8vIEZhbGxiYWNrOiBpdC5kYXRlSVNPICh5eXl5LW1tLWRkKSB2ZXlhIGl0LmRhdGUKICAgIGNvbnN0IHMgPSBTdHJpbmcoaXQ/LmRhdGVJU08gfHwgaXQ/LmRhdGUgfHwgIiIpLnRyaW0oKTsKICAgIGlmICghcykgcmV0dXJuICJUYXJpaCBZb2siOwoKICAgIC8vIElTTyB5eXl5LW1tLWRkCiAgICBjb25zdCBtID0gcy5tYXRjaCgvXihcZHs0fSktKFxkezEsMn0pLShcZHsxLDJ9KS8pOwogICAgaWYgKG0pIHsKICAgICAgICBjb25zdCBkID0gbmV3IERhdGUoTnVtYmVyKG1bMV0pLCBOdW1iZXIobVsyXSkgLSAxLCBOdW1iZXIobVszXSkpOwogICAgICAgIHJldHVybiBuZXcgSW50bC5EYXRlVGltZUZvcm1hdCgidHItVFIiLCB7IGRheTogIjItZGlnaXQiLCBtb250aDogImxvbmciLCB5ZWFyOiAibnVtZXJpYyIsIHdlZWtkYXk6ICJsb25nIiB9KS5mb3JtYXQoZCk7CiAgICB9CgogICAgLy8gZGQubW0ueXl5eSAvIGRkL21tL3l5eXkKICAgIGNvbnN0IG0yID0gcy5tYXRjaCgvXihcZHsxLDJ9KVtcLi8tXShcZHsxLDJ9KVtcLi8tXShcZHs0fSkvKTsKICAgIGlmIChtMikgewogICAgICAgIGNvbnN0IGQgPSBuZXcgRGF0ZShOdW1iZXIobTJbM10pLCBOdW1iZXIobTJbMl0pIC0gMSwgTnVtYmVyKG0yWzFdKSk7CiAgICAgICAgcmV0dXJuIG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KCJ0ci1UUiIsIHsgZGF5OiAiMi1kaWdpdCIsIG1vbnRoOiAibG9uZyIsIHllYXI6ICJudW1lcmljIiwgd2Vla2RheTogImxvbmciIH0pLmZvcm1hdChkKTsKICAgIH0KCiAgICByZXR1cm4gczsgLy8gZW4ga8O2dMO8IGhhbGl5bGUgZ8O2c3Rlcgp9CgpmdW5jdGlvbiBlc2NhcGVIdG1sKHN0cikgewogICAgcmV0dXJuIFN0cmluZyhzdHIgPz8gIiIpCiAgICAgICAgLnJlcGxhY2VBbGwoIiYiLCAiJmFtcDsiKQogICAgICAgIC5yZXBsYWNlQWxsKCI8IiwgIiZsdDsiKQogICAgICAgIC5yZXBsYWNlQWxsKCI+IiwgIiZndDsiKQogICAgICAgIC5yZXBsYWNlQWxsKCciJywgIiZxdW90OyIpCiAgICAgICAgLnJlcGxhY2VBbGwoIiciLCAiJiMwMzk7Iik7Cn0KCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyBTYcSfbGFtbGHFn3TEsXJtYSAoaGF0YSB5w7ZuZXRpbWkgKyBsb2NhbFN0b3JhZ2UgZ8O8dmVubGkgeWF6bWEpCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpjb25zdCBERUJVRyA9ICgoKSA9PiB7CiAgICB0cnkgeyByZXR1cm4gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ0RFQlVHJykgPT09ICcxJzsgfSBjYXRjaCAoZSkgeyByZXR1cm4gZmFsc2U7IH0KfSkoKTsKCmZ1bmN0aW9uIGRsb2coLi4uYXJncykgewogICAgdHJ5IHsgaWYgKERFQlVHKSBjb25zb2xlLmxvZyguLi5hcmdzKTsgfSBjYXRjaCAoZSkge30KfQoKZnVuY3Rpb24gc2FmZUxvY2FsU3RvcmFnZVNldChrZXksIHZhbHVlLCBtYXhCeXRlcyA9IDQgKiAxMDI0ICogMTAyNCkgeyAvLyB+NE1CCiAgICB0cnkgewogICAgICAgIGNvbnN0IHN0ciA9IEpTT04uc3RyaW5naWZ5KHZhbHVlKTsKICAgICAgICAvLyBCYXNpdCBib3l1dCBrb250cm9sw7wgKFVURi0xNiB5YWtsYcWfxLHEn8SxKQogICAgICAgIGlmIChzdHIubGVuZ3RoICogMiA+IG1heEJ5dGVzKSB7CiAgICAgICAgICAgIHRyeSB7IFN3YWwuZmlyZSgnVXlhcsSxJywgJ1Zlcmkgw6dvayBiw7x5w7xrLCBrYXlkZWRpbGVtZWRpJywgJ3dhcm5pbmcnKTsgfSBjYXRjaCAoZSkge30KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShrZXksIHN0cik7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgaWYgKGUgJiYgKGUubmFtZSA9PT0gJ1F1b3RhRXhjZWVkZWRFcnJvcicgfHwgZS5uYW1lID09PSAnTlNfRVJST1JfRE9NX1FVT1RBX1JFQUNIRUQnKSkgewogICAgICAgICAgICB0cnkgeyBTd2FsLmZpcmUoJ0hhdGEnLCAnRGVwb2xhbWEgYWxhbsSxIGRvbHUnLCAnZXJyb3InKTsgfSBjYXRjaCAoeCkge30KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBkbG9nKCdbc2FmZUxvY2FsU3RvcmFnZVNldF0nLCBlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQp9CgpmdW5jdGlvbiBzYWZlTG9jYWxTdG9yYWdlR2V0KGtleSwgZmFsbGJhY2sgPSBudWxsKSB7CiAgICB0cnkgewogICAgICAgIGNvbnN0IHJhdyA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSk7CiAgICAgICAgaWYgKHJhdyA9PSBudWxsKSByZXR1cm4gZmFsbGJhY2s7CiAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UocmF3KTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICByZXR1cm4gZmFsbGJhY2s7CiAgICB9Cn0KCmNvbnN0IHN0b3JhZ2UgPSB7CiAgICBzZXQ6IChrLCB2KSA9PiBzYWZlTG9jYWxTdG9yYWdlU2V0KGssIHYpLAogICAgZ2V0OiAoaywgZmIgPSBudWxsKSA9PiBzYWZlTG9jYWxTdG9yYWdlR2V0KGssIGZiKSwKICAgIGRlbDogKGspID0+IHsgdHJ5IHsgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oayk7IH0gY2F0Y2ggKGUpIHt9IH0KfTsKCi8vIEdsb2JhbCBlcnJvciBoYW5kbGVycyAoa3VsbGFuxLFjxLF5YSBzYWRlIG1lc2FqLCBhZG1pbidlIGRldGF5IGxvZykKd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgZnVuY3Rpb24gKGUpIHsKICAgIHRyeSB7IGlmIChpc0FkbWluTW9kZSB8fCBpc0xvY0FkbWluKSBkbG9nKCdbR2xvYmFsIEVycm9yXScsIGUgJiYgKGUuZXJyb3IgfHwgZS5tZXNzYWdlKSA/IChlLmVycm9yIHx8IGUubWVzc2FnZSkgOiBlKTsgfSBjYXRjaCAoXykge30KICAgIHRyeSB7IGlmICh0eXBlb2Ygc2hvd0dsb2JhbEVycm9yID09PSAnZnVuY3Rpb24nKSBzaG93R2xvYmFsRXJyb3IoJ0Jla2xlbm1leWVuIGhhdGE6ICcgKyAoZSAmJiBlLm1lc3NhZ2UgPyBlLm1lc3NhZ2UgOiAnQmlsaW5tZXllbicpKTsgfSBjYXRjaCAoXykge30KfSk7Cgp3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndW5oYW5kbGVkcmVqZWN0aW9uJywgZnVuY3Rpb24gKGUpIHsKICAgIHRyeSB7IGlmIChpc0FkbWluTW9kZSB8fCBpc0xvY0FkbWluKSBkbG9nKCdbVW5oYW5kbGVkIFByb21pc2VdJywgZSAmJiBlLnJlYXNvbiA/IGUucmVhc29uIDogZSk7IH0gY2F0Y2ggKF8pIHt9CiAgICB0cnkgeyBpZiAodHlwZW9mIHNob3dHbG9iYWxFcnJvciA9PT0gJ2Z1bmN0aW9uJykgc2hvd0dsb2JhbEVycm9yKCdCZWtsZW5tZXllbiBoYXRhOiAnICsgKGUgJiYgZS5yZWFzb24gJiYgZS5yZWFzb24ubWVzc2FnZSA/IGUucmVhc29uLm1lc3NhZ2UgOiAnQmlsaW5tZXllbicpKTsgfSBjYXRjaCAoXykge30KfSk7CgoKZnVuY3Rpb24gb3Blbkd1aWRlKCkgewogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2d1aWRlLW1vZGFsJykuc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsKICAgIGNvbnN0IGdyaWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3VpZGUtZ3JpZCcpOwogICAgZ3JpZC5pbm5lckhUTUwgPSAnJzsKICAgIHNwb3J0c0RhdGEuZm9yRWFjaCgocywgaW5kZXgpID0+IHsKICAgICAgICBsZXQgcHJvbkh0bWwgPSBzLnByb251bmNpYXRpb24gPyBgPGRpdiBjbGFzcz0icHJvbnVuY2lhdGlvbi1iYWRnZSI+IPCfl6PvuI8gICR7cy5wcm9udW5jaWF0aW9ufTwvZGl2PmAgOiAnJzsKICAgICAgICBsZXQgZWRpdEJ0biA9IChpc0FkbWluTW9kZSAmJiBpc0VkaXRpbmdBY3RpdmUpID8gYDxpIGNsYXNzPSJmYXMgZmEtcGVuY2lsLWFsdCBlZGl0LWljb24iIHN0eWxlPSJ0b3A6NXB4OyByaWdodDo1cHg7IHotaW5kZXg6NTA7IiBvbmNsaWNrPSJldmVudC5zdG9wUHJvcGFnYXRpb24oKTsgZWRpdFNwb3J0KCcke2VzY2FwZUZvckpzU3RyaW5nKHMudGl0bGUpfScpIj48L2k+YCA6ICcnOwogICAgICAgIGdyaWQuaW5uZXJIVE1MICs9IGA8ZGl2IGNsYXNzPSJndWlkZS1pdGVtIiBvbmNsaWNrPSJzaG93U3BvcnREZXRhaWwoJHtpbmRleH0pIj4ke2VkaXRCdG59PGkgY2xhc3M9ImZhcyAke3MuaWNvbn0gZ3VpZGUtaWNvbiI+PC9pPjxzcGFuIGNsYXNzPSJndWlkZS10aXRsZSI+JHtzLnRpdGxlfTwvc3Bhbj4ke3Byb25IdG1sfTxkaXYgY2xhc3M9Imd1aWRlLWRlc2MiPiR7cy5kZXNjfTwvZGl2PjxkaXYgY2xhc3M9Imd1aWRlLXRpcCI+PGkgY2xhc3M9ImZhcyBmYS1saWdodGJ1bGIiPjwvaT4gJHtzLnRpcH08L2Rpdj48ZGl2IHN0eWxlPSJmb250LXNpemU6MC44cmVtOyBjb2xvcjojOTk5OyBtYXJnaW4tdG9wOjVweDsiPihEZXRheSBpw6dpbiB0xLFrbGEpPC9kaXY+PC9kaXY+YDsKICAgIH0pOwp9CmZ1bmN0aW9uIHNob3dTcG9ydERldGFpbChpbmRleCkgewogICAgY29uc3Qgc3BvcnQgPSBzcG9ydHNEYXRhW2luZGV4XTsKICAgIGNvbnN0IGRldGFpbFRleHQgPSBzcG9ydC5kZXRhaWwgPyBzcG9ydC5kZXRhaWwucmVwbGFjZSgvXG4vZywnPGJyPicpIDogIkJ1IGnDp2VyaWsgacOnaW4gaGVuw7x6IGRldGF5IGVrbGVubWVtacWfLiI7CiAgICBjb25zdCBwcm9uRGV0YWlsID0gc3BvcnQucHJvbnVuY2lhdGlvbiA/IGA8ZGl2IHN0eWxlPSJjb2xvcjojZTY1MTAwOyBmb250LXdlaWdodDpib2xkOyBtYXJnaW4tYm90dG9tOjE1cHg7Ij4g8J+Xo++4jyAgT2t1bnXFn3U6ICR7c3BvcnQucHJvbnVuY2lhdGlvbn08L2Rpdj5gIDogJyc7CiAgICBTd2FsLmZpcmUoewogICAgICAgIHRpdGxlOiBgPGkgY2xhc3M9ImZhcyAke3Nwb3J0Lmljb259IiBzdHlsZT0iY29sb3I6IzBlMWI0MjsiPjwvaT4gJHtzcG9ydC50aXRsZX1gLAogICAgICAgIGh0bWw6IGAke3Byb25EZXRhaWx9PGRpdiBzdHlsZT0idGV4dC1hbGlnbjpsZWZ0OyBmb250LXNpemU6MXJlbTsgbGluZS1oZWlnaHQ6MS42OyI+JHtkZXRhaWxUZXh0fTwvZGl2PmAsCiAgICAgICAgc2hvd0Nsb3NlQnV0dG9uOiB0cnVlLCBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsIHdpZHRoOiAnNjAwcHgnLCBiYWNrZ3JvdW5kOiAnI2Y4ZjlmYScKICAgIH0pOwp9CmZ1bmN0aW9uIG9wZW5TYWxlcygpIHsKICAgIC8vIFRlbGVTYXTEscWfIGFydMSxayB0YW0gZWtyYW4gbW9kw7xsCiAgICBvcGVuVGVsZXNhbGVzQXJlYSgpOwp9CmZ1bmN0aW9uIHRvZ2dsZVNhbGVzKGluZGV4KSB7CiAgICBjb25zdCBpdGVtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHNhbGVzLSR7aW5kZXh9YCk7CiAgICBjb25zdCBpY29uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGljb24tJHtpbmRleH1gKTsKICAgIGl0ZW0uY2xhc3NMaXN0LnRvZ2dsZSgnYWN0aXZlJyk7CiAgICBpZihpdGVtLmNsYXNzTGlzdC5jb250YWlucygnYWN0aXZlJykpeyBpY29uLmNsYXNzTGlzdC5yZXBsYWNlKCdmYS1jaGV2cm9uLWRvd24nLCAnZmEtY2hldnJvbi11cCcpOyB9IAogICAgZWxzZSB7IGljb24uY2xhc3NMaXN0LnJlcGxhY2UoJ2ZhLWNoZXZyb24tdXAnLCAnZmEtY2hldnJvbi1kb3duJyk7IH0KfQoKLy8gLS0tIFBFTkFMVFkgR0FNRSAtLS0KLy8gVGFzYXLEsW0vR8O8bmNlbGxlbWU6IFRla3JhcmxheWFuIHNvcnUgZW5nZWxpLCBha8SxbGzEsSA1MDo1MCwgZG91YmxlIHJvemV0LCBkYWhhIG5ldCBtYcOnIHNvbnUgZWtyYW7EsQoKbGV0IHBTY29yZSA9IDAsIHBCYWxscyA9IDEwLCBwQ3VycmVudFEgPSBudWxsOwpsZXQgcFF1ZXN0aW9uUXVldWUgPSBbXTsgICAgICAgIC8vIG90dXJ1bSBib3l1bmNhIHNvcnVsYWNhayBzb3J1IGluZGVrc2xlcmkgKGthcsSxxZ90xLFyxLFsbcSxxZ8pCmxldCBwQXNrZWRDb3VudCA9IDA7ICAgICAgICAgICAgLy8ga2HDpyBzb3J1IHNvcnVsZHUKbGV0IHBDb3JyZWN0Q291bnQgPSAwOyAgICAgICAgICAvLyBrYcOnIGRvxJ9ydQpsZXQgcFdyb25nQ291bnQgPSAwOyAgICAgICAgICAgIC8vIGthw6cgeWFubMSxxZ8KCmZ1bmN0aW9uIHNldERvdWJsZUluZGljYXRvcihpc0FjdGl2ZSkgewogICAgY29uc3QgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZG91YmxlLWluZGljYXRvcicpOwogICAgaWYgKCFlbCkgcmV0dXJuOwogICAgZWwuc3R5bGUuZGlzcGxheSA9IGlzQWN0aXZlID8gJ2lubGluZS1mbGV4JyA6ICdub25lJzsKfQoKZnVuY3Rpb24gdXBkYXRlSm9rZXJCdXR0b25zKCkgewogICAgY29uc3QgY2FsbEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdqb2tlci1jYWxsJyk7CiAgICBjb25zdCBoYWxmQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2pva2VyLWhhbGYnKTsKICAgIGNvbnN0IGRvdWJsZUJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdqb2tlci1kb3VibGUnKTsKCiAgICBpZiAoY2FsbEJ0bikgY2FsbEJ0bi5kaXNhYmxlZCA9IGpva2Vycy5jYWxsID09PSAwOwogICAgaWYgKGhhbGZCdG4pIGhhbGZCdG4uZGlzYWJsZWQgPSBqb2tlcnMuaGFsZiA9PT0gMDsKICAgIGlmIChkb3VibGVCdG4pIGRvdWJsZUJ0bi5kaXNhYmxlZCA9IGpva2Vycy5kb3VibGUgPT09IDAgfHwgZmlyc3RBbnN3ZXJJbmRleCAhPT0gLTE7CgogICAgLy8gRG91YmxlIGFrdGlma2VuIGRpxJ9lcmxlcmkga2lsaXRsZW5zaW4KICAgIGlmIChmaXJzdEFuc3dlckluZGV4ICE9PSAtMSkgewogICAgICAgIGlmIChjYWxsQnRuKSBjYWxsQnRuLmRpc2FibGVkID0gdHJ1ZTsKICAgICAgICBpZiAoaGFsZkJ0bikgaGFsZkJ0bi5kaXNhYmxlZCA9IHRydWU7CiAgICAgICAgaWYgKGRvdWJsZUJ0bikgZG91YmxlQnRuLmRpc2FibGVkID0gdHJ1ZTsKICAgIH0KfQoKZnVuY3Rpb24gdXNlSm9rZXIodHlwZSkgewogICAgaWYgKCFwQ3VycmVudFEpIHJldHVybjsKICAgIGlmIChqb2tlcnNbdHlwZV0gPT09IDApIHJldHVybjsKICAgIGlmIChmaXJzdEFuc3dlckluZGV4ICE9PSAtMSAmJiB0eXBlICE9PSAnZG91YmxlJykgcmV0dXJuOwoKICAgIGpva2Vyc1t0eXBlXSA9IDA7CiAgICB1cGRhdGVKb2tlckJ1dHRvbnMoKTsKCiAgICBjb25zdCBjdXJyZW50USA9IHBDdXJyZW50UTsKICAgIGNvbnN0IGNvcnJlY3RBbnMgPSBjdXJyZW50US5hOwogICAgY29uc3QgYnRucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wZW5hbHR5LWJ0bicpOwoKICAgIGlmICh0eXBlID09PSAnY2FsbCcpIHsKICAgICAgICBjb25zdCBleHBlcnRzID0gWyJVbXV0IEJleSIsICJEb8SfdcWfIEJleSIsICJEZW5peiBCZXkiLCAiRXNyYSBIYW7EsW0iXTsKICAgICAgICBjb25zdCBleHBlcnQgPSBleHBlcnRzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGV4cGVydHMubGVuZ3RoKV07CgogICAgICAgIGxldCBndWVzcyA9IGNvcnJlY3RBbnM7CiAgICAgICAgLy8gJTgwIGRvxJ9ydSwgJTIwIHlhbmzEscWfIHRhaG1pbgogICAgICAgIGlmIChNYXRoLnJhbmRvbSgpID4gMC44ICYmIGN1cnJlbnRRLm9wdHMubGVuZ3RoID4gMSkgewogICAgICAgICAgICBjb25zdCBpbmNvcnJlY3QgPSBjdXJyZW50US5vcHRzLm1hcCgoXywgaSkgPT4gaSkuZmlsdGVyKGkgPT4gaSAhPT0gY29ycmVjdEFucyk7CiAgICAgICAgICAgIGd1ZXNzID0gaW5jb3JyZWN0W01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGluY29ycmVjdC5sZW5ndGgpXSA/PyBjb3JyZWN0QW5zOwogICAgICAgIH0KCiAgICAgICAgU3dhbC5maXJlKHsKICAgICAgICAgICAgaWNvbjogJ2luZm8nLAogICAgICAgICAgICB0aXRsZTogJyDwn5OeIFRlbGVmb24gSm9rZXJpJywKICAgICAgICAgICAgaHRtbDogYCR7ZXhwZXJ0fSBzb3J1eXUgY2V2YXBsxLF5b3IuLi48YnI+PGJyPiJCZW5pbSB0YWhtaW5pbSAqKiR7U3RyaW5nLmZyb21DaGFyQ29kZSg2NSArIGd1ZXNzKX0qKiDFn8Sxa2vEsS4gQnVuZGFuICR7TWF0aC5yYW5kb20oKSA8IDAuOCA/ICLDp29rIGVtaW5pbSIgOiAiZW1pbiBkZcSfaWxpbSJ9LiJgLAogICAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogJ0thcGF0JwogICAgICAgIH0pOwoKICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ2hhbGYnKSB7CiAgICAgICAgY29uc3Qgb3B0TGVuID0gQXJyYXkuaXNBcnJheShjdXJyZW50US5vcHRzKSA/IGN1cnJlbnRRLm9wdHMubGVuZ3RoIDogMDsKICAgICAgICBpZiAob3B0TGVuIDw9IDIpIHsKICAgICAgICAgICAgU3dhbC5maXJlKHsgaWNvbjonaW5mbycsIHRpdGxlOifinILvuI8gNTA6NTAnLCB0ZXh0OidCdSBzb3J1ZGEgNTA6NTAgdXlndWxhbmFtYXouJywgdG9hc3Q6dHJ1ZSwgcG9zaXRpb246J3RvcCcsIHNob3dDb25maXJtQnV0dG9uOmZhbHNlLCB0aW1lcjoxODAwIH0pOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyA0KyDFn8Sxa3RhIDIgeWFubMSxxZ8sIDMgxZ/EsWt0YSAxIHlhbmzEscWfIGVsZQogICAgICAgIGNvbnN0IHJlbW92ZUNvdW50ID0gb3B0TGVuID49IDQgPyAyIDogMTsKICAgICAgICBjb25zdCBpbmNvcnJlY3QgPSBjdXJyZW50US5vcHRzLm1hcCgoXywgaSkgPT4gaSkuZmlsdGVyKGkgPT4gaSAhPT0gY29ycmVjdEFucyk7CiAgICAgICAgaW5jb3JyZWN0LnNvcnQoKCkgPT4gTWF0aC5yYW5kb20oKSAtIDAuNSkuc2xpY2UoMCwgcmVtb3ZlQ291bnQpLmZvckVhY2goaWR4ID0+IHsKICAgICAgICAgICAgY29uc3QgYiA9IGJ0bnNbaWR4XTsKICAgICAgICAgICAgaWYgKCFiKSByZXR1cm47CiAgICAgICAgICAgIGIuZGlzYWJsZWQgPSB0cnVlOwogICAgICAgICAgICBiLnN0eWxlLnRleHREZWNvcmF0aW9uID0gJ2xpbmUtdGhyb3VnaCc7CiAgICAgICAgICAgIGIuc3R5bGUub3BhY2l0eSA9ICcwLjQnOwogICAgICAgIH0pOwoKICAgICAgICBTd2FsLmZpcmUoewogICAgICAgICAgICBpY29uOiAnc3VjY2VzcycsCiAgICAgICAgICAgIHRpdGxlOiAnIOKcgu+4jyA1MDo1MCcsCiAgICAgICAgICAgIHRleHQ6IHJlbW92ZUNvdW50ID09PSAyID8gJ8Swa2kgeWFubMSxxZ8gxZ/EsWsgZWxlbmRpIScgOiAnQmlyIHlhbmzEscWfIMWfxLFrIGVsZW5kaSEnLAogICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgcG9zaXRpb246ICd0b3AnLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHRpbWVyOiAxNDAwCiAgICAgICAgfSk7CgogICAgfSBlbHNlIGlmICh0eXBlID09PSAnZG91YmxlJykgewogICAgICAgIGRvdWJsZUNoYW5jZVVzZWQgPSB0cnVlOwogICAgICAgIHNldERvdWJsZUluZGljYXRvcih0cnVlKTsKICAgICAgICBTd2FsLmZpcmUoewogICAgICAgICAgICBpY29uOiAnd2FybmluZycsCiAgICAgICAgICAgIHRpdGxlOiAnMu+4jyDig6Mgw4dpZnQgQ2V2YXAnLAogICAgICAgICAgICB0ZXh0OiAnQmlyIGtleiB5YW5sxLHFnyBjZXZhcCBoYWtrxLFuIHZhci4nLAogICAgICAgICAgICB0b2FzdDogdHJ1ZSwKICAgICAgICAgICAgcG9zaXRpb246ICd0b3AnLAogICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsCiAgICAgICAgICAgIHRpbWVyOiAyMjAwCiAgICAgICAgfSk7CiAgICB9Cn0KCgpmdW5jdGlvbiBvcGVuR2FtZUh1YigpIHsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnYW1lLWh1Yi1tb2RhbCcpLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7Cn0KCmZ1bmN0aW9uIG9wZW5RdWlja0RlY2lzaW9uR2FtZSgpIHsKICAgIHRyeSB7IGNsb3NlTW9kYWwoJ2dhbWUtaHViLW1vZGFsJyk7IH0gY2F0Y2goZSkge30KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdWljay1tb2RhbCcpLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7CgogICAgLy8gTG9iYnkgZWtyYW7EsQogICAgY29uc3QgbG9iYnkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncWQtbG9iYnknKTsKICAgIGNvbnN0IGdhbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncWQtZ2FtZScpOwogICAgaWYgKGxvYmJ5KSBsb2JieS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgIGlmIChnYW1lKSBnYW1lLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CgogICAgLy8gUmVzZXQgZ8O2c3RlcmdlbGVyCiAgICBjb25zdCB0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FkLXRpbWUnKTsgaWYgKHQpIHQuaW5uZXJUZXh0ID0gJzMwJzsKICAgIGNvbnN0IHMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncWQtc2NvcmUnKTsgaWYgKHMpIHMuaW5uZXJUZXh0ID0gJzAnOwogICAgY29uc3Qgc3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncWQtc3RlcCcpOyBpZiAoc3QpIHN0LmlubmVyVGV4dCA9ICcwJzsKfQoKLy8gLS0tIEhJWkxJIEtBUkFSIE9ZVU5VIC0tLQpsZXQgcWRUaW1lciA9IG51bGw7CmxldCBxZFRpbWVMZWZ0ID0gMzA7CmxldCBxZFNjb3JlID0gMDsKbGV0IHFkU3RlcCA9IDA7CmxldCBxZFF1ZXVlID0gW107Cgpjb25zdCBRVUlDS19ERUNJU0lPTl9CQU5LID0gWwogIHsKICAgIHE6ICdNw7zFn3Rlcmk6ICJGaXlhdCBwYWhhbMSxLCBpcHRhbCBlZGVjZcSfaW0uIiDEsGxrIHlha2xhxZ/EsW3EsW4gbmUgb2xtYWzEsT8nLAogICAgb3B0czogWwogICAgICAnSGVtZW4gaXB0YWwgacWfbGVtaW5pIGJhxZ9sYXRhbMSxbS4nLAogICAgICAnSGFrbMSxc8SxbsSxeiwgc2l6aSBhbmzEsXlvcnVtLiBQYWtldC9hdmFudGFqbGFyYSBnw7ZyZSBhbHRlcm5hdGlmIHN1bmF5xLFtIG3EsT8nLAogICAgICAnS2FtcGFueWEgeW9rLCB5YXBhY2FrIGJpciDFn2V5IHlvay4nCiAgICBdLAogICAgYTogMSwKICAgIGV4cDogJ0VtcGF0aSArIGlodGl5YcOnIGFuYWxpemkgaXRpcmF6xLEgeXVtdcWfYXTEsXIgdmUgaWtuYXnEsSBhcnTEsXLEsXIuJwogIH0sCiAgewogICAgcTogJ03DvMWfdGVyaTogIlV5Z3VsYW1hIGHDp8SxbG3EsXlvci4iIEVuIGjEsXpsxLEgaWxrIGtvbnRyb2wgbmU/JywKICAgIG9wdHM6IFsKICAgICAgJ8WeaWZyZXlpIHPEsWbEsXJsYXQuJywKICAgICAgJ8SwbnRlcm5ldCBiYcSfbGFudMSxc8SxIC8gVlBOIC8gRE5TIGtvbnRyb2zDvCB5YXB0xLFyLicsCiAgICAgICdIZW1lbiBjaWhhesSxIGZhYnJpa2EgYXlhcmxhcsSxbmEgZMO2bmTDvHIuJwogICAgXSwKICAgIGE6IDEsCiAgICBleHA6ICfDlm5jZSBrw7ZrIG5lZGVuaSBkYXJhbHQ6IGJhxJ9sYW50xLEgbcSxIHV5Z3VsYW1hIG3EsT8gQsO8ecO8ayBhZMSxbWxhcsSxIHNvbmEgYsSxcmFrLicKICB9LAogIHsKICAgIHE6ICdNw7zFn3Rlcmk6ICJZYXnEsW4gZG9udXlvci4iIFRla25pa3RlIGRvxJ9ydSBzb3J1IGhhbmdpc2k/JywKICAgIG9wdHM6IFsKICAgICAgJ0hhbmdpIGNpaGF6ZGEgKFRWL3RlbGVmb24pIHZlIGhhbmdpIGHEn2RhIChXaeKAkUZpL2thYmxvKSBvbHV5b3I/JywKICAgICAgJ0thw6cgZ8O8bmTDvHIgYsO2eWxlPycsCiAgICAgICfFnmltZGkga2FwYXTEsXAgYcOnxLFuLicKICAgIF0sCiAgICBhOiAwLAogICAgZXhwOiAnQ2loYXogKyBhxJ8gYmlsZ2lzaSwgc29ydW51IGjEsXpsxLEgaXpvbGUgZXRtZXlpIHNhxJ9sYXIuJwogIH0sCiAgewogICAgcTogJ03DvMWfdGVyaTogIsSwYWRlIGlzdGl5b3J1bS4iIEVuIGRvxJ9ydSB5w7ZubGVuZGlybWU/JywKICAgIG9wdHM6IFsKICAgICAgJ0hlbWVuIGthcGF0YWzEsW0uJywKICAgICAgJ8SwYWRlIGtvxZ91bGxhcsSxIHZlIGFkxLFtbGFyxLEgbmV0IGFubGF0LCBkb8SfcnUga2FuYWxhIHnDtm5sZW5kaXIgKGFzaXN0YW4vcmVoYmVyKS4nLAogICAgICAnVGVrcmFyIGFyYXnEsW4uJwogICAgXSwKICAgIGE6IDEsCiAgICBleHA6ICdOZXQgc8O8cmXDpyArIGRvxJ9ydSBrYW5hbCA9IG1lbW51bml5ZXQgKyB0ZWtyYXIgYXJhbWF5xLEgYXphbHTEsXIuJwogIH0sCiAgewogICAgcTogJ03DvMWfdGVyaTogIkthbXBhbnlhZGFuIHlhcmFybGFuYW3EsXlvcnVtLiIgxLBsayBhZMSxbT8nLAogICAgb3B0czogWwogICAgICAnS2FtcGFueWEga2/Fn3VsbGFyxLEgKHRhcmloL3Bha2V0L2NpaGF6KSB1eWd1biBtdSBrb250cm9sIGV0LicsCiAgICAgICdEaXJla3Qga2FtcGFueWF5xLEgdGFuxLFtbGEuJywKICAgICAgJ1NvcnVuIHlvayBkZXlpcCBrYXBhdC4nCiAgICBdLAogICAgYTogMCwKICAgIGV4cDogJ1V5Z3VubHVrIGtvbnRyb2zDvCB5YXDEsWxtYWRhbiBpxZ9sZW0geWFwbWFrIGhhdGF5YSBzw7xyw7xrbGVyLicKICB9LAogIHsKICAgIHE6ICdNw7zFn3Rlcmkgc2luaXJsaTogIktpbXNlIMOnw7Z6bWVkaSEiIE5lIHlhcGFyc8Sxbj8nLAogICAgb3B0czogWwogICAgICAnU2FraW5sZcWfdGlyaWNpIGJpciBjw7xtbGUgKyDDtnpldCArIG5ldCBha3NpeW9uIHBsYW7EsS4nLAogICAgICAnU8SxcmF5YSBhbGFsxLFtLicsCiAgICAgICdTZXMgecO8a3NlbHQuJwogICAgXSwKICAgIGE6IDAsCiAgICBleHA6ICdLb250cm9sw7wgZ2VyaSBhbG1hayBpw6dpbiBlbXBhdGkgKyDDtnpldCArIHBsYW4gw7zDp2zDvHPDvCDDp2FsxLHFn8Sxci4nCiAgfQpdOwoKZnVuY3Rpb24gcmVzZXRRdWlja0RlY2lzaW9uKCkgewogICAgaWYgKHFkVGltZXIpIHsgY2xlYXJJbnRlcnZhbChxZFRpbWVyKTsgcWRUaW1lciA9IG51bGw7IH0KICAgIHFkVGltZUxlZnQgPSAzMDsgcWRTY29yZSA9IDA7IHFkU3RlcCA9IDA7IHFkUXVldWUgPSBbXTsKICAgIG9wZW5RdWlja0RlY2lzaW9uR2FtZSgpOwp9CgpmdW5jdGlvbiBzdGFydFF1aWNrRGVjaXNpb24oKSB7CiAgICBjb25zdCBiYW5rID0gQXJyYXkuaXNBcnJheShxdWlja0RlY2lzaW9uUXVlc3Rpb25zKSA/IHF1aWNrRGVjaXNpb25RdWVzdGlvbnMgOiBbXTsKICAgIGlmICghYmFuay5sZW5ndGgpIHsKICAgICAgICBTd2FsLmZpcmUoJ0JpbGdpJywgJ1NvcnVsYXIgaGVuw7x6IHnDvGtsZW5tZWRpLiBMw7x0ZmVuIGFkbWluIHBhbmVsZGVuIHNvcnVsYXLEsSBla2xleWluIHZlIHNheWZhecSxIHllbmlsZXlpbi4nLCAnaW5mbycpOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBjb25zdCB0YWtlID0gTWF0aC5taW4oNSwgYmFuay5sZW5ndGgpOwogICAgY29uc3QgaWR4cyA9IEFycmF5LmZyb20oe2xlbmd0aDogYmFuay5sZW5ndGh9LCAoXyxpKT0+aSkuc29ydCgoKT0+TWF0aC5yYW5kb20oKS0wLjUpLnNsaWNlKDAsIHRha2UpOwogICAgcWRRdWV1ZSA9IGlkeHMubWFwKGkgPT4gYmFua1tpXSk7CiAgICBxZFRpbWVMZWZ0ID0gMzA7CiAgICBxZFNjb3JlID0gMDsKICAgIHFkU3RlcCA9IDA7CgogICAgY29uc3QgbG9iYnkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncWQtbG9iYnknKTsKICAgIGNvbnN0IGdhbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncWQtZ2FtZScpOwogICAgaWYgKGxvYmJ5KSBsb2JieS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgaWYgKGdhbWUpIGdhbWUuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CgogICAgdXBkYXRlUXVpY2tIdWQoKTsKICAgIHJlbmRlclF1aWNrUXVlc3Rpb24oKTsKCiAgICBpZiAocWRUaW1lcikgY2xlYXJJbnRlcnZhbChxZFRpbWVyKTsKICAgIHFkVGltZXIgPSBzZXRJbnRlcnZhbCgoKSA9PiB7CiAgICAgICAgcWRUaW1lTGVmdCAtPSAxOwogICAgICAgIHVwZGF0ZVF1aWNrSHVkKCk7CiAgICAgICAgaWYgKHFkVGltZUxlZnQgPD0gMCkgewogICAgICAgICAgICBmaW5pc2hRdWlja0RlY2lzaW9uKHRydWUpOwogICAgICAgIH0KICAgIH0sIDEwMDApOwp9CgpmdW5jdGlvbiB1cGRhdGVRdWlja0h1ZCgpIHsKICAgIGNvbnN0IHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncWQtdGltZScpOyBpZiAodCkgdC5pbm5lclRleHQgPSBTdHJpbmcoTWF0aC5tYXgoMCwgcWRUaW1lTGVmdCkpOwogICAgY29uc3QgcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxZC1zY29yZScpOyBpZiAocykgcy5pbm5lclRleHQgPSBTdHJpbmcocWRTY29yZSk7CiAgICBjb25zdCBzdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxZC1zdGVwJyk7IGlmIChzdCkgc3QuaW5uZXJUZXh0ID0gU3RyaW5nKHFkU3RlcCk7Cn0KCmZ1bmN0aW9uIHJlbmRlclF1aWNrUXVlc3Rpb24oKSB7CiAgICBjb25zdCBxID0gcWRRdWV1ZVtxZFN0ZXBdOwogICAgY29uc3QgcUVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FkLXF1ZXN0aW9uJyk7CiAgICBjb25zdCBvcHRFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxZC1vcHRpb25zJyk7CiAgICBpZiAoIXFFbCB8fCAhb3B0RWwgfHwgIXEpIHJldHVybjsKCiAgICBxRWwuaW5uZXJUZXh0ID0gcS5xOwogICAgb3B0RWwuaW5uZXJIVE1MID0gJyc7CgogICAgcS5vcHRzLmZvckVhY2goKHR4dCwgaSkgPT4gewogICAgICAgIGNvbnN0IGIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsKICAgICAgICBiLmNsYXNzTmFtZSA9ICdxdWljay1vcHQnOwogICAgICAgIGIuaW5uZXJUZXh0ID0gdHh0OwogICAgICAgIGIub25jbGljayA9ICgpID0+IGFuc3dlclF1aWNrKGkpOwogICAgICAgIG9wdEVsLmFwcGVuZENoaWxkKGIpOwogICAgfSk7Cn0KCmZ1bmN0aW9uIGFuc3dlclF1aWNrKGlkeCkgewogICAgY29uc3QgcSA9IHFkUXVldWVbcWRTdGVwXTsKICAgIGNvbnN0IG9wdEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FkLW9wdGlvbnMnKTsKICAgIGlmICghcSB8fCAhb3B0RWwpIHJldHVybjsKCiAgICBjb25zdCBidG5zID0gQXJyYXkuZnJvbShvcHRFbC5xdWVyeVNlbGVjdG9yQWxsKCdidXR0b24nKSk7CiAgICBidG5zLmZvckVhY2goYiA9PiBiLmRpc2FibGVkID0gdHJ1ZSk7CgogICAgY29uc3QgY29ycmVjdCA9IChpZHggPT09IHEuYSk7CgogICAgaWYgKGJ0bnNbaWR4XSkgYnRuc1tpZHhdLmNsYXNzTGlzdC5hZGQoY29ycmVjdCA/ICdnb29kJyA6ICdiYWQnKTsKICAgIGlmICghY29ycmVjdCAmJiBidG5zW3EuYV0pIGJ0bnNbcS5hXS5jbGFzc0xpc3QuYWRkKCdnb29kJyk7CgogICAgLy8gcHVhbmxhbWE6IGRvxJ9ydSArMiwgeWFubMSxxZ8gLTEKICAgIHFkU2NvcmUgKz0gY29ycmVjdCA/IDIgOiAtMTsKICAgIGlmIChxZFNjb3JlIDwgMCkgcWRTY29yZSA9IDA7CiAgICB1cGRhdGVRdWlja0h1ZCgpOwoKICAgIFN3YWwuZmlyZSh7CiAgICAgICAgdG9hc3Q6IHRydWUsCiAgICAgICAgcG9zaXRpb246ICd0b3AnLAogICAgICAgIGljb246IGNvcnJlY3QgPyAnc3VjY2VzcycgOiAnd2FybmluZycsCiAgICAgICAgdGl0bGU6IGNvcnJlY3QgPyAnRG/En3J1IHNlw6dpbSEnIDogJ1lhbmzEscWfIHNlw6dpbScsCiAgICAgICAgdGV4dDogcS5leHAsCiAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLAogICAgICAgIHRpbWVyOiAxODAwCiAgICB9KTsKCiAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICBxZFN0ZXAgKz0gMTsKICAgICAgICB1cGRhdGVRdWlja0h1ZCgpOwogICAgICAgIGlmIChxZFN0ZXAgPj0gcWRRdWV1ZS5sZW5ndGgpIGZpbmlzaFF1aWNrRGVjaXNpb24oZmFsc2UpOwogICAgICAgIGVsc2UgcmVuZGVyUXVpY2tRdWVzdGlvbigpOwogICAgfSwgNjUwKTsKfQoKZnVuY3Rpb24gZmluaXNoUXVpY2tEZWNpc2lvbih0aW1lb3V0KSB7CiAgICBpZiAocWRUaW1lcikgeyBjbGVhckludGVydmFsKHFkVGltZXIpOyBxZFRpbWVyID0gbnVsbDsgfQoKICAgIGNvbnN0IG1zZyA9IHRpbWVvdXQgPyAnU8O8cmUgYml0dGkhJyA6ICdCaXR0aSEnOwogICAgU3dhbC5maXJlKHsKICAgICAgICBpY29uOiAnaW5mbycsCiAgICAgICAgdGl0bGU6IGDwn6egIEjEsXpsxLEgS2FyYXIgJHttc2d9YCwKICAgICAgICBodG1sOiBgPGRpdiBzdHlsZT0idGV4dC1hbGlnbjpjZW50ZXI7Ij4KICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZToxLjByZW07IG1hcmdpbi1ib3R0b206OHB4OyI+U2tvcnVuOiA8Yj4ke3FkU2NvcmV9PC9iPjwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iY29sb3I6IzY2NjsgZm9udC1zaXplOjAuOXJlbTsiPsSwc3RlcnNlbiB5ZW5pZGVuIGJhxZ9sYXTEsXAgcmVrb3IgZGVuZXllYmlsaXJzaW4uPC9kaXY+CiAgICAgICAgICAgICAgPC9kaXY+YCwKICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogJ1RhbWFtJwogICAgfSk7CgogICAgLy8gTG9iYnknZSBkw7ZuCiAgICBjb25zdCBsb2JieSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxZC1sb2JieScpOwogICAgY29uc3QgZ2FtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxZC1nYW1lJyk7CiAgICBpZiAobG9iYnkpIGxvYmJ5LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgaWYgKGdhbWUpIGdhbWUuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgIGNvbnN0IHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncWQtdGltZScpOyBpZiAodCkgdC5pbm5lclRleHQgPSAnMzAnOwogICAgY29uc3Qgc3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncWQtc3RlcCcpOyBpZiAoc3QpIHN0LmlubmVyVGV4dCA9ICcwJzsKfQoKZnVuY3Rpb24gb3BlblBlbmFsdHlHYW1lKCkgewogICAgdHJ5IHsgY2xvc2VNb2RhbCgnZ2FtZS1odWItbW9kYWwnKTsgfSBjYXRjaChlKSB7fQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BlbmFsdHktbW9kYWwnKS5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOwogICAgc2hvd0xvYmJ5KCk7Cn0KCmZ1bmN0aW9uIHNob3dMb2JieSgpIHsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwZW5hbHR5LWxvYmJ5Jykuc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwZW5hbHR5LWdhbWUtYXJlYScpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICBmZXRjaExlYWRlcmJvYXJkKCk7Cn0KCmZ1bmN0aW9uIHN0YXJ0R2FtZUZyb21Mb2JieSgpIHsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwZW5hbHR5LWxvYmJ5Jykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwZW5hbHR5LWdhbWUtYXJlYScpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgc3RhcnRQZW5hbHR5U2Vzc2lvbigpOwp9CgpmdW5jdGlvbiBmZXRjaExlYWRlcmJvYXJkKCkgewogICAgY29uc3QgdGJvZHkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGVhZGVyYm9hcmQtYm9keScpOwogICAgY29uc3QgbG9hZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xlYWRlcmJvYXJkLWxvYWRlcicpOwogICAgY29uc3QgdGFibGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGVhZGVyYm9hcmQtdGFibGUnKTsKCiAgICBpZiAoIXRib2R5IHx8ICFsb2FkZXIgfHwgIXRhYmxlKSByZXR1cm47CgogICAgdGJvZHkuaW5uZXJIVE1MID0gJyc7CiAgICBsb2FkZXIuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICB0YWJsZS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwoKICAgIGZldGNoKFNDUklQVF9VUkwsIHsKICAgICAgICBtZXRob2Q6ICdQT1NUJywKICAgICAgICBoZWFkZXJzOiB7ICJDb250ZW50LVR5cGUiOiAidGV4dC9wbGFpbjtjaGFyc2V0PXV0Zi04IiB9LAogICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgYWN0aW9uOiAiZ2V0TGVhZGVyYm9hcmQiIH0pCiAgICB9KQogICAgLnRoZW4ociA9PiByLmpzb24oKSkKICAgIC50aGVuKGRhdGEgPT4gewogICAgICAgIGxvYWRlci5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgIGlmIChkYXRhLnJlc3VsdCAhPT0gInN1Y2Nlc3MiKSB7CiAgICAgICAgICAgIGxvYWRlci5pbm5lclRleHQgPSAiWcO8a2xlbmVtZWRpLiI7CiAgICAgICAgICAgIGxvYWRlci5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdGFibGUuc3R5bGUuZGlzcGxheSA9ICd0YWJsZSc7CiAgICAgICAgbGV0IGh0bWwgPSAnJzsKCiAgICAgICAgaWYgKCFkYXRhLmxlYWRlcmJvYXJkIHx8IGRhdGEubGVhZGVyYm9hcmQubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgIGh0bWwgPSAnPHRyPjx0ZCBjb2xzcGFuPSI0IiBzdHlsZT0idGV4dC1hbGlnbjpjZW50ZXI7Ij5IZW7DvHogbWHDpyB5YXDEsWxtYWTEsS48L3RkPjwvdHI+JzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBkYXRhLmxlYWRlcmJvYXJkLmZvckVhY2goKHUsIGkpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IG1lZGFsID0gaT09PTAgPyAn8J+lhycgOiAoaT09PTEgPyAn8J+liCcgOiAoaT09PTIgPyAn8J+liScgOiBgPHNwYW4gY2xhc3M9InJhbmstYmFkZ2UiPiR7aSsxfTwvc3Bhbj5gKSk7CiAgICAgICAgICAgICAgICBjb25zdCBiZ1N0eWxlID0gKHUudXNlcm5hbWUgPT09IGN1cnJlbnRVc2VyKSA/ICdiYWNrZ3JvdW5kOnJnYmEoMjUwLCAxODcsIDAsIDAuMSk7JyA6ICcnOwogICAgICAgICAgICAgICAgaHRtbCArPSBgPHRyIHN0eWxlPSIke2JnU3R5bGV9Ij48dGQ+JHttZWRhbH08L3RkPjx0ZD4ke3UudXNlcm5hbWV9PC90ZD48dGQ+JHt1LmdhbWVzfTwvdGQ+PHRkPiR7dS5hdmVyYWdlfTwvdGQ+PC90cj5gOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgdGJvZHkuaW5uZXJIVE1MID0gaHRtbDsKICAgIH0pCiAgICAuY2F0Y2goKCkgPT4gewogICAgICAgIGxvYWRlci5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgIGxvYWRlci5pbm5lclRleHQgPSAiQmHEn2xhbnTEsSBoYXRhc8SxLiI7CiAgICAgICAgbG9hZGVyLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgfSk7Cn0KCmZ1bmN0aW9uIGJ1aWxkUXVlc3Rpb25RdWV1ZSgpIHsKICAgIGNvbnN0IG4gPSBxdWl6UXVlc3Rpb25zLmxlbmd0aDsKICAgIGNvbnN0IGlkeHMgPSBBcnJheS5mcm9tKHsgbGVuZ3RoOiBuIH0sIChfLCBpKSA9PiBpKTsKICAgIGlkeHMuc29ydCgoKSA9PiBNYXRoLnJhbmRvbSgpIC0gMC41KTsKCiAgICAvLyAxMCBzb3J1IGnDp2luIHlldGVyIHlva3NhLCB5aW5lIGRlIGTDtm5nw7x5ZSBzb2ttYXlhbMSxbToga2FsYW4gdG9wbGFyZGEgdGVrcmFyIG9sYWJpbGlyLgogICAgLy8gYW1hIMO2bmNlIHTDvG0gc29ydWxhciBiaXIga2V6IGdlbHNpbi4KICAgIHJldHVybiBpZHhzOwp9CgpmdW5jdGlvbiBzdGFydFBlbmFsdHlTZXNzaW9uKCkgewogICAgLy8gU2Vzc2lvbiByZXNldAogICAgcFNjb3JlID0gMDsKICAgIHBCYWxscyA9IDEwOwogICAgcEFza2VkQ291bnQgPSAwOwogICAgcENvcnJlY3RDb3VudCA9IDA7CiAgICBwV3JvbmdDb3VudCA9IDA7CgogICAgam9rZXJzID0geyBjYWxsOiAxLCBoYWxmOiAxLCBkb3VibGU6IDEgfTsKICAgIGRvdWJsZUNoYW5jZVVzZWQgPSBmYWxzZTsKICAgIGZpcnN0QW5zd2VySW5kZXggPSAtMTsKICAgIHNldERvdWJsZUluZGljYXRvcihmYWxzZSk7CgogICAgLy8gU29ydSBrdXlydcSfdQogICAgcFF1ZXN0aW9uUXVldWUgPSBidWlsZFF1ZXN0aW9uUXVldWUoKTsKCiAgICB1cGRhdGVKb2tlckJ1dHRvbnMoKTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwLXNjb3JlJykuaW5uZXJUZXh0ID0gcFNjb3JlOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3AtYmFsbHMnKS5pbm5lclRleHQgPSBwQmFsbHM7CgogICAgY29uc3QgcmVzdGFydEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwLXJlc3RhcnQtYnRuJyk7CiAgICBjb25zdCBvcHRpb25zRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncC1vcHRpb25zJyk7CiAgICBpZiAocmVzdGFydEJ0bikgcmVzdGFydEJ0bi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgaWYgKG9wdGlvbnNFbCkgb3B0aW9uc0VsLnN0eWxlLmRpc3BsYXkgPSAnZ3JpZCc7CgogICAgcmVzZXRGaWVsZCgpOwogICAgbG9hZFBlbmFsdHlRdWVzdGlvbigpOwp9CgpmdW5jdGlvbiBwaWNrTmV4dFF1ZXN0aW9uKCkgewogICAgaWYgKHF1aXpRdWVzdGlvbnMubGVuZ3RoID09PSAwKSByZXR1cm4gbnVsbDsKCiAgICAvLyDDlm5jZSBrdXlydWt0YW4gdMO8a2V0CiAgICBpZiAocFF1ZXN0aW9uUXVldWUubGVuZ3RoID4gMCkgewogICAgICAgIGNvbnN0IGkgPSBwUXVlc3Rpb25RdWV1ZS5zaGlmdCgpOwogICAgICAgIHJldHVybiBxdWl6UXVlc3Rpb25zW2ldOwogICAgfQoKICAgIC8vIEt1eXJ1ayBiaXR0aSBhbWEgdG9wIGRldmFtIGVkaXlvcjogYXJ0xLFrIHJhbmRvbSAoc29ydSBhenNhKQogICAgcmV0dXJuIHF1aXpRdWVzdGlvbnNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogcXVpelF1ZXN0aW9ucy5sZW5ndGgpXTsKfQoKZnVuY3Rpb24gbG9hZFBlbmFsdHlRdWVzdGlvbigpIHsKICAgIGlmIChwQmFsbHMgPD0gMCkgeyBmaW5pc2hQZW5hbHR5R2FtZSgpOyByZXR1cm47IH0KICAgIGlmICghQXJyYXkuaXNBcnJheShxdWl6UXVlc3Rpb25zKSB8fCBxdWl6UXVlc3Rpb25zLmxlbmd0aCA9PT0gMCkgewogICAgICAgIFN3YWwuZmlyZSgnSGF0YScsICdTb3J1IHlvayEnLCAnd2FybmluZycpOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBwQ3VycmVudFEgPSBwaWNrTmV4dFF1ZXN0aW9uKCk7CiAgICBpZiAoIXBDdXJyZW50USB8fCAhcEN1cnJlbnRRLm9wdHMgfHwgcEN1cnJlbnRRLm9wdHMubGVuZ3RoIDwgMikgewogICAgICAgIFN3YWwuZmlyZSgnSGF0YScsICdCdSBzb3J1IGhhdGFsxLEgZm9ybWF0dGEgKMWfxLFrIHlvaykuJywgJ2Vycm9yJyk7CiAgICAgICAgLy8gYmlyIHNvbnJha2kgc29ydXl1IGRlbmUKICAgICAgICBwQ3VycmVudFEgPSBwaWNrTmV4dFF1ZXN0aW9uKCk7CiAgICAgICAgaWYgKCFwQ3VycmVudFEpIHJldHVybjsKICAgIH0KCiAgICBwQXNrZWRDb3VudCsrOwogICAgZG91YmxlQ2hhbmNlVXNlZCA9IGZhbHNlOwogICAgZmlyc3RBbnN3ZXJJbmRleCA9IC0xOwogICAgc2V0RG91YmxlSW5kaWNhdG9yKGZhbHNlKTsKICAgIHVwZGF0ZUpva2VyQnV0dG9ucygpOwoKICAgIGNvbnN0IHFFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwLXF1ZXN0aW9uLXRleHQnKTsKICAgIGlmIChxRWwpIHFFbC5pbm5lclRleHQgPSBwQ3VycmVudFEucSB8fCAiU29ydSI7CgogICAgbGV0IGh0bWwgPSAnJzsKICAgIHBDdXJyZW50US5vcHRzLmZvckVhY2goKG9wdCwgaW5kZXgpID0+IHsKICAgICAgICBjb25zdCBsZXR0ZXIgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKDY1ICsgaW5kZXgpOwogICAgICAgIGh0bWwgKz0gYDxidXR0b24gY2xhc3M9InBlbmFsdHktYnRuIiBvbmNsaWNrPSJzaG9vdEJhbGwoJHtpbmRleH0pIj4ke2xldHRlcn06ICR7b3B0fTwvYnV0dG9uPmA7CiAgICB9KTsKCiAgICBjb25zdCBvcHRpb25zRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncC1vcHRpb25zJyk7CiAgICBpZiAob3B0aW9uc0VsKSBvcHRpb25zRWwuaW5uZXJIVE1MID0gaHRtbDsKfQoKZnVuY3Rpb24gc2hvb3RCYWxsKGlkeCkgewogICAgY29uc3QgYnRucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wZW5hbHR5LWJ0bicpOwogICAgY29uc3QgaXNDb3JyZWN0ID0gKGlkeCA9PT0gcEN1cnJlbnRRLmEpOwoKICAgIC8vIERvdWJsZSBqb2tlcjogaWxrIHlhbmzEscWfdGEgYmlyIGhhayBkYWhhCiAgICBpZiAoIWlzQ29ycmVjdCAmJiBkb3VibGVDaGFuY2VVc2VkICYmIGZpcnN0QW5zd2VySW5kZXggPT09IC0xKSB7CiAgICAgICAgZmlyc3RBbnN3ZXJJbmRleCA9IGlkeDsKICAgICAgICBpZiAoYnRuc1tpZHhdKSB7CiAgICAgICAgICAgIGJ0bnNbaWR4XS5jbGFzc0xpc3QuYWRkKCd3cm9uZy1maXJzdC10cnknKTsKICAgICAgICAgICAgYnRuc1tpZHhdLmRpc2FibGVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgU3dhbC5maXJlKHsgdG9hc3Q6IHRydWUsIHBvc2l0aW9uOiAndG9wJywgaWNvbjogJ2luZm8nLCB0aXRsZTogJ8SwbGsgSGF0YSEgS2FsYW4gSGFra8SxbjogMScsIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSwgdGltZXI6IDE0MDAsIGJhY2tncm91bmQ6ICcjZmZjMTA3JyB9KTsKICAgICAgICB1cGRhdGVKb2tlckJ1dHRvbnMoKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgLy8gQXJ0xLFrIGF0xLHFnyBrZXNpbmxlxZ90aQogICAgYnRucy5mb3JFYWNoKGIgPT4gYi5kaXNhYmxlZCA9IHRydWUpOwoKICAgIGNvbnN0IGJhbGxXcmFwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JhbGwtd3JhcCcpOwogICAgY29uc3Qga2VlcGVyV3JhcCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdrZWVwZXItd3JhcCcpOwogICAgY29uc3Qgc2hvb3RlcldyYXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2hvb3Rlci13cmFwJyk7CiAgICBjb25zdCBnb2FsTXNnID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dvYWwtbXNnJyk7CgogICAgY29uc3Qgc2hvdERpciA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDQpOwogICAgaWYgKHNob290ZXJXcmFwKSBzaG9vdGVyV3JhcC5jbGFzc0xpc3QuYWRkKCdzaG9vdGVyLXJ1bicpOwoKICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgIGlmIChrZWVwZXJXcmFwKSB7CiAgICAgICAgICAgIGlmIChpc0NvcnJlY3QpIHsKICAgICAgICAgICAgICAgIGlmIChzaG90RGlyID09PSAwIHx8IHNob3REaXIgPT09IDIpIGtlZXBlcldyYXAuY2xhc3NMaXN0LmFkZCgna2VlcGVyLWRpdmUtcmlnaHQnKTsKICAgICAgICAgICAgICAgIGVsc2Uga2VlcGVyV3JhcC5jbGFzc0xpc3QuYWRkKCdrZWVwZXItZGl2ZS1sZWZ0Jyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoc2hvdERpciA9PT0gMCB8fCBzaG90RGlyID09PSAyKSBrZWVwZXJXcmFwLmNsYXNzTGlzdC5hZGQoJ2tlZXBlci1kaXZlLWxlZnQnKTsKICAgICAgICAgICAgICAgIGVsc2Uga2VlcGVyV3JhcC5jbGFzc0xpc3QuYWRkKCdrZWVwZXItZGl2ZS1yaWdodCcpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoaXNDb3JyZWN0KSB7CiAgICAgICAgICAgIGlmIChiYWxsV3JhcCkgewogICAgICAgICAgICAgICAgaWYgKHNob3REaXIgPT09IDApIGJhbGxXcmFwLmNsYXNzTGlzdC5hZGQoJ2JhbGwtc2hvb3QtbGVmdC10b3AnKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKHNob3REaXIgPT09IDEpIGJhbGxXcmFwLmNsYXNzTGlzdC5hZGQoJ2JhbGwtc2hvb3QtcmlnaHQtdG9wJyk7CiAgICAgICAgICAgICAgICBlbHNlIGlmIChzaG90RGlyID09PSAyKSBiYWxsV3JhcC5jbGFzc0xpc3QuYWRkKCdiYWxsLXNob290LWxlZnQtbG93Jyk7CiAgICAgICAgICAgICAgICBlbHNlIGJhbGxXcmFwLmNsYXNzTGlzdC5hZGQoJ2JhbGwtc2hvb3QtcmlnaHQtbG93Jyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgaWYgKGdvYWxNc2cpIHsKICAgICAgICAgICAgICAgICAgICBnb2FsTXNnLmlubmVyVGV4dCA9ICJHT0whISEiOwogICAgICAgICAgICAgICAgICAgIGdvYWxNc2cuc3R5bGUuY29sb3IgPSAiI2ZhYmIwMCI7CiAgICAgICAgICAgICAgICAgICAgZ29hbE1zZy5jbGFzc0xpc3QuYWRkKCdzaG93Jyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBwU2NvcmUrKzsKICAgICAgICAgICAgICAgIHBDb3JyZWN0Q291bnQrKzsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwLXNjb3JlJykuaW5uZXJUZXh0ID0gcFNjb3JlOwoKICAgICAgICAgICAgICAgIFN3YWwuZmlyZSh7IHRvYXN0OnRydWUsIHBvc2l0aW9uOid0b3AnLCBpY29uOidzdWNjZXNzJywgdGl0bGU6J03DvGtlbW1lbCDFnnV0IScsIHNob3dDb25maXJtQnV0dG9uOmZhbHNlLCB0aW1lcjo5MDAsIGJhY2tncm91bmQ6JyNhNWQ2YTcnIH0pOwogICAgICAgICAgICB9LCA0NTApOwoKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwV3JvbmdDb3VudCsrOwoKICAgICAgICAgICAgY29uc3Qgc2hvd1dyb25nID0gKCkgPT4gewogICAgICAgICAgICAgICAgaWYgKGdvYWxNc2cpIHsKICAgICAgICAgICAgICAgICAgICBnb2FsTXNnLnN0eWxlLmNvbG9yID0gIiNlZjUzNTAiOwogICAgICAgICAgICAgICAgICAgIGdvYWxNc2cuY2xhc3NMaXN0LmFkZCgnc2hvdycpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgU3dhbC5maXJlKHsgaWNvbjonZXJyb3InLCB0aXRsZTonS2HDp8SxcmTEsW4hJywgdGV4dDpgRG/En3J1OiAke1N0cmluZy5mcm9tQ2hhckNvZGUoNjUgKyBwQ3VycmVudFEuYSl9YCwgc2hvd0NvbmZpcm1CdXR0b246dHJ1ZSwgdGltZXI6MjQwMCwgYmFja2dyb3VuZDonI2VmOWE5YScgfSk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBpZiAoTWF0aC5yYW5kb20oKSA+IDAuNSkgewogICAgICAgICAgICAgICAgaWYgKGJhbGxXcmFwKSB7CiAgICAgICAgICAgICAgICAgICAgYmFsbFdyYXAuc3R5bGUuYm90dG9tID0gIjE2MHB4IjsKICAgICAgICAgICAgICAgICAgICBiYWxsV3JhcC5zdHlsZS5sZWZ0ID0gKHNob3REaXIgPT09IDAgfHwgc2hvdERpciA9PT0gMikgPyAiNDAlIiA6ICI2MCUiOwogICAgICAgICAgICAgICAgICAgIGJhbGxXcmFwLnN0eWxlLnRyYW5zZm9ybSA9ICJzY2FsZSgwLjYpIjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4geyBpZiAoZ29hbE1zZykgZ29hbE1zZy5pbm5lclRleHQgPSAiS1VSVEFSREkhIjsgc2hvd1dyb25nKCk7IH0sIDQ1MCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoYmFsbFdyYXApIGJhbGxXcmFwLmNsYXNzTGlzdC5hZGQoTWF0aC5yYW5kb20oKSA+IDAuNSA/ICdiYWxsLW1pc3MtbGVmdCcgOiAnYmFsbC1taXNzLXJpZ2h0Jyk7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsgaWYgKGdvYWxNc2cpIGdvYWxNc2cuaW5uZXJUZXh0ID0gIkRJxZ5BUkkhIjsgc2hvd1dyb25nKCk7IH0sIDQ1MCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9LCAzMDApOwoKICAgIC8vIHRvcCBhemFsdAogICAgcEJhbGxzLS07CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncC1iYWxscycpLmlubmVyVGV4dCA9IHBCYWxsczsKCiAgICBzZXRUaW1lb3V0KCgpID0+IHsgcmVzZXRGaWVsZCgpOyBsb2FkUGVuYWx0eVF1ZXN0aW9uKCk7IH0sIDI0MDApOwp9CgpmdW5jdGlvbiByZXNldEZpZWxkKCkgewogICAgY29uc3QgYmFsbFdyYXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmFsbC13cmFwJyk7CiAgICBjb25zdCBrZWVwZXJXcmFwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2tlZXBlci13cmFwJyk7CiAgICBjb25zdCBzaG9vdGVyV3JhcCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaG9vdGVyLXdyYXAnKTsKICAgIGNvbnN0IGdvYWxNc2cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ29hbC1tc2cnKTsKCiAgICBpZiAoYmFsbFdyYXApIHsgYmFsbFdyYXAuY2xhc3NOYW1lID0gJ2JhbGwtd3JhcHBlcic7IGJhbGxXcmFwLnN0eWxlID0gIiI7IH0KICAgIGlmIChrZWVwZXJXcmFwKSBrZWVwZXJXcmFwLmNsYXNzTmFtZSA9ICdrZWVwZXItd3JhcHBlcic7CiAgICBpZiAoc2hvb3RlcldyYXApIHNob290ZXJXcmFwLmNsYXNzTmFtZSA9ICdzaG9vdGVyLXdyYXBwZXInOwogICAgaWYgKGdvYWxNc2cpIGdvYWxNc2cuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpOwoKICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wZW5hbHR5LWJ0bicpLmZvckVhY2goYiA9PiB7CiAgICAgICAgYi5jbGFzc0xpc3QucmVtb3ZlKCd3cm9uZy1maXJzdC10cnknKTsKICAgICAgICBiLnN0eWxlLnRleHREZWNvcmF0aW9uID0gJyc7CiAgICAgICAgYi5zdHlsZS5vcGFjaXR5ID0gJyc7CiAgICAgICAgYi5zdHlsZS5iYWNrZ3JvdW5kID0gJyNmYWJiMDAnOwogICAgICAgIGIuc3R5bGUuY29sb3IgPSAnIzBlMWI0Mic7CiAgICAgICAgYi5zdHlsZS5ib3JkZXJDb2xvciA9ICcjZjBiNTAwJzsKICAgICAgICBiLmRpc2FibGVkID0gZmFsc2U7CiAgICB9KTsKfQoKZnVuY3Rpb24gZmluaXNoUGVuYWx0eUdhbWUoKSB7CiAgICBjb25zdCB0b3RhbFNob3RzID0gMTA7CiAgICBjb25zdCB0aXRsZSA9IHBTY29yZSA+PSA4ID8gIkVGU0FORSEg8J+PhiIgOiAocFNjb3JlID49IDUgPyAixLB5aSBNYcOndMSxISDwn5GPIiA6ICJBbnRyZW5tYW4gTGF6xLFtIPCfpJUiKTsKICAgIGNvbnN0IGFjYyA9IE1hdGgucm91bmQoKHBDb3JyZWN0Q291bnQgLyBNYXRoLm1heCgxLCAocENvcnJlY3RDb3VudCArIHBXcm9uZ0NvdW50KSkpICogMTAwKTsKCiAgICBjb25zdCBxRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncC1xdWVzdGlvbi10ZXh0Jyk7CiAgICBpZiAocUVsKSB7CiAgICAgICAgcUVsLmlubmVySFRNTCA9IGAKICAgICAgICAgICAgPGRpdiBzdHlsZT0iZm9udC1zaXplOjEuNXJlbTsgY29sb3I6I2ZhYmIwMDsgZm9udC13ZWlnaHQ6ODAwOyI+TUHDhyBCxLBUVMSwITwvZGl2PgogICAgICAgICAgICA8ZGl2IHN0eWxlPSJtYXJnaW4tdG9wOjRweDsgZm9udC1zaXplOjEuMXJlbTsgY29sb3I6I2ZmZjsiPiR7dGl0bGV9PC9kaXY+CiAgICAgICAgICAgIDxkaXYgc3R5bGU9Im1hcmdpbi10b3A6OHB4OyBmb250LXNpemU6MXJlbTsgY29sb3I6I2RkZDsiPgogICAgICAgICAgICAgICAgPGI+U2tvcjo8L2I+ICR7cFNjb3JlfS8ke3RvdGFsU2hvdHN9ICZuYnNwOyDigKIgJm5ic3A7CiAgICAgICAgICAgICAgICA8Yj5Eb8SfcnVsdWs6PC9iPiAke2FjY30lCiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IHN0eWxlPSJtYXJnaW4tdG9wOjZweDsgZm9udC1zaXplOjAuOXJlbTsgY29sb3I6I2JiYjsiPgogICAgICAgICAgICAgICAgRG/En3J1OiAke3BDb3JyZWN0Q291bnR9ICZuYnNwOyB8ICZuYnNwOyBZYW5sxLHFnzogJHtwV3JvbmdDb3VudH0KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgc3R5bGU9Im1hcmdpbi10b3A6MTBweDsgZm9udC1zaXplOjAuODVyZW07IGNvbG9yOiNhYWE7Ij4KICAgICAgICAgICAgICAgIFllbmlkZW4gb3luYW1hayBpw6dpbiBhxZ9hxJ/EsWRhbiBiYcWfbGF0YWJpbGlyc2luLgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICBgOwogICAgfQoKICAgIGNvbnN0IG9wdGlvbnNFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwLW9wdGlvbnMnKTsKICAgIGNvbnN0IHJlc3RhcnRCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncC1yZXN0YXJ0LWJ0bicpOwogICAgaWYgKG9wdGlvbnNFbCkgb3B0aW9uc0VsLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICBpZiAocmVzdGFydEJ0bikgcmVzdGFydEJ0bi5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKCiAgICAvLyBMZWFkZXJib2FyZCBsb2cgKG1ldmN1dCBiYWNrZW5kIHV5dW11KQogICAgZmV0Y2goU0NSSVBUX1VSTCwgewogICAgICAgIG1ldGhvZDogJ1BPU1QnLAogICAgICAgIGhlYWRlcnM6IHsgIkNvbnRlbnQtVHlwZSI6ICJ0ZXh0L3BsYWluO2NoYXJzZXQ9dXRmLTgiIH0sCiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBhY3Rpb246ICJsb2dRdWl6IiwgdXNlcm5hbWU6IGN1cnJlbnRVc2VyLCB0b2tlbjogZ2V0VG9rZW4oKSwgc2NvcmU6IHBTY29yZSAqIDEwLCB0b3RhbDogMTAwIH0pCiAgICB9KS5maW5hbGx5KCgpID0+IHsKICAgICAgICAvLyBsb2JieSB0YWJsb3N1bnUgZ8O8bmNlbCB0dXQKICAgICAgICBzZXRUaW1lb3V0KGZldGNoTGVhZGVyYm9hcmQsIDYwMCk7CiAgICB9KTsKfQoKCi8vIC0tLSBXSVpBUkQgRlVOQ1RJT05TIC0tLQpmdW5jdGlvbiBvcGVuV2l6YXJkKCl7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd2l6YXJkLW1vZGFsJykuc3R5bGUuZGlzcGxheT0nZmxleCc7CiAgICBpZiAoT2JqZWN0LmtleXMod2l6YXJkU3RlcHNEYXRhKS5sZW5ndGggPT09IDApIHsKICAgICAgICBTd2FsLmZpcmUoeyB0aXRsZTogJ8SwYWRlIEFzaXN0YW7EsSBWZXJpc2kgWcO8a2xlbml5b3IuLi4nLCBkaWRPcGVuOiAoKSA9PiBTd2FsLnNob3dMb2FkaW5nKCkgfSk7CiAgICAgICAgbG9hZFdpemFyZERhdGEoKS50aGVuKCgpID0+IHsgU3dhbC5jbG9zZSgpOyBpZiAod2l6YXJkU3RlcHNEYXRhWydzdGFydCddKSByZW5kZXJTdGVwKCdzdGFydCcpOyBlbHNlIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3aXphcmQtYm9keScpLmlubmVySFRNTCA9ICc8aDIgc3R5bGU9ImNvbG9yOnJlZDsiPkFzaXN0YW4gdmVyaXNpIGVrc2lrLjwvaDI+JzsgfSkKICAgICAgICAuY2F0Y2goKCkgPT4geyBTd2FsLmNsb3NlKCk7IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3aXphcmQtYm9keScpLmlubmVySFRNTCA9ICc8aDIgc3R5bGU9ImNvbG9yOnJlZDsiPlZlcmkgw6dla21lIGhhdGFzxLEuPC9oMj4nOyB9KTsKICAgIH0gZWxzZSB7IHJlbmRlclN0ZXAoJ3N0YXJ0Jyk7IH0KfQpmdW5jdGlvbiByZW5kZXJTdGVwKGspewogICAgY29uc3QgcyA9IHdpemFyZFN0ZXBzRGF0YVtrXTsKICAgIGlmICghcykgeyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd2l6YXJkLWJvZHknKS5pbm5lckhUTUwgPSBgPGgyIHN0eWxlPSJjb2xvcjpyZWQ7Ij5IQVRBOiBBZMSxbSBJRCAoJHtrfSkgeW9rLjwvaDI+YDsgcmV0dXJuOyB9CiAgICBjb25zdCBiID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3dpemFyZC1ib2R5Jyk7CiAgICBsZXQgaCA9IGA8aDIgc3R5bGU9ImNvbG9yOnZhcigtLXByaW1hcnkpOyI+JHtzLnRpdGxlIHx8ICcnfTwvaDI+YDsKICAgIGlmKHMucmVzdWx0KSB7CiAgICAgICAgbGV0IGkgPSBzLnJlc3VsdCA9PT0gJ3JlZCcgPyAnIPCfm5EgJyA6IChzLnJlc3VsdCA9PT0gJ2dyZWVuJyA/ICcg4pyFICcgOiAnIOKaoO+4jyAnKTsKICAgICAgICBsZXQgYyA9IHMucmVzdWx0ID09PSAncmVkJyA/ICdyZXMtcmVkJyA6IChzLnJlc3VsdCA9PT0gJ2dyZWVuJyA/ICdyZXMtZ3JlZW4nIDogJ3Jlcy15ZWxsb3cnKTsKICAgICAgICBoICs9IGA8ZGl2IGNsYXNzPSJyZXN1bHQtYm94ICR7Y30iPjxkaXYgc3R5bGU9ImZvbnQtc2l6ZTozcmVtO21hcmdpbi1ib3R0b206MTBweDsiPiR7aX08L2Rpdj48aDM+JHtzLnRpdGxlfTwvaDM+PHA+JHtzLnRleHR9PC9wPiR7cy5zY3JpcHQgPyBgPGRpdiBjbGFzcz0ic2NyaXB0LWJveCI+JHtzLnNjcmlwdH08L2Rpdj5gIDogJyd9PC9kaXY+PGJ1dHRvbiBjbGFzcz0icmVzdGFydC1idG4iIG9uY2xpY2s9InJlbmRlclN0ZXAoJ3N0YXJ0JykiPjxpIGNsYXNzPSJmYXMgZmEtcmVkbyI+PC9pPiBCYcWfYSBEw7ZuPC9idXR0b24+YDsKICAgIH0gZWxzZSB7CiAgICAgICAgaCArPSBgPHA+JHtzLnRleHR9PC9wPjxkaXYgY2xhc3M9IndpemFyZC1vcHRpb25zIj5gOwogICAgICAgIHMub3B0aW9ucy5mb3JFYWNoKG8gPT4geyBoICs9IGA8YnV0dG9uIGNsYXNzPSJvcHRpb24tYnRuIiBvbmNsaWNrPSJyZW5kZXJTdGVwKCcke28ubmV4dH0nKSI+PGkgY2xhc3M9ImZhcyBmYS1jaGV2cm9uLXJpZ2h0Ij48L2k+ICR7by50ZXh0fTwvYnV0dG9uPmA7IH0pOwogICAgICAgIGggKz0gYDwvZGl2PmA7IGlmKGsgIT09ICdzdGFydCcpIGggKz0gYDxidXR0b24gY2xhc3M9InJlc3RhcnQtYnRuIiBvbmNsaWNrPSJyZW5kZXJTdGVwKCdzdGFydCcpIiBzdHlsZT0iYmFja2dyb3VuZDojZWVlO2NvbG9yOiMzMzM7bWFyZ2luLXRvcDoxNXB4OyI+QmHFn2EgRMO2bjwvYnV0dG9uPmA7CiAgICB9CiAgICBiLmlubmVySFRNTCA9IGg7Cn0KLy8gLS0tIFRFQ0ggV0laQVJEIC0tLQpjb25zdCB0d1N0YXRlID0geyBjdXJyZW50U3RlcDogJ3N0YXJ0JywgaGlzdG9yeTogW10gfTsKZnVuY3Rpb24gb3BlblRlY2hXaXphcmQoKSB7CiAgICAvLyBUZWtuaWsgU2loaXJiYXogYXJ0xLFrIFRla25payAodGFtIGVrcmFuKSBpw6dpbmRlCiAgICBvcGVuVGVjaEFyZWEoJ3dpemFyZCcpOwp9CmZ1bmN0aW9uIHR3UmVuZGVyU3RlcCgpIHsKICAgIGNvbnN0IGNvbnRlbnREaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGVjaC13aXphcmQtY29udGVudCcpOwogICAgY29uc3QgYmFja0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0dy1idG4tYmFjaycpOwogICAgY29uc3Qgc3RlcERhdGEgPSB0ZWNoV2l6YXJkRGF0YVt0d1N0YXRlLmN1cnJlbnRTdGVwXTsKICAgIGlmICh0d1N0YXRlLmhpc3RvcnkubGVuZ3RoID4gMCkgYmFja0J0bi5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsgZWxzZSBiYWNrQnRuLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICBpZiAoIXN0ZXBEYXRhKSB7IGNvbnRlbnREaXYuaW5uZXJIVE1MID0gYDxkaXYgY2xhc3M9ImFsZXJ0IiBzdHlsZT0iY29sb3I6cmVkOyI+SGF0YTogQWTEsW0gYnVsdW5hbWFkxLEgKCR7dHdTdGF0ZS5jdXJyZW50U3RlcH0pLjwvZGl2PmA7IHJldHVybjsgfQogICAgbGV0IGh0bWwgPSBgPGRpdiBjbGFzcz0idGVjaC1zdGVwLXRpdGxlIj4ke3N0ZXBEYXRhLnRpdGxlIHx8ICcnfTwvZGl2PmA7CiAgICBpZiAoc3RlcERhdGEudGV4dCkgaHRtbCArPSBgPHAgc3R5bGU9ImZvbnQtc2l6ZToxcmVtOyBtYXJnaW4tYm90dG9tOjE1cHg7Ij4ke3N0ZXBEYXRhLnRleHR9PC9wPmA7CiAgICBpZiAoc3RlcERhdGEuc2NyaXB0KSB7CiAgICAgICAgY29uc3Qgc2FmZVNjcmlwdCA9IGVuY29kZVVSSUNvbXBvbmVudChzdGVwRGF0YS5zY3JpcHQpOwogICAgICAgIGh0bWwgKz0gYDxkaXYgY2xhc3M9InRlY2gtc2NyaXB0LWJveCI+PHNwYW4gY2xhc3M9InRlY2gtc2NyaXB0LWxhYmVsIj5Nw7zFn3Rlcml5ZSBpbGV0aWxlY2VrOjwvc3Bhbj4iJHtzdGVwRGF0YS5zY3JpcHR9IjxkaXYgc3R5bGU9Im1hcmdpbi10b3A6MTBweDsgdGV4dC1hbGlnbjpyaWdodDsiPjxidXR0b24gY2xhc3M9ImJ0biBidG4tY29weSIgc3R5bGU9ImZvbnQtc2l6ZTowLjhyZW07IHBhZGRpbmc6NXB4IDEwcHg7IiBvbmNsaWNrPSJjb3B5U2NyaXB0Q29udGVudCgnJHtzYWZlU2NyaXB0fScpIj48aSBjbGFzcz0iZmFzIGZhLWNvcHkiPjwvaT4gS29weWFsYTwvYnV0dG9uPjwvZGl2PjwvZGl2PmA7CiAgICB9CiAgICBpZiAoc3RlcERhdGEuYWxlcnQpIGh0bWwgKz0gYDxkaXYgY2xhc3M9InRlY2gtYWxlcnQiPiR7c3RlcERhdGEuYWxlcnR9PC9kaXY+YDsKICAgIGlmIChzdGVwRGF0YS5idXR0b25zICYmIHN0ZXBEYXRhLmJ1dHRvbnMubGVuZ3RoID4gMCkgewogICAgICAgIGh0bWwgKz0gYDxkaXYgY2xhc3M9InRlY2gtYnV0dG9ucy1hcmVhIj5gOwogICAgICAgIHN0ZXBEYXRhLmJ1dHRvbnMuZm9yRWFjaChidG4gPT4geyBsZXQgYnRuQ2xhc3MgPSBidG4uc3R5bGUgPT09ICdvcHRpb24nID8gJ3RlY2gtYnRuLW9wdGlvbicgOiAndGVjaC1idG4tcHJpbWFyeSc7IGh0bWwgKz0gYDxidXR0b24gY2xhc3M9InRlY2gtYnRuICR7YnRuQ2xhc3N9IiBvbmNsaWNrPSJ0d0NoYW5nZVN0ZXAoJyR7YnRuLm5leHR9JykiPiR7YnRuLnRleHR9PC9idXR0b24+YDsgfSk7CiAgICAgICAgaHRtbCArPSBgPC9kaXY+YDsKICAgIH0KICAgIGNvbnRlbnREaXYuaW5uZXJIVE1MID0gaHRtbDsKfQpmdW5jdGlvbiB0d0NoYW5nZVN0ZXAobmV3U3RlcCkgeyB0d1N0YXRlLmhpc3RvcnkucHVzaCh0d1N0YXRlLmN1cnJlbnRTdGVwKTsgdHdTdGF0ZS5jdXJyZW50U3RlcCA9IG5ld1N0ZXA7IHR3UmVuZGVyU3RlcCgpOyB9CmZ1bmN0aW9uIHR3R29CYWNrKCkgeyBpZiAodHdTdGF0ZS5oaXN0b3J5Lmxlbmd0aCA+IDApIHsgdHdTdGF0ZS5jdXJyZW50U3RlcCA9IHR3U3RhdGUuaGlzdG9yeS5wb3AoKTsgdHdSZW5kZXJTdGVwKCk7IH0gfQpmdW5jdGlvbiB0d1Jlc2V0V2l6YXJkKCkgeyB0d1N0YXRlLmN1cnJlbnRTdGVwID0gJ3N0YXJ0JzsgdHdTdGF0ZS5oaXN0b3J5ID0gW107IHR3UmVuZGVyU3RlcCgpOyB9Ci8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gLS0tIFlFTsSwIEtBTMSwVEUgTE1TIE1PRMOcTMOcIChUQU0gRUtSQU4gRU5URUdSQVNZT05VKSAtLS0KLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyBNb2TDvGzDvCBBw6cKZnVuY3Rpb24gb3BlblF1YWxpdHlBcmVhKCkgewogICAgLy8gRXNraSBtb2RhbMSxIGthcGF0IChlxJ9lciBhw6fEsWtzYSkKICAgIGNvbnN0IG9sZE1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1YWxpdHktbW9kYWwnKTsKICAgIGlmKG9sZE1vZGFsKSBvbGRNb2RhbC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgLy8gVGFtIGVrcmFuxLEgYcOnCiAgICBjb25zdCBmdWxsU2NyZWVuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1YWxpdHktZnVsbHNjcmVlbicpOwogICAgZnVsbFNjcmVlbi5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOwogICAgLy8gS3VsbGFuxLFjxLEgYmlsZ2lzaW5pIGfDvG5jZWxsZQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Etc2lkZS1uYW1lJykuaW5uZXJUZXh0ID0gY3VycmVudFVzZXI7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncS1zaWRlLXJvbGUnKS5pbm5lclRleHQgPSBpc0FkbWluTW9kZSA/ICdZw7ZuZXRpY2knIDogJ1RlbXNpbGNpJzsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxLXNpZGUtYXZhdGFyJykuaW5uZXJUZXh0ID0gY3VycmVudFVzZXIuY2hhckF0KDApLnRvVXBwZXJDYXNlKCk7CiAgICAvLyBEw7ZuZW0gZmlsdHJlc2luaSBkb2xkdXIKICAgIHBvcHVsYXRlTW9udGhGaWx0ZXJGdWxsKCk7CiAgICAvLyBZZXRraSBrb250cm9sw7wgKEFkbWluIGJ1dG9ubGFyxLFuxLEgZ8O2c3Rlci9naXpsZSkKICAgIGNvbnN0IGFkbWluRmlsdGVycyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZG1pbi1maWx0ZXJzJyk7CiAgICBjb25zdCBhc3NpZ25CdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXNzaWduLXRyYWluaW5nLWJ0bicpOwogICAgY29uc3QgbWFudWFsRmVlZGJhY2tCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFudWFsLWZlZWRiYWNrLWFkbWluLWJ0bicpOwogICAgCiAgICBpZiAoaXNBZG1pbk1vZGUpIHsKICAgICAgICBpZihhZG1pbkZpbHRlcnMpIGFkbWluRmlsdGVycy5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOwogICAgICAgIGlmKGFzc2lnbkJ0bikgYXNzaWduQnRuLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgIGlmKG1hbnVhbEZlZWRiYWNrQnRuKSBtYW51YWxGZWVkYmFja0J0bi5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOwogICAgICAgIAogICAgICAgIC8vIEt1bGxhbsSxY8SxIGxpc3Rlc2kgYm/Fn3NhIMOnZWssIHNvbnJhIGZpbHRyZWxlcmkgZG9sZHVyCiAgICAgICAgaWYgKGFkbWluVXNlckxpc3QubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgIGZldGNoVXNlckxpc3RGb3JBZG1pbigpLnRoZW4odXNlcnMgPT4gewogICAgICAgICAgICAgICAgY29uc3QgZ3JvdXBTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncS1hZG1pbi1ncm91cCcpOwogICAgICAgICAgICAgICAgaWYoZ3JvdXBTZWxlY3QpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBncm91cHMgPSBbLi4ubmV3IFNldCh1c2Vycy5tYXAodSA9PiB1Lmdyb3VwKSldLnNvcnQoKTsKICAgICAgICAgICAgICAgICAgICBncm91cFNlbGVjdC5pbm5lckhUTUwgPSBgPG9wdGlvbiB2YWx1ZT0iYWxsIj5Uw7xtIEdydXBsYXI8L29wdGlvbj5gICsgZ3JvdXBzLm1hcChnID0+IGA8b3B0aW9uIHZhbHVlPSIke2d9Ij4ke2d9PC9vcHRpb24+YCkuam9pbignJyk7CiAgICAgICAgICAgICAgICAgICAgdXBkYXRlQWdlbnRMaXN0QmFzZWRPbkdyb3VwKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBwb3B1bGF0ZURhc2hib2FyZEZpbHRlcnMoKTsgLy8gRGFzaGJvYXJkIGZpbHRyZWxlcmluaSBkZSBkb2xkdXIKICAgICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcG9wdWxhdGVEYXNoYm9hcmRGaWx0ZXJzKCk7IC8vIExpc3RlIHphdGVuIHZhcnNhIGRpcmVrdCBkb2xkdXIKICAgICAgICB9CiAgICB9IGVsc2UgewogICAgICAgIGlmKGFkbWluRmlsdGVycykgYWRtaW5GaWx0ZXJzLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgaWYoYXNzaWduQnRuKSBhc3NpZ25CdG4uc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICBpZihtYW51YWxGZWVkYmFja0J0bikgbWFudWFsRmVlZGJhY2tCdG4uc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAKICAgICAgICAvLyBBZG1pbiBkZcSfaWxzZSBmaWx0cmVsZXJpIGdpemxlCiAgICAgICAgY29uc3QgZGFzaEZpbHRlckFyZWEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjdmlldy1kYXNoYm9hcmQgLnEtdmlldy1oZWFkZXIgPiBkaXYnKTsKICAgICAgICBpZihkYXNoRmlsdGVyQXJlYSAmJiBkYXNoRmlsdGVyQXJlYS5zdHlsZS5kaXNwbGF5ICE9PSAnbm9uZScpIHsKICAgICAgICAgICAgIC8vIEJ1cmFkYSBiYXNpdMOnZSBkYXNoYm9hcmQgZmlsdHJlIGZvbmtzaXlvbnUgYWRtaW4ga29udHJvbMO8IHlhcMSxeW9yLgogICAgICAgICAgICAgcG9wdWxhdGVEYXNoYm9hcmRGaWx0ZXJzKCk7IAogICAgICAgIH0KICAgIH0KICAgIC8vIFZhcnNhecSxbGFuIHNla21leWkgYcOnCiAgICAvLyBUxLFrbGFubWEgc2ltw7xsYXN5b251IGlsZSBpbGsgc2VrbWV5aSBha3RpZiBldAogICAgY29uc3QgZGVmYXVsdFRhYiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5xLW5hdi1pdGVtLmFjdGl2ZScpOwogICAgaWYgKGRlZmF1bHRUYWIpIHsKICAgICAgICBzd2l0Y2hRdWFsaXR5VGFiKCdkYXNoYm9hcmQnLCBkZWZhdWx0VGFiKTsKICAgIH0KfQovLyBNb2TDvGzDvCBLYXBhdApmdW5jdGlvbiBjbG9zZUZ1bGxRdWFsaXR5KCkgewogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1YWxpdHktZnVsbHNjcmVlbicpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAvLyBFxJ9lciBxdXNlcnMgaXNlIChzYWRlY2Uga2FsaXRlIHlldGtpc2kgdmFyc2EpIGxvZ291dCB5YXBtYWzEsSB2ZXlhIHV5YXLEsSB2ZXJtZWxpCiAgICBpZihsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgic1Nwb3J0Um9sZSIpID09PSAncXVzZXJzJykgewogICAgICAgIGxvZ291dCgpOwogICAgfQp9Ci8vIFNla21lIERlxJ9pxZ90aXJtZQpmdW5jdGlvbiBzd2l0Y2hRdWFsaXR5VGFiKHRhYk5hbWUsIGVsZW1lbnQpIHsKICAgIC8vIE1lbnUgYWN0aXZlIGNsYXNzCiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucS1uYXYtaXRlbScpLmZvckVhY2goaXRlbSA9PiBpdGVtLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpKTsKICAgIC8vIEVsZW1lbnQgdmFyc2Egb251IGFrdGlmIHlhcCwgeW9rc2EgdmFyc2F5xLFsYW7EsSAoZGFzaGJvYXJkKSBidWx1cCBha3RpZiB5YXAKICAgIGlmIChlbGVtZW50KSB7CiAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgIH0gZWxzZSB7CiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgLnEtbmF2LWl0ZW1bb25jbGljayo9IiR7dGFiTmFtZX0iXWApLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgfQogICAgCiAgICAvLyBWaWV3IGFjdGl2ZSBjbGFzcwogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnEtdmlldy1zZWN0aW9uJykuZm9yRWFjaChzZWN0aW9uID0+IHNlY3Rpb24uY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJykpOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHZpZXctJHt0YWJOYW1lfWApLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgLy8gVmVyaSBZw7xrbGVtZQogICAgaWYgKHRhYk5hbWUgPT09ICdkYXNoYm9hcmQnKSBsb2FkUXVhbGl0eURhc2hib2FyZCgpOwogICAgZWxzZSBpZiAodGFiTmFtZSA9PT0gJ2V2YWx1YXRpb25zJykgZmV0Y2hFdmFsdWF0aW9uc0ZvckFnZW50KCk7CiAgICAvLyBEw5xaRUxUTUU6IEZlZWRiYWNrIHNla21lc2kgYcOnxLFsxLFya2VuIMO2bmNlIEZlZWRiYWNrX0xvZ3Mgw6dla2lsbWVsaQogICAgZWxzZSBpZiAodGFiTmFtZSA9PT0gJ2ZlZWRiYWNrJykgewogICAgICAgIHBvcHVsYXRlRmVlZGJhY2tGaWx0ZXJzKCk7CiAgICAgICAgcmVmcmVzaEZlZWRiYWNrRGF0YSgpOwogICAgfQogICAgZWxzZSBpZiAodGFiTmFtZSA9PT0gJ3RyYWluaW5nJykgbG9hZFRyYWluaW5nRGF0YSgpOwp9Ci8vIC0tLSBEQVNIQk9BUkQgRk9OS1PEsFlPTkxBUkkgLS0tCmZ1bmN0aW9uIHBvcHVsYXRlTW9udGhGaWx0ZXJGdWxsKCkgewogICAgY29uc3Qgc2VsZWN0SWRzID0gWydxLWRhc2gtbW9udGgnXTsgLy8gU2FkZWNlIHllbmkgZmlsdHJlCiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpOwogICAgY29uc3QgY3VycmVudE1vbnRoID0gbm93LmdldE1vbnRoKCk7CiAgICBjb25zdCBjdXJyZW50WWVhciA9IG5vdy5nZXRGdWxsWWVhcigpOwogICAgCiAgICBzZWxlY3RJZHMuZm9yRWFjaChpZCA9PiB7CiAgICAgICAgY29uc3QgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7CiAgICAgICAgaWYoIWVsKSByZXR1cm47CiAgICAgICAgZWwuaW5uZXJIVE1MID0gJyc7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA2OyBpKyspIHsKICAgICAgICAgICAgbGV0IG1vbnRoID0gKGN1cnJlbnRNb250aCAtIGkgKyAxMikgJSAxMjsKICAgICAgICAgICAgbGV0IHllYXIgPSBjdXJyZW50WWVhciAtIChjdXJyZW50TW9udGggLSBpIDwgMCA/IDEgOiAwKTsKICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBgJHtTdHJpbmcobW9udGggKyAxKS5wYWRTdGFydCgyLCAnMCcpfS4ke3llYXJ9YDsKICAgICAgICAgICAgY29uc3QgdGV4dCA9IGAke01PTlRIX05BTUVTW21vbnRoXX0gJHt5ZWFyfWA7CiAgICAgICAgICAgIGNvbnN0IG9wdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpOwogICAgICAgICAgICBvcHQudmFsdWUgPSB2YWx1ZTsgb3B0LnRleHRDb250ZW50ID0gdGV4dDsKICAgICAgICAgICAgaWYoaT09PTApIG9wdC5zZWxlY3RlZCA9IHRydWU7CiAgICAgICAgICAgIGVsLmFwcGVuZENoaWxkKG9wdCk7CiAgICAgICAgfQogICAgfSk7Cn0KLy8gWUVOxLA6IERhc2hib2FyZCBGaWx0cmVsZXJpbmkgRG9sZHVybWEKZnVuY3Rpb24gcG9wdWxhdGVEYXNoYm9hcmRGaWx0ZXJzKCkgewogICAgY29uc3QgZ3JvdXBTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncS1kYXNoLWdyb3VwJyk7CiAgICBjb25zdCBhZ2VudFNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxLWRhc2gtYWdlbnQnKTsKICAgIGlmKCFpc0FkbWluTW9kZSkgewogICAgICAgIGlmKGdyb3VwU2VsZWN0KSBncm91cFNlbGVjdC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgIGlmKGFnZW50U2VsZWN0KSBhZ2VudFNlbGVjdC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgIHJldHVybjsKICAgIH0gZWxzZSB7CiAgICAgICAgaWYoZ3JvdXBTZWxlY3QpIGdyb3VwU2VsZWN0LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgIGlmKGFnZW50U2VsZWN0KSBhZ2VudFNlbGVjdC5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgIH0KICAgIAogICAgaWYoIWdyb3VwU2VsZWN0KSByZXR1cm47CiAgICAKICAgIGNvbnN0IGdyb3VwcyA9IFsuLi5uZXcgU2V0KGFkbWluVXNlckxpc3QubWFwKHUgPT4gdS5ncm91cCkuZmlsdGVyKGcgPT4gZykpXS5zb3J0KCk7CiAgICBncm91cFNlbGVjdC5pbm5lckhUTUwgPSAnPG9wdGlvbiB2YWx1ZT0iYWxsIj5Uw7xtIEdydXBsYXI8L29wdGlvbj4nOwogICAgZ3JvdXBzLmZvckVhY2goZyA9PiB7CiAgICAgICAgY29uc3Qgb3B0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7CiAgICAgICAgb3B0LnZhbHVlID0gZzsgb3B0LmlubmVyVGV4dCA9IGc7CiAgICAgICAgZ3JvdXBTZWxlY3QuYXBwZW5kQ2hpbGQob3B0KTsKICAgIH0pOwogICAgLy8gxLBsayB5w7xrbGVtZWRlIHTDvG0gYWdlbnRsYXLEsSBsaXN0ZWxlCiAgICB1cGRhdGVEYXNoQWdlbnRMaXN0KCk7Cn0KLy8gWUVOxLA6IERhc2hib2FyZCBBZ2VudCBMaXN0ZXNpbmkgR8O8bmNlbGxlbWUKZnVuY3Rpb24gdXBkYXRlRGFzaEFnZW50TGlzdCgpIHsKICAgIGNvbnN0IGdyb3VwU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3EtZGFzaC1ncm91cCcpOwogICAgY29uc3QgYWdlbnRTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncS1kYXNoLWFnZW50Jyk7CiAgICBpZighYWdlbnRTZWxlY3QpIHJldHVybjsKICAgIGNvbnN0IHNlbGVjdGVkR3JvdXAgPSBncm91cFNlbGVjdC52YWx1ZTsKICAgIGFnZW50U2VsZWN0LmlubmVySFRNTCA9ICc8b3B0aW9uIHZhbHVlPSJhbGwiPlTDvG0gVGVtc2lsY2lsZXI8L29wdGlvbj4nOwogICAgCiAgICBsZXQgZmlsdGVyZWRVc2VycyA9IGFkbWluVXNlckxpc3Q7CiAgICBpZiAoc2VsZWN0ZWRHcm91cCAhPT0gJ2FsbCcpIHsKICAgICAgICBmaWx0ZXJlZFVzZXJzID0gYWRtaW5Vc2VyTGlzdC5maWx0ZXIodSA9PiB1Lmdyb3VwID09PSBzZWxlY3RlZEdyb3VwKTsKICAgIH0KICAgIGZpbHRlcmVkVXNlcnMuZm9yRWFjaCh1ID0+IHsKICAgICAgICBjb25zdCBvcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTsKICAgICAgICBvcHQudmFsdWUgPSB1Lm5hbWU7IAogICAgICAgIG9wdC5pbm5lclRleHQgPSB1Lm5hbWU7CiAgICAgICAgYWdlbnRTZWxlY3QuYXBwZW5kQ2hpbGQob3B0KTsKICAgIH0pOwogICAgCiAgICB1cGRhdGVEYXNoUmluZ1RpdGxlKCk7CiAgICByZWZyZXNoUXVhbGl0eURhdGEoKTsKfQoKLy8g4pyFIERhc2hib2FyZCByaW5nIGJhxZ9sxLHEn8SxICsgYWRtaW4gdGVtc2lsY2kgb3J0YWxhbWFsYXLEsQpmdW5jdGlvbiB1cGRhdGVEYXNoUmluZ1RpdGxlKCkgewogICAgY29uc3QgdGl0bGVFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxLWRhc2gtcmluZy10aXRsZScpIHx8IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxLWRhc2gtcmluZy10aXRsZScucmVwbGFjZSgndGl0bGUnLCd0aXRsZScpKTsKICAgIC8vIChpZCBrZXNpbjogcS1kYXNoLXJpbmctdGl0bGUpCiAgICBjb25zdCB0RWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncS1kYXNoLXJpbmctdGl0bGUnKTsKICAgIGlmKCF0RWwpIHJldHVybjsKCiAgICBpZighaXNBZG1pbk1vZGUpIHsKICAgICAgICB0RWwudGV4dENvbnRlbnQgPSAnUHVhbiBEdXJ1bXUnOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBjb25zdCBnU2VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3EtZGFzaC1ncm91cCcpOwogICAgY29uc3QgYVNlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxLWRhc2gtYWdlbnQnKTsKICAgIGNvbnN0IGcgPSBnU2VsID8gZ1NlbC52YWx1ZSA6ICdhbGwnOwogICAgY29uc3QgYSA9IGFTZWwgPyBhU2VsLnZhbHVlIDogJ2FsbCc7CgogICAgaWYoYSAmJiBhICE9PSAnYWxsJykgewogICAgICAgIHRFbC50ZXh0Q29udGVudCA9IGAke2F9IFB1YW4gRHVydW11YDsKICAgIH0gZWxzZSBpZihnICYmIGcgIT09ICdhbGwnKSB7CiAgICAgICAgdEVsLnRleHRDb250ZW50ID0gYCR7Z30gVGFrxLFtIE9ydGFsYW1hc8SxYDsKICAgIH0gZWxzZSB7CiAgICAgICAgdEVsLnRleHRDb250ZW50ID0gJ0dlbmVsIFB1YW4gT3J0YWxhbWFzxLEnOwogICAgfQp9CgovLyBBZG1pbiBpw6dpbjogdGVtc2lsY2kgb3J0YWxhbWFsYXLEsSBsaXN0ZXNpbmkgYmFzCmZ1bmN0aW9uIHJlbmRlckRhc2hBZ2VudFNjb3JlcyhldmFscykgewogICAgY29uc3QgYm94ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3EtZGFzaC1hZ2VudC1zY29yZXMnKTsKICAgIGlmKCFib3gpIHJldHVybjsKCiAgICAvLyBTYWRlY2UgYWRtaW4gKyBhZ2VudD1hbGwgaWtlbiBnw7ZzdGVyICh5b2tzYSBnZXJla3NpeiBrYWxhYmFsxLFrKQogICAgaWYoIWlzQWRtaW5Nb2RlKSB7IGJveC5zdHlsZS5kaXNwbGF5PSdub25lJzsgcmV0dXJuOyB9CgogICAgY29uc3QgZ1NlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxLWRhc2gtZ3JvdXAnKTsKICAgIGNvbnN0IGFTZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncS1kYXNoLWFnZW50Jyk7CiAgICBjb25zdCBnID0gZ1NlbCA/IGdTZWwudmFsdWUgOiAnYWxsJzsKICAgIGNvbnN0IGEgPSBhU2VsID8gYVNlbC52YWx1ZSA6ICdhbGwnOwoKICAgIGlmKGEgJiYgYSAhPT0gJ2FsbCcpIHsgYm94LnN0eWxlLmRpc3BsYXk9J25vbmUnOyByZXR1cm47IH0KCiAgICAvLyBldmFscyAtPiBhZ2VudCBiYXpsxLEgb3J0YWxhbWEKICAgIGNvbnN0IGJ5QWdlbnQgPSB7fTsKICAgIChldmFscyB8fCBbXSkuZm9yRWFjaChlID0+IHsKICAgICAgICBjb25zdCBhZ2VudCA9IGUuYWdlbnQgfHwgJ04vQSc7CiAgICAgICAgY29uc3QgZ3JvdXAgPSBlLmdyb3VwIHx8ICcnOwogICAgICAgIGNvbnN0IHNjb3JlID0gcGFyc2VGbG9hdChlLnNjb3JlKSB8fCAwOwogICAgICAgIGlmKCFieUFnZW50W2FnZW50XSkgYnlBZ2VudFthZ2VudF0gPSB7IHRvdGFsOjAsIGNvdW50OjAsIGdyb3VwOiBncm91cCB9OwogICAgICAgIGJ5QWdlbnRbYWdlbnRdLnRvdGFsICs9IHNjb3JlOwogICAgICAgIGJ5QWdlbnRbYWdlbnRdLmNvdW50ICs9IDE7CiAgICAgICAgLy8gZ3JvdXAgYm/Fn3NhIHNvbiBnw7Zyw7xsZW5pIHlhegogICAgICAgIGlmKCFieUFnZW50W2FnZW50XS5ncm91cCAmJiBncm91cCkgYnlBZ2VudFthZ2VudF0uZ3JvdXAgPSBncm91cDsKICAgIH0pOwoKICAgIGNvbnN0IHJvd3MgPSBPYmplY3Qua2V5cyhieUFnZW50KS5tYXAobmFtZSA9PiB7CiAgICAgICAgY29uc3QgbyA9IGJ5QWdlbnRbbmFtZV07CiAgICAgICAgcmV0dXJuIHsgbmFtZSwgZ3JvdXA6IG8uZ3JvdXAgfHwgKGcgIT09ICdhbGwnID8gZyA6ICcnKSwgYXZnOiBvLmNvdW50ID8gKG8udG90YWwvby5jb3VudCkgOiAwLCBjb3VudDpvLmNvdW50IH07CiAgICB9KTsKCiAgICAvLyBFxJ9lciBncm91cCBzZcOnaWxpeXNlIHNhZGVjZSBvIGdydWJ1biBrdWxsYW7EsWPEsWxhcsSxIHphdGVuIGdlbGl5b3I7IGFtYSBnYXJhbnRpIG9sc3VuCiAgICBjb25zdCBmaWx0ZXJlZFJvd3MgPSAoZyAmJiBnICE9PSAnYWxsJykgPyByb3dzLmZpbHRlcihyID0+IChyLmdyb3VwIHx8ICcnKSA9PT0gZykgOiByb3dzOwoKICAgIC8vIFPEsXJhbGE6IGVuIGTDvMWfw7xrIG9ydGFsYW1hIMO8c3R0ZSAoaXlpbGXFn3Rpcm1lIGFsYW7EsSkKICAgIGZpbHRlcmVkUm93cy5zb3J0KCh4LHkpPT4geC5hdmcgLSB5LmF2Zyk7CgogICAgaWYoZmlsdGVyZWRSb3dzLmxlbmd0aCA9PT0gMCkgeyBib3guc3R5bGUuZGlzcGxheT0nbm9uZSc7IHJldHVybjsgfQoKICAgIC8vIMSwbGsgOCBracWfaXlpIGfDtnN0ZXIKICAgIGNvbnN0IHRvcCA9IGZpbHRlcmVkUm93cy5zbGljZSgwLCA4KTsKCiAgICBib3guaW5uZXJIVE1MID0gdG9wLm1hcChyID0+IGAKICAgICAgICA8ZGl2IGNsYXNzPSJkYXMtaXRlbSI+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImRhcy1sZWZ0Ij4KICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJkYXMtbmFtZSI+JHtlc2NhcGVIdG1sKHIubmFtZSl9PC9zcGFuPgogICAgICAgICAgICAgICAgJHtyLmdyb3VwID8gYDxzcGFuIGNsYXNzPSJkYXMtZ3JvdXAiPiR7ZXNjYXBlSHRtbChyLmdyb3VwKX08L3NwYW4+YCA6IGBgfQogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iZGFzLXNjb3JlIj4keyhyLmF2Z3x8MCkudG9GaXhlZCgxKX08L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgIGApLmpvaW4oJycpOwoKICAgIGJveC5zdHlsZS5kaXNwbGF5ID0gJ2dyaWQnOwp9CgovLyBEZXRheSBhbGFuxLFuxLEgdG9sZXJhbnNsxLEgcGFyc2UgZXQKZnVuY3Rpb24gc2FmZVBhcnNlRGV0YWlscyhkZXRhaWxzKSB7CiAgICBpZighZGV0YWlscykgcmV0dXJuIG51bGw7CiAgICBpZihBcnJheS5pc0FycmF5KGRldGFpbHMpKSByZXR1cm4gZGV0YWlsczsKICAgIGlmKHR5cGVvZiBkZXRhaWxzID09PSAnb2JqZWN0JykgcmV0dXJuIGRldGFpbHM7CiAgICBpZih0eXBlb2YgZGV0YWlscyA9PT0gJ3N0cmluZycpIHsKICAgICAgICBjb25zdCBzID0gZGV0YWlscy50cmltKCk7CiAgICAgICAgaWYoIXMpIHJldHVybiBudWxsOwogICAgICAgIC8vIEJhesSxIGVza2kga2F5xLF0bGFyIMOnaWZ0IHTEsXJuYWsga2HDp8SxxZ9sxLEgZ2VsZWJpbGlyCiAgICAgICAgY29uc3QgdHJ5TGlzdCA9IFtzLCBzLnJlcGxhY2UoL1wiL2csJyInKSwgcy5yZXBsYWNlKC8nL2csJyInKV07CiAgICAgICAgZm9yKGNvbnN0IGNhbmQgb2YgdHJ5TGlzdCl7CiAgICAgICAgICAgIHRyeXsKICAgICAgICAgICAgICAgIGNvbnN0IHBhcnNlZCA9IEpTT04ucGFyc2UoY2FuZCk7CiAgICAgICAgICAgICAgICBpZihBcnJheS5pc0FycmF5KHBhcnNlZCkpIHJldHVybiBwYXJzZWQ7CiAgICAgICAgICAgIH1jYXRjaChlKXt9CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIG51bGw7Cn0KCi8vIOKchSBZRU7EsDogRmVlZGJhY2sgKEdlcmkgQmlsZGlyaW1sZXIpIEZpbHRyZWxlcmluaSBEb2xkdXJtYQpmdW5jdGlvbiBwb3B1bGF0ZUZlZWRiYWNrRmlsdGVycygpIHsKICAgIGNvbnN0IGdyb3VwU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3EtZmVlZGJhY2stZ3JvdXAnKTsKICAgIGNvbnN0IGFnZW50U2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3EtZmVlZGJhY2stYWdlbnQnKTsKICAgIGlmICghZ3JvdXBTZWxlY3QgfHwgIWFnZW50U2VsZWN0KSByZXR1cm47CgogICAgaWYoIWlzQWRtaW5Nb2RlKSB7CiAgICAgICAgZ3JvdXBTZWxlY3Quc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICBhZ2VudFNlbGVjdC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgIHJldHVybjsKICAgIH0gZWxzZSB7CiAgICAgICAgZ3JvdXBTZWxlY3Quc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgYWdlbnRTZWxlY3Quc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICB9CgogICAgY29uc3QgZ3JvdXBzID0gWy4uLm5ldyBTZXQoYWRtaW5Vc2VyTGlzdC5tYXAodSA9PiB1Lmdyb3VwKS5maWx0ZXIoZyA9PiBnKSldLnNvcnQoKTsKICAgIGdyb3VwU2VsZWN0LmlubmVySFRNTCA9ICc8b3B0aW9uIHZhbHVlPSJhbGwiPlTDvG0gR3J1cGxhcjwvb3B0aW9uPic7CiAgICBncm91cHMuZm9yRWFjaChnID0+IHsKICAgICAgICBjb25zdCBvcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTsKICAgICAgICBvcHQudmFsdWUgPSBnOwogICAgICAgIG9wdC50ZXh0Q29udGVudCA9IGc7CiAgICAgICAgZ3JvdXBTZWxlY3QuYXBwZW5kQ2hpbGQob3B0KTsKICAgIH0pOwoKICAgIC8vIMSwbGsgecO8a2xlbWVkZSB0w7xtIGFnZW50bGFyxLEgbGlzdGVsZQogICAgdXBkYXRlRmVlZGJhY2tBZ2VudExpc3QoZmFsc2UpOwp9CgpmdW5jdGlvbiB1cGRhdGVGZWVkYmFja0FnZW50TGlzdChzaG91bGRSZWZyZXNoPXRydWUpIHsKICAgIGNvbnN0IGdyb3VwU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3EtZmVlZGJhY2stZ3JvdXAnKTsKICAgIGNvbnN0IGFnZW50U2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3EtZmVlZGJhY2stYWdlbnQnKTsKICAgIGlmKCFncm91cFNlbGVjdCB8fCAhYWdlbnRTZWxlY3QpIHJldHVybjsKCiAgICBjb25zdCBzZWxlY3RlZEdyb3VwID0gZ3JvdXBTZWxlY3QudmFsdWU7CgogICAgLy8gc2XDp2lsZW4gZ3J1YmEgZ8O2cmUga3VsbGFuxLFjxLFsYXLEsSBmaWx0cmVsZQogICAgY29uc3QgZmlsdGVyZWRVc2VycyA9IGFkbWluVXNlckxpc3QuZmlsdGVyKHUgPT4gewogICAgICAgIGlmKCF1IHx8ICF1LnVzZXJuYW1lKSByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYoc2VsZWN0ZWRHcm91cCA9PT0gJ2FsbCcpIHJldHVybiB0cnVlOwogICAgICAgIHJldHVybiB1Lmdyb3VwID09PSBzZWxlY3RlZEdyb3VwOwogICAgfSk7CgogICAgY29uc3QgYWdlbnRzID0gZmlsdGVyZWRVc2VycwogICAgICAgIC5tYXAodSA9PiB1LnVzZXJuYW1lKQogICAgICAgIC5maWx0ZXIoYSA9PiBhKQogICAgICAgIC5zb3J0KChhLGIpID0+IGEubG9jYWxlQ29tcGFyZShiLCAndHInKSk7CgogICAgYWdlbnRTZWxlY3QuaW5uZXJIVE1MID0gJzxvcHRpb24gdmFsdWU9ImFsbCI+VMO8bSBUZW1zaWxjaWxlcjwvb3B0aW9uPic7CiAgICBhZ2VudHMuZm9yRWFjaChhID0+IHsKICAgICAgICBjb25zdCBvcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTsKICAgICAgICBvcHQudmFsdWUgPSBhOwogICAgICAgIG9wdC50ZXh0Q29udGVudCA9IGE7CiAgICAgICAgYWdlbnRTZWxlY3QuYXBwZW5kQ2hpbGQob3B0KTsKICAgIH0pOwoKICAgIGlmKHNob3VsZFJlZnJlc2gpIHJlZnJlc2hGZWVkYmFja0RhdGEoKTsKfQoKYXN5bmMgZnVuY3Rpb24gZmV0Y2hFdmFsdWF0aW9uc0ZvckZlZWRiYWNrKCkgewogICAgY29uc3QgZ3JvdXBTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncS1mZWVkYmFjay1ncm91cCcpOwogICAgY29uc3QgYWdlbnRTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncS1mZWVkYmFjay1hZ2VudCcpOwoKICAgIGxldCB0YXJnZXRBZ2VudCA9IGN1cnJlbnRVc2VyOwogICAgbGV0IHRhcmdldEdyb3VwID0gJ2FsbCc7CgogICAgaWYgKGlzQWRtaW5Nb2RlKSB7CiAgICAgICAgdGFyZ2V0QWdlbnQgPSBhZ2VudFNlbGVjdCA/IGFnZW50U2VsZWN0LnZhbHVlIDogJ2FsbCc7CiAgICAgICAgdGFyZ2V0R3JvdXAgPSBncm91cFNlbGVjdCA/IGdyb3VwU2VsZWN0LnZhbHVlIDogJ2FsbCc7CiAgICB9CgogICAgdHJ5IHsKICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKFNDUklQVF9VUkwsIHsKICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsCiAgICAgICAgICAgIGhlYWRlcnM6IHsgJ0NvbnRlbnQtVHlwZSc6ICd0ZXh0L3BsYWluO2NoYXJzZXQ9dXRmLTgnIH0sCiAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsKICAgICAgICAgICAgICAgIGFjdGlvbjogJ2ZldGNoRXZhbHVhdGlvbnMnLAogICAgICAgICAgICAgICAgdGFyZ2V0QWdlbnQ6IHRhcmdldEFnZW50LAogICAgICAgICAgICAgICAgdGFyZ2V0R3JvdXA6IHRhcmdldEdyb3VwLAogICAgICAgICAgICAgICAgdXNlcm5hbWU6IGN1cnJlbnRVc2VyLAogICAgICAgICAgICAgICAgdG9rZW46IGdldFRva2VuKCkKICAgICAgICAgICAgfSkKICAgICAgICB9KTsKICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpOwogICAgICAgIGlmIChkYXRhLnJlc3VsdCA9PT0gInN1Y2Nlc3MiKSB7CiAgICAgICAgICAgIGFsbEV2YWx1YXRpb25zRGF0YSA9IChkYXRhLmV2YWx1YXRpb25zIHx8IFtdKS5yZXZlcnNlKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYWxsRXZhbHVhdGlvbnNEYXRhID0gW107CiAgICAgICAgfQogICAgfSBjYXRjaCAoZSkgewogICAgICAgIGFsbEV2YWx1YXRpb25zRGF0YSA9IFtdOwogICAgfQp9Cgphc3luYyBmdW5jdGlvbiByZWZyZXNoRmVlZGJhY2tEYXRhKCkgewogICAgLy8gRmVlZGJhY2sgZWtyYW7EsSBpw6dpbiAoYWRtaW4gZmlsdHJlbGVyaW5lIGfDtnJlKSBkZcSfZXJsZW5kaXJtZWxlcmkgKyBsb2dsYXLEsSDDp2VrLCBzb25yYSBsaXN0ZXlpIGJhcwogICAgYXdhaXQgZmV0Y2hFdmFsdWF0aW9uc0ZvckZlZWRiYWNrKCk7CiAgICBhd2FpdCBmZXRjaEZlZWRiYWNrTG9ncygpOwogICAgbG9hZEZlZWRiYWNrTGlzdCgpOwp9CgoKZnVuY3Rpb24gcmVmcmVzaFF1YWxpdHlEYXRhKCkgewogICAgbG9hZFF1YWxpdHlEYXNoYm9hcmQoKTsKfQphc3luYyBmdW5jdGlvbiBmZXRjaEV2YWx1YXRpb25zRm9yRGFzaGJvYXJkKCkgewogICAgLy8gRGFzaGJvYXJkIGZpbHRyZWxlcmluZSBnw7ZyZSBkZcSfZXJsZW5kaXJtZWxlcmkgw6dlayAoYWRtaW4gaXNlIHNlw6dpbGVuIGdydXAvdGVtc2lsY2l5ZSBnw7ZyZSkKICAgIGNvbnN0IGdyb3VwU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3EtZGFzaC1ncm91cCcpOwogICAgY29uc3QgYWdlbnRTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncS1kYXNoLWFnZW50Jyk7CgogICAgbGV0IHRhcmdldEFnZW50ID0gY3VycmVudFVzZXI7CiAgICBsZXQgdGFyZ2V0R3JvdXAgPSAnYWxsJzsKCiAgICBpZiAoaXNBZG1pbk1vZGUpIHsKICAgICAgICB0YXJnZXRBZ2VudCA9IGFnZW50U2VsZWN0ID8gYWdlbnRTZWxlY3QudmFsdWUgOiAnYWxsJzsKICAgICAgICB0YXJnZXRHcm91cCA9IGdyb3VwU2VsZWN0ID8gZ3JvdXBTZWxlY3QudmFsdWUgOiAnYWxsJzsKICAgIH0KCiAgICB0cnkgewogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goU0NSSVBUX1VSTCwgewogICAgICAgICAgICBtZXRob2Q6ICdQT1NUJywKICAgICAgICAgICAgaGVhZGVyczogeyAiQ29udGVudC1UeXBlIjogInRleHQvcGxhaW47Y2hhcnNldD11dGYtOCIgfSwKICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoewogICAgICAgICAgICAgICAgYWN0aW9uOiAiZmV0Y2hFdmFsdWF0aW9ucyIsCiAgICAgICAgICAgICAgICB0YXJnZXRBZ2VudDogdGFyZ2V0QWdlbnQsCiAgICAgICAgICAgICAgICB0YXJnZXRHcm91cDogdGFyZ2V0R3JvdXAsCiAgICAgICAgICAgICAgICB1c2VybmFtZTogY3VycmVudFVzZXIsCiAgICAgICAgICAgICAgICB0b2tlbjogZ2V0VG9rZW4oKQogICAgICAgICAgICB9KQogICAgICAgIH0pOwogICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7CiAgICAgICAgaWYgKGRhdGEucmVzdWx0ID09PSAic3VjY2VzcyIpIHsKICAgICAgICAgICAgYWxsRXZhbHVhdGlvbnNEYXRhID0gKGRhdGEuZXZhbHVhdGlvbnMgfHwgW10pLnJldmVyc2UoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhbGxFdmFsdWF0aW9uc0RhdGEgPSBbXTsKICAgICAgICB9CiAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgYWxsRXZhbHVhdGlvbnNEYXRhID0gW107CiAgICB9Cn0KZnVuY3Rpb24gbG9hZFF1YWxpdHlEYXNoYm9hcmQoKSB7CiAgICAvLyBWZXJpbGVyaSDDp2VrIChzaWxlbnQgbW9kZSksIHZlcmkgZ2VsaW5jZSBncmFmaWtsZXJpIMOnaXoKICAgIGZldGNoRXZhbHVhdGlvbnNGb3JEYXNoYm9hcmQoKS50aGVuKCgpID0+IHsKICAgICAgICBjb25zdCBtb250aFNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxLWRhc2gtbW9udGgnKTsKICAgICAgICBjb25zdCBncm91cFNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxLWRhc2gtZ3JvdXAnKTsKICAgICAgICBjb25zdCBhZ2VudFNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxLWRhc2gtYWdlbnQnKTsKICAgICAgICBjb25zdCBzZWxlY3RlZE1vbnRoID0gbW9udGhTZWxlY3QgPyBtb250aFNlbGVjdC52YWx1ZSA6ICcnOwogICAgICAgIGNvbnN0IHNlbGVjdGVkR3JvdXAgPSBncm91cFNlbGVjdCA/IGdyb3VwU2VsZWN0LnZhbHVlIDogJ2FsbCc7CiAgICAgICAgY29uc3Qgc2VsZWN0ZWRBZ2VudCA9IGFnZW50U2VsZWN0ID8gYWdlbnRTZWxlY3QudmFsdWUgOiAnYWxsJzsKICAgICAgICAKICAgICAgICBsZXQgZmlsdGVyZWQgPSBhbGxFdmFsdWF0aW9uc0RhdGEuZmlsdGVyKGUgPT4gewogICAgICAgICAgICBjb25zdCBlRGF0ZSA9IGUuZGF0ZS5zdWJzdHJpbmcoMyk7IC8vIGRkLk1NLnl5eXkgLT4gTU0ueXl5eQogICAgICAgICAgICBjb25zdCBtYXRjaE1vbnRoID0gKGVEYXRlID09PSBzZWxlY3RlZE1vbnRoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGxldCBtYXRjaEdyb3VwID0gdHJ1ZTsKICAgICAgICAgICAgbGV0IG1hdGNoQWdlbnQgPSB0cnVlOwogICAgICAgICAgICAvLyBBZG1pbiBmaWx0cmVsZW1lIG1hbnTEscSfxLEKICAgICAgICAgICAgaWYgKGlzQWRtaW5Nb2RlKSB7CiAgICAgICAgICAgICAgICAvLyBFxJ9lciB2ZXJpIGnDp2luZGUgZ3J1cCBiaWxnaXNpIHZhcnNhIG9udSBrdWxsYW4sIHlva3NhIGFkbWluVXNlckxpc3QndGVuIGJha21hayBnZXJla2lyLgogICAgICAgICAgICAgICAgaWYgKHNlbGVjdGVkR3JvdXAgIT09ICdhbGwnKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGUuZ3JvdXApIHsKICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2hHcm91cCA9IChlLmdyb3VwID09PSBzZWxlY3RlZEdyb3VwKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB1c2VyID0gYWRtaW5Vc2VyTGlzdC5maW5kKHUgPT4gdS5uYW1lID09PSBlLmFnZW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2hHcm91cCA9ICh1c2VyICYmIHVzZXIuZ3JvdXAgPT09IHNlbGVjdGVkR3JvdXApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKHNlbGVjdGVkQWdlbnQgIT09ICdhbGwnICYmIGUuYWdlbnQgIT09IHNlbGVjdGVkQWdlbnQpIG1hdGNoQWdlbnQgPSBmYWxzZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIEFkbWluIGRlxJ9pbHNlIHNhZGVjZSBrZW5kaSB2ZXJpc2kKICAgICAgICAgICAgICAgIGlmKGUuYWdlbnQgIT09IGN1cnJlbnRVc2VyKSBtYXRjaEFnZW50ID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gTUFOVUVMIGthecSxdGxhcsSxIGRhc2hib2FyZCdkYSBnw7ZzdGVybWUKICAgICAgICAgICAgY29uc3QgaXNNYW51YWwgPSBlLmNhbGxJZCAmJiBTdHJpbmcoZS5jYWxsSWQpLnRvVXBwZXJDYXNlKCkuc3RhcnRzV2l0aCgnTUFOVUVMLScpOwogICAgICAgICAgICByZXR1cm4gbWF0Y2hNb250aCAmJiBtYXRjaEdyb3VwICYmIG1hdGNoQWdlbnQgJiYgIWlzTWFudWFsOwogICAgICAgIH0pOwogICAgICAgIGNvbnN0IHRvdGFsID0gZmlsdGVyZWQucmVkdWNlKChhY2MsIGN1cnIpID0+IGFjYyArIChwYXJzZUludChjdXJyLnNjb3JlKXx8MCksIDApOwogICAgICAgIGNvbnN0IGNvdW50ID0gZmlsdGVyZWQubGVuZ3RoOwogICAgICAgIGNvbnN0IGF2ZyA9IGNvdW50ID4gMCA/ICh0b3RhbCAvIGNvdW50KS50b0ZpeGVkKDEpIDogMDsKICAgICAgICBjb25zdCB0YXJnZXRIaXQgPSBmaWx0ZXJlZC5maWx0ZXIoZSA9PiBlLnNjb3JlID49IDkwKS5sZW5ndGg7CiAgICAgICAgY29uc3QgcmF0ZSA9IGNvdW50ID4gMCA/IE1hdGgucm91bmQoKHRhcmdldEhpdCAvIGNvdW50KSAqIDEwMCkgOiAwOwogICAgICAgIC8vIFVJIEfDvG5jZWxsZQogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxLWRhc2gtc2NvcmUnKS5pbm5lclRleHQgPSBhdmc7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3EtZGFzaC1jb3VudCcpLmlubmVyVGV4dCA9IGNvdW50OwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxLWRhc2gtdGFyZ2V0JykuaW5uZXJUZXh0ID0gYCUke3JhdGV9YDsKICAgICAgICAKICAgICAgICAvLyBSaW5nIENoYXJ0IFJlbmdpCiAgICAgICAgY29uc3QgcmluZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxLWRhc2gtcmluZycpOwogICAgICAgIGxldCBjb2xvciA9ICcjMmU3ZDMyJzsKICAgICAgICBpZihhdmcgPCA3MCkgY29sb3IgPSAnI2QzMmYyZic7IGVsc2UgaWYoYXZnIDwgODUpIGNvbG9yID0gJyNlZDZjMDInOwogICAgICAgIGNvbnN0IHJhdGlvID0gKGF2ZyAvIDEwMCkgKiAxMDA7CiAgICAgICAgaWYocmluZykgcmluZy5zdHlsZS5iYWNrZ3JvdW5kID0gYGNvbmljLWdyYWRpZW50KCR7Y29sb3J9ICR7cmF0aW99JSwgI2VlZSAke3JhdGlvfSUpYDsKICAgICAgICBpZihkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncS1kYXNoLXJpbmctdGV4dCcpKSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncS1kYXNoLXJpbmctdGV4dCcpLmlubmVyVGV4dCA9IE1hdGgucm91bmQoYXZnKTsKICAgICAgICB1cGRhdGVEYXNoUmluZ1RpdGxlKCk7CiAgICAgICAgLy8gQWRtaW4gacOnaW46IHRlbXNpbGNpIG9ydGFsYW1hbGFyxLEKICAgICAgICByZW5kZXJEYXNoQWdlbnRTY29yZXMoZmlsdGVyZWQpOwogICAgICAgIC8vIEdyYWZpayDDh2l6ZGlyCiAgICAgICAgcmVuZGVyRGFzaGJvYXJkQ2hhcnQoZmlsdGVyZWQpOwogICAgfSk7Cn0KZnVuY3Rpb24gcmVuZGVyRGFzaGJvYXJkQ2hhcnQoZGF0YSkgewogICAgY29uc3QgY3R4ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3EtYnJlYWtkb3duLWNoYXJ0Jyk7CiAgICBpZiAoIWN0eCkgcmV0dXJuOwogICAgaWYgKGRhc2hib2FyZENoYXJ0KSB7CiAgICAgICAgZGFzaGJvYXJkQ2hhcnQuZGVzdHJveSgpOwogICAgfQogICAgLy8gLS0tIEtSxLBURVIgQkFaTEkgQU5BTMSwWiAtLS0KICAgIGxldCBxdWVzdGlvblN0YXRzID0ge307CiAgICBpZiAoZGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgZGF0YS5mb3JFYWNoKGl0ZW0gPT4gewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgLy8gRGV0YXkgdmVyaXNpbmkga29udHJvbCBldCwgc3RyaW5nIGlzZSBwYXJzZSBldAogICAgICAgICAgICAgICAgbGV0IGRldGFpbHMgPSBzYWZlUGFyc2VEZXRhaWxzKGl0ZW0uZGV0YWlscyk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmKEFycmF5LmlzQXJyYXkoZGV0YWlscykpIHsKICAgICAgICAgICAgICAgICAgICBkZXRhaWxzLmZvckVhY2goZCA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBxRnVsbFRleHQgPSBkLnE7IC8vIFRhbSBtZXRpbgogICAgICAgICAgICAgICAgICAgICAgICAvLyBTb3J1eXUgYW5haHRhciBvbGFyYWsga3VsbGFuIChrxLFzYWx0xLFsbcSxxZ8gdmVyc2l5b251KQogICAgICAgICAgICAgICAgICAgICAgICBsZXQgcVNob3J0VGV4dCA9IHFGdWxsVGV4dC5sZW5ndGggPiAyNSA/IHFGdWxsVGV4dC5zdWJzdHJpbmcoMCwgMjUpICsgJy4uLicgOiBxRnVsbFRleHQ7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXF1ZXN0aW9uU3RhdHNbcVNob3J0VGV4dF0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGZ1bGxUZXh0J2kgdHV0dXlvcnV6IGtpIHRvb2x0aXAndGUgZ8O2c3RlcmViaWxlbGltCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBxdWVzdGlvblN0YXRzW3FTaG9ydFRleHRdID0geyBlYXJuZWQ6IDAsIG1heDogMCwgZnVsbFRleHQ6IHFGdWxsVGV4dCB9OyAKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgcXVlc3Rpb25TdGF0c1txU2hvcnRUZXh0XS5lYXJuZWQgKz0gcGFyc2VJbnQoZC5zY29yZSB8fCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgcXVlc3Rpb25TdGF0c1txU2hvcnRUZXh0XS5tYXggKz0gcGFyc2VJbnQoZC5tYXggfHwgMCk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIC8vIEpTT04gcGFyc2UgaGF0YXPEsSB2ZXlhIGVza2kgdmVyaSBmb3JtYXTEsQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coIkRldGF5IHZlcmlzaSBpxZ9sZW5lbWVkaSIsIGUpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CiAgICAvLyDEsHN0YXRpc3Rpa2xlcmkgZGl6aXllIMOnZXZpcmlwIGJhxZ9hcsSxIG9yYW7EsW5hIGfDtnJlIHPEsXJhbGEKICAgIGxldCBzdGF0c0FycmF5ID0gT2JqZWN0LmtleXMocXVlc3Rpb25TdGF0cykubWFwKGtleSA9PiB7CiAgICAgICAgbGV0IHMgPSBxdWVzdGlvblN0YXRzW2tleV07CiAgICAgICAgLy8gQmHFn2FyxLEgb3JhbsSxICUKICAgICAgICBsZXQgcGVyY2VudGFnZSA9IHMubWF4ID4gMCA/IChzLmVhcm5lZCAvIHMubWF4KSAqIDEwMCA6IDA7CiAgICAgICAgcmV0dXJuIHsgbGFiZWw6IGtleSwgZnVsbExhYmVsOiBzLmZ1bGxUZXh0LCB2YWx1ZTogcGVyY2VudGFnZSB9OwogICAgfSk7CiAgICAKICAgIC8vIEJhxZ9hcsSxIG9yYW7EsW5hIGfDtnJlIGFydGFuIHPEsXJhbGFtYSAoRW4gZMO8xZ/DvGsgYmHFn2FyxLEgZW4gYmHFn3RhKQogICAgc3RhdHNBcnJheS5zb3J0KChhLCBiKSA9PiBhLnZhbHVlIC0gYi52YWx1ZSk7CiAgICAvLyBFxJ9lciBkZXRheSBrxLFyxLFsxLFtxLEgeW9rc2EgKGVza2kvYm/FnyBrYXnEsXRsYXIpLCB0ZW1zaWxjaSBvcnRhbGFtYXPEsW5hIGfDtnJlIGvEsXLEsWzEsW0gZ8O2c3RlcgogICAgaWYgKHN0YXRzQXJyYXkubGVuZ3RoID09PSAwKSB7CiAgICAgICAgY29uc3QgYnlBZ2VudCA9IHt9OwogICAgICAgIGRhdGEuZm9yRWFjaChpdCA9PiB7CiAgICAgICAgICAgIGNvbnN0IGEgPSBpdC5hZ2VudCB8fCAnTi9BJzsKICAgICAgICAgICAgY29uc3QgcyA9IHBhcnNlRmxvYXQoaXQuc2NvcmUpIHx8IDA7CiAgICAgICAgICAgIGlmKCFieUFnZW50W2FdKSBieUFnZW50W2FdID0geyB0b3RhbDowLCBjb3VudDowIH07CiAgICAgICAgICAgIGJ5QWdlbnRbYV0udG90YWwgKz0gczsKICAgICAgICAgICAgYnlBZ2VudFthXS5jb3VudCArPSAxOwogICAgICAgIH0pOwogICAgICAgIGNvbnN0IGFBcnIgPSBPYmplY3Qua2V5cyhieUFnZW50KS5tYXAobmFtZSA9PiAoewogICAgICAgICAgICBsYWJlbDogbmFtZS5sZW5ndGggPiAyNSA/IG5hbWUuc3Vic3RyaW5nKDAsMjUpICsgJy4uLicgOiBuYW1lLAogICAgICAgICAgICBmdWxsTGFiZWw6IG5hbWUsCiAgICAgICAgICAgIHZhbHVlOiBieUFnZW50W25hbWVdLmNvdW50ID8gKGJ5QWdlbnRbbmFtZV0udG90YWwvYnlBZ2VudFtuYW1lXS5jb3VudCkgOiAwCiAgICAgICAgfSkpOwogICAgICAgIGFBcnIuc29ydCgoeCx5KT0+IHgudmFsdWUgLSB5LnZhbHVlKTsKICAgICAgICBsZXQgdG9wSXNzdWVzID0gYUFyci5zbGljZSgwLCA2KTsKICAgICAgICBsZXQgY2hhcnRMYWJlbHMgPSB0b3BJc3N1ZXMubWFwKGkgPT4gaS5sYWJlbCk7CiAgICAgICAgbGV0IGNoYXJ0RGF0YSA9IHRvcElzc3Vlcy5tYXAoaSA9PiBpLnZhbHVlLnRvRml4ZWQoMSkpOwoKICAgICAgICBkYXNoYm9hcmRDaGFydCA9IG5ldyBDaGFydChjdHgsIHsKICAgICAgICAgICAgdHlwZTogJ2JhcicsCiAgICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgICAgIGxhYmVsczogY2hhcnRMYWJlbHMsCiAgICAgICAgICAgICAgICBkYXRhc2V0czogW3sKICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ09ydGFsYW1hIFB1YW4nLAogICAgICAgICAgICAgICAgICAgIGRhdGE6IGNoYXJ0RGF0YSwKICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IGNoYXJ0RGF0YS5tYXAodmFsID0+IHZhbCA8IDcwID8gJ3JnYmEoMjExLCA0NywgNDcsIDAuNyknIDogKHZhbCA8IDg1ID8gJ3JnYmEoMjM3LCAxMDgsIDIsIDAuNyknIDogJ3JnYmEoNDYsIDEyNSwgNTAsIDAuNyknKSksCiAgICAgICAgICAgICAgICAgICAgYm9yZGVyQ29sb3I6IGNoYXJ0RGF0YS5tYXAodmFsID0+IHZhbCA8IDcwID8gJyNiNzFjMWMnIDogKHZhbCA8IDg1ID8gJyNlNjUxMDAnIDogJyMxYjVlMjAnKSksCiAgICAgICAgICAgICAgICAgICAgYm9yZGVyV2lkdGg6IDEsCiAgICAgICAgICAgICAgICAgICAgYm9yZGVyUmFkaXVzOiA0CiAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICB9LAogICAgICAgICAgICBvcHRpb25zOiB7CiAgICAgICAgICAgICAgICByZXNwb25zaXZlOiB0cnVlLAogICAgICAgICAgICAgICAgbWFpbnRhaW5Bc3BlY3RSYXRpbzogZmFsc2UsCiAgICAgICAgICAgICAgICBpbmRleEF4aXM6ICd5JywKICAgICAgICAgICAgICAgIHNjYWxlczogewogICAgICAgICAgICAgICAgICAgIHg6IHsgYmVnaW5BdFplcm86IHRydWUsIG1heDogMTAwLCBncmlkOiB7IGNvbG9yOiAnI2YwZjBmMCcgfSB9LAogICAgICAgICAgICAgICAgICAgIHk6IHsgZ3JpZDogeyBkaXNwbGF5OiBmYWxzZSB9IH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBwbHVnaW5zOiB7CiAgICAgICAgICAgICAgICAgICAgbGVnZW5kOiB7IGRpc3BsYXk6IGZhbHNlIH0sCiAgICAgICAgICAgICAgICAgICAgdG9vbHRpcDogewogICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFja3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBmdW5jdGlvbihjb250ZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRleHQubGVuZ3RoID4gMCkgcmV0dXJuIHRvcElzc3Vlc1tjb250ZXh0WzBdLmRhdGFJbmRleF0uZnVsbExhYmVsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogZnVuY3Rpb24oY29udGV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjb250ZXh0LnBhcnNlZC54ICsgJyBPcnRhbGFtYSc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgLy8gU2FkZWNlIGVuIGTDvMWfw7xrIDYga3JpdGVyaSBnw7ZzdGVyCiAgICBsZXQgdG9wSXNzdWVzID0gc3RhdHNBcnJheS5zbGljZSgwLCA2KTsKIAogICAgbGV0IGNoYXJ0TGFiZWxzID0gdG9wSXNzdWVzLm1hcChpID0+IGkubGFiZWwpOwogICAgbGV0IGNoYXJ0RGF0YSA9IHRvcElzc3Vlcy5tYXAoaSA9PiBpLnZhbHVlLnRvRml4ZWQoMSkpOwogICAgZGFzaGJvYXJkQ2hhcnQgPSBuZXcgQ2hhcnQoY3R4LCB7CiAgICAgICAgdHlwZTogJ2JhcicsCiAgICAgICAgZGF0YTogewogICAgICAgICAgICBsYWJlbHM6IGNoYXJ0TGFiZWxzLAogICAgICAgICAgICBkYXRhc2V0czogW3sKICAgICAgICAgICAgICAgIGxhYmVsOiAnQmHFn2FyxLEgT3JhbsSxICglKScsCiAgICAgICAgICAgICAgICBkYXRhOiBjaGFydERhdGEsCiAgICAgICAgICAgICAgICAvLyBLcml0ZXIgQmF6bMSxIFJlbmtsZW5kaXJtZQogICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBjaGFydERhdGEubWFwKHZhbCA9PiB2YWwgPCA3MCA/ICdyZ2JhKDIxMSwgNDcsIDQ3LCAwLjcpJyA6ICh2YWwgPCA5MCA/ICdyZ2JhKDIzNywgMTA4LCAyLCAwLjcpJyA6ICdyZ2JhKDQ2LCAxMjUsIDUwLCAwLjcpJykpLAogICAgICAgICAgICAgICAgYm9yZGVyQ29sb3I6IGNoYXJ0RGF0YS5tYXAodmFsID0+IHZhbCA8IDcwID8gJyNiNzFjMWMnIDogKHZhbCA8IDkwID8gJyNlNjUxMDAnIDogJyMxYjVlMjAnKSksCiAgICAgICAgICAgICAgICBib3JkZXJXaWR0aDogMSwKICAgICAgICAgICAgICAgIGJvcmRlclJhZGl1czogNAogICAgICAgICAgICB9XQogICAgICAgIH0sCiAgICAgICAgb3B0aW9uczogewogICAgICAgICAgICByZXNwb25zaXZlOiB0cnVlLAogICAgICAgICAgICBtYWludGFpbkFzcGVjdFJhdGlvOiBmYWxzZSwKICAgICAgICAgICAgaW5kZXhBeGlzOiAneScsIC8vIFlhdGF5IMOndWJ1ayBncmFmaWsKICAgICAgICAgICAgc2NhbGVzOiB7CiAgICAgICAgICAgICAgICB4OiB7IAogICAgICAgICAgICAgICAgICAgIGJlZ2luQXRaZXJvOiB0cnVlLCAKICAgICAgICAgICAgICAgICAgICBtYXg6IDEwMCwKICAgICAgICAgICAgICAgICAgICBncmlkOiB7IGNvbG9yOiAnI2YwZjBmMCcgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHk6IHsKICAgICAgICAgICAgICAgICAgICBncmlkOiB7IGRpc3BsYXk6IGZhbHNlIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgcGx1Z2luczogewogICAgICAgICAgICAgICAgbGVnZW5kOiB7IGRpc3BsYXk6IGZhbHNlIH0sCiAgICAgICAgICAgICAgICB0b29sdGlwOiB7CiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2tzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRvb2x0aXAgYmHFn2zEscSfxLFuZGEgdGFtIG1ldG5pIGfDtnN0ZXJpbG1lc2kKICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGZ1bmN0aW9uKGNvbnRleHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb250ZXh0Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRhSW5kZXggPSBjb250ZXh0WzBdLmRhdGFJbmRleDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBmdWxsTGFiZWwnaSBrdWxsYW5hcmFrIHRhbSBtZXRuaSBkw7ZuZMO8cgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0b3BJc3N1ZXNbZGF0YUluZGV4XS5mdWxsTGFiZWw7IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcnOwogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogZnVuY3Rpb24oY29udGV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbnRleHQucGFyc2VkLnggKyAnJSBCYcWfYXLEsSc7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9KTsKfQovLyAtLS0gRcSexLBUxLBNIE1PRMOcTMOcIChZRU7EsCkgLS0tCmZ1bmN0aW9uIGxvYWRUcmFpbmluZ0RhdGEoKSB7CiAgICBjb25zdCBsaXN0RWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndHJhaW5pbmctbGlzdCcpOwogICAgbGlzdEVsLmlubmVySFRNTCA9ICc8ZGl2IHN0eWxlPSJncmlkLWNvbHVtbjoxLy0xOyB0ZXh0LWFsaWduOmNlbnRlcjsiPlnDvGtsZW5peW9yLi4uPC9kaXY+JzsKICAgIAogICAgZmV0Y2goU0NSSVBUX1VSTCwgewogICAgICAgIG1ldGhvZDogJ1BPU1QnLAogICAgICAgIGhlYWRlcnM6IHsgIkNvbnRlbnQtVHlwZSI6ICJ0ZXh0L3BsYWluO2NoYXJzZXQ9dXRmLTgiIH0sCiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBhY3Rpb246ICJnZXRUcmFpbmluZ3MiLCB1c2VybmFtZTogY3VycmVudFVzZXIsIHRva2VuOiBnZXRUb2tlbigpLCBhc0FkbWluOiBpc0FkbWluTW9kZSB9KQogICAgfSkudGhlbihyID0+IHIuanNvbigpKS50aGVuKGRhdGEgPT4gewogICAgICAgIGxpc3RFbC5pbm5lckhUTUwgPSAnJzsKICAgICAgICBpZihkYXRhLnJlc3VsdCA9PT0gJ3N1Y2Nlc3MnICYmIGRhdGEudHJhaW5pbmdzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgZGF0YS50cmFpbmluZ3MuZm9yRWFjaCh0ID0+IHsKICAgICAgICAgICAgICAgIGxldCBzdGF0dXNIdG1sID0gdC5pc0NvbXBsZXRlZCAKICAgICAgICAgICAgICAgICAgICA/IGA8YnV0dG9uIGNsYXNzPSJ0LWJ0biB0LWJ0bi1kb25lIj48aSBjbGFzcz0iZmFzIGZhLWNoZWNrIj48L2k+IFRhbWFtbGFuZMSxPC9idXR0b24+YAogICAgICAgICAgICAgICAgICAgIDogYDxidXR0b24gY2xhc3M9InQtYnRuIHQtYnRuLXN0YXJ0IiBvbmNsaWNrPSJvcGVuVHJhaW5pbmdMaW5rKCcke3QuaWR9JywgJyR7dC5saW5rfScpIj5FxJ9pdGltZSBHaXQ8L2J1dHRvbj5gOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsZXQgZG9jSHRtbCA9IHQuZG9jTGluayAmJiB0LmRvY0xpbmsgIT09ICdOL0EnIAogICAgICAgICAgICAgICAgICAgID8gYDxhIGhyZWY9IiR7dC5kb2NMaW5rfSIgdGFyZ2V0PSJfYmxhbmsiIGNsYXNzPSJ0LWRvYy1saW5rIj48aSBjbGFzcz0iZmFzIGZhLWZpbGUtZG93bmxvYWQiPjwvaT4gRMO2a8O8bWFuxLEgxLBuZGlyPC9hPmAgCiAgICAgICAgICAgICAgICAgICAgOiAnJzsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gR8OcTkNFTExFTk3EsMWeIEtBUlQgWUFQSVNJIChUYXJpaCB2ZSBTw7xyZSBFa2xlbmRpKQogICAgICAgICAgICAgICAgbGlzdEVsLmlubmVySFRNTCArPSBgCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0LWNhcmQiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InQtY2FyZC1oZWFkZXIiPgogICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj4ke3QudGl0bGV9JHtpc0FkbWluTW9kZSA/IGAgPHNwYW4gc3R5bGU9XCJmb250LXdlaWdodDo2MDA7IG9wYWNpdHk6Ljg7IGZvbnQtc2l6ZTouNzVyZW1cIj4oJHt0LnRhcmdldH0ke3QudGFyZ2V0PT09J0luZGl2aWR1YWwnICYmIHQudGFyZ2V0VXNlciA/ICcg4oCiICcrdC50YXJnZXRVc2VyIDogJyd9KTwvc3Bhbj5gIDogJyd9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0idC1zdGF0dXMtYmFkZ2UiPkF0YW5tYTogJHt0LmRhdGV9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InQtY2FyZC1ib2R5Ij4KICAgICAgICAgICAgICAgICAgICAgICAgJHt0LmRlc2N9CiAgICAgICAgICAgICAgICAgICAgICAgICR7ZG9jSHRtbH0KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0ibWFyZ2luLXRvcDoxMHB4OyBkaXNwbGF5OmZsZXg7IGp1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuOyBmb250LXNpemU6MC44cmVtOyBjb2xvcjojNjY2OyBwYWRkaW5nLXRvcDoxMHB4OyBib3JkZXItdG9wOjFweCBkYXNoZWQgI2VlZTsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48c3Ryb25nPlPDvHJlOjwvc3Ryb25nPiAke3QuZHVyYXRpb24gfHwgJ0JlbGlydGlsbWVkaSd9PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxzdHJvbmc+QmHFn2xhbmfEscOnOjwvc3Ryb25nPiAke3Quc3RhcnREYXRlIHx8ICdOL0EnfSAtIDxzdHJvbmc+Qml0acWfOjwvc3Ryb25nPiAke3QuZW5kRGF0ZSB8fCAnTi9BJ308L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZTowLjhyZW07IGNvbG9yOiM5OTk7IG1hcmdpbi10b3A6NXB4OyI+QXRheWFuOiAke3QuY3JlYXRvcn08L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0LWNhcmQtZm9vdGVyIj4KICAgICAgICAgICAgICAgICAgICAgICAgJHtzdGF0dXNIdG1sfQogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbGlzdEVsLmlubmVySFRNTCA9ICc8ZGl2IHN0eWxlPSJncmlkLWNvbHVtbjoxLy0xOyB0ZXh0LWFsaWduOmNlbnRlcjsgcGFkZGluZzoyMHB4OyBjb2xvcjojODg4OyI+QXRhbm3EscWfIGXEn2l0aW0gYnVsdW5tdXlvci48L2Rpdj4nOwogICAgICAgIH0KICAgIH0pOwp9CmZ1bmN0aW9uIHN0YXJ0VHJhaW5pbmcoaWQpewogICAgZmV0Y2goU0NSSVBUX1VSTCwgewogICAgICAgIG1ldGhvZDonUE9TVCcsCiAgICAgICAgaGVhZGVyczp7IkNvbnRlbnQtVHlwZSI6InRleHQvcGxhaW47Y2hhcnNldD11dGYtOCJ9LAogICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgYWN0aW9uOiAic3RhcnRUcmFpbmluZyIsIHRyYWluaW5nSWQ6IGlkLCB1c2VybmFtZTogY3VycmVudFVzZXIsIHRva2VuOiBnZXRUb2tlbigpIH0pCiAgICB9KS50aGVuKHI9PnIuanNvbigpKS5jYXRjaCgoKT0+e30pOwp9CgpmdW5jdGlvbiBvcGVuVHJhaW5pbmdMaW5rKGlkLCBsaW5rKSB7CiAgICBzdGFydFRyYWluaW5nKGlkKTsKICAgIGlmKGxpbmsgJiYgbGluayAhPT0gJ04vQScpIHsKICAgICAgICB3aW5kb3cub3BlbihsaW5rLCAnX2JsYW5rJyk7CiAgICB9IGVsc2UgewogICAgICAgIFN3YWwuZmlyZSgnVXlhcsSxJywgJ0J1IGXEn2l0aW0gacOnaW4gZ2XDp2VybGkgYmlyIGxpbmsgYnVsdW5tYW1ha3RhZMSxci4nLCAnd2FybmluZycpOwogICAgfQogICAgCiAgICAvLyBMaW5rZSB0xLFrbGFkxLFrdGFuIHNvbnJhIG9uYXkgc29yCiAgICBTd2FsLmZpcmUoewogICAgICAgIHRpdGxlOiAnRcSfaXRpbWkgVGFtYW1sYWTEsW4gbcSxPycsCiAgICAgICAgdGV4dDogIkXEn2l0aW0gacOnZXJpxJ9pbmkgaW5jZWxleWlwIGFubGFkxLF5c2FuIG9uYXlsYS4iLAogICAgICAgIGljb246ICdxdWVzdGlvbicsCiAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogJ0V2ZXQsIFRhbWFtbGFkxLFtJywKICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiAnRGFoYSBTb25yYScKICAgIH0pLnRoZW4oKHJlc3VsdCkgPT4gewogICAgICAgIGlmIChyZXN1bHQuaXNDb25maXJtZWQpIHsKICAgICAgICAgICAgY29tcGxldGVUcmFpbmluZyhpZCk7CiAgICAgICAgfQogICAgfSk7Cn0KZnVuY3Rpb24gY29tcGxldGVUcmFpbmluZyhpZCkgewogICAgZmV0Y2goU0NSSVBUX1VSTCwgewogICAgICAgIG1ldGhvZDogJ1BPU1QnLAogICAgICAgIGhlYWRlcnM6IHsgIkNvbnRlbnQtVHlwZSI6ICJ0ZXh0L3BsYWluO2NoYXJzZXQ9dXRmLTgiIH0sCiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBhY3Rpb246ICJjb21wbGV0ZVRyYWluaW5nIiwgdHJhaW5pbmdJZDogaWQsIHVzZXJuYW1lOiBjdXJyZW50VXNlciwgdG9rZW46IGdldFRva2VuKCkgfSkKICAgIH0pLnRoZW4ociA9PiByLmpzb24oKSkudGhlbihkID0+IHsKICAgICAgICBpZihkLnJlc3VsdCA9PT0gJ3N1Y2Nlc3MnKSB7CiAgICAgICAgICAgIFN3YWwuZmlyZSgnSGFyaWthIScsICdFxJ9pdGltIHRhbWFtbGFuZMSxIG9sYXJhayBpxZ9hcmV0bGVuZGkuJywgJ3N1Y2Nlc3MnKTsKICAgICAgICAgICAgbG9hZFRyYWluaW5nRGF0YSgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFN3YWwuZmlyZSgnSGF0YScsIGQubWVzc2FnZSwgJ2Vycm9yJyk7CiAgICAgICAgfQogICAgfSk7Cn0KYXN5bmMgZnVuY3Rpb24gYXNzaWduVHJhaW5pbmdQb3B1cCgpIHsKICAgIGNvbnN0IHsgdmFsdWU6IGZvcm1WYWx1ZXMgfSA9IGF3YWl0IFN3YWwuZmlyZSh7CiAgICAgICAgdGl0bGU6ICdZZW5pIEXEn2l0aW0gJiBEw7Zrw7xtYW4gQXRhJywKICAgICAgICBodG1sOiBgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9InQtbW9kYWwtZ3JpZCI+CiAgICAgICAgICAgICAgICA8aW5wdXQgaWQ9InN3YWwtdC10aXRsZSIgY2xhc3M9InN3YWwyLWlucHV0IiBwbGFjZWhvbGRlcj0iRcSfaXRpbSBCYcWfbMSxxJ/EsSIgc3R5bGU9ImdyaWQtY29sdW1uOiAxIC8gNDsiPgogICAgICAgICAgICAgICAgPHRleHRhcmVhIGlkPSJzd2FsLXQtZGVzYyIgY2xhc3M9InN3YWwyLXRleHRhcmVhIiBzdHlsZT0iaGVpZ2h0OjEwMHB4OyBncmlkLWNvbHVtbjogMSAvIDQ7IiBwbGFjZWhvbGRlcj0iRcSfaXRpbSBhw6fEsWtsYW1hc8SxIHZleWEgdGFsaW1hdGxhci4uLiI+PC90ZXh0YXJlYT4KICAgICAgICAgICAgICAgIDxpbnB1dCBpZD0ic3dhbC10LWxpbmsiIGNsYXNzPSJzd2FsMi1pbnB1dCIgcGxhY2Vob2xkZXI9IlZpZGVvL0XEn2l0aW0gTGlua2kgKFVSTCkiIHN0eWxlPSJncmlkLWNvbHVtbjogMSAvIDQ7Ij4KICAgICAgICAgICAgICAgIDxpbnB1dCBpZD0ic3dhbC10LWRvYyIgY2xhc3M9InN3YWwyLWlucHV0IiBwbGFjZWhvbGRlcj0iRMO2a8O8bWFuIExpbmtpIChEcml2ZS9QREYgVVJMKSAoxLBzdGXEn2UgQmHEn2zEsSkiIHN0eWxlPSJncmlkLWNvbHVtbjogMSAvIDQ7Ij4KICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJkYXRlIiBpZD0ic3dhbC10LXN0YXJ0IiBjbGFzcz0ic3dhbDItaW5wdXQiIHZhbHVlPSIke25ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zdWJzdHJpbmcoMCwgMTApfSI+CiAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iZGF0ZSIgaWQ9InN3YWwtdC1lbmQiIGNsYXNzPSJzd2FsMi1pbnB1dCI+CiAgICAgICAgICAgICAgICA8aW5wdXQgaWQ9InN3YWwtdC1kdXJhdGlvbiIgY2xhc3M9InN3YWwyLWlucHV0IiBwbGFjZWhvbGRlcj0iU8O8cmUgKMOWcm46IDIwZGspIj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxzZWxlY3QgaWQ9InN3YWwtdC10YXJnZXQiIGNsYXNzPSJzd2FsMi1pbnB1dCIgb25jaGFuZ2U9InVwZGF0ZVRyYWluaW5nVGFyZ2V0KHRoaXMudmFsdWUpIiBzdHlsZT0ibWFyZ2luLXRvcDoxMHB4OyI+CiAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJHZW5lbCI+SGVya2VzZSAoVMO8bSBFa2lwKTwvb3B0aW9uPgogICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iVGVsZXNhdMSxxZ8iPlRlbGVzYXTEscWfIEVraWJpPC9vcHRpb24+CiAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJDaGF0Ij5DaGF0IEVraWJpPC9vcHRpb24+CiAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJJbmRpdmlkdWFsIj5LacWfaXllIMOWemVsPC9vcHRpb24+CiAgICAgICAgICAgIDwvc2VsZWN0PgogICAgICAgICAgICA8c2VsZWN0IGlkPSJzd2FsLXQtYWdlbnQiIGNsYXNzPSJzd2FsMi1pbnB1dCIgc3R5bGU9ImRpc3BsYXk6bm9uZTsgd2lkdGg6MTAwJTsiPjwvc2VsZWN0PgogICAgICAgIGAsCiAgICAgICAgZm9jdXNDb25maXJtOiBmYWxzZSwKICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAnQXRhJywKICAgICAgICBkaWRPcGVuOiAoKSA9PiB7CiAgICAgICAgICAgIHdpbmRvdy51cGRhdGVUcmFpbmluZ1RhcmdldCA9IGZ1bmN0aW9uKHZhbCkgewogICAgICAgICAgICAgICAgY29uc3QgYWdlbnRTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC10LWFnZW50Jyk7CiAgICAgICAgICAgICAgICBhZ2VudFNlbGVjdC5zdHlsZS5kaXNwbGF5ID0gdmFsID09PSAnSW5kaXZpZHVhbCcgPyAnYmxvY2snIDogJ25vbmUnOwogICAgICAgICAgICAgICAgaWYgKHZhbCA9PT0gJ0luZGl2aWR1YWwnKSB7CiAgICAgICAgICAgICAgICAgICAgYWdlbnRTZWxlY3QuaW5uZXJIVE1MID0gYWRtaW5Vc2VyTGlzdC5tYXAodSA9PiBgPG9wdGlvbiB2YWx1ZT0iJHt1Lm5hbWV9Ij4ke3UubmFtZX08L29wdGlvbj5gKS5qb2luKCcnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgdXBkYXRlVHJhaW5pbmdUYXJnZXQoJ0dlbmVsJyk7CiAgICAgICAgfSwKICAgICAgICBwcmVDb25maXJtOiAoKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHRhcmdldCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLXQtdGFyZ2V0JykudmFsdWU7CiAgICAgICAgICAgIGNvbnN0IGFnZW50ID0gdGFyZ2V0ID09PSAnSW5kaXZpZHVhbCcgPyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC10LWFnZW50JykudmFsdWUgOiAnJzsKICAgICAgICAgICAgaWYgKCFkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC10LXRpdGxlJykudmFsdWUgfHwgKCF0YXJnZXQgJiYgIWFnZW50KSkgewogICAgICAgICAgICAgICAgU3dhbC5zaG93VmFsaWRhdGlvbk1lc3NhZ2UoJ0JhxZ9sxLFrIHZlIEF0YW1hIEFsYW7EsSBib8WfIGLEsXJha8SxbGFtYXonKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgdGl0bGU6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLXQtdGl0bGUnKS52YWx1ZSwKICAgICAgICAgICAgICAgIGRlc2M6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLXQtZGVzYycpLnZhbHVlLAogICAgICAgICAgICAgICAgbGluazogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N3YWwtdC1saW5rJykudmFsdWUsCiAgICAgICAgICAgICAgICBkb2NMaW5rOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC10LWRvYycpLnZhbHVlIHx8ICdOL0EnLAogICAgICAgICAgICAgICAgdGFyZ2V0OiB0YXJnZXQsCiAgICAgICAgICAgICAgICB0YXJnZXRBZ2VudDogYWdlbnQsIC8vIEtpxZ9peWUgw7Z6ZWwgYXRhbWEgacOnaW4KICAgICAgICAgICAgICAgIGNyZWF0b3I6IGN1cnJlbnRVc2VyLAogICAgICAgICAgICAgICAgc3RhcnREYXRlOiBmb3JtYXREYXRlVG9ERE1NWVlZWShkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC10LXN0YXJ0JykudmFsdWUpLCAKICAgICAgICAgICAgICAgIGVuZERhdGU6IGZvcm1hdERhdGVUb0RETU1ZWVlZKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzd2FsLXQtZW5kJykudmFsdWUpLCAKICAgICAgICAgICAgICAgIGR1cmF0aW9uOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dhbC10LWR1cmF0aW9uJykudmFsdWUgCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9KTsKICAgIGlmIChmb3JtVmFsdWVzKSB7CiAgICAgICAgU3dhbC5maXJlKHt0aXRsZTonQXRhbsSxeW9yLi4uJywgZGlkT3BlbjooKT0+U3dhbC5zaG93TG9hZGluZygpfSk7CiAgICAgICAgZmV0Y2goU0NSSVBUX1VSTCwgewogICAgICAgICAgICBtZXRob2Q6ICdQT1NUJywKICAgICAgICAgICAgaGVhZGVyczogeyAiQ29udGVudC1UeXBlIjogInRleHQvcGxhaW47Y2hhcnNldD11dGYtOCIgfSwKICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBhY3Rpb246ICJhc3NpZ25UcmFpbmluZyIsIHVzZXJuYW1lOiBjdXJyZW50VXNlciwgdG9rZW46IGdldFRva2VuKCksIC4uLmZvcm1WYWx1ZXMgfSkKICAgICAgICB9KS50aGVuKHI9PnIuanNvbigpKS50aGVuKGQ9PnsKICAgICAgICAgICAgU3dhbC5maXJlKCdCYcWfYXLEsWzEsScsICdFxJ9pdGltIGF0YW5kxLEuJywgJ3N1Y2Nlc3MnKTsKICAgICAgICAgICAgbG9hZFRyYWluaW5nRGF0YSgpOwogICAgICAgIH0pOwogICAgfQp9Ci8vIC0tLSBGRUVEQkFDSyBNT0TDnEzDnCAtLS0KCi8vIFlFTsSwIEZPTktTxLBZT046IEZlZWRiYWNrX0xvZ3MndSDDp2VrbWVrIGnDp2luCmFzeW5jIGZ1bmN0aW9uIGZldGNoRmVlZGJhY2tMb2dzKCkgewogICAgdHJ5IHsKICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaChTQ1JJUFRfVVJMLCB7CiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLAogICAgICAgICAgICBoZWFkZXJzOiB7ICJDb250ZW50LVR5cGUiOiAidGV4dC9wbGFpbjtjaGFyc2V0PXV0Zi04IiB9LAogICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGFjdGlvbjogImZldGNoRmVlZGJhY2tMb2dzIiwgdXNlcm5hbWU6IGN1cnJlbnRVc2VyLCB0b2tlbjogZ2V0VG9rZW4oKSB9KQogICAgICAgIH0pOwogICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXMuanNvbigpOwogICAgICAgIGlmIChkYXRhLnJlc3VsdCA9PT0gInN1Y2Nlc3MiKSB7CiAgICAgICAgICAgIGZlZWRiYWNrTG9nc0RhdGEgPSBkYXRhLmZlZWRiYWNrTG9ncyB8fCBbXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmZWVkYmFja0xvZ3NEYXRhID0gW107CiAgICAgICAgfQogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJGZWVkYmFjayBMb2dzIMOnZWtpbGlya2VuIGhhdGEgb2x1xZ90dToiLCBlcnJvcik7CiAgICAgICAgZmVlZGJhY2tMb2dzRGF0YSA9IFtdOwogICAgfQp9CgovLyBZQVJESU1DSSBGT05LU8SwWU9OOiBEw7ZuZW0gYmlsZ2lzaW5pIE1NLllZWVkgZm9ybWF0xLFuZGEgZMO2bmTDvHLDvHIKZnVuY3Rpb24gZm9ybWF0UGVyaW9kKHBlcmlvZFN0cmluZykgewogICAgaWYgKCFwZXJpb2RTdHJpbmcgfHwgcGVyaW9kU3RyaW5nID09PSAnTi9BJykgcmV0dXJuICdOL0EnOwogICAgCiAgICAvLyBaYXRlbiBNTS5ZWVlZIGZvcm1hdMSxbmRheXNhIGRpcmVrdCBkw7ZuZMO8cgogICAgaWYgKHBlcmlvZFN0cmluZy5tYXRjaCgvXlxkezJ9XC5cZHs0fSQvKSkgewogICAgICAgIHJldHVybiBwZXJpb2RTdHJpbmc7CiAgICB9CiAgICAKICAgIC8vIEXEn2VyIHV6dW4gYmlyIERhdGUgc3RyaW5nJ2kgaXNlICjDtnI6IFdlZCBPY3QgMDEgMjAyNS4uLikgdGFyaWggbmVzbmVzaW5lIMOnZXZpcgogICAgdHJ5IHsKICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUocGVyaW9kU3RyaW5nKTsKICAgICAgICBpZiAoIWlzTmFOKGRhdGUuZ2V0VGltZSgpKSkgewogICAgICAgICAgICBjb25zdCBtb250aCA9IFN0cmluZyhkYXRlLmdldE1vbnRoKCkgKyAxKS5wYWRTdGFydCgyLCAnMCcpOwogICAgICAgICAgICBjb25zdCB5ZWFyID0gZGF0ZS5nZXRGdWxsWWVhcigpOwogICAgICAgICAgICByZXR1cm4gYCR7bW9udGh9LiR7eWVhcn1gOwogICAgICAgIH0KICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAvLyBIYXRhIG9sdcWfdXJzYSBvbGR1xJ91IGdpYmkgYsSxcmFrIHZleWEgTi9BIGTDtm5kw7xyCiAgICAgICAgY29uc29sZS5lcnJvcigiRMO2bmVtIGZvcm1hdGxhbWEgaGF0YXPEsToiLCBlKTsKICAgIH0KICAgIAogICAgcmV0dXJuIHBlcmlvZFN0cmluZzsgLy8gQmHFn2thIGZvcm1hdHRhIGdlbGlyc2UgeWluZSBkZSBvbGR1xJ91IGdpYmkgZMO2bmTDvHIKfQoKZnVuY3Rpb24gbG9hZEZlZWRiYWNrTGlzdCgpIHsKICAgIGNvbnN0IGxpc3RFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmZWVkYmFjay1saXN0Jyk7CiAgICBsaXN0RWwuaW5uZXJIVE1MID0gJyc7CiAgICAKICAgIC8vIEFkbWluIGJ1dG9udW51IGfDtnN0ZXIvZ2l6bGUKICAgIGNvbnN0IG1hbnVhbEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYW51YWwtZmVlZGJhY2stYWRtaW4tYnRuJyk7CiAgICBpZihtYW51YWxCdG4pIG1hbnVhbEJ0bi5zdHlsZS5kaXNwbGF5ID0gaXNBZG1pbk1vZGUgPyAnZmxleCcgOiAnbm9uZSc7CiAgICAKICAgIC8vIFlFTsSwIEbEsExUUkVMRU1FIE1BTlRJxJ5JOiBTYWRlY2UgZmVlZGJhY2tUeXBlICdNYWlsJyBvbGFubGFyIFZFWUEgY2FsbElkICdNQU5VRUwnIG9sYW5sYXIgbGlzdGVsZW5pci4KICAgIGNvbnN0IGZlZWRiYWNrSXRlbXMgPSBhbGxFdmFsdWF0aW9uc0RhdGEuZmlsdGVyKGUgPT4gewogICAgICAgIC8vIGZlZWRiYWNrVHlwZSBrb250cm9sw7wgKELDvHnDvGsva8O8w6fDvGsgaGFyZiBkdXlhcmzEsWzEscSfxLFuxLEgb3J0YWRhbiBrYWxkxLFyxLFyxLF6KQogICAgICAgIGNvbnN0IGlzTWFpbEZlZWRiYWNrID0gZS5mZWVkYmFja1R5cGUgJiYgZS5mZWVkYmFja1R5cGUudG9Mb3dlckNhc2UoKSA9PT0gJ21haWwnOwogICAgICAgIC8vIE1hbnVlbCBrb250cm9sw7wKICAgICAgICBjb25zdCBpc01hbnVhbEZlZWRiYWNrID0gZS5jYWxsSWQgJiYgU3RyaW5nKGUuY2FsbElkKS50b1VwcGVyQ2FzZSgpLnN0YXJ0c1dpdGgoJ01BTlVFTC0nKTsKICAgICAgICAKICAgICAgICByZXR1cm4gaXNNYWlsRmVlZGJhY2sgfHwgaXNNYW51YWxGZWVkYmFjazsKICAgIH0pOwogICAgaWYoZmVlZGJhY2tJdGVtcy5sZW5ndGggPT09IDApIHsKICAgICAgICBsaXN0RWwuaW5uZXJIVE1MID0gJzxkaXYgc3R5bGU9InBhZGRpbmc6MjBweDsgdGV4dC1hbGlnbjpjZW50ZXI7IGNvbG9yOiM4ODg7Ij5Hw7Zyw7xudMO8bGVuZWNlayBmaWx0cmVsZW5tacWfIGdlcmkgYmlsZGlyaW0geW9rIChTYWRlY2UgTWFpbCB2ZXlhIE1hbnVlbCkuPC9kaXY+JzsKICAgICAgICByZXR1cm47CiAgICB9CiAgICAKICAgIGZlZWRiYWNrSXRlbXMuZm9yRWFjaChlID0+IHsKICAgICAgICAvLyBHZWxpxZ90aXJtZTogw4dhxJ9yxLEgVGFyaWhpIHZlIElEIGVrbGVuZGkgKEdlbGnFn21pxZ8gS2FydCBUYXNhcsSxbcSxKQogICAgICAgIGNvbnN0IGZlZWRiYWNrQ2xhc3MgPSBlLmZlZWRiYWNrVHlwZSA9PT0gJ1PDtnpsw7wnID8gJyMyMTk2ZjMnIDogKGUuZmVlZGJhY2tUeXBlID09PSAnTWFpbCcgPyAnI2U2NTEwMCcgOiAoZS5mZWVkYmFja1R5cGUgPT09ICdCaWxnaWxlbmRpcm1lJyA/ICcjMDI4OGQxJyA6IChlLmZlZWRiYWNrVHlwZSA9PT0gJ0ZlZWRiYWNrJyA/ICcjMmU3ZDMyJyA6ICcjMTBiOTgxJykpKTsKICAgICAgICAKICAgICAgICAvLyBNQU5VRUwgQ2FsbElEJ2RlbiDDtm4gZWtpIHRlbWl6bGUKICAgICAgICBjb25zdCBjbGVhbkNhbGxJZCA9IFN0cmluZyhlLmNhbGxJZCkudG9VcHBlckNhc2UoKS5zdGFydHNXaXRoKCdNQU5VRUwtJykgPyBTdHJpbmcoZS5jYWxsSWQpLnN1YnN0cmluZyg3KSA6IGUuY2FsbElkOwogICAgICAgIAogICAgICAgIC8vIEtvbnUvQmHFn2zEsWsgYmlsZ2lzaSAnZGV0YWlscycgYWxhbsSxbmRhbiBnZWxpciAoTWFudWVsIGdlcmkgYmlsZGlyaW0gacOnaW4pCiAgICAgICAgLy8gRcSfZXIgZGV0YXkgYWxhbsSxIEpTT04gaXNlICh5YW5pIG5vcm1hbCBkZcSfZXJsZW5kaXJtZSkgdmV5YSBib8Wfc2EgdmFyc2F5xLFsYW4gbWV0aW4ga3VsbGFuCiAgICAgICAgY29uc3QgaXNFdmFsdWF0aW9uRGV0YWlsID0gU3RyaW5nKGUuZGV0YWlscykuc3RhcnRzV2l0aCgnWycpOwogICAgICAgIGNvbnN0IGZlZWRiYWNrVG9waWMgPSBpc0V2YWx1YXRpb25EZXRhaWwgPyAnRGXEn2VybGVuZGlybWUgS29udXN1JyA6IChlLmRldGFpbHMgfHwgJ0JlbGlydGlsbWVtacWfJyk7CiAgICAgICAgCiAgICAgICAgLy8gRMO2bmVtLCBLYW5hbCB2ZSBUaXBpIGJlbGlybGUgKE1hbnVlbCBrYXnEsXRsYXJkYSBidSBiaWxnaWxlcmkgRXZhbHVhdGlvbnMndGFuIGRlxJ9pbCwgRmVlZGJhY2tfTG9ncyd0YW4gw6dla2l5b3J1eikKICAgICAgICBjb25zdCBpc01hbnVhbCA9IFN0cmluZyhlLmNhbGxJZCkudG9VcHBlckNhc2UoKS5zdGFydHNXaXRoKCdNQU5VRUwtJyk7CiAgICAgICAgCiAgICAgICAgbGV0IHBlcmlvZCA9IGUucGVyaW9kIHx8IGUuZGF0ZS5zdWJzdHJpbmcoMyk7CiAgICAgICAgbGV0IGNoYW5uZWwgPSAoZS5jaGFubmVsICYmIFN0cmluZyhlLmNoYW5uZWwpLnRyaW0oKSkgPyBTdHJpbmcoZS5jaGFubmVsKS50cmltKCkgOiAnWW9rJzsKICAgICAgICBjb25zdCBpbmZvVHlwZSA9IGUuZmVlZGJhY2tUeXBlIHx8ICdZb2snOwoKICAgICAgICAvLyBEw5xaRUxUTUUgTUFOVEnEnkk6IEXEn2VyIGthecSxdCBNYW51ZWwgaXNlLCBkZXRheWzEsSBiaWxnaXlpIGZlZWRiYWNrTG9nc0RhdGEnZGFuIMOnZWsuCiAgICAgICAgaWYgKGlzTWFudWFsKSB7CiAgICAgICAgICAgIC8vIENhbGxJZCdkZWtpIE1BTlVFTC0gw7ZuIGVraW5pIGF0YXJhayBGZWVkYmFja19Mb2dzJ3Rha2kgQ2FsbF9JRCBpbGUgZcWfbGXFn3Rpcm1lCiAgICAgICAgICAgIGNvbnN0IGxvZ1JvdyA9IGZlZWRiYWNrTG9nc0RhdGEuZmluZCh4ID0+IFN0cmluZyh4LmNhbGxJZCkgPT09IFN0cmluZyhjbGVhbkNhbGxJZCkpOwogICAgICAgICAgICBpZiAobG9nUm93KSB7CiAgICAgICAgICAgICAgICAvLyBBcHBzIFNjcmlwdCd0ZW4gZ2VsZW4gcGVyaW9kIGRlxJ9lcmluaSBmb3JtYXRsYSAoVGFyaWggTmVzbmVzaS9TdHJpbmcgb2xtYSBpaHRpbWFsaW5lIGthcsWfxLEpCiAgICAgICAgICAgICAgICBwZXJpb2QgPSBmb3JtYXRQZXJpb2QobG9nUm93LnBlcmlvZCkgfHwgcGVyaW9kOwogICAgICAgICAgICAgICAgY2hhbm5lbCA9IGxvZ1Jvdy5jaGFubmVsICYmIGxvZ1Jvdy5jaGFubmVsICE9PSAnTi9BJyA/IGxvZ1Jvdy5jaGFubmVsIDogJ1lvayc7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgbGlzdEVsLmlubmVySFRNTCArPSBgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZlZWRiYWNrLWNhcmQiIHN0eWxlPSJib3JkZXItbGVmdC1jb2xvcjogJHtmZWVkYmFja0NsYXNzfTsiPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmVlZGJhY2staGVhZGVyIj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJmb250LXdlaWdodDpib2xkOyBjb2xvcjojMGUxYjQyOyBmb250LXNpemU6MS4xcmVtOyI+JHtlLmFnZW50fTwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZlZWRiYWNrLWluZm8tcmlnaHQiPgogICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj48aSBjbGFzcz0iZmFzIGZhLXVzZXItY2hlY2siPjwvaT4gRGXEn2VybGV5ZW46ICR7ZS5ldmFsdWF0b3J9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj48aSBjbGFzcz0iZmFzIGZhLWlkLWJhZGdlIj48L2k+IMOHYcSfcsSxIElEOiAke2NsZWFuQ2FsbElkfTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4+PGkgY2xhc3M9ImZhcyBmYS1jYWxlbmRhci1hbHQiPjwvaT4gVGFyaWg6ICR7ZS5jYWxsRGF0ZX08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZlZWRiYWNrLWJvZHkiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtd2VpZ2h0OmJvbGQ7IGNvbG9yOiMzMzM7IG1hcmdpbi1ib3R0b206NXB4OyI+S29udS9Bw6fEsWtsYW1hOiAke2ZlZWRiYWNrVG9waWN9PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iY29sb3I6IzU1NTsgbGluZS1oZWlnaHQ6MS41OyBmb250LXNpemU6MC45NXJlbTsiPiR7ZS5mZWVkYmFja308L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmVlZGJhY2stZm9vdGVyIj4KICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4OyBnYXA6MTBweDsgZm9udC1zaXplOjAuN3JlbTsgY29sb3I6IzY2NjsgZm9udC13ZWlnaHQ6NjAwOyBtYXJnaW4tcmlnaHQ6MTBweDsiPgogICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj48aSBjbGFzcz0iZmFzIGZhLWNhbGVuZGFyLXdlZWsiPjwvaT4gRMO2bmVtOiAke3BlcmlvZH08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuPjxpIGNsYXNzPSJmYXMgZmEtY29tbWVudC1hbHQiPjwvaT4gS2FuYWw6ICR7Y2hhbm5lbH08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuPjxpIGNsYXNzPSJmYXMgZmEtdGFnIj48L2k+IFRpcDogJHtpbmZvVHlwZX08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgPC9kaXY+YDsKICAgIH0pOwp9Ci8vIEFkbWlubGVyIGnDp2luIG1hbnVlbCBnZXJpIGJpbGRpcmltIGVrbGVtZSAow4dhxJ9yxLEgZMSxxZ/EsSBrb251bGFyIGnDp2luKQphc3luYyBmdW5jdGlvbiBhZGRNYW51YWxGZWVkYmFja1BvcHVwKCkgewogICAgaWYgKCFpc0FkbWluTW9kZSkgcmV0dXJuOwogICAgCiAgICAvLyBBZG1pbiB1c2VyIGxpc3Rlc2kgeW9rc2EgecO8a2xlCiAgICBpZiAoYWRtaW5Vc2VyTGlzdC5sZW5ndGggPT09IDApIHsKICAgICAgICBTd2FsLmZpcmUoeyB0aXRsZTogJ0t1bGxhbsSxY8SxIExpc3Rlc2kgWcO8a2xlbml5b3IuLi4nLCBkaWRPcGVuOiAoKSA9PiBTd2FsLnNob3dMb2FkaW5nKCkgfSk7CiAgICAgICAgYXdhaXQgZmV0Y2hVc2VyTGlzdEZvckFkbWluKCk7CiAgICAgICAgU3dhbC5jbG9zZSgpOwogICAgfQogICAgLy8gRMO2bmVtIGZpbHRyZSBzZcOnZW5la2xlcmluaSBvbHXFn3R1cgogICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTsKICAgIGNvbnN0IGN1cnJlbnRNb250aCA9IG5vdy5nZXRNb250aCgpOwogICAgY29uc3QgY3VycmVudFllYXIgPSBub3cuZ2V0RnVsbFllYXIoKTsKICAgIGxldCBtb250aE9wdGlvbnMgPSAnJzsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNjsgaSsrKSB7CiAgICAgICAgbGV0IG1vbnRoID0gKGN1cnJlbnRNb250aCAtIGkgKyAxMikgJSAxMjsKICAgICAgICBsZXQgeWVhciA9IGN1cnJlbnRZZWFyIC0gKGN1cnJlbnRNb250aCAtIGkgPCAwID8gMSA6IDApOwogICAgICAgIGNvbnN0IHRleHQgPSBgJHtNT05USF9OQU1FU1ttb250aF19ICR7eWVhcn1gOwogICAgICAgIGNvbnN0IHZhbHVlID0gYCR7U3RyaW5nKG1vbnRoICsgMSkucGFkU3RhcnQoMiwgJzAnKX0uJHt5ZWFyfWA7IC8vIEJhY2tlbmQnaW4gYmVrbGVkacSfaSBNTS5ZWVlZIGZvcm1hdMSxCiAgICAgICAgY29uc3QgaXNDdXJyZW50ID0gKGkgPT09IDApOwogICAgICAgIG1vbnRoT3B0aW9ucyArPSBgPG9wdGlvbiB2YWx1ZT0iJHt2YWx1ZX0iICR7aXNDdXJyZW50ID8gJ3NlbGVjdGVkJyA6ICcnfT4ke3RleHR9PC9vcHRpb24+YDsKICAgIH0KICAgIAogICAgLy8gWUVOxLAgSFRNTCBUQVNBUklNSTogRGFoYSBkw7x6ZW5saSB2ZSBldGlrZXRsaSBmb3JtCiAgICBjb25zdCBuZXdIdG1sQ29udGVudCA9IGAKICAgICAgICA8ZGl2IGNsYXNzPSJtYW51YWwtZmVlZGJhY2stZm9ybSI+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPgogICAgICAgICAgICAgICAgPGxhYmVsIGZvcj0ibWFudWFsLXEtYWdlbnQiPlRlbXNpbGNpIEFkxLEgPHNwYW4gY2xhc3M9InJlcXVpcmVkIj4qPC9zcGFuPjwvbGFiZWw+CiAgICAgICAgICAgICAgICA8c2VsZWN0IGlkPSJtYW51YWwtcS1hZ2VudCIgY2xhc3M9InN3YWwyLWlucHV0Ij48L3NlbGVjdD4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPgogICAgICAgICAgICAgICAgPGxhYmVsIGZvcj0ibWFudWFsLXEtdG9waWMiPktvbnUgLyBCYcWfbMSxayA8c3BhbiBjbGFzcz0icmVxdWlyZWQiPio8L3NwYW4+PC9sYWJlbD4KICAgICAgICAgICAgICAgIDxpbnB1dCBpZD0ibWFudWFsLXEtdG9waWMiIGNsYXNzPSJzd2FsMi1pbnB1dCIgcGxhY2Vob2xkZXI9IkdlcmkgYmlsZGlyaW0ga29udXN1ICjDlnJuOiBZZW5pIEthbXBhbnlhIEJpbGdpbGVuZGlybWVzaSkiPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImdyaWQtMi1jb2xzIj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPgogICAgICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9Im1hbnVhbC1xLWNhbGxpZCI+w4dhxJ9yxLEvRXRraWxlxZ9pbSBJRCA8c3BhbiBjbGFzcz0icmVxdWlyZWQiPio8L3NwYW4+PC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICA8aW5wdXQgaWQ9Im1hbnVhbC1xLWNhbGxpZCIgY2xhc3M9InN3YWwyLWlucHV0IiBwbGFjZWhvbGRlcj0iSUQgKMOWcm46IDEyMzQ1NikiPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIj4KICAgICAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJtYW51YWwtcS1kYXRlIj5UYXJpaCA8c3BhbiBjbGFzcz0icmVxdWlyZWQiPio8L3NwYW4+PC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iZGF0ZSIgaWQ9Im1hbnVhbC1xLWRhdGUiIGNsYXNzPSJzd2FsMi1pbnB1dCIgdmFsdWU9IiR7bmV3IERhdGUoKS50b0lTT1N0cmluZygpLnN1YnN0cmluZygwLCAxMCl9Ij4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iZ3JpZC0zLWNvbHMiPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cCI+CiAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGZvcj0ibWFudWFsLXEtY2hhbm5lbCI+S2FuYWw8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgIDxzZWxlY3QgaWQ9Im1hbnVhbC1xLWNoYW5uZWwiIGNsYXNzPSJzd2FsMi1pbnB1dCI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IlRlbGVmb24iPlRlbGVmb248L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iQ2FubMSxIERlc3RlayI+Q2FubMSxIERlc3Rlazwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJFLXBvc3RhIj5FLXBvc3RhPC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IlNvc3lhbCBNZWR5YSI+U29zeWFsIE1lZHlhPC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IllvayI+WW9rL0RpxJ9lcjwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgIDwvc2VsZWN0PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIj4KICAgICAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJtYW51YWwtcS1wZXJpb2QiPkTDtm5lbTwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgPHNlbGVjdCBpZD0ibWFudWFsLXEtcGVyaW9kIiBjbGFzcz0ic3dhbDItaW5wdXQiPiR7bW9udGhPcHRpb25zfTwvc2VsZWN0PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIj4KICAgICAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJtYW51YWwtcS10eXBlIj5UaXA8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgIDxzZWxlY3QgaWQ9Im1hbnVhbC1xLXR5cGUiIGNsYXNzPSJzd2FsMi1pbnB1dCI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IkZlZWRiYWNrIj5GZWVkYmFjazwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJCaWxnaWxlbmRpcm1lIj5CaWxnaWxlbmRpcm1lPC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IlPDtnpsw7wiPlPDtnpsw7w8L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iTWFpbCI+TWFpbDwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSLDlnplbCI+w5Z6ZWwgS29udTwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgIDwvc2VsZWN0PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAKICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cCI+CiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJtYW51YWwtcS1mZWVkYmFjayI+R2VyaSBCaWxkaXJpbSBEZXRheWxhcsSxIDxzcGFuIGNsYXNzPSJyZXF1aXJlZCI+Kjwvc3Bhbj48L2xhYmVsPgogICAgICAgICAgICAgICAgPHRleHRhcmVhIGlkPSJtYW51YWwtcS1mZWVkYmFjayIgY2xhc3M9InN3YWwyLXRleHRhcmVhIiBwbGFjZWhvbGRlcj0iQnVyYXlhIGdlcmkgYmlsZGlyaW1pbiBkZXRheWzEsSBtZXRuaW5pIGdpcmluaXouLi4iPjwvdGV4dGFyZWE+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICAgIDxzdHlsZT4KICAgICAgICAgICAgLyogTWFudWVsIEdlcmkgQmlsZGlyaW0gRm9ybXUgU3RpbCDEsHlpbGXFn3Rpcm1lbGVyaSAqLwogICAgICAgICAgICAubWFudWFsLWZlZWRiYWNrLWZvcm0gewogICAgICAgICAgICAgICAgdGV4dC1hbGlnbjogbGVmdDsKICAgICAgICAgICAgICAgIHBhZGRpbmc6IDEwcHg7CiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZmNmY2ZjOwogICAgICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogOHB4OwogICAgICAgICAgICAgICAgYm9yZGVyOiAxcHggc29saWQgI2VlZTsKICAgICAgICAgICAgfQogICAgICAgICAgICAuZm9ybS1ncm91cCB7CiAgICAgICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAxMnB4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIC5mb3JtLWdyb3VwIGxhYmVsIHsKICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogMC44NXJlbTsKICAgICAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7CiAgICAgICAgICAgICAgICBjb2xvcjogdmFyKC0tcHJpbWFyeSk7CiAgICAgICAgICAgICAgICBkaXNwbGF5OiBibG9jazsKICAgICAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDRweDsKICAgICAgICAgICAgfQogICAgICAgICAgICAuZ3JpZC0yLWNvbHMgewogICAgICAgICAgICAgICAgZGlzcGxheTogZ3JpZDsKICAgICAgICAgICAgICAgIGdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIDFmcjsKICAgICAgICAgICAgICAgIGdhcDogMTVweDsKICAgICAgICAgICAgfQogICAgICAgICAgICAuZ3JpZC0zLWNvbHMgewogICAgICAgICAgICAgICAgZGlzcGxheTogZ3JpZDsKICAgICAgICAgICAgICAgIGdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIDFmciAxZnI7CiAgICAgICAgICAgICAgICBnYXA6IDE1cHg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLnJlcXVpcmVkIHsKICAgICAgICAgICAgICAgIGNvbG9yOiB2YXIoLS1hY2NlbnQpOwogICAgICAgICAgICAgICAgZm9udC1zaXplOiAwLjlyZW07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLyogSW5wdXQvU2VsZWN0L1RleHRhcmVhIHN0aWxsZXJpbmkgZ2VuZWwgc3dhbDItaW5wdXQgc3RpbGluZGVuIGRldnJhbGTEsWsgKi8KICAgICAgICAgICAgLm1hbnVhbC1mZWVkYmFjay1mb3JtIC5zd2FsMi1pbnB1dCwgLm1hbnVhbC1mZWVkYmFjay1mb3JtIC5zd2FsMi10ZXh0YXJlYSB7CiAgICAgICAgICAgICAgICB3aWR0aDogMTAwJSAhaW1wb3J0YW50OwogICAgICAgICAgICAgICAgYm94LXNpemluZzogYm9yZGVyLWJveCAhaW1wb3J0YW50OwogICAgICAgICAgICAgICAgbWFyZ2luOiAwICFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICBwYWRkaW5nOiAxMHB4IDEycHggIWltcG9ydGFudDsKICAgICAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNkY2RjZGMgIWltcG9ydGFudDsKICAgICAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDZweCAhaW1wb3J0YW50OwogICAgICAgICAgICAgICAgZm9udC1zaXplOiAwLjk1cmVtICFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICB0cmFuc2l0aW9uOiBib3JkZXItY29sb3IgMC4ycywgYm94LXNoYWRvdyAwLjJzOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC5tYW51YWwtZmVlZGJhY2stZm9ybSAuc3dhbDItaW5wdXQ6Zm9jdXMsIC5tYW51YWwtZmVlZGJhY2stZm9ybSAuc3dhbDItdGV4dGFyZWE6Zm9jdXMgewogICAgICAgICAgICAgICAgYm9yZGVyLWNvbG9yOiB2YXIoLS1zZWNvbmRhcnkpICFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICBib3gtc2hhZG93OiAwIDAgMCAycHggcmdiYSgyNTAsIDE4NywgMCwgMC4yKSAhaW1wb3J0YW50OwogICAgICAgICAgICB9CiAgICAgICAgICAgIC5tYW51YWwtZmVlZGJhY2stZm9ybSAuc3dhbDItdGV4dGFyZWEgewogICAgICAgICAgICAgICAgbWluLWhlaWdodDogMTAwcHg7CiAgICAgICAgICAgICAgICByZXNpemU6IHZlcnRpY2FsOwogICAgICAgICAgICB9CiAgICAgICAgPC9zdHlsZT4KICAgIGA7CiAgICAKICAgIC8vIE1vZGFsxLEgZ8O2csO8bnTDvGRla2kgZ2liaSBkw7x6ZW5sZWRpayAoQWdlbnQgU2VsZWN0IHZlIHNhZGUgYWxhbmxhcikKICAgIGNvbnN0IHsgdmFsdWU6IGZvcm1WYWx1ZXMgfSA9IGF3YWl0IFN3YWwuZmlyZSh7CiAgICAgICAgdGl0bGU6ICdNYW51ZWwgR2VyaSBCaWxkaXJpbSBZYXonLAogICAgICAgIGh0bWw6IG5ld0h0bWxDb250ZW50LAogICAgICAgIHdpZHRoOiAnNjAwcHgnLCAvLyBNb2RhbCBnZW5pxZ9sacSfaW5pIGFydMSxcmTEsWsKICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAnPGkgY2xhc3M9ImZhcyBmYS1zYXZlIj48L2k+IEtheWRldCcsCiAgICAgICAgZGlkT3BlbjogKCkgPT4gewogICAgICAgICAgICBjb25zdCBzZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFudWFsLXEtYWdlbnQnKTsKICAgICAgICAgICAgYWRtaW5Vc2VyTGlzdC5mb3JFYWNoKHUgPT4gc2VsLmlubmVySFRNTCArPSBgPG9wdGlvbiB2YWx1ZT0iJHt1Lm5hbWV9Ij4ke3UubmFtZX08L29wdGlvbj5gKTsKICAgICAgICB9LAogICAgICAgIHByZUNvbmZpcm06ICgpID0+IHsKICAgICAgICAgICAgY29uc3QgYWdlbnROYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hbnVhbC1xLWFnZW50JykudmFsdWU7CiAgICAgICAgICAgIGNvbnN0IHRvcGljID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hbnVhbC1xLXRvcGljJykudmFsdWU7CiAgICAgICAgICAgIGNvbnN0IGZlZWRiYWNrID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hbnVhbC1xLWZlZWRiYWNrJykudmFsdWU7CiAgICAgICAgICAgIGNvbnN0IGZlZWRiYWNrVHlwZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYW51YWwtcS10eXBlJykudmFsdWU7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBZRU7EsCBBTEFOTEFSCiAgICAgICAgICAgIGNvbnN0IGNoYW5uZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFudWFsLXEtY2hhbm5lbCcpLnZhbHVlOwogICAgICAgICAgICBjb25zdCBwZXJpb2QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFudWFsLXEtcGVyaW9kJykudmFsdWU7IC8vIE1NLllZWVkgZm9ybWF0xLFuZGEKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFlFTsSwIFpPUlVOTFUgS09OVFJPTExFUgogICAgICAgICAgICBjb25zdCBjYWxsSWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFudWFsLXEtY2FsbGlkJykudmFsdWUudHJpbSgpOwogICAgICAgICAgICBjb25zdCByYXdDYWxsRGF0ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYW51YWwtcS1kYXRlJykudmFsdWU7CiAgICAgICAgICAgIGNvbnN0IGNhbGxEYXRlID0gZm9ybWF0RGF0ZVRvRERNTVlZWVkocmF3Q2FsbERhdGUpOwogICAgICAgICAgICBpZiAoIWFnZW50TmFtZSB8fCAhZmVlZGJhY2sgfHwgIWNhbGxJZCB8fCAhcmF3Q2FsbERhdGUgfHwgIXRvcGljKSB7IC8vIEtvbnUvQmHFn2zEsWsgZGEgem9ydW5sdSB5YXDEsWxkxLEKICAgICAgICAgICAgICAgICBTd2FsLnNob3dWYWxpZGF0aW9uTWVzc2FnZSgnVMO8bSAoKikgacWfYXJldGxpIGFsYW5sYXIgem9ydW5sdWR1ciEnKTsgCiAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBLb251IHNhZGVjZSBiYcWfbMSxayBvbGFyYWsgZ8O2bmRlcmlsaXlvci4gRMO2bmVtIHZlIEthbmFsIGF5csSxIGFsYW5sYXIgb2xhcmFrIGfDtm5kZXJpbGVjZWsuCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBhZ2VudE5hbWUsCiAgICAgICAgICAgICAgICAvLyBCYWNrZW5kJ2RlIGF5csSxIGxvZ2xhbWEgacOnaW4gQ2FsbElEJ3lpIE1BTlVFTCBpbGUgYmHFn2xhdMSxeW9ydXouCiAgICAgICAgICAgICAgICBjYWxsSWQ6ICJNQU5VRUwtIiArIGNhbGxJZCwgCiAgICAgICAgICAgICAgICBjYWxsRGF0ZTogY2FsbERhdGUsCiAgICAgICAgICAgICAgICBzY29yZTogMTAwLCAvLyBNYW51ZWwgb2xkdcSfdSBpw6dpbiB0YW0gcHVhbgogICAgICAgICAgICAgICAgZGV0YWlsczogdG9waWMsIC8vIFNhZGVjZSBrb251eXUgZ8O2bmRlcml5b3J1egogICAgICAgICAgICAgICAgZmVlZGJhY2ssCiAgICAgICAgICAgICAgICBmZWVkYmFja1R5cGUsCiAgICAgICAgICAgICAgICBhZ2VudEdyb3VwOiAiR2VuZWwiLCAvLyBNYW51ZWwgb2xkdcSfdSBpw6dpbiBHZW5lbCBHcnVwIG9sYXJhayBrYXlkZWRpbGlyLgogICAgICAgICAgICAgICAgLy8gw4fDllrDnE06IFllbmkgYWxhbmxhcsSxIGVrbGl5b3J1egogICAgICAgICAgICAgICAgY2hhbm5lbDogY2hhbm5lbCwKICAgICAgICAgICAgICAgIHBlcmlvZDogcGVyaW9kCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgfSk7CiAgICBpZiAoZm9ybVZhbHVlcykgewogICAgICAgIC8vIE3DnEtFUlJFUiBLT05UUk9MOiBBeW7EsSB0ZW1zaWxjaSArIGF5bsSxIENhbGwgSUQgZGFoYSDDtm5jZSBrYXlkZWRpbGRpeXNlIHV5YXIKICAgICAgICB0cnkgewogICAgICAgICAgICBjb25zdCBub3JtQWdlbnQgPSBTdHJpbmcoZm9ybVZhbHVlcy5hZ2VudE5hbWUgfHwgJycpLnRyaW0oKS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICBjb25zdCBub3JtQ2FsbElkID0gU3RyaW5nKGZvcm1WYWx1ZXMuY2FsbElkIHx8ICcnKS50cmltKCk7CiAgICAgICAgICAgIGNvbnN0IGlzRHVwID0gQXJyYXkuaXNBcnJheShhbGxFdmFsdWF0aW9uc0RhdGEpICYmIGFsbEV2YWx1YXRpb25zRGF0YS5zb21lKGUgPT4KICAgICAgICAgICAgICAgIFN0cmluZyhlLmFnZW50IHx8IGUuYWdlbnROYW1lIHx8ICcnKS50cmltKCkudG9Mb3dlckNhc2UoKSA9PT0gbm9ybUFnZW50ICYmCiAgICAgICAgICAgICAgICBTdHJpbmcoZS5jYWxsSWQgfHwgJycpLnRyaW0oKSA9PT0gbm9ybUNhbGxJZAogICAgICAgICAgICApOwoKICAgICAgICAgICAgaWYgKGlzRHVwKSB7CiAgICAgICAgICAgICAgICBjb25zdCBkZWNpc2lvbiA9IGF3YWl0IFN3YWwuZmlyZSh7CiAgICAgICAgICAgICAgICAgICAgaWNvbjogJ3dhcm5pbmcnLAogICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnTcO8a2VycmVyIERpbmxlbWUnLAogICAgICAgICAgICAgICAgICAgIGh0bWw6IGA8ZGl2IHN0eWxlPSJ0ZXh0LWFsaWduOmxlZnQ7IGxpbmUtaGVpZ2h0OjEuNDsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGI+JHtmb3JtVmFsdWVzLmFnZW50TmFtZX08L2I+IGnDp2luIDxiPkNhbGwgSUQ6ICR7ZXNjYXBlSHRtbChmb3JtVmFsdWVzLmNhbGxJZCl9PC9iPiBkYWhhIMO2bmNlIGtheWRlZGlsbWnFnyBnw7Zyw7xuw7x5b3IuPGJyPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gc3R5bGU9ImNvbG9yOiM2NjY7IGZvbnQtc2l6ZTowLjlyZW07Ij5ZaW5lIGRlIHllbmkga2F5xLF0IG9sdcWfdHVybWFrIGlzdGl5b3IgbXVzdW4/PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5gLAogICAgICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICdFdmV0LCBrYXlkZXQnLAogICAgICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6ICdWYXpnZcOnJywKICAgICAgICAgICAgICAgICAgICByZXZlcnNlQnV0dG9uczogdHJ1ZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBpZiAoIWRlY2lzaW9uLmlzQ29uZmlybWVkKSByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIGNvbnNvbGUud2FybignRHVwbGljYXRlIGNoZWNrIGZhaWxlZCcsIGUpOwogICAgICAgIH0KCiAgICAgICAgU3dhbC5maXJlKHsgdGl0bGU6ICdLYXlkZWRpbGl5b3IuLi4nLCBkaWRPcGVuOiAoKSA9PiBTd2FsLnNob3dMb2FkaW5nKCkgfSk7CiAgICAgICAgZmV0Y2goU0NSSVBUX1VSTCwgeyAKICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsIAogICAgICAgICAgICBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAndGV4dC9wbGFpbjtjaGFyc2V0PXV0Zi04JyB9LAogICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGFjdGlvbjogImxvZ0V2YWx1YXRpb24iLCB1c2VybmFtZTogY3VycmVudFVzZXIsIHRva2VuOiBnZXRUb2tlbigpLCAuLi5mb3JtVmFsdWVzIH0pIAogICAgICAgIH0pCiAgICAgICAgLnRoZW4ociA9PiByLmpzb24oKSkudGhlbihhc3luYyBkID0+IHsKICAgICAgICAgICAgaWYgKGQucmVzdWx0ID09PSAic3VjY2VzcyIpIHsgCiAgICAgICAgICAgICAgICBTd2FsLmZpcmUoeyBpY29uOiAnc3VjY2VzcycsIHRpdGxlOiAnS2F5ZGVkaWxkaScsIHRpbWVyOiAxNTAwLCBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UgfSk7CiAgICAgICAgICAgICAgICAvLyBEw5xaRUxUTUU6IEhlbSBldmFsdWF0aW9ucyBoZW0gZGUgZmVlZGJhY2sgbG9ncyBnw7xuY2VsbGVubWVsaQogICAgICAgICAgICAgICAgZmV0Y2hFdmFsdWF0aW9uc0ZvckFnZW50KGZvcm1WYWx1ZXMuYWdlbnROYW1lKTsKICAgICAgICAgICAgICAgIGZldGNoRmVlZGJhY2tMb2dzKCkudGhlbigoKSA9PiB7IGxvYWRGZWVkYmFja0xpc3QoKTsgfSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZC5yZXN1bHQgPT09ICJkdXBsaWNhdGUiKSB7CiAgICAgICAgICAgICAgICBjb25zdCBkZWNpc2lvbiA9IGF3YWl0IFN3YWwuZmlyZSh7CiAgICAgICAgICAgICAgICAgICAgaWNvbjogJ3dhcm5pbmcnLAogICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnTcO8a2VycmVyIERpbmxlbWUnLAogICAgICAgICAgICAgICAgICAgIGh0bWw6IGA8ZGl2IHN0eWxlPSJ0ZXh0LWFsaWduOmxlZnQ7IGxpbmUtaGVpZ2h0OjEuNDsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGI+JHtmb3JtVmFsdWVzLmFnZW50TmFtZX08L2I+IGnDp2luIDxiPkNhbGwgSUQ6ICR7ZXNjYXBlSHRtbChmb3JtVmFsdWVzLmNhbGxJZCl9PC9iPiB6YXRlbiB2YXIuPGJyPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gc3R5bGU9ImNvbG9yOiM2NjY7IGZvbnQtc2l6ZTowLjlyZW07Ij5ZaW5lIGRlIHllbmkga2F5xLF0IG9sdcWfdHVydWxzdW4gbXU/PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5gLAogICAgICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICdFdmV0LCB6b3JsYSBrYXlkZXQnLAogICAgICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6ICdWYXpnZcOnJywKICAgICAgICAgICAgICAgICAgICByZXZlcnNlQnV0dG9uczogdHJ1ZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBpZiAoZGVjaXNpb24uaXNDb25maXJtZWQpIHsKICAgICAgICAgICAgICAgICAgICBTd2FsLmZpcmUoeyB0aXRsZTogJ0theWRlZGlsaXlvci4uLicsIGRpZE9wZW46ICgpID0+IFN3YWwuc2hvd0xvYWRpbmcoKSB9KTsKICAgICAgICAgICAgICAgICAgICBmZXRjaChTQ1JJUFRfVVJMLCB7IAogICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJywKICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogJ3RleHQvcGxhaW47Y2hhcnNldD11dGYtOCcgfSwKICAgICAgICAgICAgICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBhY3Rpb246ICJsb2dFdmFsdWF0aW9uIiwgdXNlcm5hbWU6IGN1cnJlbnRVc2VyLCB0b2tlbjogZ2V0VG9rZW4oKSwgZm9yY2U6IHRydWUsIC4uLmZvcm1WYWx1ZXMgfSkKICAgICAgICAgICAgICAgICAgICB9KS50aGVuKHIyID0+IHIyLmpzb24oKSkudGhlbihkMiA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkMi5yZXN1bHQgPT09ICJzdWNjZXNzIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgU3dhbC5maXJlKHsgaWNvbjogJ3N1Y2Nlc3MnLCB0aXRsZTogJ0theWRlZGlsZGknLCB0aW1lcjogMTUwMCwgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmV0Y2hFdmFsdWF0aW9uc0ZvckFnZW50KGZvcm1WYWx1ZXMuYWdlbnROYW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZldGNoRmVlZGJhY2tMb2dzKCkudGhlbigoKSA9PiB7IGxvYWRGZWVkYmFja0xpc3QoKTsgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTd2FsLmZpcmUoJ0hhdGEnLCBkMi5tZXNzYWdlLCAnZXJyb3InKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgeyAKICAgICAgICAgICAgICAgIFN3YWwuZmlyZSgnSGF0YScsIGQubWVzc2FnZSwgJ2Vycm9yJyk7IAogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9Cn0KYXN5bmMgZnVuY3Rpb24gZmV0Y2hFdmFsdWF0aW9uc0ZvckFnZW50KGZvcmNlZE5hbWUsIHNpbGVudD1mYWxzZSkgewogICAgY29uc3QgbGlzdEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V2YWx1YXRpb25zLWxpc3QnKTsKICAgIGlmKCFzaWxlbnQpIGxpc3RFbC5pbm5lckhUTUwgPSAnWcO8a2xlbml5b3IuLi4nOwogICAgY29uc3QgZ3JvdXBTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncS1hZG1pbi1ncm91cCcpOwogICAgY29uc3QgYWdlbnRTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncS1hZG1pbi1hZ2VudCcpOwogICAgCiAgICBsZXQgdGFyZ2V0QWdlbnQgPSBmb3JjZWROYW1lIHx8IGN1cnJlbnRVc2VyOwogICAgbGV0IHRhcmdldEdyb3VwID0gJ2FsbCc7CiAgICAKICAgIGlmIChpc0FkbWluTW9kZSAmJiBhZ2VudFNlbGVjdCkgewogICAgICAgIHRhcmdldEFnZW50ID0gZm9yY2VkTmFtZSB8fCBhZ2VudFNlbGVjdC52YWx1ZTsKICAgICAgICB0YXJnZXRHcm91cCA9IGdyb3VwU2VsZWN0ID8gZ3JvdXBTZWxlY3QudmFsdWUgOiAnYWxsJzsKICAgIH0KICAgIHRyeSB7CiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChTQ1JJUFRfVVJMLCB7CiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLCBoZWFkZXJzOiB7ICJDb250ZW50LVR5cGUiOiAidGV4dC9wbGFpbjtjaGFyc2V0PXV0Zi04IiB9LAogICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGFjdGlvbjogImZldGNoRXZhbHVhdGlvbnMiLCB0YXJnZXRBZ2VudDogdGFyZ2V0QWdlbnQsIHRhcmdldEdyb3VwOiB0YXJnZXRHcm91cCwgdXNlcm5hbWU6IGN1cnJlbnRVc2VyLCB0b2tlbjogZ2V0VG9rZW4oKSB9KQogICAgICAgIH0pOwogICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7CiAgICAgICAgCiAgICAgICAgaWYgKGRhdGEucmVzdWx0ID09PSAic3VjY2VzcyIpIHsKICAgICAgICAgICAgLy8gRW4geWVuaSBlbiDDvHN0dGUgb2xtYXPEsSBpw6dpbiB0ZXJzIMOnZXZpcgogICAgICAgICAgICBhbGxFdmFsdWF0aW9uc0RhdGEgPSBkYXRhLmV2YWx1YXRpb25zLnJldmVyc2UoKTsKICAgICAgICAgICAgaWYoc2lsZW50KSByZXR1cm47IC8vIFNpbGVudCBtb2RlIGlzZSBidXJhZGEgYml0aXIgKHZlcmkgecO8a2xlbmRpKQogICAgICAgICAgICBsaXN0RWwuaW5uZXJIVE1MID0gJyc7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTYWRlY2Ugbm9ybWFsIGRlxJ9lcmxlbmRpcm1lbGVyaSBmaWx0cmVsZSB2ZSBnw7ZzdGVyCiAgICAgICAgICAgIGNvbnN0IG5vcm1hbEV2YWx1YXRpb25zID0gYWxsRXZhbHVhdGlvbnNEYXRhLmZpbHRlcihlID0+ICFTdHJpbmcoZS5jYWxsSWQpLnRvVXBwZXJDYXNlKCkuc3RhcnRzV2l0aCgnTUFOVUVMLScpKTsKICAgICAgICAgICAgaWYgKG5vcm1hbEV2YWx1YXRpb25zLmxlbmd0aCA9PT0gMCkgeyBsaXN0RWwuaW5uZXJIVE1MID0gYDxwIHN0eWxlPSJ0ZXh0LWFsaWduOmNlbnRlcjsgY29sb3I6IzY2NjsiPkthecSxdCB5b2suPC9wPmA7IHJldHVybjsgfQogICAgICAgICAgICAKICAgICAgICAgICAgbm9ybWFsRXZhbHVhdGlvbnMuZm9yRWFjaCgoZXZhbEl0ZW0sIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBzY29yZUNvbG9yID0gZXZhbEl0ZW0uc2NvcmUgPj0gOTAgPyAnIzJlN2QzMicgOiAoZXZhbEl0ZW0uc2NvcmUgPj0gNzAgPyAnI2VkNmMwMicgOiAnI2QzMmYyZicpOwogICAgICAgICAgICAgICAgbGV0IGVkaXRCdG4gPSBpc0FkbWluTW9kZSA/IGA8aSBjbGFzcz0iZmFzIGZhLXBlbiIgc3R5bGU9ImZvbnQtc2l6ZToxcmVtOyBjb2xvcjojZmFiYjAwOyBjdXJzb3I6cG9pbnRlcjsgbWFyZ2luLXJpZ2h0OjVweDsiIG9uY2xpY2s9ImV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOyBlZGl0RXZhbHVhdGlvbignJHtldmFsSXRlbS5jYWxsSWR9JykiPjwvaT5gIDogJyc7CiAgICAgICAgICAgICAgICAvLyDEsHNpbSBpa2kga2V6IHlhesSxbG1hc8SxbjogYWdlbnQgemF0ZW4gYmHFn2zEsWt0YSB2YXIuIEXEn2VyIGFnZW50TmFtZSBnaWJpIGF5csSxIGJpciBhbGFuIHZhcnNhIG9udSBnw7ZzdGVyLgogICAgICAgICAgICAgICAgY29uc3QgYmFzZUFnZW50ID0gZXNjYXBlSHRtbChldmFsSXRlbS5hZ2VudCB8fCAnJyk7CiAgICAgICAgICAgICAgICBjb25zdCBhbHROYW1lUmF3ID0gKGV2YWxJdGVtLmFnZW50TmFtZSAhPSBudWxsKSA/IFN0cmluZyhldmFsSXRlbS5hZ2VudE5hbWUpLnRyaW0oKSA6ICcnOwogICAgICAgICAgICAgICAgY29uc3Qgc2hvd0FsdE5hbWUgPSBhbHROYW1lUmF3ICYmIGFsdE5hbWVSYXcgIT09IFN0cmluZyhldmFsSXRlbS5hZ2VudCB8fCAnJykudHJpbSgpOwogICAgICAgICAgICAgICAgbGV0IGFnZW50TmFtZURpc3BsYXkgPSAodGFyZ2V0QWdlbnQgPT09ICdhbGwnIHx8IHRhcmdldEFnZW50ID09PSB0YXJnZXRHcm91cCkgJiYgc2hvd0FsdE5hbWUKICAgICAgICAgICAgICAgICAgPyBgPHNwYW4gc3R5bGU9ImZvbnQtc2l6ZTowLjhyZW07IGZvbnQtd2VpZ2h0OmJvbGQ7IGNvbG9yOiM1NTU7IGJhY2tncm91bmQ6I2VlZTsgcGFkZGluZzoycHggNnB4OyBib3JkZXItcmFkaXVzOjRweDsgbWFyZ2luLWxlZnQ6MTBweDsiPiR7ZXNjYXBlSHRtbChhbHROYW1lUmF3KX08L3NwYW4+YAogICAgICAgICAgICAgICAgICA6ICcnOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBEZXRheSBIVE1MIG9sdcWfdHVybWEKICAgICAgICAgICAgICAgIGxldCBkZXRhaWxIdG1sID0gJyc7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIC8vIEpTT04nxLEgacWfbGVya2VuIG9sYXPEsSBoYXRhbGFyYSBrYXLFn8SxIHRyeS1jYXRjaAogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRldGFpbE9iaiA9IEpTT04ucGFyc2UoZXZhbEl0ZW0uZGV0YWlscyk7CiAgICAgICAgICAgICAgICAgICAgZGV0YWlsSHRtbCA9ICc8dGFibGUgc3R5bGU9IndpZHRoOjEwMCU7IGZvbnQtc2l6ZTowLjg1cmVtOyBib3JkZXItY29sbGFwc2U6Y29sbGFwc2U7IG1hcmdpbi10b3A6MTBweDsiPic7CiAgICAgICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZGV0YWlsT2JqKSkgewogICAgICAgICAgICAgICAgICAgICAgICBkZXRhaWxPYmouZm9yRWFjaChpdGVtID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCByb3dDb2xvciA9IGl0ZW0uc2NvcmUgPCBpdGVtLm1heCA/ICcjZmZlYmVlJyA6ICcjZjlmOWY5JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBub3RlRGlzcGxheSA9IGl0ZW0ubm90ZSA/IGA8YnI+PGVtIHN0eWxlPSJjb2xvcjogI2QzMmYyZjsgZm9udC1zaXplOjAuOHJlbTsiPihOb3Q6ICR7aXRlbS5ub3RlfSk8L2VtPmAgOiAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldGFpbEh0bWwgKz0gYDx0ciBzdHlsZT0iYmFja2dyb3VuZDoke3Jvd0NvbG9yfTsgYm9yZGVyLWJvdHRvbToxcHggc29saWQgI2ZmZjsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBzdHlsZT0icGFkZGluZzo4cHg7IGJvcmRlci1yYWRpdXM6NHB4OyI+JHtpdGVtLnF9JHtub3RlRGlzcGxheX08L3RkPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBzdHlsZT0icGFkZGluZzo4cHg7IGZvbnQtd2VpZ2h0OmJvbGQ7IHRleHQtYWxpZ246cmlnaHQ7Ij4ke2l0ZW0uc2NvcmV9LyR7aXRlbS5tYXh9PC90ZD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdHI+YDsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gSlNPTiBvbG1hc8SxbmEgcmHEn21lbiBhcnJheSBkZcSfaWxzZSAobWFudWVsIG5vdGxhcikKICAgICAgICAgICAgICAgICAgICAgICAgZGV0YWlsSHRtbCA9IGA8cCBzdHlsZT0id2hpdGUtc3BhY2U6cHJlLXdyYXA7IG1hcmdpbjowOyBmb250LXNpemU6MC45cmVtOyBiYWNrZ3JvdW5kOiNmZmY4ZTE7IHBhZGRpbmc6MTBweDsgYm9yZGVyLXJhZGl1czo0cHg7Ij4ke2V2YWxJdGVtLmRldGFpbHN9PC9wPmA7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGRldGFpbEh0bWwgKz0gJzwvdGFibGU+JzsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsgCiAgICAgICAgICAgICAgICAgICAgLy8gSlNPTiBwYXJzZSBoYXRhc8SxIHZleWEgZXNraS9tYW51ZWwgdmVyaSBmb3JtYXTEsQogICAgICAgICAgICAgICAgICAgIGRldGFpbEh0bWwgPSBgPHAgc3R5bGU9IndoaXRlLXNwYWNlOnByZS13cmFwOyBtYXJnaW46MDsgZm9udC1zaXplOjAuOXJlbTsgYmFja2dyb3VuZDojZmZmOGUxOyBwYWRkaW5nOjEwcHg7IGJvcmRlci1yYWRpdXM6NHB4OyI+JHtldmFsSXRlbS5kZXRhaWxzfTwvcD5gOyAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gR2VsacWfdGlybWU6IMOHYcSfcsSxIFRhcmloaSB2ZSBEaW5sZW5tZSBUYXJpaGkKICAgICAgICAgICAgICAgIGNvbnN0IGNhbGxEYXRlRGlzcGxheSA9IGV2YWxJdGVtLmNhbGxEYXRlICYmIGV2YWxJdGVtLmNhbGxEYXRlICE9PSAnTi9BJyA/IGV2YWxJdGVtLmNhbGxEYXRlIDogJ04vQSc7CiAgICAgICAgICAgICAgICBjb25zdCBsaXN0ZW5EYXRlRGlzcGxheSA9IGV2YWxJdGVtLmRhdGUgfHwgJ04vQSc7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxpc3RFbC5pbm5lckhUTUwgKz0gYAogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZXZhbHVhdGlvbi1zdW1tYXJ5IiBpZD0iZXZhbC1zdW1tYXJ5LSR7aW5kZXh9IiBzdHlsZT0iYm9yZGVyLWxlZnQ6NHB4IHNvbGlkICR7c2NvcmVDb2xvcn07IHBhZGRpbmc6MTVweDsgbWFyZ2luLWJvdHRvbToxMHB4OyBib3JkZXItcmFkaXVzOjhweDsgYmFja2dyb3VuZDojZmZmOyBjdXJzb3I6cG9pbnRlcjsiIG9uY2xpY2s9InRvZ2dsZUV2YWx1YXRpb25EZXRhaWwoJHtpbmRleH0pIj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7IGp1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuOyBhbGlnbi1pdGVtczpjZW50ZXI7Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtd2VpZ2h0OjcwMDsgY29sb3I6IzJjM2U1MDsiPiR7YmFzZUFnZW50fSAke2FnZW50TmFtZURpc3BsYXl9PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8IS0tIEdlbGnFn3Rpcm1lOiDDh2HEn3LEsSBUYXJpaGkgdmUgRGlubGVubWUgVGFyaWhpIC0tPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZXZhbC1kYXRlLWluZm8iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuPjxpIGNsYXNzPSJmYXMgZmEtcGhvbmUiPjwvaT4gw4dhxJ9yxLE6ICR7Y2FsbERhdGVEaXNwbGF5fTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj48aSBjbGFzcz0iZmFzIGZhLWhlYWRwaG9uZXMiPjwvaT4gRGlubGVubWU6ICR7bGlzdGVuRGF0ZURpc3BsYXl9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJmb250LXNpemU6MC43NXJlbTsgY29sb3I6Izk5OTsgbWFyZ2luLXRvcDoycHg7Ij5JRDogJHtldmFsSXRlbS5jYWxsSWR9PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJ0ZXh0LWFsaWduOnJpZ2h0OyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHtlZGl0QnRufSA8c3BhbiBzdHlsZT0iZm9udC13ZWlnaHQ6ODAwOyBmb250LXNpemU6MS42cmVtOyBjb2xvcjoke3Njb3JlQ29sb3J9OyI+JHtldmFsSXRlbS5zY29yZX08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImV2YWx1YXRpb24tZGV0YWlscy1jb250ZW50IiBpZD0iZXZhbC1kZXRhaWxzLSR7aW5kZXh9Ij4KICAgICAgICAgICAgICAgICAgICAgICAgJHtkZXRhaWxIdG1sfQogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJtYXJnaW4tdG9wOjEwcHg7IGJhY2tncm91bmQ6I2Y4ZjlmYTsgcGFkZGluZzoxMHB4OyBib3JkZXItcmFkaXVzOjRweDsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHN0cm9uZz5GZWVkYmFjazo8L3N0cm9uZz4gJHtldmFsSXRlbS5mZWVkYmFjayB8fCAnLSd9CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfSBjYXRjaChlcnIpIHsgaWYoIXNpbGVudCkgbGlzdEVsLmlubmVySFRNTCA9IGA8cCBzdHlsZT0iY29sb3I6cmVkOyB0ZXh0LWFsaWduOmNlbnRlcjsiPkhhdGEgb2x1xZ90dS48L3A+YDsgfQp9CmZ1bmN0aW9uIHVwZGF0ZUFnZW50TGlzdEJhc2VkT25Hcm91cCgpIHsKICAgIGNvbnN0IGdyb3VwU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3EtYWRtaW4tZ3JvdXAnKTsKICAgIGNvbnN0IGFnZW50U2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3EtYWRtaW4tYWdlbnQnKTsKICAgIGlmKCFncm91cFNlbGVjdCB8fCAhYWdlbnRTZWxlY3QpIHJldHVybjsKICAgIGNvbnN0IHNlbGVjdGVkR3JvdXAgPSBncm91cFNlbGVjdC52YWx1ZTsKICAgIGFnZW50U2VsZWN0LmlubmVySFRNTCA9ICcnOwogICAgCiAgICBsZXQgZmlsdGVyZWRVc2VycyA9IGFkbWluVXNlckxpc3Q7CiAgICBpZiAoc2VsZWN0ZWRHcm91cCAhPT0gJ2FsbCcpIHsKICAgICAgICBmaWx0ZXJlZFVzZXJzID0gYWRtaW5Vc2VyTGlzdC5maWx0ZXIodSA9PiB1Lmdyb3VwID09PSBzZWxlY3RlZEdyb3VwKTsKICAgICAgICBhZ2VudFNlbGVjdC5pbm5lckhUTUwgPSBgPG9wdGlvbiB2YWx1ZT0iYWxsIj4tLSBUw7xtICR7c2VsZWN0ZWRHcm91cH0gRWtpYmkgLS08L29wdGlvbj5gOwogICAgfSBlbHNlIHsKICAgICAgICBhZ2VudFNlbGVjdC5pbm5lckhUTUwgPSBgPG9wdGlvbiB2YWx1ZT0iYWxsIj4tLSBUw7xtIFRlbXNpbGNpbGVyIC0tPC9vcHRpb24+YDsKICAgIH0KICAgIGZpbHRlcmVkVXNlcnMuZm9yRWFjaCh1ID0+IHsgYWdlbnRTZWxlY3QuaW5uZXJIVE1MICs9IGA8b3B0aW9uIHZhbHVlPSIke3UubmFtZX0iPiR7dS5uYW1lfTwvb3B0aW9uPmA7IH0pOwogICAgZmV0Y2hFdmFsdWF0aW9uc0ZvckFnZW50KCk7Cn0KZnVuY3Rpb24gZmV0Y2hVc2VyTGlzdEZvckFkbWluKCkgewogICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgZmV0Y2goU0NSSVBUX1VSTCwgewogICAgICAgICAgICBtZXRob2Q6ICdQT1NUJywgaGVhZGVyczogeyAiQ29udGVudC1UeXBlIjogInRleHQvcGxhaW47Y2hhcnNldD11dGYtOCIgfSwKICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBhY3Rpb246ICJnZXRVc2VyTGlzdCIsIHVzZXJuYW1lOiBjdXJyZW50VXNlciwgdG9rZW46IGdldFRva2VuKCkgfSkKICAgICAgICB9KS50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLmpzb24oKSkudGhlbihkYXRhID0+IHsKICAgICAgICAgICAgaWYgKGRhdGEucmVzdWx0ID09PSAic3VjY2VzcyIpIHsgYWRtaW5Vc2VyTGlzdCA9IGRhdGEudXNlcnMuZmlsdGVyKHUgPT4gdS5ncm91cCAhPT0gJ1nDtm5ldGltJyk7IHJlc29sdmUoYWRtaW5Vc2VyTGlzdCk7IH0gCiAgICAgICAgICAgIGVsc2UgcmVzb2x2ZShbXSk7CiAgICAgICAgfSkuY2F0Y2goZXJyID0+IHJlc29sdmUoW10pKTsKICAgIH0pOwp9CmZ1bmN0aW9uIGZldGNoQ3JpdGVyaWEoZ3JvdXBOYW1lKSB7CiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICBmZXRjaChTQ1JJUFRfVVJMLCB7CiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLCBoZWFkZXJzOiB7ICJDb250ZW50LVR5cGUiOiAidGV4dC9wbGFpbjtjaGFyc2V0PXV0Zi04IiB9LAogICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGFjdGlvbjogImdldENyaXRlcmlhIiwgZ3JvdXA6IGdyb3VwTmFtZSwgdXNlcm5hbWU6IGN1cnJlbnRVc2VyLCB0b2tlbjogZ2V0VG9rZW4oKSB9KQogICAgICAgIH0pLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuanNvbigpKS50aGVuKGRhdGEgPT4gewogICAgICAgICAgICBpZiAoZGF0YS5yZXN1bHQgPT09ICJzdWNjZXNzIikgcmVzb2x2ZShkYXRhLmNyaXRlcmlhIHx8IFtdKTsgZWxzZSByZXNvbHZlKFtdKTsKICAgICAgICB9KS5jYXRjaChlcnIgPT4gcmVzb2x2ZShbXSkpOwogICAgfSk7Cn0KZnVuY3Rpb24gdG9nZ2xlRXZhbHVhdGlvbkRldGFpbChpbmRleCkgewogICAgY29uc3QgZGV0YWlsRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgZXZhbC1kZXRhaWxzLSR7aW5kZXh9YCk7CiAgICBpZiAoZGV0YWlsRWwuc3R5bGUubWF4SGVpZ2h0ICYmIGRldGFpbEVsLnN0eWxlLm1heEhlaWdodCAhPT0gJzBweCcpIHsgZGV0YWlsRWwuc3R5bGUubWF4SGVpZ2h0ID0gJzBweCc7IGRldGFpbEVsLnN0eWxlLm1hcmdpblRvcCA9ICcwJzsgfSAKICAgIGVsc2UgeyBkZXRhaWxFbC5zdHlsZS5tYXhIZWlnaHQgPSBkZXRhaWxFbC5zY3JvbGxIZWlnaHQgKyA1MDAgKyAncHgnOyBkZXRhaWxFbC5zdHlsZS5tYXJnaW5Ub3AgPSAnMTBweCc7IH0KfQphc3luYyBmdW5jdGlvbiBleHBvcnRFdmFsdWF0aW9ucygpIHsKICAgIGlmICghaXNBZG1pbk1vZGUpIHJldHVybjsKICAgIGNvbnN0IHsgaXNDb25maXJtZWQgfSA9IGF3YWl0IFN3YWwuZmlyZSh7IGljb246ICdxdWVzdGlvbicsIHRpdGxlOiAnUmFwb3IgxLBuZGlyaWxzaW4gbWk/Jywgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwgY29uZmlybUJ1dHRvblRleHQ6ICfEsG5kaXInIH0pOwogICAgaWYgKCFpc0NvbmZpcm1lZCkgcmV0dXJuOwogICAgU3dhbC5maXJlKHsgdGl0bGU6ICdIYXrEsXJsYW7EsXlvci4uLicsIGRpZE9wZW46ICgpID0+IFN3YWwuc2hvd0xvYWRpbmcoKSB9KTsKICAgIAogICAgY29uc3QgZ3JvdXBTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncS1hZG1pbi1ncm91cCcpOwogICAgY29uc3QgYWdlbnRTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncS1hZG1pbi1hZ2VudCcpOwogICAgCiAgICBmZXRjaChTQ1JJUFRfVVJMLCB7CiAgICAgICAgbWV0aG9kOiAnUE9TVCcsIGhlYWRlcnM6IHsgIkNvbnRlbnQtVHlwZSI6ICJ0ZXh0L3BsYWluO2NoYXJzZXQ9dXRmLTgiIH0sCiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoewogICAgICAgICAgICBhY3Rpb246ICJleHBvcnRFdmFsdWF0aW9ucyIsCiAgICAgICAgICAgIHRhcmdldEFnZW50OiBhZ2VudFNlbGVjdCA/IGFnZW50U2VsZWN0LnZhbHVlIDogJ2FsbCcsCiAgICAgICAgICAgIHRhcmdldEdyb3VwOiBncm91cFNlbGVjdCA/IGdyb3VwU2VsZWN0LnZhbHVlIDogJ2FsbCcsCiAgICAgICAgICAgIHVzZXJuYW1lOiBjdXJyZW50VXNlciwgdG9rZW46IGdldFRva2VuKCkKICAgICAgICB9KQogICAgfSkudGhlbihyID0+IHIuanNvbigpKS50aGVuKGRhdGEgPT4gewogICAgICAgIGlmIChkYXRhLnJlc3VsdCA9PT0gInN1Y2Nlc3MiICYmIGRhdGEuY3N2RGF0YSkgewogICAgICAgICAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoWyJcdWZlZmYiICsgZGF0YS5jc3ZEYXRhXSwgeyB0eXBlOiAndGV4dC9jc3Y7Y2hhcnNldD11dGYtODsnIH0pOwogICAgICAgICAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYSIpOwogICAgICAgICAgICBjb25zdCB1cmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpOwogICAgICAgICAgICBsaW5rLnNldEF0dHJpYnV0ZSgiaHJlZiIsIHVybCk7IGxpbmsuc2V0QXR0cmlidXRlKCJkb3dubG9hZCIsIGRhdGEuZmlsZU5hbWUpOwogICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGxpbmspOyBsaW5rLmNsaWNrKCk7IGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQobGluayk7CiAgICAgICAgICAgIFN3YWwuZmlyZSgnQmHFn2FyxLFsxLEnLCAnUmFwb3IgaW5kaXJpbGRpLicsICdzdWNjZXNzJyk7CiAgICAgICAgfSBlbHNlIHsgU3dhbC5maXJlKCdIYXRhJywgZGF0YS5tZXNzYWdlIHx8ICdWZXJpIGFsxLFuYW1hZMSxLicsICdlcnJvcicpOyB9CiAgICB9KTsKfQovLyAtLS0gRVZBTFVBVElPTiBQT1BVUCAmIEVESVQgLS0tCmFzeW5jIGZ1bmN0aW9uIGxvZ0V2YWx1YXRpb25Qb3B1cCgpIHsKICAgIGNvbnN0IGFnZW50U2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3EtYWRtaW4tYWdlbnQnKTsKICAgIGNvbnN0IGFnZW50TmFtZSA9IGFnZW50U2VsZWN0ID8gYWdlbnRTZWxlY3QudmFsdWUgOiAiIjsKICAgIAogICAgaWYgKCFhZ2VudE5hbWUgfHwgYWdlbnROYW1lID09PSAnYWxsJykgeyBTd2FsLmZpcmUoJ1V5YXLEsScsICdMw7x0ZmVuIGxpc3RlZGVuIGJpciB0ZW1zaWxjaSBzZcOnaW5pei4nLCAnd2FybmluZycpOyByZXR1cm47IH0KICAgIAogICAgbGV0IGFnZW50R3JvdXAgPSAnR2VuZWwnOwogICAgY29uc3QgZm91bmRVc2VyID0gYWRtaW5Vc2VyTGlzdC5maW5kKHUgPT4gdS5uYW1lLnRvTG93ZXJDYXNlKCkgPT09IGFnZW50TmFtZS50b0xvd2VyQ2FzZSgpKTsKICAgIGlmIChmb3VuZFVzZXIgJiYgZm91bmRVc2VyLmdyb3VwKSB7IGFnZW50R3JvdXAgPSBmb3VuZFVzZXIuZ3JvdXA7IH0KICAgIAogICAgY29uc3QgaXNDaGF0ID0gYWdlbnRHcm91cC5pbmRleE9mKCdDaGF0JykgPiAtMTsKICAgIGNvbnN0IGlzVGVsZXNhdGlzID0gYWdlbnRHcm91cC5pbmRleE9mKCdUZWxlc2F0xLHFnycpID4gLTE7CiAgICBpZiAoaXNDaGF0KSBhZ2VudEdyb3VwID0gJ0NoYXQnOwogICAgCiAgICBTd2FsLmZpcmUoeyB0aXRsZTogJ0hhesSxcmxhbsSxeW9yLi4uJywgZGlkT3BlbjogKCkgPT4gU3dhbC5zaG93TG9hZGluZygpIH0pOwogICAgbGV0IGNyaXRlcmlhTGlzdCA9IFtdOwogICAgaWYoYWdlbnRHcm91cCAmJiBhZ2VudEdyb3VwICE9PSAnR2VuZWwnKSB7IGNyaXRlcmlhTGlzdCA9IGF3YWl0IGZldGNoQ3JpdGVyaWEoYWdlbnRHcm91cCk7IH0gCiAgICBTd2FsLmNsb3NlKCk7CiAgICAKICAgIGNvbnN0IGlzQ3JpdGVyaWFCYXNlZCA9IGNyaXRlcmlhTGlzdC5sZW5ndGggPiAwOwogICAgbGV0IGNyaXRlcmlhRmllbGRzSHRtbCA9ICcnOwogICAgCiAgICBpZiAoaXNDcml0ZXJpYUJhc2VkKSB7CiAgICAgICAgY3JpdGVyaWFGaWVsZHNIdG1sICs9IGA8ZGl2IGNsYXNzPSJjcml0ZXJpYS1jb250YWluZXIiPmA7CiAgICAgICAgY3JpdGVyaWFMaXN0LmZvckVhY2goKGMsIGkpID0+IHsKICAgICAgICAgICAgbGV0IHB0cyA9IHBhcnNlSW50KGMucG9pbnRzKSB8fCAwOwogICAgICAgICAgICBpZiAocHRzID09PSAwKSByZXR1cm47CiAgICAgICAgICAgIC8vIEdlbGnFn3Rpcm1lOiBQdWFuIGJhxZ9sxLHEn8SxIMO8c3TDvG5lIGdlbGluY2UgdGFtIG1ldGluIGfDtnN0ZXJpbG1lc2kgacOnaW4gdGl0bGUgZWtsZW5kaQogICAgICAgICAgICBjb25zdCBmdWxsVGV4dCA9IGVzY2FwZUZvckpzU3RyaW5nKGMudGV4dCk7IAogICAgICAgICAgICBpZiAoaXNDaGF0KSB7CiAgICAgICAgICAgICAgICBsZXQgbVB0cyA9IHBhcnNlSW50KGMubWVkaXVtU2NvcmUpIHx8IDA7IGxldCBiUHRzID0gcGFyc2VJbnQoYy5iYWRTY29yZSkgfHwgMDsKICAgICAgICAgICAgICAgIGNyaXRlcmlhRmllbGRzSHRtbCArPSBgPGRpdiBjbGFzcz0iY3JpdGVyaWEtcm93IiBpZD0icm93LSR7aX0iIGRhdGEtbWF4LXNjb3JlPSIke3B0c30iPjxkaXYgY2xhc3M9ImNyaXRlcmlhLWhlYWRlciI+PHNwYW4gdGl0bGU9IiR7ZnVsbFRleHR9Ij4ke2krMX0uICR7Yy50ZXh0fTwvc3Bhbj48c3BhbiBzdHlsZT0iZm9udC1zaXplOjAuOHJlbTsiPk1heDogJHtwdHN9PC9zcGFuPjwvZGl2PjxkaXYgY2xhc3M9ImNyaXRlcmlhLWNvbnRyb2xzIj48ZGl2IGNsYXNzPSJldmFsLWJ1dHRvbi1ncm91cCI+PGJ1dHRvbiBjbGFzcz0iZXZhbC1idXR0b24gZXZhbC1nb29kIGFjdGl2ZSIgZGF0YS1zY29yZT0iJHtwdHN9IiBvbmNsaWNrPSJzZXRCdXR0b25TY29yZSgke2l9LCAke3B0c30sICR7cHRzfSkiPsSweWkgKCR7cHRzfSk8L2J1dHRvbj4ke21QdHMgPiAwID8gYDxidXR0b24gY2xhc3M9ImV2YWwtYnV0dG9uIGV2YWwtbWVkaXVtIiBkYXRhLXNjb3JlPSIke21QdHN9IiBvbmNsaWNrPSJzZXRCdXR0b25TY29yZSgke2l9LCAke21QdHN9LCAke3B0c30pIj5PcnRhICgke21QdHN9KTwvYnV0dG9uPmAgOiAnJ30ke2JQdHMgPiAwID8gYDxidXR0b24gY2xhc3M9ImV2YWwtYnV0dG9uIGV2YWwtYmFkIiBkYXRhLXNjb3JlPSIke2JQdHN9IiBvbmNsaWNrPSJzZXRCdXR0b25TY29yZSgke2l9LCAke2JQdHN9LCAke3B0c30pIj5Lw7Z0w7wgKCR7YlB0c30pPC9idXR0b24+YCA6ICcnfTwvZGl2PjxzcGFuIGNsYXNzPSJzY29yZS1iYWRnZSIgaWQ9ImJhZGdlLSR7aX0iIHN0eWxlPSJtYXJnaW4tdG9wOjhweDsgZGlzcGxheTpibG9jazsgYmFja2dyb3VuZDojMmU3ZDMyOyI+JHtwdHN9PC9zcGFuPjwvZGl2PjxpbnB1dCB0eXBlPSJ0ZXh0IiBpZD0ibm90ZS0ke2l9IiBjbGFzcz0ibm90ZS1pbnB1dCIgcGxhY2Vob2xkZXI9Ik5vdC4uLiIgc3R5bGU9ImRpc3BsYXk6bm9uZTsiPjwvZGl2PmA7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNUZWxlc2F0aXMpIHsKICAgICAgICAgICAgICAgICBjcml0ZXJpYUZpZWxkc0h0bWwgKz0gYDxkaXYgY2xhc3M9ImNyaXRlcmlhLXJvdyIgaWQ9InJvdy0ke2l9IiBkYXRhLW1heC1zY29yZT0iJHtwdHN9Ij48ZGl2IGNsYXNzPSJjcml0ZXJpYS1oZWFkZXIiPjxzcGFuIHRpdGxlPSIke2Z1bGxUZXh0fSI+JHtpKzF9LiAke2MudGV4dH08L3NwYW4+PHNwYW4+TWF4OiAke3B0c308L3NwYW4+PC9kaXY+PGRpdiBjbGFzcz0iY3JpdGVyaWEtY29udHJvbHMiIHN0eWxlPSJkaXNwbGF5OmZsZXg7IGFsaWduLWl0ZW1zOmNlbnRlcjsgZ2FwOjE1cHg7IGJhY2tncm91bmQ6I2Y5ZjlmOTsiPjxpbnB1dCB0eXBlPSJyYW5nZSIgY2xhc3M9ImN1c3RvbS1yYW5nZSBzbGlkZXItaW5wdXQiIGlkPSJzbGlkZXItJHtpfSIgbWluPSIwIiBtYXg9IiR7cHRzfSIgdmFsdWU9IiR7cHRzfSIgZGF0YS1pbmRleD0iJHtpfSIgb25pbnB1dD0idXBkYXRlUm93U2xpZGVyU2NvcmUoJHtpfSwgJHtwdHN9KSIgc3R5bGU9ImZsZXgtZ3JvdzoxOyI+PHNwYW4gY2xhc3M9InNjb3JlLWJhZGdlIiBpZD0iYmFkZ2UtJHtpfSIgc3R5bGU9ImJhY2tncm91bmQ6IzJlN2QzMjsiPiR7cHRzfTwvc3Bhbj48L2Rpdj48aW5wdXQgdHlwZT0idGV4dCIgaWQ9Im5vdGUtJHtpfSIgY2xhc3M9Im5vdGUtaW5wdXQiIHBsYWNlaG9sZGVyPSJOb3QuLi4iIHN0eWxlPSJkaXNwbGF5Om5vbmU7Ij48L2Rpdj5gOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgY3JpdGVyaWFGaWVsZHNIdG1sICs9IGA8L2Rpdj5gOwogICAgfQogICAgCiAgICAvLyBHw5xOQ0VMTEVOTcSwxZ4gTU9EQUw6IENhbGwgSUQgem9ydW5sdSB5YXDEsWxkxLEKICAgIGNvbnN0IGNvbnRlbnRIdG1sID0gYAogICAgICAgIDxkaXYgY2xhc3M9ImV2YWwtbW9kYWwtd3JhcHBlciI+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InNjb3JlLWRhc2hib2FyZCI+PGRpdj48ZGl2IHN0eWxlPSJmb250LXNpemU6MC45cmVtOyI+RGXEn2VybGVuZGlyaWxlbjwvZGl2PjxkaXYgc3R5bGU9ImZvbnQtc2l6ZToxLjJyZW07IGZvbnQtd2VpZ2h0OmJvbGQ7IGNvbG9yOiNmYWJiMDA7Ij4ke2FnZW50TmFtZX08L2Rpdj48L2Rpdj48ZGl2IGNsYXNzPSJzY29yZS1jaXJjbGUtb3V0ZXIiIGlkPSJzY29yZS1yaW5nIj48ZGl2IGNsYXNzPSJzY29yZS1jaXJjbGUtaW5uZXIiIGlkPSJsaXZlLXNjb3JlIj4ke2lzQ3JpdGVyaWFCYXNlZCA/ICcxMDAnIDogJzEwMCd9PC9kaXY+PC9kaXY+PC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImV2YWwtaGVhZGVyLWNhcmQiPjxkaXY+PGxhYmVsPkNhbGwgSUQgPHNwYW4gc3R5bGU9ImNvbG9yOnJlZDsiPio8L3NwYW4+PC9sYWJlbD48aW5wdXQgaWQ9ImV2YWwtY2FsbGlkIiBjbGFzcz0ic3dhbDItaW5wdXQiIHN0eWxlPSJoZWlnaHQ6MzVweDsgbWFyZ2luOjA7IHdpZHRoOjEwMCU7IiBwbGFjZWhvbGRlcj0iQ2FsbCBJRCI+PC9kaXY+PGRpdj48bGFiZWw+VGFyaWg8L2xhYmVsPjxpbnB1dCB0eXBlPSJkYXRlIiBpZD0iZXZhbC1jYWxsZGF0ZSIgY2xhc3M9InN3YWwyLWlucHV0IiBzdHlsZT0iaGVpZ2h0OjM1cHg7IG1hcmdpbjowOyB3aWR0aDoxMDAlOyIgdmFsdWU9IiR7bmV3IERhdGUoKS50b0lTT1N0cmluZygpLnN1YnN0cmluZygwLCAxMCl9Ij48L2Rpdj48L2Rpdj4KICAgICAgICAgICAgJHtpc0NyaXRlcmlhQmFzZWQgPyBjcml0ZXJpYUZpZWxkc0h0bWwgOiBgPGRpdiBzdHlsZT0icGFkZGluZzoxNXB4OyBib3JkZXI6MXB4IGRhc2hlZCAjY2NjOyB0ZXh0LWFsaWduOmNlbnRlcjsiPjxsYWJlbD5NYW51ZWwgUHVhbjwvbGFiZWw+PGJyPjxpbnB1dCBpZD0iZXZhbC1tYW51YWwtc2NvcmUiIHR5cGU9Im51bWJlciIgY2xhc3M9InN3YWwyLWlucHV0IiB2YWx1ZT0iMTAwIiBtaW49IjAiIG1heD0iMTAwIiBzdHlsZT0id2lkdGg6MTAwcHg7IHRleHQtYWxpZ246Y2VudGVyOyI+PC9kaXY+PHRleHRhcmVhIGlkPSJldmFsLWRldGFpbHMiIGNsYXNzPSJzd2FsMi10ZXh0YXJlYSIgcGxhY2Vob2xkZXI9IkRldGF5bGFyLi4uIj48L3RleHRhcmVhPmB9CiAgICAgICAgICAgIDxkaXYgc3R5bGU9Im1hcmdpbi10b3A6MTVweDsgcGFkZGluZzoxMHB4OyBiYWNrZ3JvdW5kOiNmYWZhZmE7IGJvcmRlcjoxcHggc29saWQgI2VlZTsiPjxsYWJlbD5HZXJpIEJpbGRpcmltIFRpcGk8L2xhYmVsPjxzZWxlY3QgaWQ9ImZlZWRiYWNrLXR5cGUiIGNsYXNzPSJzd2FsMi1pbnB1dCIgc3R5bGU9IndpZHRoOjEwMCU7IGhlaWdodDo0MHB4OyBtYXJnaW46MDsiPjxvcHRpb24gdmFsdWU9IllvayIgc2VsZWN0ZWQ+WW9rPC9vcHRpb24+PG9wdGlvbiB2YWx1ZT0iU8O2emzDvCI+U8O2emzDvDwvb3B0aW9uPjxvcHRpb24gdmFsdWU9Ik1haWwiPk1haWw8L29wdGlvbj48L3NlbGVjdD48L2Rpdj4KICAgICAgICAgICAgPGRpdiBzdHlsZT0ibWFyZ2luLXRvcDoxNXB4OyI+PGxhYmVsPkdlbmVsIEdlcmkgQmlsZGlyaW08L2xhYmVsPjx0ZXh0YXJlYSBpZD0iZXZhbC1mZWVkYmFjayIgY2xhc3M9InN3YWwyLXRleHRhcmVhIiBzdHlsZT0ibWFyZ2luLXRvcDo1cHg7IGhlaWdodDo4MHB4OyI+PC90ZXh0YXJlYT48L2Rpdj4KICAgICAgICA8L2Rpdj5gOwogICAgCiAgICBjb25zdCB7IHZhbHVlOiBmb3JtVmFsdWVzIH0gPSBhd2FpdCBTd2FsLmZpcmUoewogICAgICAgIGh0bWw6IGNvbnRlbnRIdG1sLAogICAgICAgIHdpZHRoOiAnNjAwcHgnLAogICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICcg8J+SviAgS2F5ZGV0JywKICAgICAgICBhbGxvd091dHNpZGVDbGljazogZmFsc2UsCiAgICAgICAgYWxsb3dFc2NhcGVLZXk6IGZhbHNlLAogICAgICAgIGRpZE9wZW46ICgpID0+IHsgCiAgICAgICAgICAgIGlmIChpc1RlbGVzYXRpcykgd2luZG93LnJlY2FsY1RvdGFsU2xpZGVyU2NvcmUoKTsgCiAgICAgICAgICAgIGVsc2UgaWYgKGlzQ2hhdCkgd2luZG93LnJlY2FsY1RvdGFsU2NvcmUoKTsgCiAgICAgICAgfSwKICAgICAgICBwcmVDb25maXJtOiAoKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IGNhbGxJZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdldmFsLWNhbGxpZCcpLnZhbHVlLnRyaW0oKTsKICAgICAgICAgICAgaWYgKCFjYWxsSWQpIHsKICAgICAgICAgICAgICAgIFN3YWwuc2hvd1ZhbGlkYXRpb25NZXNzYWdlKCdDYWxsIElEIGFsYW7EsSBib8WfIGLEsXJha8SxbGFtYXohJyk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IGNhbGxEYXRlUmF3ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V2YWwtY2FsbGRhdGUnKS52YWx1ZTsKICAgICAgICAgICAgY29uc3QgZGF0ZVBhcnRzID0gY2FsbERhdGVSYXcuc3BsaXQoJy0nKTsKICAgICAgICAgICAgY29uc3QgZm9ybWF0dGVkQ2FsbERhdGUgPSBkYXRlUGFydHMubGVuZ3RoID09PSAzID8gYCR7ZGF0ZVBhcnRzWzJdfS4ke2RhdGVQYXJ0c1sxXX0uJHtkYXRlUGFydHNbMF19YCA6IGNhbGxEYXRlUmF3OwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKGlzQ3JpdGVyaWFCYXNlZCkgewogICAgICAgICAgICAgICAgbGV0IHRvdGFsID0gMDsgbGV0IGRldGFpbHNBcnIgPSBbXTsKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY3JpdGVyaWFMaXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYyA9IGNyaXRlcmlhTGlzdFtpXTsgaWYgKHBhcnNlSW50KGMucG9pbnRzKSA9PT0gMCkgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgbGV0IHZhbCA9IDA7IGxldCBub3RlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYG5vdGUtJHtpfWApLnZhbHVlOwogICAgICAgICAgICAgICAgICAgIGlmIChpc0NoYXQpIHZhbCA9IHBhcnNlSW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBiYWRnZS0ke2l9YCkuaW5uZXJUZXh0KSB8fCAwOwogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGlzVGVsZXNhdGlzKSB2YWwgPSBwYXJzZUludChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgc2xpZGVyLSR7aX1gKS52YWx1ZSkgfHwgMDsKICAgICAgICAgICAgICAgICAgICB0b3RhbCArPSB2YWw7IGRldGFpbHNBcnIucHVzaCh7IHE6IGMudGV4dCwgbWF4OiBwYXJzZUludChjLnBvaW50cyksIHNjb3JlOiB2YWwsIG5vdGU6IG5vdGUgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4geyBhZ2VudE5hbWUsIGFnZW50R3JvdXAsIGNhbGxJZCwgY2FsbERhdGU6IGZvcm1hdHRlZENhbGxEYXRlLCBzY29yZTogdG90YWwsIGRldGFpbHM6IEpTT04uc3RyaW5naWZ5KGRldGFpbHNBcnIpLCBmZWVkYmFjazogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V2YWwtZmVlZGJhY2snKS52YWx1ZSwgZmVlZGJhY2tUeXBlOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmVlZGJhY2stdHlwZScpLnZhbHVlIH07CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4geyBhZ2VudE5hbWUsIGFnZW50R3JvdXAsIGNhbGxJZCwgY2FsbERhdGU6IGZvcm1hdHRlZENhbGxEYXRlLCBzY29yZTogcGFyc2VJbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V2YWwtbWFudWFsLXNjb3JlJykudmFsdWUpLCBkZXRhaWxzOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXZhbC1kZXRhaWxzJykudmFsdWUsIGZlZWRiYWNrOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmVlZGJhY2stdHlwZScpLnZhbHVlIH07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9KTsKICAgIGlmIChmb3JtVmFsdWVzKSB7CiAgICAgICAgU3dhbC5maXJlKHsgdGl0bGU6ICdLYXlkZWRpbGl5b3IuLi4nLCBkaWRPcGVuOiAoKSA9PiBTd2FsLnNob3dMb2FkaW5nKCkgfSk7CiAgICAgICAgZmV0Y2goU0NSSVBUX1VSTCwgeyAKICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsIAogICAgICAgICAgICBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAndGV4dC9wbGFpbjtjaGFyc2V0PXV0Zi04JyB9LAogICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGFjdGlvbjogImxvZ0V2YWx1YXRpb24iLCB1c2VybmFtZTogY3VycmVudFVzZXIsIHRva2VuOiBnZXRUb2tlbigpLCAuLi5mb3JtVmFsdWVzIH0pIAogICAgICAgIH0pCiAgICAgICAgLnRoZW4ociA9PiByLmpzb24oKSkudGhlbihkID0+IHsKICAgICAgICAgICAgaWYgKGQucmVzdWx0ID09PSAic3VjY2VzcyIpIHsgCiAgICAgICAgICAgICAgICBTd2FsLmZpcmUoeyBpY29uOiAnc3VjY2VzcycsIHRpdGxlOiAnS2F5ZGVkaWxkaScsIHRpbWVyOiAxNTAwLCBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UgfSk7CiAgICAgICAgICAgICAgICAvLyBEw5xaRUxUTUU6IEhlbSBldmFsdWF0aW9ucyBoZW0gZGUgZmVlZGJhY2sgbG9ncyBnw7xuY2VsbGVubWVsaQogICAgICAgICAgICAgICAgZmV0Y2hFdmFsdWF0aW9uc0ZvckFnZW50KGZvcm1WYWx1ZXMuYWdlbnROYW1lKTsKICAgICAgICAgICAgICAgIGZldGNoRmVlZGJhY2tMb2dzKCkudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgbG9hZEZlZWRiYWNrTGlzdCgpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7IAogICAgICAgICAgICAgICAgU3dhbC5maXJlKCdIYXRhJywgZC5tZXNzYWdlLCAnZXJyb3InKTsgCiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KfQphc3luYyBmdW5jdGlvbiBlZGl0RXZhbHVhdGlvbih0YXJnZXRDYWxsSWQpIHsKICAgIGNvbnN0IGV2YWxEYXRhID0gYWxsRXZhbHVhdGlvbnNEYXRhLmZpbmQoaXRlbSA9PiBTdHJpbmcoaXRlbS5jYWxsSWQpLnRyaW0oKSA9PT0gU3RyaW5nKHRhcmdldENhbGxJZCkudHJpbSgpKTsKICAgIGlmICghZXZhbERhdGEpIHsgU3dhbC5maXJlKCdIYXRhJywgJ0thecSxdCBidWx1bmFtYWTEsS4nLCAnZXJyb3InKTsgcmV0dXJuOyB9CiAgICAKICAgIGNvbnN0IGFnZW50TmFtZSA9IGV2YWxEYXRhLmFnZW50OwogICAgY29uc3QgYWdlbnRHcm91cFJhdyA9IGV2YWxEYXRhLmdyb3VwIHx8ICdHZW5lbCc7CiAgICBjb25zdCBpc0NoYXQgPSBhZ2VudEdyb3VwUmF3LmluZGV4T2YoJ0NoYXQnKSA+IC0xOwogICAgY29uc3QgaXNUZWxlc2F0aXMgPSBhZ2VudEdyb3VwUmF3LmluZGV4T2YoJ1RlbGVzYXTEscWfJykgPiAtMTsKICAgIGxldCBhZ2VudEdyb3VwID0gaXNDaGF0ID8gJ0NoYXQnIDogKGlzVGVsZXNhdGlzID8gJ1RlbGVzYXTEscWfJyA6ICdHZW5lbCcpOwogICAgCiAgICBTd2FsLmZpcmUoeyB0aXRsZTogJ8SwbmNlbGVuaXlvci4uLicsIGRpZE9wZW46ICgpID0+IFN3YWwuc2hvd0xvYWRpbmcoKSB9KTsKICAgIGxldCBjcml0ZXJpYUxpc3QgPSBbXTsKICAgIGlmKGFnZW50R3JvdXAgJiYgYWdlbnRHcm91cCAhPT0gJ0dlbmVsJykgY3JpdGVyaWFMaXN0ID0gYXdhaXQgZmV0Y2hDcml0ZXJpYShhZ2VudEdyb3VwKTsKICAgIFN3YWwuY2xvc2UoKTsKICAgIAogICAgY29uc3QgaXNDcml0ZXJpYUJhc2VkID0gY3JpdGVyaWFMaXN0Lmxlbmd0aCA+IDA7CiAgICBsZXQgb2xkRGV0YWlscyA9IFtdOyB0cnkgeyBvbGREZXRhaWxzID0gSlNPTi5wYXJzZShldmFsRGF0YS5kZXRhaWxzIHx8ICJbXSIpOyB9IGNhdGNoKGUpIHsgb2xkRGV0YWlscyA9IFtdOyB9CiAgICAKICAgIC8vIEfDnE5DRUxMRU5NxLDFniBNT0RBTDogQ2FsbCBJRCBnw7ZzdGVyaWxpeW9yCiAgICBsZXQgY29udGVudEh0bWwgPSBgPGRpdiBjbGFzcz0iZXZhbC1tb2RhbC13cmFwcGVyIiBzdHlsZT0iYm9yZGVyLXRvcDo1cHggc29saWQgIzE5NzZkMjsiPjxkaXYgY2xhc3M9InNjb3JlLWRhc2hib2FyZCI+PGRpdj48ZGl2IHN0eWxlPSJmb250LXNpemU6MC45cmVtOyI+RMOcWkVOTEVORU48L2Rpdj48ZGl2IHN0eWxlPSJmb250LXNpemU6MS4ycmVtOyBmb250LXdlaWdodDpib2xkOyBjb2xvcjojMTk3NmQyOyI+JHthZ2VudE5hbWV9PC9kaXY+PC9kaXY+PGRpdiBjbGFzcz0ic2NvcmUtY2lyY2xlLW91dGVyIiBpZD0ic2NvcmUtcmluZyI+PGRpdiBjbGFzcz0ic2NvcmUtY2lyY2xlLWlubmVyIiBpZD0ibGl2ZS1zY29yZSI+JHtldmFsRGF0YS5zY29yZX08L2Rpdj48L2Rpdj48L2Rpdj48ZGl2IGNsYXNzPSJldmFsLWhlYWRlci1jYXJkIj48ZGl2PjxsYWJlbD5DYWxsIElEPC9sYWJlbD48aW5wdXQgaWQ9ImV2YWwtY2FsbGlkIiBjbGFzcz0ic3dhbDItaW5wdXQiIHZhbHVlPSIke2V2YWxEYXRhLmNhbGxJZH0iIHJlYWRvbmx5IHN0eWxlPSJiYWNrZ3JvdW5kOiNlZWU7IGhlaWdodDozNXB4OyB3aWR0aDoxMDAlOyI+PC9kaXY+PC9kaXY+YDsKICAgIAogICAgaWYgKGlzQ3JpdGVyaWFCYXNlZCkgewogICAgICAgIGNvbnRlbnRIdG1sICs9IGA8ZGl2IGNsYXNzPSJjcml0ZXJpYS1jb250YWluZXIiPmA7CiAgICAgICAgY3JpdGVyaWFMaXN0LmZvckVhY2goKGMsIGkpID0+IHsKICAgICAgICAgICAgbGV0IHB0cyA9IHBhcnNlSW50KGMucG9pbnRzKSB8fCAwOyBpZihwdHM9PT0wKSByZXR1cm47CiAgICAgICAgICAgIGxldCBtUHRzID0gcGFyc2VJbnQoYy5tZWRpdW1TY29yZSkgfHwgMDsgbGV0IGJQdHMgPSBwYXJzZUludChjLmJhZFNjb3JlKSB8fCAwOwogICAgICAgICAgICBsZXQgb2xkSXRlbSA9IG9sZERldGFpbHMuZmluZChkID0+IGQucSA9PT0gYy50ZXh0KSB8fCAob2xkRGV0YWlsc1tpXSA/IG9sZERldGFpbHNbaV0gOiB7c2NvcmU6cHRzLCBub3RlOicnfSk7CiAgICAgICAgICAgIGxldCBjVmFsID0gcGFyc2VJbnQob2xkSXRlbS5zY29yZSk7IGxldCBjTm90ZSA9IG9sZEl0ZW0ubm90ZSB8fCAnJzsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEdlbGnFn3Rpcm1lOiBQdWFuIGJhxZ9sxLHEn8SxIMO8c3TDvG5lIGdlbGluY2UgdGFtIG1ldGluIGfDtnN0ZXJpbG1lc2kgacOnaW4gdGl0bGUgZWtsZW5kaQogICAgICAgICAgICBjb25zdCBmdWxsVGV4dCA9IGVzY2FwZUZvckpzU3RyaW5nKGMudGV4dCk7IAogICAgICAgICAgICBpZiAoaXNDaGF0KSB7CiAgICAgICAgICAgICAgICBsZXQgZ0FjdCA9IGNWYWwgPT09IHB0cyA/ICdhY3RpdmUnIDogJyc7IGxldCBtQWN0ID0gKGNWYWw9PT1tUHRzICYmIG1QdHMhPT0wKSA/ICdhY3RpdmUnIDogJyc7IGxldCBiQWN0ID0gKGNWYWw9PT1iUHRzICYmIGJQdHMhPT0wKSA/ICdhY3RpdmUnIDogJyc7CiAgICAgICAgICAgICAgICBpZihjVmFsPT09MCAmJiBiUHRzPT09MCkgYkFjdCA9ICdhY3RpdmUnOyBlbHNlIGlmIChjVmFsPT09MCAmJiBiUHRzPjApIHsgZ0FjdD0nJzsgbUFjdD0nJzsgYkFjdD0nJzsgfQogICAgICAgICAgICAgICAgY29udGVudEh0bWwgKz0gYDxkaXYgY2xhc3M9ImNyaXRlcmlhLXJvdyIgaWQ9InJvdy0ke2l9IiBkYXRhLW1heC1zY29yZT0iJHtwdHN9Ij48ZGl2IGNsYXNzPSJjcml0ZXJpYS1oZWFkZXIiPjxzcGFuIHRpdGxlPSIke2Z1bGxUZXh0fSI+JHtpKzF9LiAke2MudGV4dH08L3NwYW4+PHNwYW4+TWF4OiAke3B0c308L3NwYW4+PC9kaXY+PGRpdiBjbGFzcz0iY3JpdGVyaWEtY29udHJvbHMiPjxkaXYgY2xhc3M9ImV2YWwtYnV0dG9uLWdyb3VwIj48YnV0dG9uIGNsYXNzPSJldmFsLWJ1dHRvbiBldmFsLWdvb2QgJHtnQWN0fSIgZGF0YS1zY29yZT0iJHtwdHN9IiBvbmNsaWNrPSJzZXRCdXR0b25TY29yZSgke2l9LCAke3B0c30sICR7cHRzfSkiPsSweWk8L2J1dHRvbj4ke21QdHM+MD9gPGJ1dHRvbiBjbGFzcz0iZXZhbC1idXR0b24gZXZhbC1tZWRpdW0gJHttQWN0fSIgZGF0YS1zY29yZT0iJHttUHRzfSIgb25jbGljaz0ic2V0QnV0dG9uU2NvcmUoJHtpfSwgJHttUHRzfSwgJHtwdHN9KSI+T3J0YTwvYnV0dG9uPmA6Jyd9JHtiUHRzPjA/YDxidXR0b24gY2xhc3M9ImV2YWwtYnV0dG9uIGV2YWwtYmFkICR7YkFjdH0iIGRhdGEtc2NvcmU9IiR7YlB0c30iIG9uY2xpY2s9InNldEJ1dHRvblNjb3JlKCR7aX0sICR7YlB0c30sICR7cHRzfSkiPkvDtnTDvDwvYnV0dG9uPmA6Jyd9PC9kaXY+PHNwYW4gY2xhc3M9InNjb3JlLWJhZGdlIiBpZD0iYmFkZ2UtJHtpfSI+JHtjVmFsfTwvc3Bhbj48L2Rpdj48aW5wdXQgdHlwZT0idGV4dCIgaWQ9Im5vdGUtJHtpfSIgY2xhc3M9Im5vdGUtaW5wdXQiIHZhbHVlPSIke2NOb3RlfSIgc3R5bGU9ImRpc3BsYXk6JHtjVmFsPHB0cz8nYmxvY2snOidub25lJ30iPjwvZGl2PmA7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNUZWxlc2F0aXMpIHsKICAgICAgICAgICAgICAgIGNvbnRlbnRIdG1sICs9IGA8ZGl2IGNsYXNzPSJjcml0ZXJpYS1yb3ciIGlkPSJyb3ctJHtpfSIgZGF0YS1tYXgtc2NvcmU9IiR7cHRzfSI+PGRpdiBjbGFzcz0iY3JpdGVyaWEtaGVhZGVyIj48c3BhbiB0aXRsZT0iJHtmdWxsVGV4dH0iPiR7aSsxfS4gJHtjLnRleHR9PC9zcGFuPjxzcGFuPk1heDogJHtwdHN9PC9zcGFuPjwvZGl2PjxkaXYgY2xhc3M9ImNyaXRlcmlhLWNvbnRyb2xzIiBzdHlsZT0iZGlzcGxheTpmbGV4OyBiYWNrZ3JvdW5kOiNmOWY5Zjk7Ij48aW5wdXQgdHlwZT0icmFuZ2UiIGNsYXNzPSJjdXN0b20tcmFuZ2Ugc2xpZGVyLWlucHV0IiBpZD0ic2xpZGVyLSR7aX0iIG1pbj0iMCIgbWF4PSIke3B0c30iIHZhbHVlPSIke2NWYWx9IiBkYXRhLWluZGV4PSIke2l9IiBvbmlucHV0PSJ1cGRhdGVSb3dTbGlkZXJTY29yZSgke2l9LCAke3B0c30pIiBzdHlsZT0iZmxleC1ncm93OjE7Ij48c3BhbiBjbGFzcz0ic2NvcmUtYmFkZ2UiIGlkPSJiYWRnZS0ke2l9Ij4ke2NWYWx9PC9zcGFuPjwvZGl2PjxpbnB1dCB0eXBlPSJ0ZXh0IiBpZD0ibm90ZS0ke2l9IiBjbGFzcz0ibm90ZS1pbnB1dCIgdmFsdWU9IiR7Y05vdGV9IiBzdHlsZT0iZGlzcGxheToke2NWYWw8cHRzPydibG9jayc6J25vbmUnfSI+PC9kaXY+YDsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIGNvbnRlbnRIdG1sICs9IGA8L2Rpdj5gOwogICAgfSBlbHNlIHsKICAgICAgICBjb250ZW50SHRtbCArPSBgPGRpdiBzdHlsZT0icGFkZGluZzoxNXB4OyBib3JkZXI6MXB4IGRhc2hlZCAjY2NjOyB0ZXh0LWFsaWduOmNlbnRlcjsiPjxsYWJlbD5NYW51ZWwgUHVhbjwvbGFiZWw+PGJyPjxpbnB1dCBpZD0iZXZhbC1tYW51YWwtc2NvcmUiIHR5cGU9Im51bWJlciIgY2xhc3M9InN3YWwyLWlucHV0IiB2YWx1ZT0iJHtldmFsRGF0YS5zY29yZX0iIG1pbj0iMCIgbWF4PSIxMDAiIHN0eWxlPSJ3aWR0aDoxMDBweDsiPjwvZGl2Pjx0ZXh0YXJlYSBpZD0iZXZhbC1kZXRhaWxzIiBjbGFzcz0ic3dhbDItdGV4dGFyZWEiPiR7dHlwZW9mIGV2YWxEYXRhLmRldGFpbHM9PT0nc3RyaW5nJz9ldmFsRGF0YS5kZXRhaWxzOicnfTwvdGV4dGFyZWE+YDsKICAgIH0KICAgIGNvbnRlbnRIdG1sICs9IGA8ZGl2PjxsYWJlbD5SZXZpemUgRmVlZGJhY2s8L2xhYmVsPjx0ZXh0YXJlYSBpZD0iZXZhbC1mZWVkYmFjayIgY2xhc3M9InN3YWwyLXRleHRhcmVhIj4ke2V2YWxEYXRhLmZlZWRiYWNrfHwnJ308L3RleHRhcmVhPjwvZGl2PjwvZGl2PmA7CiAgICAKICAgIGNvbnN0IHsgdmFsdWU6IGZvcm1WYWx1ZXMgfSA9IGF3YWl0IFN3YWwuZmlyZSh7CiAgICAgICAgaHRtbDogY29udGVudEh0bWwsCiAgICAgICAgd2lkdGg6ICc2MDBweCcsCiAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwKICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogJyDwn5K+ICBHw7xuY2VsbGUnLAogICAgICAgIGFsbG93T3V0c2lkZUNsaWNrOiBmYWxzZSwKICAgICAgICBhbGxvd0VzY2FwZUtleTogZmFsc2UsCiAgICAgICAgZGlkT3BlbjogKCkgPT4geyBpZiAoaXNUZWxlc2F0aXMpIHdpbmRvdy5yZWNhbGNUb3RhbFNsaWRlclNjb3JlKCk7IGVsc2UgaWYgKGlzQ2hhdCkgd2luZG93LnJlY2FsY1RvdGFsU2NvcmUoKTsgfSwKICAgICAgICBwcmVDb25maXJtOiAoKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IGNhbGxJZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdldmFsLWNhbGxpZCcpLnZhbHVlOwogICAgICAgICAgICBjb25zdCBmZWVkYmFjayA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdldmFsLWZlZWRiYWNrJykudmFsdWU7CiAgICAgICAgICAgIGlmIChpc0NyaXRlcmlhQmFzZWQpIHsKICAgICAgICAgICAgICAgIGxldCB0b3RhbCA9IDA7IGxldCBkZXRhaWxzQXJyID0gW107CiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNyaXRlcmlhTGlzdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGMgPSBjcml0ZXJpYUxpc3RbaV07IGlmIChwYXJzZUludChjLnBvaW50cykgPT09IDApIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIGxldCB2YWwgPSAwOyBsZXQgbm90ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBub3RlLSR7aX1gKS52YWx1ZTsKICAgICAgICAgICAgICAgICAgICBpZiAoaXNDaGF0KSB2YWwgPSBwYXJzZUludChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgYmFkZ2UtJHtpfWApLmlubmVyVGV4dCkgfHwgMDsKICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChpc1RlbGVzYXRpcykgdmFsID0gcGFyc2VJbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHNsaWRlci0ke2l9YCkudmFsdWUpIHx8IDA7CiAgICAgICAgICAgICAgICAgICAgZWxzZSB2YWwgPSBwYXJzZUludChjLnBvaW50cyk7CiAgICAgICAgICAgICAgICAgICAgdG90YWwgKz0gdmFsOyBkZXRhaWxzQXJyLnB1c2goeyBxOiBjLnRleHQsIG1heDogcGFyc2VJbnQoYy5wb2ludHMpLCBzY29yZTogdmFsLCBub3RlOiBub3RlIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHsgYWdlbnROYW1lLCBjYWxsSWQsIHNjb3JlOiB0b3RhbCwgZGV0YWlsczogSlNPTi5zdHJpbmdpZnkoZGV0YWlsc0FyciksIGZlZWRiYWNrIH07CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4geyBhZ2VudE5hbWUsIGNhbGxJZCwgc2NvcmU6IHBhcnNlSW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdldmFsLW1hbnVhbC1zY29yZScpLnZhbHVlKSwgZGV0YWlsczogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V2YWwtZGV0YWlscycpLnZhbHVlLCBmZWVkYmFjayB9OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSk7CiAgICBpZiAoZm9ybVZhbHVlcykgewogICAgICAgIFN3YWwuZmlyZSh7IHRpdGxlOiAnR8O8bmNlbGxlbml5b3IuLi4nLCBkaWRPcGVuOiAoKSA9PiBTd2FsLnNob3dMb2FkaW5nKCkgfSk7CiAgICAgICAgZmV0Y2goU0NSSVBUX1VSTCwgeyAKICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsIAogICAgICAgICAgICBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAndGV4dC9wbGFpbjtjaGFyc2V0PXV0Zi04JyB9LAogICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGFjdGlvbjogInVwZGF0ZUV2YWx1YXRpb24iLCB1c2VybmFtZTogY3VycmVudFVzZXIsIHRva2VuOiBnZXRUb2tlbigpLCAuLi5mb3JtVmFsdWVzIH0pIAogICAgICAgIH0pCiAgICAgICAgLnRoZW4ociA9PiByLmpzb24oKSkudGhlbihkID0+IHsKICAgICAgICAgICAgaWYgKGQucmVzdWx0ID09PSAic3VjY2VzcyIpIHsgCiAgICAgICAgICAgICAgICBTd2FsLmZpcmUoeyBpY29uOiAnc3VjY2VzcycsIHRpdGxlOiAnR8O8bmNlbGxlbmRpJywgdGltZXI6IDE1MDAsIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSB9KTsgCiAgICAgICAgICAgICAgICAvLyBEw5xaRUxUTUU6IEfDvG5jZWxsZW1lIHNvbnJhc8SxIGhlbSBldmFsdWF0aW9ucyBoZW0gZGUgZmVlZGJhY2sgbG9ncyBnw7xuY2VsbGVubWVsaQogICAgICAgICAgICAgICAgZmV0Y2hFdmFsdWF0aW9uc0ZvckFnZW50KGFnZW50TmFtZSk7CiAgICAgICAgICAgICAgICBmZXRjaEZlZWRiYWNrTG9ncygpLnRoZW4oKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGxvYWRGZWVkYmFja0xpc3QoKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IAogICAgICAgICAgICBlbHNlIHsgU3dhbC5maXJlKCdIYXRhJywgZC5tZXNzYWdlLCAnZXJyb3InKTsgfQogICAgICAgIH0pOwogICAgfQp9CgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgQU5BIFNBWUZBICsgVEVLTsSwSyArIFRFTEVTQVRJxZ4gKEZVTExTQ1JFRU4pIEfDnE5DRUxMRU1FU8SwCiAgID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLwoKY29uc3QgVEVMRVNhbGVzX09GRkVSU19GQUxMQkFDSyA9IFt7Im9mZmVyIjogIllJTExJSyAtIDEyOTkgVEwiLCAic2VnbWVudCI6ICJXxLBOQkFDSyIsICJkZXNjcmlwdGlvbiI6ICJLdWxsYW7EsWPEsSBkYWhhIMO2bmNlIGF5bMSxayB5YSBkYSB5xLFsbMSxayBoZXJoYW5naSBiaXIgcGFrZXQga3VsbGFubcSxxZ8sIGFyZMSxbmRhbiBwYWtldCBzb25sYW5txLHFnyB2ZSDFn3UgYW5kYSBha3RpZiBwYWtldGkgb2xtYXlhbiBrdWxsYW7EsWPEsWxhcsSxIGFyYWTEscSfxLFtxLF6IGJpciBkYXRhIiwgIm5vdGUiOiAiS3VsbGFuxLFjxLFuxLFuIGl6bGVtZSBnZcOnbWnFn2kgb2xhYmlsaXIuIn0sIHsib2ZmZXIiOiAiQVlMSUsgIC0gNiBBWSAxMDkgVEwiLCAic2VnbWVudCI6ICJXxLBOQkFDSyIsICJkZXNjcmlwdGlvbiI6ICJLdWxsYW7EsWPEsSBkYWhhIMO2bmNlIGF5bMSxayB5YSBkYSB5xLFsbMSxayBoZXJoYW5naSBiaXIgcGFrZXQga3VsbGFubcSxxZ8sIGFyZMSxbmRhbiBwYWtldCBzb25sYW5txLHFnyB2ZSDFn3UgYW5kYSBha3RpZiBwYWtldGkgb2xtYXlhbiBrdWxsYW7EsWPEsWxhcsSxIGFyYWTEscSfxLFtxLF6IGJpciBkYXRhIiwgIm5vdGUiOiAiS3VsbGFuxLFjxLFuxLFuIGl6bGVtZSBnZcOnbWnFn2kgb2xhYmlsaXIuIn0sIHsib2ZmZXIiOiAiWUlMTElLIC0gMTM5OSBUTCIsICJzZWdtZW50IjogIkNBTkNFTEzEsE5HIiwgImRlc2NyaXB0aW9uIjogIkFib25lbGnEn2luZGUgaXB0YWwgdGFsZWJpbmRlIGJ1bHVubXXFnywgcGFrZXQgc8O8cmVzaSBiaXRpbWluZSBrYWRhciBlcmnFn2ltZSBkZXZhbSBlZGVuLCBnZXJpIGthemFuxLFtIGnDp2luIGFyYWTEscSfxLFtxLF6IGJpciBkYXRhIiwgIm5vdGUiOiAiS3VsbGFuxLFjxLFuxLFuIGl6bGVtZSBnZcOnbWnFn2kgb2xhYmlsaXIuIMSwbmRpcmltIG9yYW7EsSB5w7xrc2VrICsgS3VsbGFuxLFjxLFuxLFuIGJpciBpcHRhbCBuZWRlbmkgb2xhYmlsaXIifSwgeyJvZmZlciI6ICJBWUxJSyAgLSA2IEFZIDExOSBUTCIsICJzZWdtZW50IjogIkNBTkNFTEzEsE5HIiwgImRlc2NyaXB0aW9uIjogIkFib25lbGnEn2luZGUgaXB0YWwgdGFsZWJpbmRlIGJ1bHVubXXFnywgcGFrZXQgc8O8cmVzaSBiaXRpbWluZSBrYWRhciBlcmnFn2ltZSBkZXZhbSBlZGVuLCBnZXJpIGthemFuxLFtIGnDp2luIGFyYWTEscSfxLFtxLF6IGJpciBkYXRhIiwgIm5vdGUiOiAiS3VsbGFuxLFjxLFuxLFuIGl6bGVtZSBnZcOnbWnFn2kgb2xhYmlsaXIuIMSwbmRpcmltIG9yYW7EsSB5w7xrc2VrICsgS3VsbGFuxLFjxLFuxLFuIGJpciBpcHRhbCBuZWRlbmkgb2xhYmlsaXIifSwgeyJvZmZlciI6ICJZSUxMSUsgLSAxNDk5IFRMIiwgInNlZ21lbnQiOiAiQUNUxLBWRSBHUkFDRSIsICJkZXNjcmlwdGlvbiI6ICJQYWtldCB5ZW5pbGVtZSBzw7xyZWNpbmUgZ2lyZW4gZmFrYXQgw7xjcmV0IGFsxLFuYW1hZMSxxJ/EsSBpw6dpbiBwYWtldGkgeWVuaWxlbmVtZXllbiBrdWxsYW7EsWPEsWxhcsSxIGFyYWTEscSfxLFtxLF6IGJpciBkYXRhIiwgIm5vdGUiOiAiUGFrZXQgeWVuaWxlbWUgc8O8cmVjaW5kZW4gYmlyIMO2ZGVtZSBzb3J1bnUgb2x1xZ90dcSfdW51IGJ1IG5lZGVubGUgYWJvbmVsacSfaW5pbiB5ZW5pbGVubWVkacSfaW5pLCBrdWxsYW7EsWPEsXlhIGhlbSBidSBzb3J1bnUgw6fDtnptZWsgaGVtIGRlIGluZGlyaW1saSBmaXlhdGxhciDDvHplcmluZGVuIHlhcmTEsW1jxLEgb2xtYWsgK8Sww6dlcmlrIn0sIHsib2ZmZXIiOiAiQVlMSUsgIC0gNiBBWSAxMDkgVEwiLCAic2VnbWVudCI6ICJBQ1TEsFZFIEdSQUNFIiwgImRlc2NyaXB0aW9uIjogIlBha2V0IHllbmlsZW1lIHPDvHJlY2luZSBnaXJlbiBmYWthdCDDvGNyZXQgYWzEsW5hbWFkxLHEn8SxIGnDp2luIHBha2V0aSB5ZW5pbGVuZW1leWVuIGt1bGxhbsSxY8SxbGFyxLEgYXJhZMSxxJ/EsW3EsXogYmlyIGRhdGEiLCAibm90ZSI6ICJQYWtldCB5ZW5pbGVtZSBzw7xyZWNpbmRlbiBiaXIgw7ZkZW1lIHNvcnVudSBvbHXFn3R1xJ91bnUgYnUgbmVkZW5sZSBhYm9uZWxpxJ9pbmluIHllbmlsZW5tZWRpxJ9pbmksIGt1bGxhbsSxY8SxeWEgaGVtIGJ1IHNvcnVudSDDp8O2em1layBoZW0gZGUgaW5kaXJpbWxpIGZpeWF0bGFyIMO8emVyaW5kZW4geWFyZMSxbWPEsSBvbG1hayArxLDDp2VyaWsifSwgeyJvZmZlciI6ICJZSUxMSUsgLSAxNDk5IFRMIiwgInNlZ21lbnQiOiAiSU5CT1VORCIsICJkZXNjcmlwdGlvbiI6ICJJbmJvdW5kIMO8emVyaW5kZW4gZ2VsZW4gc2F0xLFuIGFsbWEgdGFsZXBsZXJpIHlhIGRhIHNhdMSxxZ9hIGlrbmEgZWRpbGVuIGt1bGxhbsSxY8SxbGFyIGnDp2luIHN1bnVsYW4gdGVrbGlmIiwgIm5vdGUiOiAiIn0sIHsib2ZmZXIiOiAiQVlMSUsgLSA2IEFZIDEzOSw1IFRMIiwgInNlZ21lbnQiOiAiSU5CT1VORCIsICJkZXNjcmlwdGlvbiI6ICJJbmJvdW5kIMO8emVyaW5kZW4gZ2VsZW4gc2F0xLFuIGFsbWEgdGFsZXBsZXJpIHlhIGRhIHNhdMSxxZ9hIGlrbmEgZWRpbGVuIGt1bGxhbsSxY8SxbGFyIGnDp2luIHN1bnVsYW4gdGVrbGlmIiwgIm5vdGUiOiAiIn1dOwpjb25zdCBTUE9SVFNfUklHSFRTX0ZBTExCQUNLID0gW3siaXRlbSI6ICJFdXJvbGVhZ3VlIG1hw6dsYXLEsSB2ZSBzdMO8ZHlvIHByb2dyYW1sYXLEsSIsICJwZXJpb2QiOiAiMjAyNS0yMDI2IC8gMjAyNi0gMjAyNyAvIDIwMjctMjAyOCAvIDIwMjgtMjAyOSIsICJub3RlIjogIiJ9LCB7Iml0ZW0iOiAiQnVuZGVzbGlnYSIsICJwZXJpb2QiOiAiMjAyNS0yMDI2IC8gMjAyNi0gMjAyNyAvIDIwMjctMjAyOCAvIDIwMjgtMjAyOSIsICJub3RlIjogIiJ9LCB7Iml0ZW0iOiAiQnVuZGVzbGlnYSAyIiwgInBlcmlvZCI6ICIyMDI1LTIwMjYgLyAyMDI2LSAyMDI3IC8gMjAyNy0yMDI4IC8gMjAyOC0yMDI5IiwgIm5vdGUiOiAiIn0sIHsiaXRlbSI6ICLEsHNwYW55YSBMYUxpZ2Egw7ZuZW1saSBtYcOnbGFyxLEiLCAicGVyaW9kIjogIjIwMjUgLSAyMDI2IC8gMjAyNiAtIDIwMjciLCAibm90ZSI6ICIifSwgeyJpdGVtIjogIkxhTGlnYSAyIMO2bmVtbGkgbWHDp2xhcsSxIiwgInBlcmlvZCI6ICIyMDI1IC0gMjAyNiAvIDIwMjYgLSAyMDI3IiwgIm5vdGUiOiAiIn0sIHsiaXRlbSI6ICLEsHRhbHlhIFNlcmllIEEgw7ZuZW1saSBtYcOnbGFyxLEiLCAicGVyaW9kIjogIjIwMjUgLSAyMDI2IC8gMjAyNiAtIDIwMjciLCAibm90ZSI6ICIifSwgeyJpdGVtIjogIlBvcnRla2l6IExpZ2EgUG9ydHVnYWwgw7ZuZW1saSBtYcOnbGFyxLEiLCAicGVyaW9kIjogIjIwMjUgLSAyMDI2IiwgIm5vdGUiOiAiIn0sIHsiaXRlbSI6ICJTdXVkaSBBcmFiaXN0YW4gUHJvIExpZyDDtm5lbWxpIG1hw6dsYXLEsSIsICJwZXJpb2QiOiAiMjAyNS0yMDI2IC8gMjAyNi0gMjAyNyAvIDIwMjctMjAyOCAvIDIwMjgtMjAyOSIsICJub3RlIjogIiJ9LCB7Iml0ZW0iOiAiSG9sbGFuZGEgTGlnaSIsICJwZXJpb2QiOiAiMjAyNS0yMDI2IC8gMjAyNi0gMjAyNyAvIDIwMjctMjAyOCAvIDIwMjgtMjAyOSIsICJub3RlIjogIiJ9LCB7Iml0ZW0iOiAixLBza2/Dp3lhIFByZW1pZXJzaGlwIMO2bmVtbGkgbWHDp2xhcsSxIiwgInBlcmlvZCI6ICIyMDI1IC0gMjAyNiAvIDIwMjYgLSAyMDI3IiwgIm5vdGUiOiAiIn0sIHsiaXRlbSI6ICJOQ0FBIEFtZXJpa2FuIEZ1dGJvbCIsICJwZXJpb2QiOiAiMjAyNSAtIDIwMjYgLyAyMDI2IC0gMjAyNyIsICJub3RlIjogIiJ9LCB7Iml0ZW0iOiAiTkNBQSBCYXNrZXRib2wiLCAicGVyaW9kIjogIjIwMjUgLSAyMDI2IC8gMjAyNiAtIDIwMjciLCAibm90ZSI6ICIifSwgeyJpdGVtIjogIk5GTCIsICJwZXJpb2QiOiAiMjAyNSAtIDIwMjYiLCAibm90ZSI6ICIifSwgeyJpdGVtIjogIk5CQSIsICJwZXJpb2QiOiAiMjAyNS0yMDI2IC8gMjAyNi0gMjAyNyAvIDIwMjctMjAyOCAvIDIwMjgtMjAyOSIsICJub3RlIjogIiJ9LCB7Iml0ZW0iOiAiRXVyb0N1cCIsICJwZXJpb2QiOiAiMjAyNS0yMDI2IC8gMjAyNi0gMjAyNyAvIDIwMjctMjAyOCAvIDIwMjgtMjAyOSIsICJub3RlIjogIiJ9LCB7Iml0ZW0iOiAiWXVuYW5pc3RhbiBCYXNrZXRib2wgTGlnaSDDtm5lbWxpIG1hw6dsYXLEsSIsICJwZXJpb2QiOiAiMjAyNSAtIDIwMjYgU2V6b24gYmVsaXJzaXoiLCAibm90ZSI6ICIifSwgeyJpdGVtIjogIk5DQUEiLCAicGVyaW9kIjogIjIwMjUgLSAyMDI2IC8gMjAyNiAtIDIwMjciLCAibm90ZSI6ICIifSwgeyJpdGVtIjogIkxpYmVydGFkb3JlcyBLdXBhc8SxIiwgInBlcmlvZCI6ICIyMDI3LCAyMDI4LCAyMDI5LCAyMDMwICg0IHNlYXNvbnMpIiwgIm5vdGUiOiAiIn0sIHsiaXRlbSI6ICJDb3BhIFN1ZGFtZXJpY2FuYSIsICJwZXJpb2QiOiAiMjAyNywgMjAyOCwgMjAyOSwgMjAzMCAoNCBzZWFzb25zKSIsICJub3RlIjogIiJ9LCB7Iml0ZW0iOiAiV1JDIiwgInBlcmlvZCI6ICIyMDI1IiwgIm5vdGUiOiAiMjAyNiBkYSBhbMSxbmFiaWxpciBuZXQgZGXEn2lsIn0sIHsiaXRlbSI6ICJOYXNjYXIiLCAicGVyaW9kIjogIjIwMjUgLSAyMDI2IC0gMjAyNyAtIDIwMjggdmUgMjAyOSIsICJub3RlIjogIiJ9LCB7Iml0ZW0iOiAiSW5keUNhciIsICJwZXJpb2QiOiAiMjAyNSAtIDIwMjYgLSAyMDI3IiwgIm5vdGUiOiAiIn0sIHsiaXRlbSI6ICJNb3RvR1AgLSBNb3RvMiAtIE1vdG8zIiwgInBlcmlvZCI6ICIyMDI1IC0gMjAyNiAtIDIwMjciLCAibm90ZSI6ICIifSwgeyJpdGVtIjogIkFUUCBUZW5pcyBUdXJudXZhbGFyxLEgw7ZuZW1saSBtYcOnbGFyIiwgInBlcmlvZCI6ICIyMDI1IC0gMjAyNiAtIDIwMjcgYW5kIDIwMjgiLCAibm90ZSI6ICIifSwgeyJpdGVtIjogIldpbWJsZWRvbiBUZW5pcyDDtm5lbWxpIG1hw6dsYXIiLCAicGVyaW9kIjogIjIwMjUgLSAyMDI2IC0gMjAyNyIsICJub3RlIjogIiJ9LCB7Iml0ZW0iOiAiVUZDIETDtnbDvMWfIEdlY2VzaSB5YXnEsW5sYXLEsSIsICJwZXJpb2QiOiAiMjAyNyBzb251bmEga2FkYXIgYml6ZGUiLCAibm90ZSI6ICIifSwgeyJpdGVtIjogIk9rdGFnb24iLCAicGVyaW9kIjogIjIwMjUiLCAibm90ZSI6ICIifSwgeyJpdGVtIjogIlBGTCBNTUEiLCAicGVyaW9kIjogIjIwMjUiLCAibm90ZSI6ICIifSwgeyJpdGVtIjogIkNhZ2UgV2FycmlvcnMgQm9rcyBNYcOnbGFyxLEiLCAicGVyaW9kIjogIjIwMjUiLCAibm90ZSI6ICIifSwgeyJpdGVtIjogIkJLRkMiLCAicGVyaW9kIjogIkthbGTEsXLEsWxkxLEiLCAibm90ZSI6ICIifV07CgpmdW5jdGlvbiBzZXRBY3RpdmVGaWx0ZXJCdXR0b24oYnRuKXsKICAgIHRyeXsKICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZmlsdGVyLWJ0bicpLmZvckVhY2goYj0+Yi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKSk7CiAgICAgICAgaWYoYnRuKSBidG4uY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgICB9Y2F0Y2goZSl7fQp9CgpmdW5jdGlvbiBzaG93SG9tZVNjcmVlbigpewogICAgY29uc3QgaG9tZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdob21lLXNjcmVlbicpOwogICAgY29uc3QgZ3JpZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYXJkR3JpZCcpOwogICAgY29uc3QgZW1wdHkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZW1wdHlNZXNzYWdlJyk7CiAgICBpZiAoaG9tZSkgaG9tZS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgIGlmIChncmlkKSBncmlkLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICBpZiAoZW1wdHkpIGVtcHR5LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICByZW5kZXJIb21lUGFuZWxzKCk7Cn0KCmZ1bmN0aW9uIGhpZGVIb21lU2NyZWVuKCl7CiAgICBjb25zdCBob21lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hvbWUtc2NyZWVuJyk7CiAgICBpZiAoaG9tZSkgaG9tZS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgY29uc3QgZ3JpZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYXJkR3JpZCcpOwogICAgaWYgKGdyaWQpIGdyaWQuc3R5bGUuZGlzcGxheSA9ICdncmlkJzsKfQoKZnVuY3Rpb24gcmVuZGVySG9tZVBhbmVscygpewogICAgLy8gLS0tIEJVR8OcTiBORUxFUiBWQVI/IChZYXnEsW4gQWvEscWfxLEgLyBidWfDvG7DvG4gbWHDp2xhcsSxKSAtLS0KICAgIGNvbnN0IHRvZGF5RWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaG9tZS10b2RheScpOwogICAgaWYodG9kYXlFbCl7CiAgICAgICAgdG9kYXlFbC5pbm5lckhUTUwgPSAnPGRpdiBjbGFzcz0iaG9tZS1taW5pLWl0ZW0iPllhecSxbiBha8SxxZ/EsSB5w7xrbGVuaXlvci4uLjwvZGl2Pic7CiAgICAgICAgKGFzeW5jKCk9PnsKICAgICAgICAgICAgdHJ5ewogICAgICAgICAgICAgICAgY29uc3QgaXRlbXMgPSBhd2FpdCBmZXRjaEJyb2FkY2FzdEZsb3coKTsKICAgICAgICAgICAgICAgY29uc3QgZCA9IG5ldyBEYXRlKCk7CmNvbnN0IHRvZGF5SVNPID0gYCR7ZC5nZXRGdWxsWWVhcigpfS0ke1N0cmluZyhkLmdldE1vbnRoKCkrMSkucGFkU3RhcnQoMiwnMCcpfS0ke1N0cmluZyhkLmdldERhdGUoKSkucGFkU3RhcnQoMiwnMCcpfWA7CgoKICAgICAgICAgICAgICAgIGNvbnN0IHRvSVNPID0gKHZhbCk9PnsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzID0gU3RyaW5nKHZhbHx8JycpLnRyaW0oKTsKICAgICAgICAgICAgICAgICAgICBpZighcykgcmV0dXJuICcnOwogICAgICAgICAgICAgICAgICAgIGlmKC9eXGR7NH0tXGR7Mn0tXGR7Mn0kLy50ZXN0KHMpKSByZXR1cm4gczsKICAgICAgICAgICAgICAgICAgICAvLyBkZC5NTS55eXl5CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbSA9IHMubWF0Y2goL14oXGR7Mn0pXC4oXGR7Mn0pXC4oXGR7NH0pJC8pOwogICAgICAgICAgICAgICAgICAgIGlmKG0pIHJldHVybiBgJHttWzNdfS0ke21bMl19LSR7bVsxXX1gOwogICAgICAgICAgICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgY29uc3QgdG9kYXlzID0gKGl0ZW1zfHxbXSkuZmlsdGVyKGl0PT57CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNvID0gdG9JU08oaXQuZGF0ZUlTTyB8fCBpdC5kYXRlKTsKICAgICAgICAgICAgICAgICAgICBpZihpc28gIT09IHRvZGF5SVNPKSByZXR1cm4gZmFsc2U7CgogICAgICAgICAgICAgICAgICAgIC8vIFNhYXRpIGdlw6dlbiBrYXLFn8SxbGHFn21hbGFyIGfDtnLDvG5tZXNpbgogICAgICAgICAgICAgICAgICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2UgPSBOdW1iZXIoaXQuc3RhcnRFcG9jaCB8fCAwKTsKICAgICAgICAgICAgICAgICAgICBpZihzZSkgcmV0dXJuIHNlID4gbm93OwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBTdHJpbmcoaXQudGltZSB8fCAnJykudHJpbSgpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IG0gPSB0Lm1hdGNoKC9eKFxkezJ9KTooXGR7Mn0pKD86OihcZHsyfSkpPyQvKTsKICAgICAgICAgICAgICAgICAgICBpZighbSkgcmV0dXJuIHRydWU7IC8vIHNhYXQgZm9ybWF0xLEgeW9rc2EgZ8O2c3RlcgogICAgICAgICAgICAgICAgICAgIGNvbnN0IGhoID0gcGFyc2VJbnQobVsxXSwxMCksIG1tID0gcGFyc2VJbnQobVsyXSwxMCksIHNzID0gcGFyc2VJbnQobVszXXx8JzAnLDEwKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkdCA9IG5ldyBEYXRlKCk7CiAgICAgICAgICAgICAgICAgICAgZHQuc2V0SG91cnMoaGgsbW0sc3MsMCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGR0LmdldFRpbWUoKSA+IG5vdzsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlmKCF0b2RheXMubGVuZ3RoKXsKICAgICAgICAgICAgICAgICAgICB0b2RheUVsLmlubmVySFRNTCA9ICc8ZGl2IGNsYXNzPSJob21lLW1pbmktaXRlbSI+QnVnw7xuIGnDp2luIHlhecSxbiBha8SxxZ/EsSBrYXlkxLEgYnVsdW5hbWFkxLEuPC9kaXY+JzsKICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNob3duID0gdG9kYXlzLnNsaWNlKDAsNCk7CiAgICAgICAgICAgICAgICAgICAgdG9kYXlFbC5pbm5lckhUTUwgPSBzaG93bi5tYXAoaXQ9PnsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGltZSA9IGVzY2FwZUh0bWwoaXQudGltZSB8fCAnJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRpdGxlID0gZXNjYXBlSHRtbChpdC5tYXRjaCB8fCBpdC50aXRsZSB8fCBpdC5ldmVudCB8fCAnJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoID0gZXNjYXBlSHRtbChpdC5jaGFubmVsIHx8IGl0LnBsYXRmb3JtIHx8ICcnKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGVhZ3VlID0gZXNjYXBlSHRtbChpdC5sZWFndWUgfHwgaXQuY2F0ZWdvcnkgfHwgJycpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzcGsgPSBlc2NhcGVIdG1sKGl0LnNwaWtlciB8fCBpdC5zcGlrZXJzIHx8IGl0LmNvbW1lbnRhdG9yIHx8IGl0LmNvbW1lbnRhdG9ycyB8fCAnJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iaG9tZS1taW5pLWl0ZW0iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iaG9tZS1taW5pLWRhdGUiPiR7dGltZX0ke2xlYWd1ZT9gIOKAoiAke2xlYWd1ZX1gOicnfSR7Y2g/YCDigKIgJHtjaH1gOicnfTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iaG9tZS1taW5pLXRpdGxlIj4ke3RpdGxlIHx8ICdNYcOnJ308L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICR7c3BrID8gYDxkaXYgY2xhc3M9ImhvbWUtbWluaS1kZXNjIiBzdHlsZT0ibWFyZ2luLXRvcDo0cHg7Y29sb3I6IzU1NSI+8J+OmSAke3Nwa308L2Rpdj5gIDogJyd9CiAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIGA7CiAgICAgICAgICAgICAgICAgICAgfSkuam9pbignJykgKyAodG9kYXlzLmxlbmd0aD5zaG93bi5sZW5ndGggPyBgPGRpdiBzdHlsZT0iY29sb3I6IzY2Njtmb250LXNpemU6LjlyZW07bWFyZ2luLXRvcDo2cHgiPiske3RvZGF5cy5sZW5ndGgtc2hvd24ubGVuZ3RofSBtYcOnIGRhaGHigKY8L2Rpdj5gIDogJycpOwogICAgICAgICAgICAgICAgfQoKCiAgICAgICAgICAgICAgICAvLyBrYXJ0xLEgdMSxa2xhecSxbmNhIHlhecSxbiBha8SxxZ/EsW5hIGdpdAogICAgICAgICAgICAgICAgY29uc3QgY2FyZCA9IHRvZGF5RWwuY2xvc2VzdCgnLmhvbWUtY2FyZCcpOwogICAgICAgICAgICAgICAgaWYoY2FyZCl7CiAgICAgICAgICAgICAgICAgICAgY2FyZC5jbGFzc0xpc3QuYWRkKCdjbGlja2FibGUnKTsKICAgICAgICAgICAgICAgICAgICBjYXJkLm9uY2xpY2sgPSAoKT0+b3BlbkJyb2FkY2FzdEZsb3coKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfWNhdGNoKGUpewogICAgICAgICAgICAgICAgdG9kYXlFbC5pbm5lckhUTUwgPSAnPGRpdiBjbGFzcz0iaG9tZS1taW5pLWl0ZW0iPllhecSxbiBha8SxxZ/EsSBhbMSxbmFtYWTEsS48L2Rpdj4nOwogICAgICAgICAgICB9CiAgICAgICAgfSkoKTsKICAgIH0KCiAgICAvLyAtLS0gRFVZVVJVTEFSIChzb24gMyBkdXl1cnUpIC0tLQogICAgY29uc3QgYW5uRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaG9tZS1hbm4nKTsKICAgIGlmKGFubkVsKXsKICAgICAgICBjb25zdCBsYXRlc3QgPSAobmV3c0RhdGEgfHwgW10pLnNsaWNlKDAsMyk7CiAgICAgICAgaWYobGF0ZXN0Lmxlbmd0aD09PTApewogICAgICAgICAgICBhbm5FbC5pbm5lckhUTUwgPSAnPGRpdiBjbGFzcz0iaG9tZS1taW5pLWl0ZW0iPkhlbsO8eiBkdXl1cnUgeW9rLjwvZGl2Pic7CiAgICAgICAgfWVsc2V7CiAgICAgICAgICAgIGFubkVsLmlubmVySFRNTCA9IGxhdGVzdC5tYXAobj0+YAogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iaG9tZS1taW5pLWl0ZW0iPgogICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJob21lLW1pbmktZGF0ZSI+JHtlc2NhcGVIdG1sKG4uZGF0ZXx8JycpfTwvZGl2PgogICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJob21lLW1pbmktdGl0bGUiPiR7ZXNjYXBlSHRtbChuLnRpdGxlfHwnJyl9PC9kaXY+CiAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImhvbWUtbWluaS1kZXNjIj4ke2VzY2FwZUh0bWwoU3RyaW5nKG4uZGVzY3x8JycpKS5zbGljZSgwLDE2MCl9JHsobi5kZXNjfHwnJykubGVuZ3RoPjE2MD8nLi4uJzonJ308L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICBgKS5qb2luKCcnKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgY2FyZCA9IGFubkVsLmNsb3Nlc3QoJy5ob21lLWNhcmQnKTsKICAgICAgICBpZihjYXJkKXsKICAgICAgICAgICAgY2FyZC5jbGFzc0xpc3QuYWRkKCdjbGlja2FibGUnKTsKICAgICAgICAgICAgY2FyZC5vbmNsaWNrID0gKCk9Pm9wZW5OZXdzKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vIC0tLSBHw5xOw5xOIFPDllrDnCAoSG9tZUJsb2NrcyAtPiBlLXRhYmxhKSAtLS0KICAgIGNvbnN0IHF1b3RlRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaG9tZS1xdW90ZScpOwogICAgaWYocXVvdGVFbCl7CiAgICAgICAgY29uc3QgcSA9IFN0cmluZygoaG9tZUJsb2NrcyAmJiBob21lQmxvY2tzLnF1b3RlICYmIGhvbWVCbG9ja3MucXVvdGUuY29udGVudCkgPyBob21lQmxvY2tzLnF1b3RlLmNvbnRlbnQgOiAobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2hvbWVRdW90ZScpfHwnJykpLnRyaW0oKTsKICAgICAgICBxdW90ZUVsLmlubmVySFRNTCA9IHEgPyBlc2NhcGVIdG1sKHEpIDogJzxzcGFuIHN0eWxlPSJjb2xvcjojOTk5Ij5CdWfDvG4gacOnaW4gYmlyIHPDtnogZWtsZW5tZW1pxZ8uPC9zcGFuPic7CiAgICB9CgogICAgLy8gQWRtaW46IGVkaXQgYnV0b25sYXLEsW7EsSBhw6cKICAgIHRyeXsKICAgICAgICBjb25zdCBiMSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdob21lLWVkaXQtdG9kYXknKTsKICAgICAgICBjb25zdCBiMiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdob21lLWVkaXQtYW5uJyk7CiAgICAgICAgY29uc3QgYjMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaG9tZS1lZGl0LXF1b3RlJyk7CiAgICAgICAgaWYoYjEpIGIxLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7IC8vIGFydMSxayBkaW5hbWlrCiAgICAgICAgaWYoYjIpIGIyLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7IC8vIGR1eXVydSBkaW5hbWlrCiAgICAgICAgaWYoYjMpIGIzLnN0eWxlLmRpc3BsYXkgPSAoaXNBZG1pbk1vZGUgJiYgaXNFZGl0aW5nQWN0aXZlID8gJ2lubGluZS1mbGV4JyA6ICdub25lJyk7CiAgICB9Y2F0Y2goZSl7fQp9CgoKCi8vIEFuYSBTYXlmYSAtIEfDvG7DvG4gU8O2esO8IGTDvHplbmxlbWUgKHNhZGVjZSBhZG1pbiBtb2QgKyBkw7x6ZW5sZW1lIGHDp8Sxa2tlbikKZnVuY3Rpb24gZWRpdEhvbWVCbG9jayhraW5kKXsKICAgIGlmKCFpc0FkbWluTW9kZSl7CiAgICAgICAgU3dhbC5maXJlKCJZZXRraXNpeiIsICJCdSBpxZ9sZW0gacOnaW4gYWRtaW4geWV0a2lzaSBnZXJla2xpLiIsICJ3YXJuaW5nIik7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgaWYoIWlzRWRpdGluZ0FjdGl2ZSl7CiAgICAgICAgU3dhbC5maXJlKCJLYXBhbMSxIiwgIkTDvHplbmxlbWUgbW9kdSBrYXBhbMSxLiDDlm5jZSAnRMO8emVubGVtZXlpIEHDpycgZGVtZWxpc2luLiIsICJpbmZvIik7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgaWYoa2luZCAhPT0gJ3F1b3RlJyl7CiAgICAgICAgU3dhbC5maXJlKCJCaWxnaSIsICJCdSBhbGFuIGFydMSxayBvdG9tYXRpayBnw7xuY2VsbGVuaXlvci4iLCAiaW5mbyIpOwogICAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGN1ciA9IFN0cmluZygoaG9tZUJsb2NrcyAmJiBob21lQmxvY2tzLnF1b3RlICYmIGhvbWVCbG9ja3MucXVvdGUuY29udGVudCkgPyBob21lQmxvY2tzLnF1b3RlLmNvbnRlbnQgOiAobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2hvbWVRdW90ZScpIHx8ICcnKSkudHJpbSgpOwogICAgU3dhbC5maXJlKHsKICAgICAgICB0aXRsZTogIkfDvG7DvG4gU8O2esO8IiwKICAgICAgICBpbnB1dDogInRleHRhcmVhIiwKICAgICAgICBpbnB1dFZhbHVlOiBjdXIsCiAgICAgICAgaW5wdXRQbGFjZWhvbGRlcjogIkJ1Z8O8bsO8biBzw7Z6w7xuw7wgeWF64oCmIiwKICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAiS2F5ZGV0IiwKICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiAiVmF6Z2XDpyIsCiAgICAgICAgcHJlQ29uZmlybTogKHZhbCk9PiAodmFsfHwnJykudHJpbSgpCiAgICB9KS50aGVuKHJlcz0+ewogICAgICAgIGlmKCFyZXMuaXNDb25maXJtZWQpIHJldHVybjsKICAgICAgICBjb25zdCB2YWwgPSByZXMudmFsdWUgfHwgJyc7CiAgICAgICAgLy8gbG9jYWwgZmFsbGJhY2sKICAgICAgICB0cnl7IGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdob21lUXVvdGUnLCB2YWwpOyB9Y2F0Y2goZSl7fQogICAgICAgIC8vIGUtdGFibGEgKEhvbWVCbG9ja3MpCiAgICAgICAgYXBpQ2FsbCgndXBkYXRlSG9tZUJsb2NrJywgeyBrZXk6J3F1b3RlJywgdGl0bGU6J0fDvG7DvG4gU8O2esO8JywgY29udGVudDogdmFsLCB2aXNpYmxlR3JvdXBzOicnIH0pCiAgICAgICAgICAudGhlbigoKT0+ewogICAgICAgICAgICBob21lQmxvY2tzID0gaG9tZUJsb2NrcyB8fCB7fTsKICAgICAgICAgICAgaG9tZUJsb2Nrcy5xdW90ZSA9IHsga2V5OidxdW90ZScsIHRpdGxlOidHw7xuw7xuIFPDtnrDvCcsIGNvbnRlbnQ6IHZhbCwgdmlzaWJsZUdyb3VwczonJyB9OwogICAgICAgICAgICB0cnl7IGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdob21lQmxvY2tzQ2FjaGUnLCBKU09OLnN0cmluZ2lmeShob21lQmxvY2tzfHx7fSkpOyB9Y2F0Y2goZSl7fQogICAgICAgICAgICByZW5kZXJIb21lUGFuZWxzKCk7CiAgICAgICAgICAgIFN3YWwuZmlyZSgiS2F5ZGVkaWxkaSIsICJHw7xuw7xuIHPDtnrDvCBnw7xuY2VsbGVuZGkuIiwgInN1Y2Nlc3MiKTsKICAgICAgICAgIH0pCiAgICAgICAgICAuY2F0Y2goKCk9PnsKICAgICAgICAgICAgcmVuZGVySG9tZVBhbmVscygpOwogICAgICAgICAgICBTd2FsLmZpcmUoIktheWRlZGlsZGkiLCAiR8O8bsO8biBzw7Z6w7wgZ8O8bmNlbGxlbmRpICh5ZXJlbCkuIiwgInN1Y2Nlc3MiKTsKICAgICAgICAgIH0pOwogICAgfSk7Cn0KCi8vIEthcnQgZGV0YXnEsW7EsSBkb8SfcnVkYW4gYcOnbWFrIGnDp2luIGvDvMOnw7xrIGJpciB5YXJkxLFtY8SxCmZ1bmN0aW9uIG9wZW5DYXJkRGV0YWlsKGNhcmRJZCl7CiAgICBjb25zdCBjYXJkID0gKGNhcmRzRGF0YXx8W10pLmZpbmQoeD0+U3RyaW5nKHguaWQpPT09U3RyaW5nKGNhcmRJZCkpOwogICAgaWYoIWNhcmQpe1N3YWwuZmlyZSgnSGF0YScsJ0thcnQgYnVsdW5hbWFkxLEuJywnZXJyb3InKTtyZXR1cm47fQogICAgc2hvd0NhcmREZXRhaWwoY2FyZCk7Cn0KCi8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgVEVMRSBTQVRJxZ4gRlVMTFNDUkVFTgotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovCmxldCB0ZWxlc2FsZXNPZmZlcnMgPSBbXTsKbGV0IHRlbGVzYWxlc1NjcmlwdHNMb2FkZWQgPSBmYWxzZTsKZnVuY3Rpb24gc2FmZUdldFRva2VuKCl7CiAgICB0cnl7IHJldHVybiAodHlwZW9mIGdldFRva2VuID09PSAnZnVuY3Rpb24nKSA/IGdldFRva2VuKCkgOiAnJzsgfWNhdGNoKGUpeyByZXR1cm4gJyc7IH0KfQphc3luYyBmdW5jdGlvbiBmZXRjaFNoZWV0T2JqZWN0cyhhY3Rpb25OYW1lKXsKICAgIGNvbnN0IHBheWxvYWQgPSB7IGFjdGlvbjogYWN0aW9uTmFtZSwgdXNlcm5hbWU6IChjdXJyZW50VXNlcnx8JycpLCB0b2tlbjogc2FmZUdldFRva2VuKCkgfTsKICAgIGNvbnN0IHIgPSBhd2FpdCBmZXRjaChTQ1JJUFRfVVJMLCB7CiAgICAgICAgbWV0aG9kOiAiUE9TVCIsCiAgICAgICAgaGVhZGVyczogeyAiQ29udGVudC1UeXBlIjogInRleHQvcGxhaW47Y2hhcnNldD11dGYtOCIgfSwKICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShwYXlsb2FkKQogICAgfSk7CiAgICBjb25zdCBkID0gYXdhaXQgci5qc29uKCk7CiAgICBpZighZCB8fCBkLnJlc3VsdCAhPT0gInN1Y2Nlc3MiKSB0aHJvdyBuZXcgRXJyb3IoKGQgJiYgZC5tZXNzYWdlKSA/IGQubWVzc2FnZSA6ICJWZXJpIGFsxLFuYW1hZMSxLiIpOwogICAgLy8gYmFja2VuZCBoYW5kbGVGZXRjaERhdGEgcmV0dXJucyB7ZGF0YTpbLi4uXX0gOyBvdGhlciBoYW5kbGVycyBtYXkgdXNlIHtpdGVtczpbLi4uXX0KICAgIHJldHVybiBkLmRhdGEgfHwgZC5pdGVtcyB8fCBbXTsKfQoKYXN5bmMgZnVuY3Rpb24gbWF5YmVMb2FkVGVsZXNhbGVzU2NyaXB0c0Zyb21TaGVldCgpewogICAgaWYodGVsZXNhbGVzU2NyaXB0c0xvYWRlZCkgcmV0dXJuOwogICAgdGVsZXNhbGVzU2NyaXB0c0xvYWRlZCA9IHRydWU7CiAgICAvLyBFxJ9lciBrdWxsYW7EsWPEsSBsb2NhbCBvdmVycmlkZSB5YXB0xLF5c2Egc2hlZXQndGVuIGV6bWV5ZWxpbQogICAgdHJ5ewogICAgICAgIGNvbnN0IG92ID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgndGVsZXNhbGVzU2NyaXB0c092ZXJyaWRlJykgfHwgJ1tdJyk7CiAgICAgICAgaWYoQXJyYXkuaXNBcnJheShvdikgJiYgb3YubGVuZ3RoKSByZXR1cm47CiAgICB9Y2F0Y2goZSl7fQogICAgdHJ5ewogICAgICAgIGNvbnN0IGxvYWRlZCA9IGF3YWl0IGZldGNoU2hlZXRPYmplY3RzKCdnZXRUZWxlc2FsZXNTY3JpcHRzJyk7CiAgICAgICAgaWYoQXJyYXkuaXNBcnJheShsb2FkZWQpICYmIGxvYWRlZC5sZW5ndGgpewogICAgICAgICAgICAvLyBTaGVldCBrb2xvbiBhZGxhcsSxbsSxIG5vcm1hbGl6ZSBldAogICAgICAgICAgICB3aW5kb3cuc2FsZXNTY3JpcHRzID0gbG9hZGVkLm1hcChzPT4oewogICAgICAgICAgICAgICAgaWQ6IHMuaWQgfHwgcy5JRCB8fCBzLklkIHx8ICcnLAogICAgICAgICAgICAgICAgdGl0bGU6IHMudGl0bGUgfHwgcy5CYcWfbMSxayB8fCBzLkJhc2xpayB8fCBzLlNjcmlwdCB8fCBzWydTY3JpcHQgQmHFn2zEscSfxLEnXSB8fCAnU2NyaXB0JywKICAgICAgICAgICAgICAgIHRleHQ6IHMudGV4dCB8fCBzLk1ldGluIHx8IHNbJ1NjcmlwdCBNZXRuaSddIHx8IHMuY29udGVudCB8fCAnJwogICAgICAgICAgICB9KSkuZmlsdGVyKHg9PngudGV4dCk7CiAgICAgICAgfQogICAgfWNhdGNoKGUpewogICAgICAgIC8vIHNlc3NpeiBmYWxsYmFjawogICAgfQp9Cgphc3luYyBmdW5jdGlvbiBzeW5jVGVsZXNhbGVzU2NyaXB0c1RvU2hlZXQoYXJyKXsKICAgIC8vIEJhY2tlbmQgZGVzdGXEn2kgdmFyc2EgU2hlZXRzJ2UgeWF6OyB5b2tzYSBzZXNzaXpjZSBsb2NhbCdkZSBrYWxzxLFuLgogICAgdHJ5ewogICAgICAgIGF3YWl0IGZldGNoKFNDUklQVF9VUkwsIHsKICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsCiAgICAgICAgICAgIGhlYWRlcnM6IHsgJ0NvbnRlbnQtVHlwZSc6ICd0ZXh0L3BsYWluO2NoYXJzZXQ9dXRmLTgnIH0sCiAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgYWN0aW9uOiAnc2F2ZVRlbGVzYWxlc1NjcmlwdHMnLCB1c2VybmFtZTogKGN1cnJlbnRVc2VyfHwnJyksIHRva2VuOiBzYWZlR2V0VG9rZW4oKSwgc2NyaXB0czogYXJyfHxbXSB9KQogICAgICAgIH0pLnRoZW4ocj0+ci5qc29uKCkpLnRoZW4oZD0+ewogICAgICAgICAgICBpZighZCB8fCBkLnJlc3VsdCAhPT0gJ3N1Y2Nlc3MnKSB0aHJvdyBuZXcgRXJyb3IoZCAmJiBkLm1lc3NhZ2UgPyBkLm1lc3NhZ2UgOiAnZmFpbCcpOwogICAgICAgIH0pOwogICAgfWNhdGNoKGUpewogICAgICAgIC8vIHNlc3NpeiBmYWxsYmFjawogICAgfQp9Cgphc3luYyBmdW5jdGlvbiBvcGVuVGVsZXNhbGVzQXJlYSgpewogICAgLy8gTWVuw7wgeWV0a2lzaTogdGVsZXNhbGVzIChUZWxlU2F0xLHFnykgLSB5ZXRraXNpeiBrdWxsYW7EsWPEsSBmdWxsc2NyZWVuJ2UgZ2lyZW1lc2luCiAgICB0cnl7CiAgICAgICAgY29uc3QgcGVybSA9ICh0eXBlb2YgbWVudVBlcm1pc3Npb25zIT09InVuZGVmaW5lZCIgJiYgbWVudVBlcm1pc3Npb25zKSA/IG1lbnVQZXJtaXNzaW9uc1sidGVsZXNhbGVzIl0gOiBudWxsOwogICAgICAgIGlmKHBlcm0gJiYgIWlzQWxsb3dlZEJ5UGVybShwZXJtKSl7CiAgICAgICAgICAgIFN3YWwuZmlyZSgiWWV0a2lzaXoiLCAiVGVsZVNhdMSxxZ8gZWtyYW7EsW5hIGVyacWfaW1pbiB5b2suIiwgIndhcm5pbmciKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH1jYXRjaChlKXt9CgogICAgY29uc3Qgd3JhcCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0ZWxlc2FsZXMtZnVsbHNjcmVlbicpOwogICAgaWYoIXdyYXApIHJldHVybjsKICAgIHdyYXAuc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsKICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmFkZCgnZnMtb3BlbicpOwogICAgZG9jdW1lbnQuYm9keS5zdHlsZS5vdmVyZmxvdz0naGlkZGVuJzsKCiAgICAvLyBTaWRlYmFyIHByb2ZpbAogICAgY29uc3QgYXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndC1zaWRlLWF2YXRhcicpOwogICAgY29uc3Qgbm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndC1zaWRlLW5hbWUnKTsKICAgIGNvbnN0IHJsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Qtc2lkZS1yb2xlJyk7CiAgICBpZihhdikgYXYuaW5uZXJUZXh0ID0gKGN1cnJlbnRVc2VyfHwnVScpLnRyaW0oKS5zbGljZSgwLDEpLnRvVXBwZXJDYXNlKCk7CiAgICBpZihubSkgbm0uaW5uZXJUZXh0ID0gY3VycmVudFVzZXIgfHwgJ0t1bGxhbsSxY8SxJzsKICAgIGlmKHJsKSBybC5pbm5lclRleHQgPSBpc0FkbWluTW9kZSA/ICdBZG1pbicgOiAnVGVtc2lsY2knOwoKICAgIC8vIERhdGEgdGVrbGlmbGVyaTogw7ZuY2UgZS10YWJsYWRhbiDDp2VrbWV5aSBkZW5lLCBvbG1henNhIGZhbGxiYWNrCiAgICBpZih0ZWxlc2FsZXNPZmZlcnMubGVuZ3RoPT09MCl7CiAgICAgICAgbGV0IGxvYWRlZCA9IFtdOwogICAgICAgIHRyeXsKICAgICAgICAgICAgbG9hZGVkID0gYXdhaXQgZmV0Y2hTaGVldE9iamVjdHMoImdldFRlbGVzYWxlc09mZmVycyIpOwogICAgICAgIH1jYXRjaChlKXsKICAgICAgICAgICAgLy8gc2Vzc2l6IGZhbGxiYWNrCiAgICAgICAgfQogICAgICAgIHRlbGVzYWxlc09mZmVycyA9IChBcnJheS5pc0FycmF5KGxvYWRlZCkgJiYgbG9hZGVkLmxlbmd0aCkKICAgICAgICAgICAgPyBsb2FkZWQubWFwKG89Pih7CiAgICAgICAgICAgICAgICBzZWdtZW50OiBvLnNlZ21lbnQgfHwgby5TZWdtZW50IHx8IG8uU0VHTUVOVCB8fCAnJywKICAgICAgICAgICAgICAgIHRpdGxlOiBvLnRpdGxlIHx8IG8uQmHFn2zEsWsgfHwgby5CYXNsaWsgfHwgby5UZWtsaWYgfHwgb1snVGVrbGlmIEFkxLEnXSB8fCBvWydUZWtsaWYgQWRpJ10gfHwgJycsCiAgICAgICAgICAgICAgICBkZXNjOiBvLmRlc2MgfHwgby5Bw6fEsWtsYW1hIHx8IG8uQWNpa2xhbWEgfHwgby5EZXRheSB8fCBvWydEZXRheS9Ob3QnXSB8fCBvLk5vdCB8fCAnJywKICAgICAgICAgICAgICAgIGV4YW1wbGU6IG8uZXhhbXBsZSB8fCBvLsOWcm5layB8fCBvLk9ybmVrIHx8ICcnLAogICAgICAgICAgICAgICAgdGlwczogby50aXBzIHx8IG8uxLBwdWN1IHx8IG8uSXB1Y3UgfHwgJycsCiAgICAgICAgICAgICAgICBvYmplY3Rpb246IG8ub2JqZWN0aW9uIHx8IG8uSXRpcmF6IHx8ICcnLAogICAgICAgICAgICAgICAgcmVwbHk6IG8ucmVwbHkgfHwgby5DZXZhcCB8fCAnJwogICAgICAgICAgICB9KSkKICAgICAgICAgICAgOiAoQXJyYXkuaXNBcnJheSh3aW5kb3cudGVsZXNhbGVzT2ZmZXJzRnJvbVNoZWV0KSAmJiB3aW5kb3cudGVsZXNhbGVzT2ZmZXJzRnJvbVNoZWV0Lmxlbmd0aAogICAgICAgICAgICAgICAgPyB3aW5kb3cudGVsZXNhbGVzT2ZmZXJzRnJvbVNoZWV0CiAgICAgICAgICAgICAgICA6IFRFTEVTYWxlc19PRkZFUlNfRkFMTEJBQ0spOwogICAgfQoKICAgIC8vIFNlZ21lbnQgZmlsdHJlc2kga2FsZMSxcsSxbGTEsQogICAgcmVuZGVyVGVsZXNhbGVzRGF0YU9mZmVycygpOwogICAgLy8gU2NyaXB0bGVyOiBzaGVldCd0ZW4gw6dla21leWkgZGVuZQogICAgYXdhaXQgbWF5YmVMb2FkVGVsZXNhbGVzU2NyaXB0c0Zyb21TaGVldCgpOwogICAgcmVuZGVyVGVsZXNhbGVzU2NyaXB0cygpOwogICAgc3dpdGNoVGVsZXNhbGVzVGFiKCdkYXRhJyk7Cn0KCmZ1bmN0aW9uIGNsb3NlRnVsbFRlbGVzYWxlcygpewogICAgY29uc3Qgd3JhcCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0ZWxlc2FsZXMtZnVsbHNjcmVlbicpOwogICAgaWYod3JhcCkgd3JhcC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QucmVtb3ZlKCdmcy1vcGVuJyk7CiAgICBkb2N1bWVudC5ib2R5LnN0eWxlLm92ZXJmbG93PScnOwp9CgpmdW5jdGlvbiBzd2l0Y2hUZWxlc2FsZXNUYWIodGFiKXsKICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJyN0ZWxlc2FsZXMtZnVsbHNjcmVlbiAucS1uYXYtaXRlbScpLmZvckVhY2goaT0+aS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKSk7CiAgICAvLyBTZXQgYWN0aXZlIG5hdiBieSBvbmNsaWNrIG1hcmtlcgogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnI3RlbGVzYWxlcy1mdWxsc2NyZWVuIC5xLW5hdi1pdGVtJykuZm9yRWFjaChpPT57CiAgICAgICAgaWYoKGkuZ2V0QXR0cmlidXRlKCdvbmNsaWNrJyl8fCcnKS5pbmNsdWRlcyhgIiR7dGFifSJgKSkgaS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgIH0pOwoKICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJyN0ZWxlc2FsZXMtZnVsbHNjcmVlbiAucS12aWV3LXNlY3Rpb24nKS5mb3JFYWNoKHM9PnMuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJykpOwogICAgY29uc3QgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgdC12aWV3LSR7dGFifWApOwogICAgaWYoZWwpIGVsLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwp9CgpmdW5jdGlvbiBoeWRyYXRlVGVsZXNhbGVzU2VnbWVudEZpbHRlcigpewogICAgY29uc3Qgc2VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3QtZGF0YS1zZWcnKTsKICAgIGlmKCFzZWwpIHJldHVybjsKICAgIGNvbnN0IHNlZ3MgPSBBcnJheS5mcm9tKG5ldyBTZXQoKHRlbGVzYWxlc09mZmVyc3x8W10pLm1hcChvPT5vLnNlZ21lbnQpLmZpbHRlcihCb29sZWFuKSkpLnNvcnQoKTsKICAgIHNlbC5pbm5lckhUTUwgPSAnPG9wdGlvbiB2YWx1ZT0iYWxsIj5Uw7xtIFNlZ21lbnRsZXI8L29wdGlvbj4nICsgc2Vncy5tYXAocz0+YDxvcHRpb24gdmFsdWU9IiR7ZXNjYXBlSHRtbChzKX0iPiR7ZXNjYXBlSHRtbChzKX08L29wdGlvbj5gKS5qb2luKCcnKTsKfQoKZnVuY3Rpb24gcmVuZGVyVGVsZXNhbGVzRGF0YU9mZmVycygpewogICAgY29uc3QgZ3JpZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0LWRhdGEtZ3JpZCcpOwogICAgaWYoIWdyaWQpIHJldHVybjsKCiAgICBjb25zdCBxID0gKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0LWRhdGEtc2VhcmNoJyk/LnZhbHVlfHwnJykudG9Mb3dlckNhc2UoKTsKCiAgICBjb25zdCBsaXN0ID0gKHRlbGVzYWxlc09mZmVyc3x8W10pLmZpbHRlcihvPT57CiAgICAgICAgY29uc3QgaGF5ID0gYCR7by50aXRsZXx8Jyd9ICR7by5kZXNjfHwnJ30gJHtvLnNlZ21lbnR8fCcnfSAke28udGFnfHwnJ31gLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgY29uc3Qgb2tRID0gIXEgfHwgaGF5LmluY2x1ZGVzKHEpOwogICAgICAgIHJldHVybiBva1E7CiAgICB9KTsKCiAgICBjb25zdCBiYXIgPSAoaXNBZG1pbk1vZGUgJiYgaXNFZGl0aW5nQWN0aXZlKSA/IGAKICAgICAgICA8ZGl2IHN0eWxlPSJncmlkLWNvbHVtbjoxLy0xO2Rpc3BsYXk6ZmxleDtnYXA6MTBweDthbGlnbi1pdGVtczpjZW50ZXI7bWFyZ2luOjZweCAwIDEycHg7Ij4KICAgICAgICAgIDxidXR0b24gY2xhc3M9IngtYnRuIHgtYnRuLWFkbWluIiBvbmNsaWNrPSJhZGRUZWxlc2FsZXNPZmZlcigpIj48aSBjbGFzcz0iZmFzIGZhLXBsdXMiPjwvaT4gVGVrbGlmIEVrbGU8L2J1dHRvbj4KICAgICAgICA8L2Rpdj4KICAgIGAgOiAnJzsKCiAgICBpZihsaXN0Lmxlbmd0aD09PTApewogICAgICAgIGdyaWQuaW5uZXJIVE1MID0gYmFyICsgJzxkaXYgc3R5bGU9Im9wYWNpdHk6Ljc7cGFkZGluZzoyMHB4O2dyaWQtY29sdW1uOjEvLTEiPlNvbnXDpyBidWx1bmFtYWTEsS48L2Rpdj4nOwogICAgICAgIGNvbnN0IGNudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0LWRhdGEtY291bnQnKTsgaWYoY250KSBjbnQuaW5uZXJUZXh0ID0gJzAga2F5xLF0JzsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgY29uc3QgY250ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3QtZGF0YS1jb3VudCcpOwogICAgaWYoY250KSBjbnQuaW5uZXJUZXh0ID0gYCR7bGlzdC5sZW5ndGh9IGthecSxdGA7CgogICAgZ3JpZC5pbm5lckhUTUwgPSBiYXIgKyBsaXN0Lm1hcCgobywgaWR4KT0+YAogICAgICAgIDxkaXYgY2xhc3M9InEtdHJhaW5pbmctY2FyZCIgb25jbGljaz0ic2hvd1RlbGVzYWxlc09mZmVyRGV0YWlsKCR7aWR4fSkiIHN0eWxlPSJjdXJzb3I6cG9pbnRlciI+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJ0LXRyYWluaW5nLWhlYWQiPgogICAgICAgICAgICA8ZGl2IHN0eWxlPSJtaW4td2lkdGg6MCI+CiAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icS1pdGVtLXRpdGxlIiBzdHlsZT0iZm9udC1zaXplOjEuMDJyZW0iPiR7ZXNjYXBlSHRtbChvLnRpdGxlfHwnVGVrbGlmJyl9PC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0LXRyYWluaW5nLWJhZGdlIj4ke2VzY2FwZUh0bWwoby5zZWdtZW50fHxvLnRhZ3x8JycpfTwvZGl2PgogICAgICAgICAgPC9kaXY+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJ0LXRyYWluaW5nLWRlc2MiPiR7ZXNjYXBlSHRtbCgoby5kZXNjfHwnJykuc2xpY2UoMCwxNDApKX0keyhvLmRlc2N8fCcnKS5sZW5ndGg+MTQwPycuLi4nOicnfTwvZGl2PgogICAgICAgICAgPGRpdiBzdHlsZT0ibWFyZ2luLXRvcDoxMHB4O2NvbG9yOiM5OTk7Zm9udC1zaXplOi44cmVtIj4oRGV0YXkgacOnaW4gdMSxa2xhKTwvZGl2PgogICAgICAgICAgJHsoaXNBZG1pbk1vZGUgJiYgaXNFZGl0aW5nQWN0aXZlKSA/IGAKICAgICAgICAgICAgPGRpdiBzdHlsZT0ibWFyZ2luLXRvcDoxMnB4O2Rpc3BsYXk6ZmxleDtnYXA6MTBweCI+CiAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0ieC1idG4geC1idG4tYWRtaW4iIG9uY2xpY2s9ImV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOyBlZGl0VGVsZXNhbGVzT2ZmZXIoJHtpZHh9KTsiPjxpIGNsYXNzPSJmYXMgZmEtcGVuIj48L2k+IETDvHplbmxlPC9idXR0b24+CiAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0ieC1idG4geC1idG4tYWRtaW4iIG9uY2xpY2s9ImV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOyBkZWxldGVUZWxlc2FsZXNPZmZlcigke2lkeH0pOyI+PGkgY2xhc3M9ImZhcyBmYS10cmFzaCI+PC9pPiBTaWw8L2J1dHRvbj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICBgIDogYGB9CiAgICAgICAgPC9kaXY+CiAgICBgKS5qb2luKCcnKTsKfQoKZnVuY3Rpb24gYWRkVGVsZXNhbGVzT2ZmZXIoKXsKICAgIFN3YWwuZmlyZSh7CiAgICAgICAgdGl0bGU6IlRlbGVTYXTEscWfIFRla2xpZmkgRWtsZSIsCiAgICAgICAgaHRtbDogYAogICAgICAgICAgPGlucHV0IGlkPSJ0by10aXRsZSIgY2xhc3M9InN3YWwyLWlucHV0IiBwbGFjZWhvbGRlcj0iQmHFn2zEsWsiPgogICAgICAgICAgPGlucHV0IGlkPSJ0by1zZWciIGNsYXNzPSJzd2FsMi1pbnB1dCIgcGxhY2Vob2xkZXI9IlNlZ21lbnQgLyBFdGlrZXQgKG9wc2l5b25lbCkiPgogICAgICAgICAgPHRleHRhcmVhIGlkPSJ0by1kZXNjIiBjbGFzcz0ic3dhbDItdGV4dGFyZWEiIHBsYWNlaG9sZGVyPSJBw6fEsWtsYW1hIj48L3RleHRhcmVhPgogICAgICAgICAgPHRleHRhcmVhIGlkPSJ0by1kZXRhaWwiIGNsYXNzPSJzd2FsMi10ZXh0YXJlYSIgcGxhY2Vob2xkZXI9IkRldGF5IChvcHNpeW9uZWwpIj48L3RleHRhcmVhPgogICAgICAgIGAsCiAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjp0cnVlLAogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiJFa2xlIiwKICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiJWYXpnZcOnIiwKICAgICAgICBwcmVDb25maXJtOiAoKT0+ewogICAgICAgICAgICBjb25zdCB0aXRsZT0oZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvLXRpdGxlJykudmFsdWV8fCcnKS50cmltKCk7CiAgICAgICAgICAgIGlmKCF0aXRsZSkgcmV0dXJuIFN3YWwuc2hvd1ZhbGlkYXRpb25NZXNzYWdlKCJCYcWfbMSxayB6b3J1bmx1Iik7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBpZDonbG9jYWxfJytEYXRlLm5vdygpLAogICAgICAgICAgICAgICAgdGl0bGUsCiAgICAgICAgICAgICAgICBzZWdtZW50Oihkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG8tc2VnJykudmFsdWV8fCcnKS50cmltKCksCiAgICAgICAgICAgICAgICBkZXNjOihkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG8tZGVzYycpLnZhbHVlfHwnJykudHJpbSgpLAogICAgICAgICAgICAgICAgZGV0YWlsOihkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG8tZGV0YWlsJykudmFsdWV8fCcnKS50cmltKCksCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgfSkudGhlbihhc3luYyByZXM9PnsKICAgICAgICBpZighcmVzLmlzQ29uZmlybWVkKSByZXR1cm47CiAgICAgICAgY29uc3QgdiA9IHJlcy52YWx1ZTsKICAgICAgICBTd2FsLmZpcmUoeyB0aXRsZTonRWtsZW5peW9yLi4uJywgZGlkT3BlbjooKT0+U3dhbC5zaG93TG9hZGluZygpLCBzaG93Q29uZmlybUJ1dHRvbjpmYWxzZSB9KTsKICAgICAgICB0cnl7CiAgICAgICAgICBjb25zdCByID0gYXdhaXQgZmV0Y2goU0NSSVBUX1VSTCwgewogICAgICAgICAgICBtZXRob2Q6J1BPU1QnLAogICAgICAgICAgICBoZWFkZXJzOnsnQ29udGVudC1UeXBlJzondGV4dC9wbGFpbjtjaGFyc2V0PXV0Zi04J30sCiAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgYWN0aW9uOid1cHNlcnRUZWxlc2FsZXNPZmZlcicsIHVzZXJuYW1lOiBjdXJyZW50VXNlciwgdG9rZW46IGdldFRva2VuKCksIGtleVRpdGxlOiAnJywga2V5U2VnbWVudDogJycsIC4uLnYgfSkKICAgICAgICAgIH0pOwogICAgICAgICAgY29uc3QgZCA9IGF3YWl0IHIuanNvbigpOwogICAgICAgICAgaWYoZC5yZXN1bHQ9PT0nc3VjY2VzcycpewogICAgICAgICAgICBTd2FsLmZpcmUoeyBpY29uOidzdWNjZXNzJywgdGl0bGU6J0VrbGVuZGknLCB0aW1lcjoxMjAwLCBzaG93Q29uZmlybUJ1dHRvbjpmYWxzZSB9KTsKICAgICAgICAgICAgYXdhaXQgZmV0Y2hTaGVldE9iamVjdHMoKTsKICAgICAgICAgICAgcmVuZGVyVGVsZXNhbGVzRGF0YU9mZmVycygpOwogICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgIFN3YWwuZmlyZSgnSGF0YScsIGQubWVzc2FnZXx8J0VrbGVuZW1lZGknLCAnZXJyb3InKTsKICAgICAgICAgIH0KICAgICAgICB9Y2F0Y2goZSl7CiAgICAgICAgICBTd2FsLmZpcmUoJ0hhdGEnLCdTdW51Y3UgaGF0YXPEsS4nLCAnZXJyb3InKTsKICAgICAgICB9CiAgICB9KTsKfQoKYXN5bmMgZnVuY3Rpb24gZWRpdFRlbGVzYWxlc09mZmVyKGlkeCl7CiAgICBjb25zdCBvID0gKHRlbGVzYWxlc09mZmVyc3x8W10pW2lkeF07CiAgICBpZighbykgcmV0dXJuOwogICAgY29uc3QgeyB2YWx1ZTogdiB9ID0gYXdhaXQgU3dhbC5maXJlKHsKICAgICAgICB0aXRsZToiVGVrbGlmaSBEw7x6ZW5sZSIsCiAgICAgICAgaHRtbDogYAogICAgICAgICAgPGlucHV0IGlkPSJ0by10aXRsZSIgY2xhc3M9InN3YWwyLWlucHV0IiBwbGFjZWhvbGRlcj0iQmHFn2zEsWsiIHZhbHVlPSIke2VzY2FwZUh0bWwoby50aXRsZXx8JycpfSI+CiAgICAgICAgICA8aW5wdXQgaWQ9InRvLXNlZyIgY2xhc3M9InN3YWwyLWlucHV0IiBwbGFjZWhvbGRlcj0iU2VnbWVudCAvIEV0aWtldCIgdmFsdWU9IiR7ZXNjYXBlSHRtbChvLnNlZ21lbnR8fCcnKX0iPgogICAgICAgICAgPHRleHRhcmVhIGlkPSJ0by1kZXNjIiBjbGFzcz0ic3dhbDItdGV4dGFyZWEiIHBsYWNlaG9sZGVyPSJBw6fEsWtsYW1hIj4ke2VzY2FwZUh0bWwoby5kZXNjfHwnJyl9PC90ZXh0YXJlYT4KICAgICAgICAgIDx0ZXh0YXJlYSBpZD0idG8tZGV0YWlsIiBjbGFzcz0ic3dhbDItdGV4dGFyZWEiIHBsYWNlaG9sZGVyPSJEZXRheSI+JHtlc2NhcGVIdG1sKG8uZGV0YWlsfHwnJyl9PC90ZXh0YXJlYT4KICAgICAgICBgLAogICAgICAgIHNob3dDYW5jZWxCdXR0b246dHJ1ZSwKICAgICAgICBjb25maXJtQnV0dG9uVGV4dDoiS2F5ZGV0IiwKICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiJWYXpnZcOnIiwKICAgICAgICBwcmVDb25maXJtOiAoKT0+ewogICAgICAgICAgICBjb25zdCB0aXRsZT0oZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvLXRpdGxlJykudmFsdWV8fCcnKS50cmltKCk7CiAgICAgICAgICAgIGlmKCF0aXRsZSkgcmV0dXJuIFN3YWwuc2hvd1ZhbGlkYXRpb25NZXNzYWdlKCJCYcWfbMSxayB6b3J1bmx1Iik7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICB0aXRsZSwKICAgICAgICAgICAgICAgIHNlZ21lbnQ6KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0by1zZWcnKS52YWx1ZXx8JycpLnRyaW0oKSwKICAgICAgICAgICAgICAgIGRlc2M6KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0by1kZXNjJykudmFsdWV8fCcnKS50cmltKCksCiAgICAgICAgICAgICAgICBkZXRhaWw6KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0by1kZXRhaWwnKS52YWx1ZXx8JycpLnRyaW0oKSwKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICB9KTsKICAgIGlmKCF2KSByZXR1cm47CgogICAgU3dhbC5maXJlKHsgdGl0bGU6J0theWRlZGlsaXlvci4uLicsIGRpZE9wZW46KCk9PlN3YWwuc2hvd0xvYWRpbmcoKSwgc2hvd0NvbmZpcm1CdXR0b246ZmFsc2UgfSk7CiAgICB0cnl7CiAgICAgIGNvbnN0IHIgPSBhd2FpdCBmZXRjaChTQ1JJUFRfVVJMLCB7CiAgICAgICAgbWV0aG9kOidQT1NUJywKICAgICAgICBoZWFkZXJzOnsnQ29udGVudC1UeXBlJzondGV4dC9wbGFpbjtjaGFyc2V0PXV0Zi04J30sCiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBhY3Rpb246J3Vwc2VydFRlbGVzYWxlc09mZmVyJywgdXNlcm5hbWU6IGN1cnJlbnRVc2VyLCB0b2tlbjogZ2V0VG9rZW4oKSwga2V5VGl0bGU6IG8udGl0bGUsIGtleVNlZ21lbnQ6IG8uc2VnbWVudCwgLi4udiB9KQogICAgICB9KTsKICAgICAgY29uc3QgZCA9IGF3YWl0IHIuanNvbigpOwogICAgICBpZihkLnJlc3VsdD09PSdzdWNjZXNzJyl7CiAgICAgICAgU3dhbC5maXJlKHsgaWNvbjonc3VjY2VzcycsIHRpdGxlOidLYXlkZWRpbGRpJywgdGltZXI6MTIwMCwgc2hvd0NvbmZpcm1CdXR0b246ZmFsc2UgfSk7CiAgICAgICAgYXdhaXQgZmV0Y2hTaGVldE9iamVjdHMoKTsKICAgICAgICByZW5kZXJUZWxlc2FsZXNEYXRhT2ZmZXJzKCk7CiAgICAgIH1lbHNlewogICAgICAgIFN3YWwuZmlyZSgnSGF0YScsIGQubWVzc2FnZXx8J0theWRlZGlsZW1lZGknLCAnZXJyb3InKTsKICAgICAgfQogICAgfWNhdGNoKGUpewogICAgICBTd2FsLmZpcmUoJ0hhdGEnLCdTdW51Y3UgaGF0YXPEsS4nLCAnZXJyb3InKTsKICAgIH0KfQoKZnVuY3Rpb24gZGVsZXRlVGVsZXNhbGVzT2ZmZXIoaWR4KXsKICAgIGNvbnN0IG8gPSAodGVsZXNhbGVzT2ZmZXJzfHxbXSlbaWR4XTsKICAgIGlmKCFvKSByZXR1cm47CiAgICBTd2FsLmZpcmUoewogICAgICAgIHRpdGxlOiJTaWxpbnNpbiBtaT8iLAogICAgICAgIHRleHQ6IlRla2xpZiBwYXNpZmUgYWzEsW5hY2FrLiIsCiAgICAgICAgaWNvbjoid2FybmluZyIsCiAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjp0cnVlLAogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiJTaWwiLAogICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IlZhemdlw6ciCiAgICB9KS50aGVuKGFzeW5jIHJlcz0+ewogICAgICAgIGlmKCFyZXMuaXNDb25maXJtZWQpIHJldHVybjsKICAgICAgICB0cnl7CiAgICAgICAgICBjb25zdCByID0gYXdhaXQgZmV0Y2goU0NSSVBUX1VSTCwgewogICAgICAgICAgICBtZXRob2Q6J1BPU1QnLAogICAgICAgICAgICBoZWFkZXJzOnsnQ29udGVudC1UeXBlJzondGV4dC9wbGFpbjtjaGFyc2V0PXV0Zi04J30sCiAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgYWN0aW9uOidkZWxldGVUZWxlc2FsZXNPZmZlcicsIHVzZXJuYW1lOiBjdXJyZW50VXNlciwgdG9rZW46IGdldFRva2VuKCksIGtleVRpdGxlOiBvLnRpdGxlLCBrZXlTZWdtZW50OiBvLnNlZ21lbnQgfSkKICAgICAgICAgIH0pOwogICAgICAgICAgY29uc3QgZCA9IGF3YWl0IHIuanNvbigpOwogICAgICAgICAgaWYoZC5yZXN1bHQ9PT0nc3VjY2VzcycpewogICAgICAgICAgICBhd2FpdCBmZXRjaFNoZWV0T2JqZWN0cygpOwogICAgICAgICAgICByZW5kZXJUZWxlc2FsZXNEYXRhT2ZmZXJzKCk7CiAgICAgICAgICAgIFN3YWwuZmlyZSh7IGljb246J3N1Y2Nlc3MnLCB0aXRsZTonU2lsaW5kaScsIHRpbWVyOjEwMDAsIHNob3dDb25maXJtQnV0dG9uOmZhbHNlIH0pOwogICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgIFN3YWwuZmlyZSgnSGF0YScsIGQubWVzc2FnZXx8J1NpbGluZW1lZGknLCAnZXJyb3InKTsKICAgICAgICAgIH0KICAgICAgICB9Y2F0Y2goZSl7CiAgICAgICAgICBTd2FsLmZpcmUoJ0hhdGEnLCdTdW51Y3UgaGF0YXPEsS4nLCAnZXJyb3InKTsKICAgICAgICB9CiAgICB9KTsKfQoKZnVuY3Rpb24gc2hvd1RlbGVzYWxlc09mZmVyRGV0YWlsKGlkeCl7CiAgICBjb25zdCBvID0gKHRlbGVzYWxlc09mZmVyc3x8W10pW2lkeF07CiAgICBpZighbykgcmV0dXJuOwogICAgU3dhbC5maXJlKHsKICAgICAgICB0aXRsZTogYDxpIGNsYXNzPSJmYXMgZmEtZGF0YWJhc2UiIHN0eWxlPSJjb2xvcjojMGUxYjQyIj48L2k+ICR7ZXNjYXBlSHRtbChvLnRpdGxlfHwnJyl9YCwKICAgICAgICBodG1sOiBgPGRpdiBzdHlsZT0idGV4dC1hbGlnbjpsZWZ0O2xpbmUtaGVpZ2h0OjEuNiI+CiAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJtYXJnaW4tYm90dG9tOjEwcHgiPjxiPlNlZ21lbnQ6PC9iPiAke2VzY2FwZUh0bWwoby5zZWdtZW50fHwnLScpfTwvZGl2PgogICAgICAgICAgICAgICAgPGRpdj4ke2VzY2FwZUh0bWwoby5kZXNjfHwnRGV0YXkgeW9rLicpLnJlcGxhY2UoL1xuL2csJzxicj4nKX08L2Rpdj4KICAgICAgICAgICAgICA8L2Rpdj5gLAogICAgICAgIHNob3dDbG9zZUJ1dHRvbjp0cnVlLAogICAgICAgIHNob3dDb25maXJtQnV0dG9uOmZhbHNlLAogICAgICAgIHdpZHRoOic3MjBweCcsCiAgICAgICAgYmFja2dyb3VuZDonI2Y4ZjlmYScKICAgIH0pOwp9CgpmdW5jdGlvbiByZW5kZXJUZWxlc2FsZXNTY3JpcHRzKCl7CiAgICBjb25zdCBhcmVhID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Qtc2NyaXB0cy1ncmlkJyk7CiAgICBpZighYXJlYSkgcmV0dXJuOwoKICAgIGxldCBsaXN0ID0gKHNhbGVzU2NyaXB0c3x8W10pOwogICAgdHJ5ewogICAgICAgIGNvbnN0IG92ID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgndGVsZXNhbGVzU2NyaXB0c092ZXJyaWRlJykgfHwgJ1tdJyk7CiAgICAgICAgaWYoQXJyYXkuaXNBcnJheShvdikgJiYgb3YubGVuZ3RoKSBsaXN0ID0gb3Y7CiAgICB9Y2F0Y2goZSl7fQoKICAgIC8vIMSwc3RlazogVGVsZVNhdMSxxZ8gU2NyaXB0bGVyJ2Rla2kgYXlyxLEgIkTDvHplbmxlbWV5aSBBw6ciIGthbGtzxLFuLgogICAgLy8gRMO8emVubGVtZSBzYWRlY2Ugw7xzdCBrdWxsYW7EsWPEsSBtZW7DvHPDvG5kZWtpIGdsb2JhbCAiRMO8emVubGVtZXlpIEHDpyIgYWt0aWZrZW4geWFwxLFsYWJpbHNpbi4KICAgIGNvbnN0IGJhciA9IChpc0FkbWluTW9kZSAmJiBpc0VkaXRpbmdBY3RpdmUpID8gYAogICAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDtnYXA6MTBweDthbGlnbi1pdGVtczpjZW50ZXI7bWFyZ2luOjZweCAwIDEycHg7Ij4KICAgICAgICAgIDxidXR0b24gY2xhc3M9IngtYnRuIHgtYnRuLWFkbWluIiBvbmNsaWNrPSJhZGRUZWxlc2FsZXNTY3JpcHQoKSI+PGkgY2xhc3M9ImZhcyBmYS1wbHVzIj48L2k+IFNjcmlwdCBFa2xlPC9idXR0b24+CiAgICAgICAgPC9kaXY+CiAgICBgIDogJyc7CgogICAgaWYobGlzdC5sZW5ndGg9PT0wKXsKICAgICAgICBhcmVhLmlubmVySFRNTCA9IGJhciArICc8ZGl2IHN0eWxlPSJwYWRkaW5nOjE2cHg7b3BhY2l0eTouNyI+U2NyaXB0IGJ1bHVuYW1hZMSxLjwvZGl2Pic7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGFyZWEuaW5uZXJIVE1MID0gYmFyICsgbGlzdC5tYXAoKHMsIGkpPT5gCiAgICAgIDxkaXYgY2xhc3M9Im5ld3MtaXRlbSIgc3R5bGU9ImJvcmRlci1sZWZ0LWNvbG9yOiMxMGI5ODE7Y3Vyc29yOnBvaW50ZXIiIG9uY2xpY2s9ImNvcHlUZXh0KCcke2VzY2FwZUZvckpzU3RyaW5nKHMudGV4dHx8JycpfScpIj4KICAgICAgICA8c3BhbiBjbGFzcz0ibmV3cy10aXRsZSI+JHtlc2NhcGVIdG1sKHMudGl0bGV8fCdTY3JpcHQnKX08L3NwYW4+CiAgICAgICAgPGRpdiBjbGFzcz0ibmV3cy1kZXNjIiBzdHlsZT0id2hpdGUtc3BhY2U6cHJlLWxpbmUiPiR7ZXNjYXBlSHRtbChzLnRleHR8fCcnKX08L2Rpdj4KICAgICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7Z2FwOjEwcHg7YWxpZ24taXRlbXM6Y2VudGVyO2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuO21hcmdpbi10b3A6MTBweCI+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJuZXdzLXRhZyIgc3R5bGU9ImJhY2tncm91bmQ6cmdiYSgxNiwxODUsMTI5LC4wOCk7Y29sb3I6IzEwYjk4MTtib3JkZXI6MXB4IHNvbGlkIHJnYmEoMTYsMTg1LDEyOSwuMjUpIj5UxLFrbGEgJiBLb3B5YWxhPC9kaXY+CiAgICAgICAgICAkeyhpc0FkbWluTW9kZSAmJiBpc0VkaXRpbmdBY3RpdmUpID8gYAogICAgICAgICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7Z2FwOjhweCI+CiAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0ieC1idG4geC1idG4tYWRtaW4iIG9uY2xpY2s9ImV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOyBlZGl0VGVsZXNhbGVzU2NyaXB0KCR7aX0pOyI+PGkgY2xhc3M9ImZhcyBmYS1wZW4iPjwvaT48L2J1dHRvbj4KICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJ4LWJ0biB4LWJ0bi1hZG1pbiIgb25jbGljaz0iZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7IGRlbGV0ZVRlbGVzYWxlc1NjcmlwdCgke2l9KTsiPjxpIGNsYXNzPSJmYXMgZmEtdHJhc2giPjwvaT48L2J1dHRvbj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICBgIDogYGB9CiAgICAgICAgPC9kaXY+CiAgICAgIDwvZGl2PgogICAgYCkuam9pbignJyk7Cn0KCmZ1bmN0aW9uIGdldFRlbGVzYWxlc1NjcmlwdHNTdG9yZSgpewogICAgdHJ5ewogICAgICAgIGNvbnN0IG92ID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgndGVsZXNhbGVzU2NyaXB0c092ZXJyaWRlJykgfHwgJ1tdJyk7CiAgICAgICAgaWYoQXJyYXkuaXNBcnJheShvdikgJiYgb3YubGVuZ3RoKSByZXR1cm4gb3Y7CiAgICB9Y2F0Y2goZSl7fQogICAgcmV0dXJuIChzYWxlc1NjcmlwdHN8fFtdKTsKfQpmdW5jdGlvbiBzYXZlVGVsZXNhbGVzU2NyaXB0c1N0b3JlKGFycil7CiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgndGVsZXNhbGVzU2NyaXB0c092ZXJyaWRlJywgSlNPTi5zdHJpbmdpZnkoYXJyfHxbXSkpOwp9CgpmdW5jdGlvbiBhZGRUZWxlc2FsZXNTY3JpcHQoKXsKICAgIFN3YWwuZmlyZSh7CiAgICAgICAgdGl0bGU6IlNjcmlwdCBFa2xlIiwKICAgICAgICBodG1sOiBgCiAgICAgICAgICA8aW5wdXQgaWQ9InRzLXRpdGxlIiBjbGFzcz0ic3dhbDItaW5wdXQiIHBsYWNlaG9sZGVyPSJCYcWfbMSxayI+CiAgICAgICAgICA8dGV4dGFyZWEgaWQ9InRzLXRleHQiIGNsYXNzPSJzd2FsMi10ZXh0YXJlYSIgcGxhY2Vob2xkZXI9IlNjcmlwdCBtZXRuaSI+PC90ZXh0YXJlYT4KICAgICAgICBgLAogICAgICAgIHNob3dDYW5jZWxCdXR0b246dHJ1ZSwKICAgICAgICBjb25maXJtQnV0dG9uVGV4dDoiRWtsZSIsCiAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDoiVmF6Z2XDpyIsCiAgICAgICAgcHJlQ29uZmlybTogKCk9PnsKICAgICAgICAgICAgY29uc3QgdGl0bGU9KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0cy10aXRsZScpLnZhbHVlfHwnJykudHJpbSgpOwogICAgICAgICAgICBjb25zdCB0ZXh0PShkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndHMtdGV4dCcpLnZhbHVlfHwnJykudHJpbSgpOwogICAgICAgICAgICBpZighdGV4dCkgcmV0dXJuIFN3YWwuc2hvd1ZhbGlkYXRpb25NZXNzYWdlKCJTY3JpcHQgbWV0bmkgem9ydW5sdSIpOwogICAgICAgICAgICByZXR1cm4geyBpZDonbG9jYWxfJytEYXRlLm5vdygpLCB0aXRsZTogdGl0bGV8fCdTY3JpcHQnLCB0ZXh0IH07CiAgICAgICAgfQogICAgfSkudGhlbihyZXM9PnsKICAgICAgICBpZighcmVzLmlzQ29uZmlybWVkKSByZXR1cm47CiAgICAgICAgY29uc3QgYXJyID0gZ2V0VGVsZXNhbGVzU2NyaXB0c1N0b3JlKCk7CiAgICAgICAgYXJyLnVuc2hpZnQocmVzLnZhbHVlKTsKICAgICAgICBzYXZlVGVsZXNhbGVzU2NyaXB0c1N0b3JlKGFycik7CiAgICAgICAgLy8gbcO8bWvDvG5zZSBzaGVldCdlIGRlIHlhegogICAgICAgIHN5bmNUZWxlc2FsZXNTY3JpcHRzVG9TaGVldChhcnIpOwogICAgICAgIHJlbmRlclRlbGVzYWxlc1NjcmlwdHMoKTsKICAgIH0pOwp9CgpmdW5jdGlvbiBlZGl0VGVsZXNhbGVzU2NyaXB0KGlkeCl7CiAgICBjb25zdCBhcnIgPSBnZXRUZWxlc2FsZXNTY3JpcHRzU3RvcmUoKTsKICAgIGNvbnN0IHMgPSBhcnJbaWR4XTsKICAgIGlmKCFzKSByZXR1cm47CiAgICBTd2FsLmZpcmUoewogICAgICAgIHRpdGxlOiJTY3JpcHQgRMO8emVubGUiLAogICAgICAgIGh0bWw6IGAKICAgICAgICAgIDxpbnB1dCBpZD0idHMtdGl0bGUiIGNsYXNzPSJzd2FsMi1pbnB1dCIgcGxhY2Vob2xkZXI9IkJhxZ9sxLFrIiB2YWx1ZT0iJHtlc2NhcGVIdG1sKHMudGl0bGV8fCcnKX0iPgogICAgICAgICAgPHRleHRhcmVhIGlkPSJ0cy10ZXh0IiBjbGFzcz0ic3dhbDItdGV4dGFyZWEiIHBsYWNlaG9sZGVyPSJTY3JpcHQgbWV0bmkiPiR7ZXNjYXBlSHRtbChzLnRleHR8fCcnKX08L3RleHRhcmVhPgogICAgICAgIGAsCiAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjp0cnVlLAogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiJLYXlkZXQiLAogICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IlZhemdlw6ciLAogICAgICAgIHByZUNvbmZpcm06ICgpPT57CiAgICAgICAgICAgIGNvbnN0IHRpdGxlPShkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndHMtdGl0bGUnKS52YWx1ZXx8JycpLnRyaW0oKTsKICAgICAgICAgICAgY29uc3QgdGV4dD0oZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RzLXRleHQnKS52YWx1ZXx8JycpLnRyaW0oKTsKICAgICAgICAgICAgaWYoIXRleHQpIHJldHVybiBTd2FsLnNob3dWYWxpZGF0aW9uTWVzc2FnZSgiU2NyaXB0IG1ldG5pIHpvcnVubHUiKTsKICAgICAgICAgICAgcmV0dXJuIHsgLi4ucywgdGl0bGU6IHRpdGxlfHwnU2NyaXB0JywgdGV4dCB9OwogICAgICAgIH0KICAgIH0pLnRoZW4ocmVzPT57CiAgICAgICAgaWYoIXJlcy5pc0NvbmZpcm1lZCkgcmV0dXJuOwogICAgICAgIGFycltpZHhdPXJlcy52YWx1ZTsKICAgICAgICBzYXZlVGVsZXNhbGVzU2NyaXB0c1N0b3JlKGFycik7CiAgICAgICAgc3luY1RlbGVzYWxlc1NjcmlwdHNUb1NoZWV0KGFycik7CiAgICAgICAgcmVuZGVyVGVsZXNhbGVzU2NyaXB0cygpOwogICAgfSk7Cn0KZnVuY3Rpb24gZGVsZXRlVGVsZXNhbGVzU2NyaXB0KGlkeCl7CiAgICBTd2FsLmZpcmUoe3RpdGxlOiJTaWxpbnNpbiBtaT8iLCBpY29uOiJ3YXJuaW5nIiwgc2hvd0NhbmNlbEJ1dHRvbjp0cnVlLCBjb25maXJtQnV0dG9uVGV4dDoiU2lsIiwgY2FuY2VsQnV0dG9uVGV4dDoiVmF6Z2XDpyJ9KS50aGVuKHJlcz0+ewogICAgICAgIGlmKCFyZXMuaXNDb25maXJtZWQpIHJldHVybjsKICAgICAgICBjb25zdCBhcnIgPSBnZXRUZWxlc2FsZXNTY3JpcHRzU3RvcmUoKS5maWx0ZXIoKF8saSk9PmkhPT1pZHgpOwogICAgICAgIHNhdmVUZWxlc2FsZXNTY3JpcHRzU3RvcmUoYXJyKTsKICAgICAgICBzeW5jVGVsZXNhbGVzU2NyaXB0c1RvU2hlZXQoYXJyKTsKICAgICAgICByZW5kZXJUZWxlc2FsZXNTY3JpcHRzKCk7CiAgICB9KTsKfQoKZnVuY3Rpb24gcmVuZGVyVGVsZXNhbGVzRG9jcygpewogICAgY29uc3QgYm94ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3QtZG9jcycpOwogICAgaWYoIWJveCkgcmV0dXJuOwogICAgY29uc3QgZG9jcyA9ICh0cmFpbmluZ0RhdGF8fFtdKS5maWx0ZXIodD0+KHQudGFyZ2V0fHwnJyk9PT0nVGVsZXNhdMSxxZ8nIHx8ICh0LnRpdGxlfHwnJykudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygndGVsZXNhdMSxxZ8nKSk7CiAgICBpZihkb2NzLmxlbmd0aD09PTApewogICAgICAgIGJveC5pbm5lckhUTUwgPSAnPGRpdiBzdHlsZT0ib3BhY2l0eTouNztwYWRkaW5nOjEwcHgiPkJ1IGVraWJlIGF0YW5txLHFnyBkw7Zrw7xtYW4vZcSfaXRpbSBnw7Zyw7xubcO8eW9yLjwvZGl2Pic7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgYm94LmlubmVySFRNTCA9IGRvY3MubWFwKGQ9PmAKICAgICAgPGRpdiBjbGFzcz0ibmV3cy1pdGVtIiBzdHlsZT0iYm9yZGVyLWxlZnQtY29sb3I6dmFyKC0tc2Vjb25kYXJ5KSI+CiAgICAgICAgPHNwYW4gY2xhc3M9Im5ld3MtZGF0ZSI+JHtlc2NhcGVIdG1sKChkLnN0YXJ0RGF0ZXx8JycpICsgKGQuZW5kRGF0ZT8oJyDihpIgJytkLmVuZERhdGUpOicnKSl9PC9zcGFuPgogICAgICAgIDxzcGFuIGNsYXNzPSJuZXdzLXRpdGxlIj4ke2VzY2FwZUh0bWwoZC50aXRsZXx8JycpfTwvc3Bhbj4KICAgICAgICA8ZGl2IGNsYXNzPSJuZXdzLWRlc2MiPiR7ZXNjYXBlSHRtbChkLmRlc2N8fCcnKX08L2Rpdj4KICAgICAgICAke2QubGluayAmJiBkLmxpbmshPT0nTi9BJyA/IGA8YSBjbGFzcz0iYnRuIGJ0bi1saW5rIiBocmVmPSIke2VzY2FwZUh0bWwoZC5saW5rKX0iIHRhcmdldD0iX2JsYW5rIj5MaW5rPC9hPmA6Jyd9CiAgICAgICAgJHtkLmRvY0xpbmsgJiYgZC5kb2NMaW5rIT09J04vQScgPyBgPGEgY2xhc3M9ImJ0biBidG4tbGluayIgaHJlZj0iJHtlc2NhcGVIdG1sKGQuZG9jTGluayl9IiB0YXJnZXQ9Il9ibGFuayI+RMO2a8O8bWFuPC9hPmA6Jyd9CiAgICAgIDwvZGl2PgogICAgYCkuam9pbignJyk7Cn0KCi8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgVEVLTsSwSyBGVUxMU0NSRUVOCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8KYXN5bmMgZnVuY3Rpb24gb3BlblRlY2hBcmVhKHRhYil7CiAgICBjb25zdCB3cmFwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RlY2gtZnVsbHNjcmVlbicpOwogICAgaWYoIXdyYXApIHJldHVybjsKICAgIHdyYXAuc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsKICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmFkZCgnZnMtb3BlbicpOwogICAgZG9jdW1lbnQuYm9keS5zdHlsZS5vdmVyZmxvdz0naGlkZGVuJzsKCiAgICAvLyBTaWRlYmFyIHByb2ZpbAogICAgY29uc3QgYXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgneC1zaWRlLWF2YXRhcicpOwogICAgY29uc3Qgbm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgneC1zaWRlLW5hbWUnKTsKICAgIGNvbnN0IHJsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3gtc2lkZS1yb2xlJyk7CiAgICBpZihhdikgYXYuaW5uZXJUZXh0ID0gKGN1cnJlbnRVc2VyfHwnVScpLnRyaW0oKS5zbGljZSgwLDEpLnRvVXBwZXJDYXNlKCk7CiAgICBpZihubSkgbm0uaW5uZXJUZXh0ID0gY3VycmVudFVzZXIgfHwgJ0t1bGxhbsSxY8SxJzsKICAgIGlmKHJsKSBybC5pbm5lclRleHQgPSBpc0FkbWluTW9kZSA/ICdBZG1pbicgOiAnVGVtc2lsY2knOwoKICAgIC8vIMSwbGsgYcOnxLFsxLHFn3RhICJib3p1ayBnw7Zyw7xuw7xtIiAoZmxpY2tlcikgb2xtYXPEsW46IHZlcmkgZ2VsZW5lIGthZGFyIGJla2xlCiAgICB0cnl7CiAgICAgICAgaWYoKCFkYXRhYmFzZSB8fCBkYXRhYmFzZS5sZW5ndGg9PT0wKSAmJiB3aW5kb3cuX19kYXRhTG9hZGVkUHJvbWlzZSl7CiAgICAgICAgICAgIGNvbnN0IGxpc3RzID0gWyd4LWJyb2FkY2FzdC1saXN0JywneC1hY2Nlc3MtbGlzdCcsJ3gtYXBwLWxpc3QnLCd4LWFjdGl2YXRpb24tbGlzdCcsJ3gtY2FyZHMnXTsKICAgICAgICAgICAgbGlzdHMuZm9yRWFjaChpZD0+eyBjb25zdCBlbD1kb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7IGlmKGVsKSBlbC5pbm5lckhUTUwgPSAnPGRpdiBjbGFzcz0iaG9tZS1taW5pLWl0ZW0iPlnDvGtsZW5peW9yLi4uPC9kaXY+JzsgfSk7CiAgICAgICAgICAgIGF3YWl0IHdpbmRvdy5fX2RhdGFMb2FkZWRQcm9taXNlOwogICAgICAgIH0KICAgIH1jYXRjaChlKXt9CgogICAgLy8gxLDDp2VyaWtsZXJpIChidWNrZXQvbGlzdCkgaGF6xLFybGEKICAgIHRyeXsgcmVuZGVyVGVjaFNlY3Rpb25zKCk7IH1jYXRjaChlKXt9CgogICAgLy8gU2VrbWV5aSBhw6cKICAgIHN3aXRjaFRlY2hUYWIodGFiIHx8ICdicm9hZGNhc3QnKTsKfQoKZnVuY3Rpb24gY2xvc2VGdWxsVGVjaCgpewogICAgY29uc3Qgd3JhcCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0ZWNoLWZ1bGxzY3JlZW4nKTsKICAgIGlmKHdyYXApIHdyYXAuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnJlbW92ZSgnZnMtb3BlbicpOwogICAgZG9jdW1lbnQuYm9keS5zdHlsZS5vdmVyZmxvdz0nJzsKfQoKZnVuY3Rpb24gc3dpdGNoVGVjaFRhYih0YWIpewogICAgLy8gU2lkZWJhciBha3RpZiDDtsSfZXlpIGRvxJ9ydSBiZWxpcmxlCiAgICAvLyAow7ZuY2UgZGF0YS10ZWNoLXRhYiBrdWxsYW4sIHlva3NhIG9uY2xpY2sgacOnZXJpxJ9pIGlsZSBmYWxsYmFjayB5YXApCiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcjdGVjaC1mdWxsc2NyZWVuIC5xLW5hdi1pdGVtJykuZm9yRWFjaChpPT5pLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpKTsKCiAgICBjb25zdCBieURhdGEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjdGVjaC1mdWxsc2NyZWVuIC5xLW5hdi1pdGVtW2RhdGEtdGVjaC10YWI9IiR7dGFifSJdYCk7CiAgICBpZihieURhdGEpewogICAgICAgIGJ5RGF0YS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgIH1lbHNlewogICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJyN0ZWNoLWZ1bGxzY3JlZW4gLnEtbmF2LWl0ZW0nKS5mb3JFYWNoKGk9PnsKICAgICAgICAgICAgY29uc3Qgb2MgPSAoaS5nZXRBdHRyaWJ1dGUoJ29uY2xpY2snKSB8fCAnJyk7CiAgICAgICAgICAgIGlmKG9jLmluY2x1ZGVzKGAnJHt0YWJ9J2ApIHx8IG9jLmluY2x1ZGVzKGBcIiR7dGFifVwiYCkpIGkuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgICAgICAgfSk7CiAgICB9CgogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnI3RlY2gtZnVsbHNjcmVlbiAucS12aWV3LXNlY3Rpb24nKS5mb3JFYWNoKHM9PnMuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJykpOwogICAgY29uc3QgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgeC12aWV3LSR7dGFifWApOwogICAgaWYoZWwpIGVsLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwp9Cgpjb25zdCBURUNIX0RPQ19DT05URU5UID0geyJicm9hZGNhc3QiOiBbeyJ0aXRsZSI6ICJTbWFydCBUViDigJMgQ2FubMSxIFlhecSxbmRhIERvbm1hIFByb2JsZW1pIFlhxZ/EsXlvcnVtIiwgImJvZHkiOiAiTcO8xZ90ZXJpbmluIHNvcnVuIHlhxZ9hZMSxxJ/EsSB5YXnEsW4geWEgZGEgeWF5xLFubGFyZGEgZ2VuZWwgYmlyIHNvcnVuIHZhciBtxLEga29udHJvbCBlZGlsaXI/IEdlbmVsIGJpciBzb3J1biB2YXIgaXNlIHRla25payBla2liaW4gaW5jZWxlZGnEn2kgecO2bsO8bmRlIGJpbGdpIHZlcmlsaXIuXG5Nw7zFn3RlcmluaW4ga3VsbGFuZMSxxJ/EsSBjaWhheiBUVm1hbmFnZXIg4oCYZGEgbG9nbGFyZGFuIGtvbnRyb2wgZWRpbGlyLiBBcsOnZWxpay9CZWtvL0dydW5kaWcvQWx0dXMgbWFya2EgQW5kcm9pZCBUViBvbG1heWFuIFNtYXJ0IFRW4oCZbGVyZGVuIGlzZSBnZW5lbCBzb3J1biBoYWtrxLFuZGEgYmlsZ2kgdmVyaWxpci5cbll1a2FyxLFkYWtpIGR1cnVtbGFyIGTEscWfxLFuZGEgeWHFn2FuYW4gYmlyIHNvcnVuIGlzZSBUViB2ZSBtb2RlbWluIGVsZWt0cmlrIGJhxJ9sYW50xLFzxLFuxLEga2VzaWxpcCB0ZWtyYXIgdmVyaWxtZXNpIGlzdGVuaXIuIMKrIFlhxZ9hZMSxxJ/EsW7EsXogc29ydW51IGtvbnRyb2wgZWRlcmtlbiBUViB2ZSBtb2RlbWluaXppbiBlbGVrdHJpayBiYcSfbGFudMSxc8SxbsSxIGtlc2lwIDEwIHNuIHNvbnJhIHllbmlkZW4gYcOnYWJpbGlyIG1pc2luaXo/IEFyZMSxbmRhbiB5ZW5pZGVuIHlhecSxbsSxIGHDp8SxcCBrb250cm9sIGVkZWJpbGlyIG1pc2luaXo/IChBeXLEsWNhIMO2bmVyaSBvbGFyYWsgbW9kZW1pIGthcGF0xLFwIHRla3JhciBhw6d0xLFrdGFuIHNvbnJhLCBzYWRlY2UgaXpsZW1lIHlhcHTEscSfxLEgY2loYXogbW9kZW1lIGJhxJ9sxLEgb2x1cnNhIGRhaGEgaXlpIGJpciBiYcSfbGFudMSxIG9sYWNhxJ/EsSBiaWxnaXNpIHZlcmlsZWJpbGlyKVxuU29ydW4gZGV2YW0gZWRlciBpc2UgU21hcnQgVFYgdGFyYXnEsWPEsXPEsW5kYW4gaHR0cHM6Ly93d3cuaGl6dGVzdGkuY29tLnRyLyBiaXIgaMSxeiB0ZXN0aSB5YXBtYXPEsSBzb251Y3UgYml6aW1sZSBwYXlsYcWfbWFzxLEgaXN0ZW5pci5cbkjEsXogdGVzdGkgc29udWN1IDggTWJwcyBhbHTEsW5kYSBpc2UgaW50ZXJuZXQgYmHEn2xhbnTEsSBoxLF6xLFuxLFuIGTDvMWfw7xrIG9sZHXEn3VudSBpbnRlcm5ldCBzZXJ2aXMgc2HEn2xhecSxY8Sxc8SxIGlsZXRpxZ9pbWUgZ2XDp21lc2kgaXN0ZW5pci5cbjggTWJwcyDDvHplcmluZGUgaXNlIG3DvMWfdGVyaWRlbiBzb3J1bnUgZ8O2c3RlcmVuIGvEsXNhIGJpciB2aWRlbyB0YWxlcCBlZGlsaXIuXG5WaWRlbyBrYXlkxLEgdmUgaMSxeiB0ZXN0aW5pbiBzb251w6dsYXLEsSBnw7ZzdGVyZW4gYmlsZ2lsZXIgYWzEsW5kxLFrdGFuIHNvbnJhIG3DvMWfdGVyaXllIGluY2VsZW5tZXNpIGnDp2luIHRla25payBla2liaW1pemUgaWxldGlsZGnEn2kgaW5jZWxlbWUgdGFtYW1sYW5kxLHEn8SxbmRhIGVwb3N0YSBpbGUgYmlsZ2kgdmVyaWxlY2XEn2kgecO2bsO8bmRlIGJpbGdpIHZlcmlsaXIuXG5Tb3J1biBheW7EsSBnw7xuIGnDp2luZGUgYmVuemVyIGNpaGF6bGFyZGEgZmFya2zEsSBtw7zFn3RlcmlsZXJkZSB5YcWfxLF5b3IgaXNlIHTDvG0gYmlsZ2lsZXJsZSBFcmxhYuKAmWEgYXLEsXphIGtheWTEsSBhw6fEsWzEsXIuIFNvcnVuIGJpcmthw6cgbcO8xZ90ZXJpIGlsZSBzxLFuxLFybMSxIGlzZSAxNzowMCDigJMgMDE6MDAgdmFyZGl5YXPEsW5kYWtpIGVraXAgYXJrYWRhxZ/EsW5kYSBzaXN0ZW1zZWwgYmlyIHNvcnVuIG9sbWFkxLHEn8SxbmEgZGFpciBlcG9zdGEgZ8O2bmRlcmlsbWVzaSBpw6dpbiBiaWxnaWxlcmkgcGF5bGHFn8SxbMSxci4ifSwgeyJ0aXRsZSI6ICJNb2JpbCBVeWd1bGFtYSDigJMgQ2FubMSxIFlhecSxbmRhIERvbm1hIFNvcnVudSBZYcWfxLF5b3J1bSIsICJib2R5IjogIk3DvMWfdGVyaW5pbiBzb3J1biB5YcWfYWTEscSfxLEgeWF5xLFuIHlhIGRhIHlhecSxbmxhcmRhIGdlbmVsIGJpciBzb3J1biB2YXIgbcSxIGtvbnRyb2wgZWRpbGlyPyBHZW5lbCBiaXIgc29ydW4gdmFyIGlzZSB0ZWtuaWsgZWtpYmluIGluY2VsZWRpxJ9pIHnDtm7DvG5kZSBiaWxnaSB2ZXJpbGlyLihNw7zFn3RlcmkgxLBPUyB2ZXlhIEFuZHJvaWQgacWfbGV0aW0gc2lzdGVtbGkgaGFuZ2kgY2loYXpkYW4gaXpsaXlvcnNhLCBtw7xta8O8bnNlIGF5bsSxIGnFn2xldGltIHNpc3RlbWxpIG1vYmlsIGNpaGF6ZGFuIGtvbnRyb2wgZWRpbGViaWxpciwgZ2VyZWtpcnNlIGVraXAgYXJrYWRhxZ9sYXLEsW5kYW4ga29udHJvbCBldG1lbGVyaSBpc3RlbmViaWxpcilcbkdlbmVsIGJpciBzb3J1biB5b2sgaXNlLCB3d3cuaGl6dGVzdGkuY29tLnRyIGxpbmsgw7x6ZXJpbmRlbiBoxLF6IHRlc3RpIHlhcG1hc8SxIHNvbnVjdSBiaXppbWxlIHBheWxhxZ9tYXPEsSBpc3RlbmlyLlxuSMSxeiB0ZXN0aSBzb251Y3UgOCBtYnBzIGFsdMSxbmRhIGlzZSBpbnRlcm5ldCBiYcSfbGFudMSxIGjEsXrEsW7EsW4gZMO8xZ/DvGsgb2xkdcSfdSBpbnRlcm5ldCBzZXJ2aXNpIHNhxJ9sYXnEsWPEsXPEsSBpbGUgaWxldGnFn2ltZSBnZcOnbWVzaSBpc3RlbmlyLiAow5ZuZXJpIG9sYXJhayBtb2RlbWkga2FwYXTEsXAgdGVrcmFyIGHDp3TEsWt0YW4gc29ucmEgc2FkZWNlIGl6bGVtZSB5YXB0xLHEn8SxIGNpaGF6IG1vZGVtZSBiYcSfbMSxIG9sdXJzYSBkYWhhIGl5aSBiaXIgYmHEn2xhbnTEsSBvbGFjYcSfxLEgYmlsZ2lzaSB2ZXJpbGViaWxpcilcbjggbWJwcyDDvHplcmluZGUgaXNlLCB1eWd1bGFtYSB2ZXJpbGVyaW4gdGVtaXpsZW5tZXNpIHZleWEgdXlndWxhbWFuxLFuIHNpbGlwIHRla3JhciB5w7xrbGVubWVzaSBpc3RlbmlsaXIsIHNvcnVuIGRldmFtIGV0bWVzaSBkdXJ1bXVuZGEgc29ydW51IGfDtnN0ZXJlbiB2aWRlbyBrYXlkxLEgaXN0ZW5pci5cbiA0LiBIxLF6IHRlc3RpLCBjaWhheiBtYXJrYSBtb2RlbCB2ZSBzw7xyw7xtIGJpbGdpbGVyaSBhbMSxbmTEsWt0YW4gc29ucmEsIGluY2VsZW5tZXNpIGnDp2luIHRla25payBla2liZSBpbGV0aWxkacSfaSwgaW5jZWxlbWUgdGFtYW1sYW5kxLHEn8SxbmRhIGUtcG9zdGEgIGlsZSBiaWxnaSB2ZXJpbGVjZcSfaSB5w7Zuw7xuZGUgYmlsZ2kgdmVyaWxpci5cbiA1LiBTb3J1biBheW7EsSBnw7xuIGnDp2VyaW5kZSBiZW56ZXIgY2loYXpsYXJkYSBmYXJrbMSxIG3DvMWfdGVyaWxlcmRlIHlhxZ/EsXlvciBpc2UgdMO8bSBiaWxnaWxlcmxlIEVybGFi4oCZYSBhcsSxemEga2F5ZMSxIGHDp8SxbMSxci4gU29ydW4gYmlya2HDpyBtw7zFn3RlcmkgaWxlIHPEsW7EsXJsxLEgIGlzZSAxNzowMCDigJMgMDE6MDAgdmFyZGl5YXPEsW5kYWtpIGVraXAgYXJrYWRhxZ/EsW5kYSBzaXN0ZW1zZWwgYmlyIHNvcnVuIG9sbWFkxLHEn8SxbmEgZGFpciBlcG9zdGEgZ8O2bmRlcmlsbWVzaSBpw6dpbiBiaWxnaWxlcmkgcGF5bGHFn8SxbMSxci4ifSwgeyJ0aXRsZSI6ICJCaWxnaXNheWFyIOKAkyBDYW5sxLEgWWF5xLFuZGEgRG9ubWEgU29ydW51IFlhxZ/EsXlvcnVtIiwgImJvZHkiOiAiTcO8xZ90ZXJpbmluIHNvcnVuIHlhxZ9hZMSxxJ/EsSB5YXnEsW4geWEgZGEgeWF5xLFubGFyZGEgZ2VuZWwgYmlyIHNvcnVuIHZhciBtxLEga29udHJvbCBlZGlsaXI/IEdlbmVsIGJpciBzb3J1biB2YXIgaXNlIHRla25payBla2liaW4gaW5jZWxlZGnEn2kgecO2bsO8bmRlIGJpbGdpIHZlcmlsaXIuXG5HZW5lbCBiaXIgc29ydW4gZGXEn2lsc2UsIMO2bmNlbGlrbGUgaHR0cHM6Ly93d3cuaGl6dGVzdGkuY29tLnRyLyBiaXIgaMSxeiB0ZXN0aSB5YXBtYXPEsSBzb251Y3UgYml6aW1sZSBwYXlsYcWfbWFzxLEgaXN0ZW5pci5cbkjEsXogdGVzdGkgc29udWN1IDggbWJwcyBhbHTEsW5kYSBpc2UgaW50ZXJuZXQgYmHEn2xhbnTEsSBoxLF6xLFuxLFuIGTDvMWfw7xrIG9sZHXEn3VudSBpbnRlcm5ldCBzZXJ2aXMgc2HEn2xhecSxY8Sxc8SxIGlsZXRpxZ9pbWUgZ2XDp21lc2kgaXN0ZW5pci5cbjggbWJwcyDDvHplcmluZGUgaXNlIG3DvMWfdGVyaWRlbiBhxZ9hxJ/EsWRha2kgYWTEsW1sYXLEsSB1eWd1bGFtYXPEsSBpc3RlbmlyLlxuMy4gQmlsZ2lzYXlhcsSxbiBpxZ9sZXRpbSBzaXRlbWkgw7bEn3JlbmlsaXAsIGfDtnLDvMWfbWUgw7x6ZXJpbmRlbiDigJjigJlwaW5nV2luZG93czfigJnigJkgdmV5YSDigJjigJlwaW5nd2luZG93czEw4oCZ4oCZIGvEsXNheW9sbGFyxLFuZGFuIG3DvMWfdGVyaSBzdW51Y3VsYXLEsSBrb250cm9sIGVkaWxpci5cbihXaW5kb3dzIDEwIMO8emVyaSBpxZ9sZXRpbSBzaXN0ZW1pIGNpaGF6bGFyYSBwaW5nd2luZG93czEwIGvEsXNheW9sdSBnw7ZuZGVyaWxlYmlsaXIuKVxuNC4gU3VudWN1IGtvbnRyb2wgZWtyYW7EsW5kYSBrb250cm9sIGVkaWxtZXNpIGdlcmVrZW4sIG9rIGlsZSBnw7ZzdGVyaWxlbiB5ZXJkZW4sIHN1bnVjdSBpbGUga2F5xLFwIG9sdXAgb2xtYWTEscSfxLEgdmUga8Sxcm3EsXrEsSBhbGFuIGnDp2VyaXNpbmRlIHN1bnVjdSBpbGUgd2ViIHNpdGVtaXplIGthw6cgc2FuaXllZGUgacWfbGVtIHNhxJ9sYWTEscSfxLEga29udHJvbCBlZGlsaXIuXG41LiAxIOKAkyAzNSBhcmFzxLEgbm9ybWFsIHNhecSxbGFiaWxpciwgYnUgc2FuaXllIGFyYWzEscSfxLFuZGEgc29ydW4geWHFn2FuxLF5b3JzYSwgd2ViIHNpdGVtaXplIGRhaGEgaMSxemzEsSB0ZXBzaSBzw7xyZXNpIHZlcmVuIHZlIGdlbmVsbGlrbGUgc29ydW5zdXogYmlyIMWfZWtpbGRlIGl6bGVtZSBzYcSfbGFuYWJpbGVuIDE5My4xOTIuMTAzLjI0OSwgMTg1LjExLjE0LjI3IHZleWEgMTk1LjE3NS4xNzguOCBzdW51Y3VsYXLEsSBrb250cm9sIGVkaWxtZWxpZGlyLlxuNi4gVXlndW4gc3VudWN1eXUgdGVzcGl0IGV0dGlrdGVuIHNvbnJhIGNhbmzEsSBkZXN0ZWsgZWtyYW7EsW5kYSDigJjigJlIb3N04oCZ4oCZIOKAmOKAmWhvc3Qy4oCZ4oCZIGvEsXNhIHlvbGxhcsSxIGt1bGxhbmFyYWssIGvEsXNhIHlvbGRha2kgYWTEsW1sYXIgaWxlIG3DvMWfdGVyaW5pbiBzYWRlY2UgYml6aW0gc2l0ZW1pemUgYmHEn2xhbmTEscSfxLEgc3VudWN1c3VudSwgZW4gdXlndW4gc3VudWN1IGlsZSBkZcSfacWfdGlyaXAgdGFyYXnEsWPEsSBhw6fEsXAga2FwYXR0xLFyZMSxa3RhbiBzb25yYSB0ZWtyYXIgeWF5xLFuxLEga29udHJvbCBldG1lc2luaSBpbGV0ZWJpbGlyaXouIChBeXLEsWNhIG3DvMWfdGVyaSB5YXnEsW5sYXLEsSBhdXRvIGRlxJ9pbCwgbWFudWVsIG9sYXJhayA3MjAgdmV5YSAxMDgwcCBzZcOnaXAga29udHJvbCBlZGlsbWVzaSDDtm5lcmlsaXIpXG43LiBTb3J1biBheW7EsSBnw7xuIGnDp2VyaW5kZSBiZW56ZXIgacWfbGV0aW0gc2lzdGVtaSB2ZXlhIHN1bnVjdWRhIGZhcmtsxLEgbcO8xZ90ZXJpbGVyZGUgeWHFn8SxeW9yIGlzZSB0w7xtIGJpbGdpbGVybGUgRXJsYWLigJlhIGFyxLF6YSBrYXlkxLEgYcOnxLFsxLFyLiBTb3J1biBiaXJrYcOnIG3DvMWfdGVyaSBpbGUgc8SxbsSxcmzEsSBpc2UgMTc6MDAg4oCTIDAxOjAwIHZhcmRpeWFzxLFuZGFraSBla2lwIGFya2FkYcWfxLFuZGEgc2lzdGVtc2VsIGJpciBzb3J1biBvbG1hZMSxxJ/EsW5hIGRhaXIgZXBvc3RhIGfDtm5kZXJpbG1lc2kgacOnaW4gYmlsZ2lsZXJpIHBheWxhxZ/EsWzEsXIifSwgeyJ0aXRsZSI6ICJZQVlJTiBTT1JVTkxBUkkiLCAiYm9keSI6ICIzNSBzbiBhcmFzxLEgbm9ybWFsIHNhecSxbGFiaWxpciwgYnUgc2FuaXllIGFyYWzEscSfxLFuZGEgc29ydW4geWHFn2FuxLF5b3JzYSwgd2ViIHNpdGVtaXplIGRhaGEgaMSxemzEsSB0ZXBzaSBzw7xyZXNpIHZlcmVuIHZlIGdlbmVsbGlrbGUgc29ydW5zdXogYmlyIMWfZWtpbGRlIGl6bGVtZSBzYcSfbGFuYWJpbGVuIDE5My4xOTIuMTAzLjI0OSwgMTg1LjExLjE0LjI3IHZleWEgMTk1LjE3NS4xNzguOCBzdW51Y3VsYXLEsSBrb250cm9sIGVkaWxtZWxpZGlyLiJ9LCB7InRpdGxlIjogIk1hY09TIOKAkyBDYW5sxLEgWWF5xLFuZGEgRG9ubWEgU29ydW51IFlhxZ/EsXlvcnVtIiwgImJvZHkiOiAiTcO8xZ90ZXJpbmluIHNvcnVuIHlhxZ9hZMSxxJ/EsSB5YXnEsW4geWEgZGEgeWF5xLFubGFyZGEgZ2VuZWwgYmlyIHNvcnVuIHZhciBtxLEga29udHJvbCBlZGlsaXI/IEdlbmVsIGJpciBzb3J1biB2YXIgaXNlIHRla25payBla2liaW4gaW5jZWxlZGnEn2kgecO2bsO8bmRlIGJpbGdpIHZlcmlsaXIuXG5HZW5lbCBiaXIgc29ydW4gZGXEn2lsc2UsIMO2bmNlbGlrbGUgaHR0cHM6Ly93d3cuaGl6dGVzdGkuY29tLnRyLyBiaXIgaMSxeiB0ZXN0aSB5YXBtYXPEsSBzb251Y3UgYml6aW1sZSBwYXlsYcWfbWFzxLEgaXN0ZW5pci5cbkjEsXogdGVzdGkgc29udWN1IDggbWJwcyBhbHTEsW5kYSBpc2UgaW50ZXJuZXQgYmHEn2xhbnTEsSBoxLF6xLFuxLFuIGTDvMWfw7xrIG9sZHXEn3VudSBpbnRlcm5ldCBzZXJ2aXMgc2HEn2xhecSxY8Sxc8SxIGlsZXRpxZ9pbWUgZ2XDp21lc2kgaXN0ZW5pci5cbjggbWJwcyDDvHplcmluZGUgaXNlIG3DvMWfdGVyaWRlbiBhxZ9hxJ/EsWRha2kgYWTEsW1sYXLEsSB1eWd1bGFtYXPEsSBpc3RlbmlyLlxuTWluZGJlaGluZCDDvHplcmluZGVuIOKAmOKAmXBpbmdtYWNPU+KAmeKAmSBrxLFzYXlvbHVuZGFuIG3DvMWfdGVyaSBzdW51Y3VsYXLEsSBrb250cm9sIGVkaWxpci5cblN1bnVjdSBrb250cm9sIGVrcmFuxLFuZGEga29udHJvbCBlZGlsbWVzaSBnZXJla2VuLCDigJjigJlwYWNrZXQgbG9zc+KAmeKAmSBrxLFzbcSxbmRhIGthecSxcCBvbHVwIG9sbWFkxLHEn8SxLCAgYWxhbiBpw6dlcmlzaW5kZSBzdW51Y3UgaWxlIHdlYiBzaXRlbWl6ZSBrYcOnIHNhbml5ZWRlIGnFn2xlbSBzYcSfbGFkxLHEn8SxIGtvbnRyb2wgZWRpbGlyLlxuMSDigJMgMzUgYXJhc8SxIG5vcm1hbCBzYXnEsWxhYmlsaXIsIGJ1IHNhbml5ZSBhcmFsxLHEn8SxbmRhIHNvcnVuIHlhxZ9hbsSxeW9yc2EsIHdlYiBzaXRlbWl6ZSBkYWhhIGjEsXpsxLEgdGVwc2kgc8O8cmVzaSB2ZXJlbiB2ZSBnZW5lbGxpa2xlIHNvcnVuc3V6IGJpciDFn2VraWxkZSBpemxlbWUgc2HEn2xhbmFiaWxlbiAxOTMuMTkyLjEwMy4yNDksIDE4NS4xMS4xNC4yNyB2ZXlhIDE5NS4xNzUuMTc4Ljggc3VudWN1bGFyxLEga29udHJvbCBlZGlsbWVsaWRpci5cblV5Z3VuIHN1bnVjdXl1IHRlc3BpdCBldHRpa3RlbiBzb25yYSBjYW5sxLEgZGVzdGVrIGVrcmFuxLFuZGEg4oCY4oCZbWFjT1Nob3N04oCZ4oCZIGvEsXNhIHlvbHVudSBrdWxsYW5hcmFrLCBrxLFzYSB5b2xkYWtpIGFkxLFtbGFyIGlsZSBtw7zFn3RlcmluaW4gc2FkZWNlIGJpemltIHNpdGVtaXplIGJhxJ9sYW5kxLHEn8SxIHN1bnVjdXl1LCBlbiB1eWd1biBzdW51Y3UgaWxlIGRlxJ9pxZ90aXJpcCB0YXJhecSxY8SxIGHDp8SxcCBrYXBhdHTEsXJkxLFrdGFuIHNvbnJhIHRla3JhciB5YXnEsW7EsSBrb250cm9sIGV0bWVzaW5pIGlsZXRlYmlsaXJpei4gKEF5csSxY2EgbcO8xZ90ZXJpIHlhecSxbmxhcsSxIGF1dG8gZGXEn2lsLCBtYW51ZWwgb2xhcmFrIDcyMCB2ZXlhIDEwODBwIHNlw6dpcCBrb250cm9sIGVkaWxtZXNpIMO2bmVyaWxpcilcblNvcnVuIGF5bsSxIGfDvG4gacOnZXJpbmRlIGJlbnplciBpxZ9sZXRpbSBzaXN0ZW1pIHZleWEgc3VudWN1ZGEgZmFya2zEsSBtw7zFn3RlcmlsZXJkZSB5YcWfxLF5b3IgaXNlIHTDvG0gYmlsZ2lsZXJsZSBFcmxhYuKAmWEgYXLEsXphIGtheWTEsSBhw6fEsWzEsXIuIFNvcnVuIGJpcmthw6cgbcO8xZ90ZXJpIGlsZSBzxLFuxLFybMSxIGlzZSAxNzowMCDigJMgMDE6MDAgdmFyZGl5YXPEsW5kYWtpIGVraXAgYXJrYWRhxZ/EsW5kYSBzaXN0ZW1zZWwgYmlyIHNvcnVuIG9sbWFkxLHEn8SxbmEgZGFpciBlcG9zdGEgZ8O2bmRlcmlsbWVzaSBpw6dpbiBiaWxnaWxlcmkgcGF5bGHFn8SxbMSxci4ifSwgeyJ0aXRsZSI6ICLigJjigJlZYXnEsW5kYSBiZWtsZW5tZWRpayBiaXIga2VzaW50aSBvbHXFn3R14oCZ4oCZIFV5YXLEsXPEsSIsICJib2R5IjogIkJ1IHV5YXLEsSBnZW5lbCBiaXIgeWF5xLFuIHNvcnVudSBvbGR1xJ91bmRhIHlhIGRhIGt1bGxhbsSxY8SxIFTDvHJraXllIHPEsW7EsXJsYXLEsSBkxLHFn8SxbmRhIGJpciB5ZXJkZW4gZXJpxZ9pbSBzYcSfbGFkxLHEn8SxbmRhIGthcsWfxLFtxLF6YSDDp8Sxa21ha3RhZMSxci5cbkt1bGxhbsSxY8SxbsSxbiBzb3J1biB5YcWfYWTEscSfxLEgeWF5xLFuIGtvbnRyb2wgZWRpbGlyIHZlIGdlbmVsIGJpciB5YXnEsW4gc29ydW51IG9sdXAgb2xtYWTEscSfxLEgdGV5aXQgZWRpbGlyLlxuVHZtYW5hZ2Vy4oCZZGEgU3Vic2NyaWJlckxvZyBla3JhbsSxbmRhbiBpcCBhZHJlc2kgYWzEsW7EsXIgdmUgeXVydGTEscWfxLEgYmlyIGtvbnVtIG9sdXAgb2xtYWTEscSfxLEgdGV5aXQgZWRpbGlyLlxuS3VsbGFuxLFjxLEgeXVydGTEscWfxLFuZGEgaXNlIGVyacWfaW0gc2HEn2xheWFtYXlhY2HEn8SxIGJpbGdpc2kgdmVyaWxpciwgVlBOIGt1bGxhbsSxeW9yIGlzZSBrYXBhdG1hc8SxIGlzdGVuaXIuXG5UVm1hbmFnZXIgRGV2aWNlcyBrxLFzbcSxbmRhIG90dXJ1bWxhciBzb25sYW5kxLFyxLFsxLFyIHZlIGt1bGxhbsSxY8SxZGFuIHRla3JhciBnaXJpxZ8geWFwYXJhayBrb250cm9sIGV0bWVzaSByaWNhIGVkaWxpci5cbk1vYmlsIHZlcmkgdmV5YSBmYXJrbMSxIGJpciBhxJ9kYSBidSBoYXRhIG1lc2FqxLFuxLFuIGFsxLFuxLFwIGFsxLFubWFkxLHEn8SxIHRleWl0IGVkaWxpci5cbkNpaGF6IHZlIG1vZGVtIGthcGFtYSB2ZSBhw6dtYSBpxZ9sZW1pIHV5Z3VsYW7EsXIuXG5Tb3J1biBkZXZhbSBlZGVyIGlzZSBpbmNlbGVtZSBpw6dpbiBjaWhheiB2ZSBkacSfZXIgYmlsZ2lsZXJsZSB0ZWtuaWsgZWtpYmltaXplIGJpbGdpIHZlcmlsZWNlxJ9pIGlsZXRpbGlyLiBFeGNlbCBkZSBrdWxsYW7EsWPEsWRhbiBhbMSxbmFuIGJpbGdpbGVyIG5vdCBlZGlsaXIuIn1dLCAiYWNjZXNzIjogW3sidGl0bGUiOiAiRVLEsMWexLBNIFNPUlVOTEFSSSIsICJib2R5IjogIuKAmOKAmUxpc2FucyBoYWtsYXLEsSBzZWJlYml5bGUgVMO8cmtpeWUgc8SxbsSxcmxhcsSxIGTEscWfxLFuZGEgaGl6bWV0IHZlcmlsZW1lbWVrdGVkaXIu4oCZ4oCZIFV5YXLEsXPEsVxuQWzEsW5hbiBoYXRhIG3DvMWfdGVyaW5pbiB5dXJ0IGTEscWfxLFuZGEgb2xtYXPEsSB2ZSB5dXJ0IGnDp2luZGUgaXNlIFZQTiB5YSBkYSBiZW56ZXJpIGJpciB1eWd1bGFtYW7EsW4gY2loYXrEsW5kYSBha3RpZiBvbG1hc8SxbmRhbiBrYXluYWtsYW5tYWt0YWTEsXIuXG5cbk3DvMWfdGVyaXllIHl1cnQgZMSxxZ/EsW5kYSBvbHVwIG9sbWFkxLHEn8SxIHNvcnVsdXIsIHl1cnQgZMSxxZ/EsW5kYSBpc2Ug4oCY4oCZbGlzYW5zIGhha2xhcsSxIHNlYmViaXlsZSB5YXnEsW5sYXLEsW4geXVydCBkxLHFn8SxbmRhbiBpemxlbmVtZWRpxJ9p4oCZ4oCZIHnDtm7DvG5kZSBiaWxnaSB2ZXJpbGlyLlxuWXVydCBpw6dpbmRlIGlzZSBWUE4geWEgZGEgYmVuemVyaSBiaXIgdXlndWxhbWFuxLFuIGNpaGF6xLFuZGEgYWt0aWYgb2x1cCB5YSBkYSBvbG1hZMSxxJ/EsSBzb3J1bHVyLiBBa3RpZiBpc2UgZGV2cmUgZMSxxZ/EsSBixLFyYWvEsWzEsXAgdGVrcmFyIGRlbmVtZXNpIMO2bmVyaWxpci5cblZQTiB5YSBkYSBiZW56ZXJpIGJpciB1eWd1bGFtYSBrdWxsYW5txLF5b3IgaXNlIG3DvMWfdGVyaW5pbiBpcCBhZHJlc2kgw7bEn3JlbmlsaXIgdmUgaHR0cHM6Ly90ci53aXpjYXNlLmNvbS90b29scy93aGF0cy1teS1pcC8gaXAgYWRyZXNpIGtvbnRyb2wgZWRpbGlyLiAgQXluxLEgemFtYW5kYSBhZHJlc2luIHZwbiDDvHplcmluZGVuIGFsxLFuxLFwIGFsxLFubWFkxLHEn8SxbsSxbiBrb250cm9sw7wgacOnaW4gaHR0cHM6Ly92cG5hcGkuaW8gYWRyZXNpbmUgZ2lyaWxpcCBrb250cm9sIGVkaWxpci5cbklwIGFkcmVzaSB5dXJ0IGTEscWfxLEgeWEgZGEgSVNQIGJpbGdpc2kgYmlsaW5lbiBiaXIgc2VydmlzIHNhxJ9sYXnEsWPEsXPEsSBkZcSfaWxzZSBtw7zFn3Rlcml5ZSBidWx1bmR1xJ91IGxva2FzeW9udW4gb3RlbCwgeXVydCB2Yi4gYmlyIHllciBvbHVwIG9sbWFkxLHEn8SxIHlhIGRhIGNpaGF6xLFuxLFuIMWfaXJrZXQgY2loYXrEsSBvbHVwIG9sbWFkxLHEn8SxIHNvcnVsdXIuIn0sIHsidGl0bGUiOiAi4oCY4oCZSVAgS2FyYW50aW5h4oCZ4oCZIFV5YXLEsXPEsSIsICJib2R5IjogIsSwcCBLYXJhbnRpbmEgc29ydW51IGdlbmVsIGJpciBzb3J1biB5b2sgaXNlLCBlcG9zdGEgdmV5YSDFn2lmcmUgYmlyIMOnb2sgZGVmYSBoYXRhbMSxIGdpcmlsbWVzaW5kZW4gZG9sYXnEsSBhbMSxbsSxci5cbkt1bGxhbsSxY8SxbsSxbiBpcCBhZHJlc2kga2FyYW50aW5hIGRhIG9sdXAgeWEgZGEgb2xtYWTEscSfxLEsIFRWbWFuYWdlciDigJMgQ01TIOKAkyBBZG1pc3Npb24gR2F0ZSBtZW7DvHPDvCDDvHplcmluZGVuIGtvbnRyb2wgZWRpbGVyZWsgw6fEsWthcsSxbGFiaWxpci4gxLBraW5jaSBiaXIgc2XDp2VuZWsgb2xhcmFrIG1vZGVtIGthcGFtYSB2ZSBhw6dtYSBpxZ9sZW1pIHlhcHTEsXLEsWxhYmlsaXIuIn1dLCAiYXBwIjogW3sidGl0bGUiOiAiVGVrbmlrIFNvcnVuIEFuYWxpemkgTmFzxLFsIFlhcMSxbMSxcj8iLCAiYm9keSI6ICJBcHAgS2F5bmFrbMSxIE5lZGVubGVyXG5DaWhheiBLYXluYWtsxLEgTmVkZW5sZXJcbkFwcCBoYXRhbGFyxLEgYmHFn2zEscSfxLFuZGEgdXlndWxhbWFuxLFuIGHDp8SxbG1hbWFzxLEgeWEgZGEga2VuZGkga2VuZGluZSBrYXBhbm1hc8SxIMWfZWtsaW5kZSB0ZWtuaWsgc29ydW5sYXIgaWxlIGthcsWfxLFsYcWfYWJpbGlyaXouIEJ1IHRpcCBzb3J1bmxhciwga3VsbGFuxLFjxLEgZGVuZXlpbWluaSBkb8SfcnVkYW4gZXRraWxleWVyZWsgdXlndWxhbWF5YSBlcmnFn2lsZW1lbWVzaW5lIG5lZGVuIG9sdXIuXG5VeWd1bGFtYW7EsW4gZXNraSBzw7xyw7xtw7xcbsOWbmJlbGxlayBzb3J1bmxhcsSxXG5VeXVtc3V6IGNpaGF6bGFyXG5Eb2x1IFJBTS9BcmthIHBsYW5kYSDDp2FsxLHFn2FuIGZhemxhIHV5Z3VsYW1hXG5DaWhhesSxbiBnw7xuY2VsIG9sbWFtYXPEsSAoRXNraSBzaXN0ZW1pIHPDvHLDvG1sZXJpKVxuS3VsbGFuxLFjxLF5YSBTb3J1bGFiaWxlY2VrIFNvcnVsYXI6XG5VeWd1bGFtYSBhw6fEsWzEsXlvciBtdSwgeW9rc2EgYcOnxLFsbWFkYW4ga2FwYW7EsXlvciBtdT9cblV5Z3VsYW1hIHPDvHLDvG3DvCwgY2loYXogacWfbGV0aW0gc2lzdGVtaSBzw7xyw7xtw7wgbmVkaXI/IChUVm1hbmFnZXIga29udHJvbMO8KVxuQ2loYXpkYSB5ZXRlcmxpIGRlcG9sYW1hIGFsYW7EsSB2YXIgbcSxPyJ9XSwgImFjdGl2YXRpb24iOiBbeyJ0aXRsZSI6ICLigJjigJlQcm9tb3N5b24gS29kdSBCdWx1bmFtYWTEseKAmeKAmSBVeWFyxLFzxLEiLCAiYm9keSI6ICJHw7Zyc2VsZGUga2kgw7ZybmVrdGUgZG/En3J1c3Ug4oCY4oCZWUlMTElLTE9DQeKAmeKAmSBvbGFuIGthbXBhbnlhIGtvZHUsIGvDvMOnw7xrIGhhcmYgaWxlIHlhesSxbGTEscSfxLFuZGEg4oCY4oCZUHJvbW9zeW9uIEtvZHUgQnVsdW5hbWFkxLHigJnigJkgaGF0YXPEsSBhbMSxbm3EscWfdMSxci4gQnUgaGF0YSBpbGUga2FyxZ/EsWxhxZ/EsWxkxLHEn8SxbmRhIGthbXBhbnlhIGtvZHVudW4geWFubMSxxZ8sIGVrc2lrLCBrw7zDp8O8ayBoYXJmIHlhIGRhIGJvxZ9sdWsgYsSxcmFrxLFsYXJhayB5YXrEsWxkxLHEn8SxbsSxIHRlc3BpdGxlLCBrdWxsYW7EsWPEsXnEsSBidSBkb8SfcnVsdHVkYSBkb8SfcnUgeWF6xLFtIGnDp2luIHnDtm5sZW5kaXJtZW1peiBnZXJla2lyLiJ9LCB7InRpdGxlIjogIuKAmOKAmUthbXBhbnlhIEtvZHUgQWt0aWYgRWRpbGVtZWRp4oCZ4oCZIFV5YXLEsXPEsSIsICJib2R5IjogIkfDtnJzZWxkZWtpIMO2cm5la3Rla2kgZ2liaSBlc2tpIGJpciBwcm9tb3N5b24ga29kdSB5YXrEsWxkxLHEn8SxbmRhIOKAmOKAmUthbXBhbnlhIEtvZHUgQWt0aWYgRWRpbGVtZWRp4oCZ4oCZIHV5YXLEsXPEsSBhbMSxbsSxci4ifSwgeyJ0aXRsZSI6ICLigJjigJlHZcOnZXJzaXogS2FtcGFueWEgS29kdeKAmeKAmSBVeWFyxLFzxLEiLCAiYm9keSI6ICJHw7Zyc2VsZGVraSDDtnJuZWt0ZWtpIGdpYmkgZGFoYSDDtm5jZSBrdWxsYW7EsWxtxLHFnyBiaXIgcHJvbW9zeW9uIGtvZHUgeWF6xLFsZMSxxJ/EsW5kYSDigJjigJlHZcOnZXJzaXogS2FtcGFueWEgS29kdeKAmeKAmSBoYXRhc8SxIGFsxLFuxLFyLlxuUHJvbW9zeW9uIGtvZHVudW4gaGFuZ2kgaGVzYXB0YSBrdWxsYW7EsWxkxLHEn8SxbsSxIGHFn2HEn8SxZGFraSBnw7Zyc2VsZGVraSBnaWJpIENhbXBhaWduIGFsYW7EsW5kYSBhcmFtYSB5YXBhcmFrIGfDtnLDvG50w7xsZXllYmlsaXJpei4ifSwgeyJ0aXRsZSI6ICJQbGF5c3RvcmUgVXlndWxhbWEgQWt0aXZhc3lvbiBTb3J1bnUiLCAiYm9keSI6ICJCYXrEsSBkdXJ1bWxhcmRhLCBrdWxsYW7EsWPEsWxhciBHb29nbGUgUGxheSBTdG9yZSDDvHplcmluZGVuIFMgU3BvcnQgUGx1cyB1eWd1bGFtYXPEsW5kYSBhYm9uZWxpayBzYXTEsW4gYWxkxLFrbGFyxLFuZGEgdmV5YSB5ZW5pbGVtZSBnZXLDp2VrbGXFn3RpxJ9pbmRlLCDDvHllbGlrbGVyaSBvdG9tYXRpayBvbGFyYWsgYWt0aWZsZcWfbWV5ZWJpbGl5b3IuICBCdSBkdXJ1bWRhLCBrdWxsYW7EsWPEsW7EsW4gdXlndWxhbWEgw7x6ZXJpbmRlbiBtYW51ZWwgb2xhcmFrIHBha2V0IGFrdGl2YXN5b251IHlhcG1hc8SxIGdlcmVrbWVrdGVkaXIuXG5cbkFrdGl2YXN5b24gacWfbGVtaW5pbiBiYcWfYXLEsWzEsSBvbGFiaWxtZXNpIGnDp2luOlxuIEdvb2dsZSBQbGF5IFN0b3JlIMO8emVyaW5kZW4gc2F0xLFuIGFsbWEgacWfbGVtaSB5YXDEsWzEsXJrZW4ga3VsbGFuxLFsYW4gR21haWwgaGVzYWLEsSwgYWt0aXZhc3lvbiBhbsSxbmRhIGNpaGF6ZGEgYcOnxLFrIG9sbWFsxLFkxLFyLlxuIEFrdGl2YXN5b24gacWfbGVtaSB1eWd1bGFtYSBpw6dlcmlzaW5kZW4geWFwxLFsbWFsxLFkxLFyLlxuRGVzdGVrIGVraWJpIHRhcmFmxLFuZGFuIE1pbmRiZWhpbmQgw7x6ZXJpbmRlbiDigJxwYWtldGdvb2dsZeKAnSBrxLFzYXlvbHUga3VsbGFuxLFsYXJhayB5w7ZubGVuZGlybWUgc2HEn2xhbmFiaWxpci4gIEt1bGxhbsSxY8SxIGJhxZ9hcsSxbMSxIGJpciDFn2VraWxkZSBwYWtldCBha3RpdmFzeW9udSB5YXB0xLFrdGFuIHNvbnJhLCBwYWtldCBhdGFtYXPEsSBzaXN0ZW1kZSBnZXLDp2VrbGXFn2lyIHZlIGxvZyBrYXnEsXRsYXLEsW5kYSBpbGdpbGkgacWfbGVtIGHFn2HEn8SxZGFraSBnaWJpIGfDtnLDvG7DvHIgKGVrbGkgZ8O2cnNlbGxlcmRla2kgZ2liaSkuICBCdSBpxZ9sZW0sIHBha2V0aW4gZG/En3J1IMWfZWtpbGRlIHRhbsSxbWxhbm1hc8SxIGnDp2luIMO2bmVtbGlkaXIuIn0sIHsidGl0bGUiOiAiQXBwIFN0b3JlIFV5Z3VsYW1hIEFrdGl2YXN5b24gU29ydW51IiwgImJvZHkiOiAiTcO8xZ90ZXJpbGVyIEFwcCBTdG9yZSDDvHplcmluZGVuIHV5Z3VsYW1hbcSxemRhbiBhYm9uZWxpayBzYXTEsW4gYWxkxLHEn8SxIHZleWEgeWVuaWxlbWUgb2xkdcSfdSB6YW1hbiBiYXplbiDDvHllbGlrIGFrdGlmIG9sbXV5b3IuXG7DnHllbGlrbGVyaSBha3RpZiBvbGFiaWxtZWxlcmkgacOnaW4sIHV5Z3VsYW1hIMO8emVyaW5kZW4gcGFrZXQgYWt0aXZhc3lvbiB5YXBtYWxhcsSxIGdlcmVraXlvci4gUGFrZXQgYWt0aXZhc3lvbiB5YXBhcmtlbiwgc2F0xLFuIGFsbWEgeWFwYXJrZW4gaGFuZ2kgQXBwbGUga2ltbGnEn2kgaGVzYWLEsSBhw6fEsWsgaXNlLCBvIGhlc2FwIGHDp8Sxa2tlbiBha3RpdmFzeW9uIGRlbmVtZXNpIGdlcmVraXlvci5cbk1pbmRiZWhpbmQgw7x6ZXJpbmRlbiDigJjigJlwYWtldGFwcGxl4oCZ4oCZIGvEsXNheW9sdSBrdWxsYW7EsWzEsXIuXG5Nw7zFn3RlcmkgcGFrZXQgYWt0aXZhc3lvbnUgeWFwdMSxa3RhbiBzb25yYSDDvHllbGlrIGF0YW1hc8SxIHZlIGxvZ2xhcmRhIG5hc8SxbCBnw7Z6w7xrdMO8xJ/DvCBnw7Zyc2VsbGVyZGVraSBnaWJpZGlyLlxuUGFrZXQgYWt0aXZhc3lvbiBidXRvbnUgw7ZybmVrIGfDtnLDvG50w7xzw7wgeWFuZGFraSBnaWJpZGlyLiJ9LCB7InRpdGxlIjogIkFLVMSwVkFTWU9OIFNPUlVOTEFSSSIsICJib2R5IjogIsSwT1MgVXlndWxhbWEgUGFrZXQgQWt0aXZhc3lvbiDigJjigJlBYm9uZWxpayBCYcWfa2FzxLFuYSBBaXR0aXLigJnigJkgU29ydW51XG5cbsSwb3MgdXlndWxhbWFtxLF6ZGEgbcO8xZ90ZXJpIHBha2V0IGFrdGl2YXN5b24gacWfbGVtaSB5YXB0xLHEn8SxbmRhIOKAmOKAmUFib25lbGlrIEJhxZ9rYXPEsW5hIEFpdHRpcuKAmeKAmSBoYXRhc8SxIGdlbGl5b3IgaXNlLCBjaWhhemRhIGHDp8SxayBvbGFuIEFwcGxlIGtpbWxpxJ9pIGlsZSBzYXTEsW4gYWzEsW5txLHFnywgYW5jYWsgYWt0aXZhc3lvbiB5YXB0xLHEn8SxIGVwb3N0YSBhZHJlc2kgZmFya2zEsSBiaXIgZXBvc3RhIGFkcmVzaWRpci5cblxuRmFya2zEsSBlcG9zdGEgYWRyZXNpIGlsZSBwYWtldCBha3RpdmFzeW9uIHlhcHTEscSfxLFuZGEg4oCY4oCZU3Vic2NyaWJlcmxvZ+KAmeKAmSBrxLFzbcSxbmRhIMO2cm5layBla3JhbiBnw7Zyw7xudMO8c8O8bmRlIGvEsXJtxLF6xLEgYWxhbmEgYWzEsW5hbiDigJjigJlwYWNrYWdlVmFsaWRhdGlvbuKAmeKAmSAga8Sxc23EsSDDp8Sxa2FyLCBvayBpbGUgZ8O2c3RlcmlsZW4gSUQga8Sxc23EsW5kYW4gZG/En3J1IMO8eWVsacSfaSBJRCBhcmFtYXPEsSBpbGUgYnVsYWJpbGlyaXouIn0sIHsidGl0bGUiOiAiQUtUxLBWQVNZT04gU09SVU5MQVJJIiwgImJvZHkiOiAiQW5kcm9pZCDigJjigJlQYWtldCBCYcWfa2EgQmlyIEt1bGxhbsSxY8SxeWEgQWl0IE9sZHXEn3UgxLDDp2luIFBha2V0IEF0YW1hIMSwxZ9sZW1pIEJhxZ9hcsSxc8SxeiBPbGR14oCZ4oCZIFNvcnVudVxuXG5BbmRyb2lkIHV5Z3VsYW1hbcSxemRhIG3DvMWfdGVyaSBwYWtldCBha3RpdmFzeW9uIGnFn2xlbWkgeWFwdMSxxJ/EsW5kYSDigJjigJlQYWtldCBCYcWfa2EgQmlyIEt1bGxhbsSxY8SxeWEgQWl0IE9sZHXEn3UgxLDDp2luIFBha2V0IEF0YW1hIMSwxZ9sZW1pIEJhxZ9hcsSxc8SxeiBPbGR14oCZ4oCZIGhhdGFzxLEgZ2VsaXlvciBpc2UsIGNpaGF6ZGEgYcOnxLFrIG9sYW4gUGxheSBTdG9yZSBnbWFpbCBoZXNhYsSxIGlsZSBzYXTEsW4gYWzEsW5txLHFnywgYW5jYWsgYWt0aXZhc3lvbiB5YXB0xLHEn8SxIGVwb3N0YSBhZHJlc2kgZmFya2zEsSBiaXIgZXBvc3RhIGFkcmVzaWRpci5cblxuRmFya2zEsSBlcG9zdGEgYWRyZXNpIGlsZSBwYWtldCBha3RpdmFzeW9uIHlhcHTEscSfxLFuZGEg4oCY4oCZU3Vic2NyaWJlcmxvZ+KAmeKAmSBrxLFzbcSxbmRhIMO2cm5layBla3JhbiBnw7Zyw7xudMO8c8O8bmRlIGvEsXJtxLF6xLEgYWxhbmEgYWzEsW5hbiDigJjigJlWYWxpZGF0ZSBHb29nbGUgUGFja2FnZeKAmeKAmSAga8Sxc23EsSDDp8Sxa2FyLCBvayBpbGUgZ8O2c3RlcmlsZW4gSUQga8Sxc23EsW5kYW4gZG/En3J1IMO8eWVsacSfaSBJRCBhcmFtYXPEsSBpbGUgYnVsYWJpbGlyaXouIn0sIHsidGl0bGUiOiAiQUtUxLBWQVNZT04gU09SVU5MQVJJIiwgImJvZHkiOiAiQW5kcm9pZCBVeWd1bGFtYSBQYWtldCBBa3RpdmFzeW9uIMSwxZ9sZW0gVGFtYW1sYW5hbWFkxLEgdmV5YSDDnHllbGlrIEJ1bHVuYW1hbWEgU29ydW51XG5BbmRyb2lkIHV5Z3VsYW1hbcSxemRhIG3DvMWfdGVyaSDDtmRlbWUgeWFwbcSxxZ8gb2xtYXPEsW5hIHJhxJ9tZW4gcGFrZXQgYWt0aXZhc3lvbnUgeWFwdMSxxJ/EsW5kYSDigJjigJnEsMWfbGVtIHRhbWFtbGFuZMSxLCDEsMWfbGVtIFRhbWFtbGFuYW1hZMSxIHZleWEgQWJvbmUgYnVsdW5hbWFkxLHigJnigJkgaGF0YXPEsSBnZWxpeW9yIHZlIMO8eWVsaWsgYWt0aWYgb2xtdXlvciBpc2UsIG3DvMWfdGVyaWRlbiBHUEEga29kdW51IHBheWxhxZ/EsWxtYXPEsSBpc3RlbmlyLlxuR1BBIGtvZHUsIEdvb2dsZSB0YXJhZsSxbmRhbiDDtmRlbWUgeWFwxLFsZMSxxJ/EsW5hIGRhaXIgbcO8xZ90ZXJpeWUgZ8O2bmRlcmlsZW4gw7ZkZW1lIGZhdHVyYXPEsSAobWFrYnV6KSBpw6dlcmlzaW5kZSB5ZXIgYWxtYWt0YWTEsXIuXG5CdSBHUEEga29kdSBpbGUgw7x5ZWxpxJ9pIFR2bWFuYWdlciDDvHplcmluZGVuIGHFn2HEn8SxZGFraSBnw7Zyc2VsZGVraSBnaWJpIFJlcG9ydGluZyA+IEdlbmVyYWwgPiBQYXltZW50cyBrxLFzbcSxbmRhIHRhcmloaSBhcmFsxLHEn8SxIGF5YXJsYW7EsXAg4oCY4oCZVHJhbnNhY3Rpb24gSWRlbnRpZmVy4oCZ4oCZIGvEsXNtxLFuZGFuIGFyYW1hIHlhcMSxbMSxcCwgw7x5ZWxpayBJROKAmXNpbmUg4oCY4oCZU3Vic2NyaWJlciBJROKAmeKAmSDDvHplcmluZGVuIHVsYcWfxLFsYWJpbGlyLiJ9LCB7InRpdGxlIjogIkFLVMSwVkFTWU9OIFNPUlVOTEFSSSIsICJib2R5IjogIlTDvHJrc2F0IEFib25lIEJ1bHVuYW1hZMSxIHZleWEgQWJvbmUgQWN0aXZlIERlxJ9pbCBTb3J1bnVcbkJ1IGhhdGEsIEhpem1ldCBJRCB2ZXlhIEdlw6dpY2kgS29kIGhhdGFsxLEgeWF6xLFsbWFzxLFuZGFuIGRvbGF5xLEgYWzEsW7EsXIuICBNw7zFn3RlcmlsZXIgZ2VuZWxsaWtsZSBiYXrEsSBiw7x5w7xrIGvDvMOnw7xrIGhhcmZsZXJpIGthcsSxxZ90xLFyYWJpbGl5b3IgdmV5YSBzaXN0ZW1kZW4gZG9sYXnEsSBiYXplbiBidSBzb3J1biBhbMSxbmFiaWxpeW9yLlxuw4fDtnrDvG0gb2xhcmFrIGhhcmYgaGF0YXPEsSBvbG1hbWFzxLEgacOnaW4gVHZtYW5hZ2VyPlJlcG9ydGluZz5HZW5lcmFsPlRoaXJ0ZHBhcnR5IFByb3Zpc2lvbnMga8Sxc23EsW5kYW4gdGFyaWggYXJhbMSxxJ/EsSBiZWxpcmxleWlwLCBIaXptZXQgSUQgbnVtYXJhc8SxbsSxIOKAmOKAmUV4dHJlbmFsIElE4oCZ4oCZIGvEsXNtxLFuZGFuIGFyYXTEsXAsIGt1bGxhbsSxY8SxIFTDvHJrc2F0IGJpbGdpbGVyaW5pIGJ1bHVwIOKAmOKAmVVuaXF1ZUlE4oCZ4oCZIGvEsXNtxLFuZGFuIGdlw6dpY2kga29kdSBidWx1cCwga3VsbGFuxLFjxLF5YSBwYXlsYcWfdMSxxJ/EsW3EsXpkYSwgSUQgdmUgR2XDp2ljaSBrb2R1IGtvcHlhbGEgeWFwxLHFn3TEsXLEsXIgxZ9la2xpbmRlIGlsZXJsZW1lc2luaSBpbGV0ZWJpbGlyaXouXG5BeW7EsSBzb3J1biBkZXZhbSBlZGVyIGlzZSwga3VsbGFuxLFjxLFkYW4gb25heSBhbMSxcCwgSUQgdmUgZ2XDp2ljaSBrb2QgaWxlIGt1bGxhbsSxY8SxbsSxbiDDvHllbGnEn2luaSBrZW5kaW1peiB5YXBhYmlsaXJpei4gTcO8xZ90ZXJpbmluIMO8eWVsacSfaW5pIGJpeiB0YXJhZsSxbmRhbiB5YXDEsWxkxLEgaXNlLCBtw7zFn3Rlcml5ZSDFn2lmcmVzaW5pIG5hc8SxbCBnw7xuY2VsbGV5ZWJpbGVjZcSfaSBpbGUgaWxnaWxpIGJpbGdpIHZlcmlsaXIuIn1dfTsKCmZ1bmN0aW9uIHJlbmRlclRlY2hTZWN0aW9ucygpewogICAgLy8gS2F5bmFrOiBTaGVldCd0ZW4gZ2VsZW4gdGVrbmlrIGthcnRsYXIgKyBhZG1pbiBvdmVycmlkZSAobG9jYWxTdG9yYWdlKQogICAgY29uc3QgYmFzZUNhcmRzID0gKGRhdGFiYXNlfHxbXSkuZmlsdGVyKGM9PlN0cmluZyhjLmNhdGVnb3J5fHwnJykudG9Mb3dlckNhc2UoKT09PSd0ZWtuaWsnKTsKICAgIGxldCBvdmVycmlkZSA9IFtdOwogICAgdHJ5eyBvdmVycmlkZSA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3RlY2hDYXJkc092ZXJyaWRlJykgfHwgJ1tdJyk7IH1jYXRjaChlKXsgb3ZlcnJpZGUgPSBbXTsgfQogICAgY29uc3QgdGVjaENhcmRzID0gKEFycmF5LmlzQXJyYXkob3ZlcnJpZGUpICYmIG92ZXJyaWRlLmxlbmd0aCkgPyBvdmVycmlkZSA6IGJhc2VDYXJkczsKCiAgICAvLyBIZXVyaXN0aWsgc8SxbsSxZmxhbmTEsXJtYQogICAgY29uc3QgYnVja2V0cyA9IHticm9hZGNhc3Q6W10sIGFjY2VzczpbXSwgYXBwOltdLCBhY3RpdmF0aW9uOltdLCBjYXJkczpbXX07CiAgICB0ZWNoQ2FyZHMuZm9yRWFjaChjPT57CiAgICAgICAgY29uc3QgaGF5ID0gYCR7Yy50aXRsZXx8Jyd9ICR7Yy50ZXh0fHwnJ30gJHtjLnNjcmlwdHx8Jyd9YC50b0xvd2VyQ2FzZSgpOwogICAgICAgIGlmKGhheS5pbmNsdWRlcygneWF5xLFuJykgfHwgaGF5LmluY2x1ZGVzKCdkb24nKSB8fCBoYXkuaW5jbHVkZXMoJ2J1ZmZlcicpIHx8IGhheS5pbmNsdWRlcygnYWvEscWfJykgfHwgaGF5LmluY2x1ZGVzKCd0dicpKXsKICAgICAgICAgICAgYnVja2V0cy5icm9hZGNhc3QucHVzaChjKTsKICAgICAgICB9ZWxzZSBpZihoYXkuaW5jbHVkZXMoJ2VyacWfaW0nKSB8fCBoYXkuaW5jbHVkZXMoJ3ZwbicpIHx8IGhheS5pbmNsdWRlcygncHJveHknKSB8fCBoYXkuaW5jbHVkZXMoJ2xvZ2luJykgfHwgaGF5LmluY2x1ZGVzKCdnaXJpxZ8nKSB8fCBoYXkuaW5jbHVkZXMoJ3l1cnRkxLHFn8SxJykpewogICAgICAgICAgICBidWNrZXRzLmFjY2Vzcy5wdXNoKGMpOwogICAgICAgIH1lbHNlIGlmKGhheS5pbmNsdWRlcygnYXBwJykgfHwgaGF5LmluY2x1ZGVzKCd1eWd1bGFtYScpIHx8IGhheS5pbmNsdWRlcygnaGF0YScpIHx8IGhheS5pbmNsdWRlcygnY3Jhc2gnKSB8fCBoYXkuaW5jbHVkZXMoJ3ZlcnNpeW9uJykpewogICAgICAgICAgICBidWNrZXRzLmFwcC5wdXNoKGMpOwogICAgICAgIH1lbHNlIGlmKGhheS5pbmNsdWRlcygnYWt0aXZhc3lvbicpIHx8IGhheS5pbmNsdWRlcygnc2F0xLFuJykgfHwgaGF5LmluY2x1ZGVzKCdzYXTEsW5hbG1hJykgfHwgaGF5LmluY2x1ZGVzKCdzdG9yZScpIHx8IGhheS5pbmNsdWRlcygnw7ZkZW1lJykgfHwgaGF5LmluY2x1ZGVzKCdnb29nbGUnKSB8fCBoYXkuaW5jbHVkZXMoJ2FwcGxlJykpewogICAgICAgICAgICBidWNrZXRzLmFjdGl2YXRpb24ucHVzaChjKTsKICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgYnVja2V0cy5icm9hZGNhc3QucHVzaChjKTsKICAgICAgICB9CiAgICAgICAgYnVja2V0cy5jYXJkcy5wdXNoKGMpOwogICAgfSk7CgogICAgd2luZG93Ll9fdGVjaEJ1Y2tldHMgPSBidWNrZXRzOwoKICAgIC8vIFNlYXJjaCBpbnB1dCBiYcSfbGFtYQogICAgY29uc3QgYmluZFNlYXJjaCA9IChpbnB1dElkLCBrZXksIGxpc3RJZCk9PnsKICAgICAgICBjb25zdCBpbnAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpbnB1dElkKTsKICAgICAgICBpZighaW5wKSByZXR1cm47CiAgICAgICAgaW5wLm9uaW5wdXQgPSAoKT0+IHJlbmRlclRlY2hMaXN0KGtleSwgaW5wLnZhbHVlIHx8ICcnLCBsaXN0SWQpOwogICAgfTsKCiAgICBiaW5kU2VhcmNoKCd4LXNlYXJjaC1icm9hZGNhc3QnLCdicm9hZGNhc3QnLCd4LWJyb2FkY2FzdC1saXN0Jyk7CiAgICBiaW5kU2VhcmNoKCd4LXNlYXJjaC1hY2Nlc3MnLCdhY2Nlc3MnLCd4LWFjY2Vzcy1saXN0Jyk7CiAgICBiaW5kU2VhcmNoKCd4LXNlYXJjaC1hcHAnLCdhcHAnLCd4LWFwcC1saXN0Jyk7CiAgICBiaW5kU2VhcmNoKCd4LXNlYXJjaC1hY3RpdmF0aW9uJywnYWN0aXZhdGlvbicsJ3gtYWN0aXZhdGlvbi1saXN0Jyk7CiAgICBiaW5kU2VhcmNoKCd4LXNlYXJjaC1jYXJkcycsJ2NhcmRzJywneC1jYXJkcy1saXN0Jyk7CgogICAgLy8gxLBsayDDp2l6aW0KICAgIHJlbmRlclRlY2hMaXN0KCdicm9hZGNhc3QnLCcnLCAneC1icm9hZGNhc3QtbGlzdCcpOwogICAgcmVuZGVyVGVjaExpc3QoJ2FjY2VzcycsJycsICd4LWFjY2Vzcy1saXN0Jyk7CiAgICByZW5kZXJUZWNoTGlzdCgnYXBwJywnJywgJ3gtYXBwLWxpc3QnKTsKICAgIHJlbmRlclRlY2hMaXN0KCdhY3RpdmF0aW9uJywnJywgJ3gtYWN0aXZhdGlvbi1saXN0Jyk7CiAgICByZW5kZXJUZWNoTGlzdCgnY2FyZHMnLCcnLCAneC1jYXJkcy1saXN0Jyk7Cn0KCmxldCB0ZWNoRWRpdE1vZGUgPSBmYWxzZTsKCmZ1bmN0aW9uIHJlbmRlclRlY2hMaXN0KGJ1Y2tldEtleSwgcSwgbGlzdElkKXsKICAgIGNvbnN0IGxpc3RFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGxpc3RJZCk7CiAgICBpZighbGlzdEVsKSByZXR1cm47CgogICAgY29uc3QgYWxsID0gKHdpbmRvdy5fX3RlY2hCdWNrZXRzICYmIHdpbmRvdy5fX3RlY2hCdWNrZXRzW2J1Y2tldEtleV0pID8gd2luZG93Ll9fdGVjaEJ1Y2tldHNbYnVja2V0S2V5XSA6IFtdOwogICAgY29uc3QgcXVlcnkgPSBTdHJpbmcocXx8JycpLnRyaW0oKS50b0xvd2VyQ2FzZSgpOwoKICAgIGNvbnN0IGZpbHRlcmVkID0gIXF1ZXJ5ID8gYWxsIDogYWxsLmZpbHRlcihjPT57CiAgICAgICAgY29uc3QgaGF5ID0gYCR7Yy50aXRsZXx8Jyd9ICR7Yy50ZXh0fHwnJ30gJHtjLnNjcmlwdHx8Jyd9ICR7Yy5saW5rfHwnJ31gLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgcmV0dXJuIGhheS5pbmNsdWRlcyhxdWVyeSk7CiAgICB9KTsKCiAgICBjb25zdCBiYXIgPSAoaXNBZG1pbk1vZGUgPyBgCiAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2dhcDoxMHB4O2FsaWduLWl0ZW1zOmNlbnRlcjttYXJnaW46MTBweCAwIDE0cHg7Ij4KICAgICAgICAgIDxidXR0b24gY2xhc3M9IngtYnRuIHgtYnRuLWFkbWluIiBvbmNsaWNrPSJ0b2dnbGVUZWNoRWRpdCgpIj48aSBjbGFzcz0iZmFzIGZhLXBlbiI+PC9pPiAke3RlY2hFZGl0TW9kZSA/ICdEw7x6ZW5sZW1leWkgS2FwYXQnIDogJ0TDvHplbmxlbWV5aSBBw6cnfTwvYnV0dG9uPgogICAgICAgICAgJHt0ZWNoRWRpdE1vZGUgPyBgPGJ1dHRvbiBjbGFzcz0ieC1idG4geC1idG4tYWRtaW4iIG9uY2xpY2s9ImFkZFRlY2hDYXJkKCcke2J1Y2tldEtleX0nKSI+PGkgY2xhc3M9ImZhcyBmYS1wbHVzIj48L2k+IEthcnQgRWtsZTwvYnV0dG9uPmAgOiBgYH0KICAgICAgICAgIDxzcGFuIHN0eWxlPSJjb2xvcjojODg4O2ZvbnQtd2VpZ2h0OjgwMDtmb250LXNpemU6LjlyZW0iPkJ1IGTDvHplbmxlbWVsZXIgdGFyYXnEsWPEsWRhIHNha2xhbsSxciAobG9jYWwpLjwvc3Bhbj4KICAgICAgICA8L2Rpdj4KICAgIGAgOiAnJyk7CgogICAgaWYoIWZpbHRlcmVkLmxlbmd0aCl7CiAgICAgICAgbGlzdEVsLmlubmVySFRNTCA9IGJhciArICc8ZGl2IGNsYXNzPSJob21lLW1pbmktaXRlbSI+S2F5xLF0IGJ1bHVuYW1hZMSxLjwvZGl2Pic7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGxpc3RFbC5pbm5lckhUTUwgPSBiYXIgKyBgCiAgICAgIDxkaXYgY2xhc3M9IngtY2FyZC1ncmlkIj4KICAgICAgICAke2ZpbHRlcmVkLm1hcCgoYywgaWR4KT0+IHRlY2hDYXJkSHRtbChjLCBpZHgpKS5qb2luKCcnKX0KICAgICAgPC9kaXY+CiAgICBgOwp9CgpmdW5jdGlvbiB0ZWNoQ2FyZEtleShjLCBpZHgpewogICAgcmV0dXJuIChjICYmIChjLmlkIHx8IGMuY29kZSkpID8gU3RyaW5nKGMuaWR8fGMuY29kZSkgOiBgJHsoYy50aXRsZXx8JycpLnNsaWNlKDAsNDApfV9fJHtpZHh9YDsKfQoKZnVuY3Rpb24gdGVjaENhcmRIdG1sKGMsIGlkeCl7CiAgICBjb25zdCB0aXRsZSA9IGVzY2FwZUh0bWwoYy50aXRsZXx8JycpOwogICAgY29uc3QgYmFkZ2UgPSBlc2NhcGVIdG1sKGMuY29kZSB8fCBjLmNhdGVnb3J5IHx8ICdURUtOxLBLJyk7CiAgICBjb25zdCByYXdUZXh0ID0gKGMudGV4dHx8JycpLnRvU3RyaW5nKCk7CiAgICBjb25zdCB0ZXh0ID0gZXNjYXBlSHRtbChyYXdUZXh0KTsKICAgIGNvbnN0IGxpbmsgPSAoYy5saW5rfHwnJykudHJpbSgpOwogICAgY29uc3Qgc2NyaXB0ID0gKGMuc2NyaXB0fHwnJykudHJpbSgpOwogICAgY29uc3Qga2V5ID0gdGVjaENhcmRLZXkoYywgaWR4KTsKCiAgICAvLyBEZXRheSBidXRvbnVudSBnw7ZzdGVybWUga3JpdGVyaSAodXp1biBtZXRpbiAvIHNjcmlwdCAvIGxpbmspCiAgICBjb25zdCBoYXNEZXRhaWwgPSAocmF3VGV4dCAmJiByYXdUZXh0Lmxlbmd0aCA+IDE4MCkgfHwgKHNjcmlwdCAmJiBzY3JpcHQubGVuZ3RoID4gMTIwKSB8fCAhIWxpbms7CgogICAgcmV0dXJuIGAKICAgICAgPGRpdiBjbGFzcz0ieC1jYXJkIiBkYXRhLWtleT0iJHtlc2NhcGVIdG1sKGtleSl9Ij4KICAgICAgICA8ZGl2IGNsYXNzPSJ4LWNhcmQtaGVhZCI+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJ4LWNhcmQtdGl0bGUiPiR7dGl0bGV9PC9kaXY+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJ4LWNhcmQtYmFkZ2UiPiR7YmFkZ2V9PC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0ieC1jYXJkLWJvZHkiPgogICAgICAgICAgJHt0ZXh0ID8gYDxkaXYgY2xhc3M9IngtY2FyZC10ZXh0IHgtY2FyZC10ZXh0LXRydW5jYXRlIj4ke3RleHR9PC9kaXY+YCA6IGBgfQogICAgICAgICAgJHtoYXNEZXRhaWwgPyBgPGJ1dHRvbiBjbGFzcz0ieC1yZWFkbW9yZSIgb25jbGljaz0nb3BlblRlY2hDYXJkRGV0YWlsKCR7SlNPTi5zdHJpbmdpZnkoa2V5KX0pJz5EZXZhbSBva3U8L2J1dHRvbj5gIDogYGB9CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0ieC1jYXJkLWFjdGlvbnMiPgogICAgICAgICAgJHtzY3JpcHQgPyBgPGJ1dHRvbiBjbGFzcz0ieC1idG4geC1idG4tY29weSIgb25jbGljaz0nY29weVRleHQoJHtKU09OLnN0cmluZ2lmeShzY3JpcHQpfSknPjxpIGNsYXNzPSJmYXMgZmEtY29weSI+PC9pPiBLb3B5YWxhPC9idXR0b24+YCA6IGBgfQogICAgICAgICAgJHtpc0FkbWluTW9kZSAmJiB0ZWNoRWRpdE1vZGUgPyBgCiAgICAgICAgICAgIDxidXR0b24gY2xhc3M9IngtYnRuIHgtYnRuLWFkbWluIiBvbmNsaWNrPSJlZGl0VGVjaENhcmQoJHtKU09OLnN0cmluZ2lmeShrZXkpfSkiPjxpIGNsYXNzPSJmYXMgZmEtcGVuIj48L2k+IETDvHplbmxlPC9idXR0b24+CiAgICAgICAgICAgIDxidXR0b24gY2xhc3M9IngtYnRuIHgtYnRuLWFkbWluIiBvbmNsaWNrPSJkZWxldGVUZWNoQ2FyZCgke0pTT04uc3RyaW5naWZ5KGtleSl9KSI+PGkgY2xhc3M9ImZhcyBmYS10cmFzaCI+PC9pPiBTaWw8L2J1dHRvbj4KICAgICAgICAgIGAgOiBgYH0KICAgICAgICA8L2Rpdj4KICAgICAgPC9kaXY+CiAgICBgOwp9CgovLyBUZWtuaWsga2FydCBkZXRhecSxbsSxIHBvcHVwJ3RhIGHDpyAoYW5hIGVrcmFuIGthcnRsYXLEsSBnaWJpKQpmdW5jdGlvbiBvcGVuVGVjaENhcmREZXRhaWwoa2V5KXsKICAgIHRyeXsKICAgICAgICBjb25zdCBhbGwgPSBfX2dldFRlY2hDYXJkc0ZvclVpKCk7CiAgICAgICAgLy8ga2V5OiAiPGlkPiIgdmV5YSAiaWR4OjxuPiIgb2xhYmlsaXIKICAgICAgICBsZXQgZm91bmQgPSBudWxsOwogICAgICAgIGlmKFN0cmluZyhrZXl8fCcnKS5zdGFydHNXaXRoKCdpZHg6JykpewogICAgICAgICAgICBjb25zdCBuID0gcGFyc2VJbnQoU3RyaW5nKGtleSkuc3BsaXQoJzonKVsxXSwxMCk7CiAgICAgICAgICAgIGlmKCFOdW1iZXIuaXNOYU4obikpIGZvdW5kID0gYWxsW25dOwogICAgICAgIH1lbHNlewogICAgICAgICAgICBmb3VuZCA9IGFsbC5maW5kKChjLCBpZHgpPT50ZWNoQ2FyZEtleShjLCBpZHgpPT09a2V5KSB8fCBudWxsOwogICAgICAgIH0KICAgICAgICBpZighZm91bmQpewogICAgICAgICAgICBTd2FsLmZpcmUoe2ljb246J3dhcm5pbmcnLCB0aXRsZTonS2F5xLF0IGJ1bHVuYW1hZMSxJywgdGltZXI6MTIwMCwgc2hvd0NvbmZpcm1CdXR0b246ZmFsc2V9KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gc2hvd0NhcmREZXRhaWwob2JqKSB6YXRlbiBzY3JpcHQvbGluayB2cy4gZGVzdGVrbGl5b3IKICAgICAgICBzaG93Q2FyZERldGFpbCh7CiAgICAgICAgICAgIHRpdGxlOiBmb3VuZC50aXRsZSB8fCAnRGV0YXknLAogICAgICAgICAgICB0ZXh0OiBmb3VuZC50ZXh0IHx8ICcnLAogICAgICAgICAgICBzY3JpcHQ6IGZvdW5kLnNjcmlwdCB8fCAnJywKICAgICAgICAgICAgYWxlcnQ6IGZvdW5kLmFsZXJ0IHx8ICcnLAogICAgICAgICAgICBsaW5rOiBmb3VuZC5saW5rIHx8ICcnCiAgICAgICAgfSk7CiAgICB9Y2F0Y2goZSl7CiAgICAgICAgU3dhbC5maXJlKCdIYXRhJywgJ0RldGF5IGHDp8SxbGFtYWTEsS4nLCAnZXJyb3InKTsKICAgIH0KfQoKZnVuY3Rpb24gdG9nZ2xlVGVjaEVkaXQoKXsKICAgIHRlY2hFZGl0TW9kZSA9ICF0ZWNoRWRpdE1vZGU7CiAgICAvLyBmdWxsc2NyZWVuIHRla25payBrYXJ0bGFyIHNla21lc2luaSB0YXplbGUKICAgIHRyeXsgZmlsdGVyVGVjaENhcmRzKCk7IH1jYXRjaChlKXt9Cn0KCmZ1bmN0aW9uIGdldFRlY2hPdmVycmlkZSgpewogICAgdHJ5ewogICAgICAgIGNvbnN0IGFyciA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3RlY2hDYXJkc092ZXJyaWRlJykgfHwgJ1tdJyk7CiAgICAgICAgaWYoQXJyYXkuaXNBcnJheShhcnIpKSByZXR1cm4gYXJyOwogICAgfWNhdGNoKGUpe30KICAgIHJldHVybiBbXTsKfQoKZnVuY3Rpb24gc2F2ZVRlY2hPdmVycmlkZShhcnIpewogICAgLy8gbG9jYWxTdG9yYWdlIGxpbWl0IC8gcXVvdGEgaGF0YWxhcsSxbmRhIHV5Z3VsYW1hIMOnw7ZrbWVzaW4KICAgIHN0b3JhZ2Uuc2V0KCd0ZWNoQ2FyZHNPdmVycmlkZScsIChhcnIgfHwgW10pKTsKfQoKZnVuY3Rpb24gYWRkVGVjaENhcmQoYnVja2V0S2V5KXsKICAgIFN3YWwuZmlyZSh7CiAgICAgICAgdGl0bGU6ICJUZWtuaWsgS2FydCBFa2xlIiwKICAgICAgICBodG1sOiBgCiAgICAgICAgICA8aW5wdXQgaWQ9InRjLXRpdGxlIiBjbGFzcz0ic3dhbDItaW5wdXQiIHBsYWNlaG9sZGVyPSJCYcWfbMSxayI+CiAgICAgICAgICA8aW5wdXQgaWQ9InRjLWJhZGdlIiBjbGFzcz0ic3dhbDItaW5wdXQiIHBsYWNlaG9sZGVyPSJFdGlrZXQgKMO2cjogVEVLTsSwSykiPgogICAgICAgICAgPGlucHV0IGlkPSJ0Yy1saW5rIiBjbGFzcz0ic3dhbDItaW5wdXQiIHBsYWNlaG9sZGVyPSJMaW5rIChvcHNpeW9uZWwpIj4KICAgICAgICAgIDx0ZXh0YXJlYSBpZD0idGMtdGV4dCIgY2xhc3M9InN3YWwyLXRleHRhcmVhIiBwbGFjZWhvbGRlcj0iQcOnxLFrbGFtYSI+PC90ZXh0YXJlYT4KICAgICAgICAgIDx0ZXh0YXJlYSBpZD0idGMtc2NyaXB0IiBjbGFzcz0ic3dhbDItdGV4dGFyZWEiIHBsYWNlaG9sZGVyPSJTY3JpcHQgKG9wc2l5b25lbCkiPjwvdGV4dGFyZWE+CiAgICAgICAgYCwKICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAiRWtsZSIsCiAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogIlZhemdlw6ciLAogICAgICAgIHByZUNvbmZpcm06ICgpPT57CiAgICAgICAgICAgIGNvbnN0IHRpdGxlID0gKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0Yy10aXRsZScpLnZhbHVlfHwnJykudHJpbSgpOwogICAgICAgICAgICBpZighdGl0bGUpIHJldHVybiBTd2FsLnNob3dWYWxpZGF0aW9uTWVzc2FnZSgiQmHFn2zEsWsgem9ydW5sdSIpOwogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgaWQ6ICdsb2NhbF8nICsgRGF0ZS5ub3coKSwKICAgICAgICAgICAgICAgIHRpdGxlLAogICAgICAgICAgICAgICAgY29kZTogKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0Yy1iYWRnZScpLnZhbHVlfHwnVEVLTsSwSycpLnRyaW0oKSwKICAgICAgICAgICAgICAgIGxpbms6IChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGMtbGluaycpLnZhbHVlfHwnJykudHJpbSgpLAogICAgICAgICAgICAgICAgdGV4dDogKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0Yy10ZXh0JykudmFsdWV8fCcnKS50cmltKCksCiAgICAgICAgICAgICAgICBzY3JpcHQ6IChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGMtc2NyaXB0JykudmFsdWV8fCcnKS50cmltKCksCiAgICAgICAgICAgICAgICBjYXRlZ29yeTogJ3Rla25paycKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICB9KS50aGVuKHJlcz0+ewogICAgICAgIGlmKCFyZXMuaXNDb25maXJtZWQpIHJldHVybjsKICAgICAgICBjb25zdCBjdXIgPSBnZXRUZWNoT3ZlcnJpZGUoKTsKICAgICAgICBjb25zdCBiYXNlID0gKGRhdGFiYXNlfHxbXSkuZmlsdGVyKGM9PlN0cmluZyhjLmNhdGVnb3J5fHwnJykudG9Mb3dlckNhc2UoKT09PSd0ZWtuaWsnKTsKICAgICAgICBjb25zdCBhcnIgPSAoY3VyLmxlbmd0aCA/IGN1ciA6IGJhc2UpOwogICAgICAgIGFyci51bnNoaWZ0KHJlcy52YWx1ZSk7CiAgICAgICAgc2F2ZVRlY2hPdmVycmlkZShhcnIpOwogICAgICAgIHRyeXsgZmlsdGVyVGVjaENhcmRzKCk7IH1jYXRjaChlKXt9CiAgICB9KTsKfQoKZnVuY3Rpb24gZWRpdFRlY2hDYXJkKGtleSl7CiAgICBjb25zdCBjdXIgPSBnZXRUZWNoT3ZlcnJpZGUoKTsKICAgIGNvbnN0IGJhc2UgPSAoZGF0YWJhc2V8fFtdKS5maWx0ZXIoYz0+U3RyaW5nKGMuY2F0ZWdvcnl8fCcnKS50b0xvd2VyQ2FzZSgpPT09J3Rla25paycpOwogICAgY29uc3QgYXJyID0gKGN1ci5sZW5ndGggPyBjdXIgOiBiYXNlKTsKICAgIGNvbnN0IGlkeCA9IGFyci5maW5kSW5kZXgoKGMsaSk9PnRlY2hDYXJkS2V5KGMsaSk9PT1rZXkpOwogICAgaWYoaWR4PDApIHJldHVybjsKCiAgICBjb25zdCBjID0gYXJyW2lkeF0gfHwge307CiAgICBTd2FsLmZpcmUoewogICAgICAgIHRpdGxlOiAiS2FydMSxIETDvHplbmxlIiwKICAgICAgICBodG1sOiBgCiAgICAgICAgICA8aW5wdXQgaWQ9InRjLXRpdGxlIiBjbGFzcz0ic3dhbDItaW5wdXQiIHBsYWNlaG9sZGVyPSJCYcWfbMSxayIgdmFsdWU9IiR7ZXNjYXBlSHRtbChjLnRpdGxlfHwnJyl9Ij4KICAgICAgICAgIDxpbnB1dCBpZD0idGMtYmFkZ2UiIGNsYXNzPSJzd2FsMi1pbnB1dCIgcGxhY2Vob2xkZXI9IkV0aWtldCIgdmFsdWU9IiR7ZXNjYXBlSHRtbChjLmNvZGV8fGMuY2F0ZWdvcnl8fCdURUtOxLBLJyl9Ij4KICAgICAgICAgIDxpbnB1dCBpZD0idGMtbGluayIgY2xhc3M9InN3YWwyLWlucHV0IiBwbGFjZWhvbGRlcj0iTGluayIgdmFsdWU9IiR7ZXNjYXBlSHRtbChjLmxpbmt8fCcnKX0iPgogICAgICAgICAgPHRleHRhcmVhIGlkPSJ0Yy10ZXh0IiBjbGFzcz0ic3dhbDItdGV4dGFyZWEiIHBsYWNlaG9sZGVyPSJBw6fEsWtsYW1hIj4ke2VzY2FwZUh0bWwoYy50ZXh0fHwnJyl9PC90ZXh0YXJlYT4KICAgICAgICAgIDx0ZXh0YXJlYSBpZD0idGMtc2NyaXB0IiBjbGFzcz0ic3dhbDItdGV4dGFyZWEiIHBsYWNlaG9sZGVyPSJTY3JpcHQiPiR7ZXNjYXBlSHRtbChjLnNjcmlwdHx8JycpfTwvdGV4dGFyZWE+CiAgICAgICAgYCwKICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAiS2F5ZGV0IiwKICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiAiVmF6Z2XDpyIsCiAgICAgICAgcHJlQ29uZmlybTogKCk9PnsKICAgICAgICAgICAgY29uc3QgdGl0bGUgPSAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RjLXRpdGxlJykudmFsdWV8fCcnKS50cmltKCk7CiAgICAgICAgICAgIGlmKCF0aXRsZSkgcmV0dXJuIFN3YWwuc2hvd1ZhbGlkYXRpb25NZXNzYWdlKCJCYcWfbMSxayB6b3J1bmx1Iik7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAuLi5jLAogICAgICAgICAgICAgICAgdGl0bGUsCiAgICAgICAgICAgICAgICBjb2RlOiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RjLWJhZGdlJykudmFsdWV8fCdURUtOxLBLJykudHJpbSgpLAogICAgICAgICAgICAgICAgbGluazogKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0Yy1saW5rJykudmFsdWV8fCcnKS50cmltKCksCiAgICAgICAgICAgICAgICB0ZXh0OiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RjLXRleHQnKS52YWx1ZXx8JycpLnRyaW0oKSwKICAgICAgICAgICAgICAgIHNjcmlwdDogKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0Yy1zY3JpcHQnKS52YWx1ZXx8JycpLnRyaW0oKSwKICAgICAgICAgICAgICAgIGNhdGVnb3J5OiAndGVrbmlrJwogICAgICAgICAgICB9OwogICAgICAgIH0KICAgIH0pLnRoZW4ocmVzPT57CiAgICAgICAgaWYoIXJlcy5pc0NvbmZpcm1lZCkgcmV0dXJuOwogICAgICAgIGFycltpZHhdPXJlcy52YWx1ZTsKICAgICAgICBzYXZlVGVjaE92ZXJyaWRlKGFycik7CiAgICAgICAgdHJ5eyBmaWx0ZXJUZWNoQ2FyZHMoKTsgfWNhdGNoKGUpe30KICAgIH0pOwp9CgpmdW5jdGlvbiBkZWxldGVUZWNoQ2FyZChrZXkpewogICAgU3dhbC5maXJlKHsKICAgICAgICB0aXRsZToiU2lsaW5zaW4gbWk/IiwKICAgICAgICB0ZXh0OiJCdSBrYXJ0IGxvY2FsIHZlcmlkZW4gc2lsaW5lY2VrLiIsCiAgICAgICAgaWNvbjoid2FybmluZyIsCiAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjp0cnVlLAogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiJTaWwiLAogICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IlZhemdlw6ciCiAgICB9KS50aGVuKHJlcz0+ewogICAgICAgIGlmKCFyZXMuaXNDb25maXJtZWQpIHJldHVybjsKICAgICAgICBjb25zdCBjdXIgPSBnZXRUZWNoT3ZlcnJpZGUoKTsKICAgICAgICBjb25zdCBiYXNlID0gKGRhdGFiYXNlfHxbXSkuZmlsdGVyKGM9PlN0cmluZyhjLmNhdGVnb3J5fHwnJykudG9Mb3dlckNhc2UoKT09PSd0ZWtuaWsnKTsKICAgICAgICBjb25zdCBhcnIgPSAoY3VyLmxlbmd0aCA/IGN1ciA6IGJhc2UpOwogICAgICAgIGNvbnN0IG5leHQgPSBhcnIuZmlsdGVyKChjLGkpPT50ZWNoQ2FyZEtleShjLGkpIT09a2V5KTsKICAgICAgICBzYXZlVGVjaE92ZXJyaWRlKG5leHQpOwogICAgICAgIHRyeXsgZmlsdGVyVGVjaENhcmRzKCk7IH1jYXRjaChlKXt9CiAgICB9KTsKfQoKZnVuY3Rpb24gcmVuZGVyVGVjaExpc3QodGFyZ2V0SWQsIGxpc3QsIHNob3dDYXRlZ29yeT1mYWxzZSl7CiAgICBjb25zdCBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRhcmdldElkKTsKICAgIGlmKCFlbCkgcmV0dXJuOwogICAgaWYoIWxpc3QgfHwgbGlzdC5sZW5ndGg9PT0wKXsKICAgICAgICBlbC5pbm5lckhUTUwgPSAnPGRpdiBzdHlsZT0icGFkZGluZzoxNnB4O29wYWNpdHk6LjciPkJ1IGJhxZ9sxLFrIGFsdMSxbmRhIGnDp2VyaWsgeW9rLjwvZGl2Pic7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgZWwuaW5uZXJIVE1MID0gbGlzdC5tYXAoKGMpPT5gCiAgICAgIDxkaXYgY2xhc3M9Im5ld3MtaXRlbSIgc3R5bGU9ImN1cnNvcjpwb2ludGVyIiBvbmNsaWNrPSJzaG93Q2FyZERldGFpbCgke0pTT04uc3RyaW5naWZ5KGMpLnJlcGxhY2UoLzwvZywnXHUwMDNjJyl9KSI+CiAgICAgICAgPHNwYW4gY2xhc3M9Im5ld3MtdGl0bGUiPiR7ZXNjYXBlSHRtbChjLnRpdGxlfHwnJyl9PC9zcGFuPgogICAgICAgICR7c2hvd0NhdGVnb3J5ID8gYDxzcGFuIGNsYXNzPSJuZXdzLXRhZyIgc3R5bGU9ImJhY2tncm91bmQ6I2VlZjJmZjtjb2xvcjojMmIzYThhO2JvcmRlcjoxcHggc29saWQgI2RkZTNmZiI+JHtlc2NhcGVIdG1sKGMuY2F0ZWdvcnl8fCcnKX08L3NwYW4+YDonJ30KICAgICAgICA8ZGl2IGNsYXNzPSJuZXdzLWRlc2MiIHN0eWxlPSJ3aGl0ZS1zcGFjZTpwcmUtbGluZSI+JHtlc2NhcGVIdG1sKGMudGV4dHx8JycpfTwvZGl2PgogICAgICAgICR7Yy5zY3JpcHQgPyBgPGRpdiBjbGFzcz0ic2NyaXB0LWJveCIgc3R5bGU9Im1hcmdpbi10b3A6MTBweCI+PGI+U2NyaXB0OjwvYj48ZGl2IHN0eWxlPSJtYXJnaW4tdG9wOjZweDt3aGl0ZS1zcGFjZTpwcmUtbGluZSI+JHtlc2NhcGVIdG1sKGMuc2NyaXB0fHwnJyl9PC9kaXY+PGRpdiBzdHlsZT0idGV4dC1hbGlnbjpyaWdodDttYXJnaW4tdG9wOjEwcHgiPjxidXR0b24gY2xhc3M9ImJ0biBidG4tY29weSIgb25jbGljaz0iZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7IGNvcHlUZXh0KCcke2VzY2FwZUZvckpzU3RyaW5nKGMuc2NyaXB0fHwnJyl9JykiPktvcHlhbGE8L2J1dHRvbj48L2Rpdj48L2Rpdj5gOicnfQogICAgICA8L2Rpdj4KICAgIGApLmpvaW4oJycpOwp9CgpmdW5jdGlvbiByZW5kZXJUZWNoRG9jcygpewogICAgY29uc3QgbWFwID0gewogICAgICAgIGJyb2FkY2FzdDogJ3gtYnJvYWRjYXN0LWRvY3MnLAogICAgICAgIGFjY2VzczogJ3gtYWNjZXNzLWRvY3MnLAogICAgICAgIGFwcDogJ3gtYXBwLWRvY3MnLAogICAgICAgIGFjdGl2YXRpb246ICd4LWFjdGl2YXRpb24tZG9jcycKICAgIH07CgogICAgT2JqZWN0LmtleXMobWFwKS5mb3JFYWNoKGtleT0+ewogICAgICAgIGNvbnN0IGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobWFwW2tleV0pOwogICAgICAgIGlmKCFlbCkgcmV0dXJuOwoKICAgICAgICB0cnl7CiAgICAgICAgICAgIGNvbnN0IGl0ZW1zID0gKFRFQ0hfRE9DX0NPTlRFTlQgJiYgVEVDSF9ET0NfQ09OVEVOVFtrZXldKSA/IFRFQ0hfRE9DX0NPTlRFTlRba2V5XSA6IFtdOwogICAgICAgICAgICBpZighQXJyYXkuaXNBcnJheShpdGVtcykgfHwgaXRlbXMubGVuZ3RoPT09MCl7CiAgICAgICAgICAgICAgICBlbC5pbm5lckhUTUwgPSAnPGRpdiBzdHlsZT0icGFkZGluZzoxMnB4IDJweDtvcGFjaXR5Oi43Ij5CdSBiYcWfbMSxayBhbHTEsW5kYSB0ZWtuaWsgZMO2a8O8bWFuIGJ1bHVuYW1hZMSxLjwvZGl2Pic7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGVsLmlubmVySFRNTCA9IGl0ZW1zLm1hcCgoaXQsaWR4KT0+YAogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZG9jLWNhcmQiPgogICAgICAgICAgICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9ImRvYy1oZWFkIiBvbmNsaWNrPSJ0b2dnbGVEb2NBY2NvcmRpb24odGhpcykiPgogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJkb2MtdGl0bGUiPiR7ZXNjYXBlSHRtbChpdC50aXRsZXx8KCfEsMOnZXJpayAnICsgKGlkeCsxKSkpfTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWNoZXZyb24tZG93biI+PC9pPgogICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZG9jLWJvZHkiIHN0eWxlPSJkaXNwbGF5Om5vbmU7IHdoaXRlLXNwYWNlOnByZS1saW5lIj4ke2VzY2FwZUh0bWwoaXQuYm9keXx8JycpfTwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIGApLmpvaW4oJycpOwogICAgICAgIH1jYXRjaChlcnIpewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCdyZW5kZXJUZWNoRG9jcyBlcnJvcicsIGVycik7CiAgICAgICAgICAgIGVsLmlubmVySFRNTCA9ICc8ZGl2IHN0eWxlPSJwYWRkaW5nOjEycHggMnB4O29wYWNpdHk6LjciPkTDtmvDvG1hbmxhciB5w7xrbGVuZW1lZGkuIChLb25zb2x1IGtvbnRyb2wgZWRpbik8L2Rpdj4nOwogICAgICAgIH0KICAgIH0pOwp9CgpmdW5jdGlvbiB0b2dnbGVEb2NBY2NvcmRpb24oYnRuKXsKICAgIHRyeXsKICAgICAgICBjb25zdCBjYXJkID0gYnRuLmNsb3Nlc3QoJy5kb2MtY2FyZCcpOwogICAgICAgIGlmKCFjYXJkKSByZXR1cm47CiAgICAgICAgY29uc3QgYm9keSA9IGNhcmQucXVlcnlTZWxlY3RvcignLmRvYy1ib2R5Jyk7CiAgICAgICAgaWYoIWJvZHkpIHJldHVybjsKICAgICAgICBjb25zdCBpc09wZW4gPSBib2R5LnN0eWxlLmRpc3BsYXkgIT09ICdub25lJzsKICAgICAgICBib2R5LnN0eWxlLmRpc3BsYXkgPSBpc09wZW4gPyAnbm9uZScgOiAnYmxvY2snOwogICAgICAgIGNhcmQuY2xhc3NMaXN0LnRvZ2dsZSgnb3BlbicsICFpc09wZW4pOwogICAgfWNhdGNoKGUpe30KfQoKCmZ1bmN0aW9uIHJlbmRlclRlY2hXaXphcmRJbnRvKHRhcmdldElkKXsKICAgIGNvbnN0IGJveCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRhcmdldElkKTsKICAgIGlmKCFib3gpIHJldHVybjsKCiAgICAvLyBBeXLEsSBzdGF0ZTogZnVsbHNjcmVlbiBpw6dpbmRla2kgZ8O2bcO8bMO8IHNpaGlyYmF6CiAgICB3aW5kb3cuZW1iZWRkZWRUd1N0YXRlID0gd2luZG93LmVtYmVkZGVkVHdTdGF0ZSB8fCB7IGN1cnJlbnRTdGVwOiAnc3RhcnQnLCBoaXN0b3J5OiBbXSB9OwoKICAgIC8vIFZlcmkgeW9rc2EgecO8a2xlCiAgICBpZighdGVjaFdpemFyZERhdGEgfHwgT2JqZWN0LmtleXModGVjaFdpemFyZERhdGEpLmxlbmd0aCA9PT0gMCl7CiAgICAgICAgYm94LmlubmVySFRNTCA9ICc8ZGl2IHN0eWxlPSJwYWRkaW5nOjE2cHg7b3BhY2l0eTouNyI+U2loaXJiYXogecO8a2xlbml5b3IuLi48L2Rpdj4nOwogICAgICAgIGxvYWRUZWNoV2l6YXJkRGF0YSgpLnRoZW4oKCk9PnJlbmRlclRlY2hXaXphcmRJbnRvKHRhcmdldElkKSk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGVtYmVkZGVkVHdSZW5kZXIodGFyZ2V0SWQpOwp9CgpmdW5jdGlvbiBlbWJlZGRlZFR3UmVuZGVyKHRhcmdldElkKXsKICAgIGNvbnN0IGJveCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRhcmdldElkKTsKICAgIGlmKCFib3gpIHJldHVybjsKCiAgICBjb25zdCBzdCA9IHdpbmRvdy5lbWJlZGRlZFR3U3RhdGUgfHwgeyBjdXJyZW50U3RlcDonc3RhcnQnLCBoaXN0b3J5OltdIH07CiAgICBjb25zdCBzdGVwRGF0YSA9IHRlY2hXaXphcmREYXRhW3N0LmN1cnJlbnRTdGVwXTsKCiAgICBpZighc3RlcERhdGEpewogICAgICAgIGJveC5pbm5lckhUTUwgPSBgPGRpdiBjbGFzcz0idGVjaC1hbGVydCI+SGF0YTogQWTEsW0gYnVsdW5hbWFkxLEgKCR7ZXNjYXBlSHRtbChTdHJpbmcoc3QuY3VycmVudFN0ZXApKX0pLjwvZGl2PmA7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGNvbnN0IGJhY2tWaXNpYmxlID0gc3QuaGlzdG9yeSAmJiBzdC5oaXN0b3J5Lmxlbmd0aD4wOwoKICAgIGxldCBodG1sID0gYAogICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7IGdhcDo4cHg7IGFsaWduLWl0ZW1zOmNlbnRlcjsganVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47IG1hcmdpbi1ib3R0b206MTJweDsgZmxleC13cmFwOndyYXAiPgogICAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDsgZ2FwOjhweDsgYWxpZ24taXRlbXM6Y2VudGVyIj4KICAgICAgICAgICR7YmFja1Zpc2libGUgPyBgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJ0ZWNoLWJ0biB0ZWNoLWJ0bi1vcHRpb24iIG9uY2xpY2s9ImVtYmVkZGVkVHdCYWNrKCcke3RhcmdldElkfScpIj7irIUgR2VyaTwvYnV0dG9uPmAgOiAnJ30KICAgICAgICAgIDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0idGVjaC1idG4gdGVjaC1idG4tb3B0aW9uIiBvbmNsaWNrPSJlbWJlZGRlZFR3UmVzZXQoJyR7dGFyZ2V0SWR9JykiPuKGuyBTxLFmxLFybGE8L2J1dHRvbj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2IHN0eWxlPSJvcGFjaXR5Oi43OyBmb250LXNpemU6LjlyZW0iPkFkxLFtOiAke2VzY2FwZUh0bWwoc3RlcERhdGEudGl0bGUgfHwgJycpfTwvZGl2PgogICAgICA8L2Rpdj4KCiAgICAgIDxkaXYgY2xhc3M9InRlY2gtc3RlcC10aXRsZSI+JHtlc2NhcGVIdG1sKHN0ZXBEYXRhLnRpdGxlIHx8ICcnKX08L2Rpdj4KICAgIGA7CgogICAgaWYoc3RlcERhdGEudGV4dCl7CiAgICAgICAgaHRtbCArPSBgPGRpdiBzdHlsZT0iZm9udC1zaXplOjFyZW07IG1hcmdpbjoxMHB4IDA7IHdoaXRlLXNwYWNlOnByZS1saW5lIj4ke2VzY2FwZUh0bWwoc3RlcERhdGEudGV4dCl9PC9kaXY+YDsKICAgIH0KICAgIGlmKHN0ZXBEYXRhLnNjcmlwdCl7CiAgICAgICAgaHRtbCArPSBgPGRpdiBjbGFzcz0idGVjaC1zY3JpcHQtYm94Ij48c3BhbiBjbGFzcz0idGVjaC1zY3JpcHQtbGFiZWwiPk3DvMWfdGVyaXllIGlsZXRpbGVjZWs6PC9zcGFuPiR7ZXNjYXBlSHRtbChzdGVwRGF0YS5zY3JpcHQpfTwvZGl2PmA7CiAgICB9CiAgICBpZihzdGVwRGF0YS5hbGVydCl7CiAgICAgICAgaHRtbCArPSBgPGRpdiBjbGFzcz0idGVjaC1hbGVydCI+JHtlc2NhcGVIdG1sKHN0ZXBEYXRhLmFsZXJ0KX08L2Rpdj5gOwogICAgfQoKICAgIGlmKEFycmF5LmlzQXJyYXkoc3RlcERhdGEuYnV0dG9ucykgJiYgc3RlcERhdGEuYnV0dG9ucy5sZW5ndGgpewogICAgICAgIGh0bWwgKz0gYDxkaXYgY2xhc3M9InRlY2gtYnV0dG9ucy1hcmVhIj5gOwogICAgICAgIHN0ZXBEYXRhLmJ1dHRvbnMuZm9yRWFjaChidG49PnsKICAgICAgICAgICAgY29uc3QgY2xzID0gYnRuLnN0eWxlID09PSAnb3B0aW9uJyA/ICd0ZWNoLWJ0bi1vcHRpb24nIDogJ3RlY2gtYnRuLXByaW1hcnknOwogICAgICAgICAgICBodG1sICs9IGA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9InRlY2gtYnRuICR7Y2xzfSIgb25jbGljaz0iZW1iZWRkZWRUd0NoYW5nZVN0ZXAoJyR7dGFyZ2V0SWR9JywnJHtlc2NhcGVGb3JKc1N0cmluZyhidG4ubmV4dHx8J3N0YXJ0Jyl9JykiPiR7ZXNjYXBlSHRtbChidG4udGV4dHx8JycpfTwvYnV0dG9uPmA7CiAgICAgICAgfSk7CiAgICAgICAgaHRtbCArPSBgPC9kaXY+YDsKICAgIH0KCiAgICBib3guaW5uZXJIVE1MID0gaHRtbDsKfQoKZnVuY3Rpb24gZW1iZWRkZWRUd0NoYW5nZVN0ZXAodGFyZ2V0SWQsIG5ld1N0ZXApewogICAgd2luZG93LmVtYmVkZGVkVHdTdGF0ZSA9IHdpbmRvdy5lbWJlZGRlZFR3U3RhdGUgfHwgeyBjdXJyZW50U3RlcDonc3RhcnQnLCBoaXN0b3J5OltdIH07CiAgICB3aW5kb3cuZW1iZWRkZWRUd1N0YXRlLmhpc3RvcnkucHVzaCh3aW5kb3cuZW1iZWRkZWRUd1N0YXRlLmN1cnJlbnRTdGVwKTsKICAgIHdpbmRvdy5lbWJlZGRlZFR3U3RhdGUuY3VycmVudFN0ZXAgPSBuZXdTdGVwOwogICAgZW1iZWRkZWRUd1JlbmRlcih0YXJnZXRJZCk7Cn0KZnVuY3Rpb24gZW1iZWRkZWRUd0JhY2sodGFyZ2V0SWQpewogICAgd2luZG93LmVtYmVkZGVkVHdTdGF0ZSA9IHdpbmRvdy5lbWJlZGRlZFR3U3RhdGUgfHwgeyBjdXJyZW50U3RlcDonc3RhcnQnLCBoaXN0b3J5OltdIH07CiAgICBpZih3aW5kb3cuZW1iZWRkZWRUd1N0YXRlLmhpc3RvcnkubGVuZ3RoKXsKICAgICAgICB3aW5kb3cuZW1iZWRkZWRUd1N0YXRlLmN1cnJlbnRTdGVwID0gd2luZG93LmVtYmVkZGVkVHdTdGF0ZS5oaXN0b3J5LnBvcCgpOwogICAgICAgIGVtYmVkZGVkVHdSZW5kZXIodGFyZ2V0SWQpOwogICAgfQp9CmZ1bmN0aW9uIGVtYmVkZGVkVHdSZXNldCh0YXJnZXRJZCl7CiAgICB3aW5kb3cuZW1iZWRkZWRUd1N0YXRlID0geyBjdXJyZW50U3RlcDonc3RhcnQnLCBoaXN0b3J5OltdIH07CiAgICBlbWJlZGRlZFR3UmVuZGVyKHRhcmdldElkKTsKfQoKLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICBURUtOxLBLIEtBUlRMQVIgKEZVTExTQ1JFRU4pCiAgIC0gRXNraSBrYXJ0IGfDtnLDvG7DvG3DvCAobGlzdGUpCiAgIC0gRMO8emVubGVtZSwgRS1UYWJsbyAoRGF0YSkgw7x6ZXJpbmRlbiAodXBkYXRlQ29udGVudC9hZGRDYXJkKQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovCgpmdW5jdGlvbiBfX2dldFRlY2hDYXJkc0ZvclVpKCl7CiAgICByZXR1cm4gKGRhdGFiYXNlfHxbXSkKICAgICAgLm1hcCgoYywgaSk9Pih7IC4uLmMsIF9fZGJJbmRleDogaSB9KSkKICAgICAgLmZpbHRlcihjPT5TdHJpbmcoYy5jYXRlZ29yeXx8JycpLnRvTG93ZXJDYXNlKCk9PT0ndGVrbmlrJyAmJiBTdHJpbmcoYy5zdGF0dXN8fCcnKS50b0xvd2VyQ2FzZSgpIT09J3Bhc2lmJyk7Cn0KCmFzeW5jIGZ1bmN0aW9uIGFkZFRlY2hDYXJkU2hlZXQoKXsKICAgIGlmKCFpc0FkbWluTW9kZSkgcmV0dXJuOwogICAgY29uc3QgeyB2YWx1ZTogdiB9ID0gYXdhaXQgU3dhbC5maXJlKHsKICAgICAgdGl0bGU6ICdUZWtuaWsgS2FydCBFa2xlJywKICAgICAgaHRtbDogYAogICAgICAgIDxpbnB1dCBpZD0idGMtdGl0bGUiIGNsYXNzPSJzd2FsMi1pbnB1dCIgcGxhY2Vob2xkZXI9IkJhxZ9sxLFrIj4KICAgICAgICA8dGV4dGFyZWEgaWQ9InRjLXRleHQiIGNsYXNzPSJzd2FsMi10ZXh0YXJlYSIgcGxhY2Vob2xkZXI9IkHDp8Sxa2xhbWEiPjwvdGV4dGFyZWE+CiAgICAgICAgPHRleHRhcmVhIGlkPSJ0Yy1zY3JpcHQiIGNsYXNzPSJzd2FsMi10ZXh0YXJlYSIgcGxhY2Vob2xkZXI9IlNjcmlwdCAob3BzaXlvbmVsKSI+PC90ZXh0YXJlYT4KICAgICAgICA8aW5wdXQgaWQ9InRjLWxpbmsiIGNsYXNzPSJzd2FsMi1pbnB1dCIgcGxhY2Vob2xkZXI9IkxpbmsgKG9wc2l5b25lbCkiPgogICAgICBgLAogICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLAogICAgICBjb25maXJtQnV0dG9uVGV4dDogJ0VrbGUnLAogICAgICBjYW5jZWxCdXR0b25UZXh0OiAnVmF6Z2XDpycsCiAgICAgIHByZUNvbmZpcm06ICgpPT57CiAgICAgICAgY29uc3QgdGl0bGUgPSAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RjLXRpdGxlJykudmFsdWV8fCcnKS50cmltKCk7CiAgICAgICAgaWYoIXRpdGxlKSByZXR1cm4gU3dhbC5zaG93VmFsaWRhdGlvbk1lc3NhZ2UoJ0JhxZ9sxLFrIHpvcnVubHUnKTsKICAgICAgICBjb25zdCB0b2RheSA9IG5ldyBEYXRlKCk7CiAgICAgICAgY29uc3QgZGF0ZVN0ciA9IHRvZGF5LmdldERhdGUoKSArICIuIiArICh0b2RheS5nZXRNb250aCgpKzEpICsgIi4iICsgdG9kYXkuZ2V0RnVsbFllYXIoKTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgY2FyZFR5cGU6ICdjYXJkJywKICAgICAgICAgIGNhdGVnb3J5OiAnVGVrbmlrJywKICAgICAgICAgIHRpdGxlLAogICAgICAgICAgdGV4dDogKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0Yy10ZXh0JykudmFsdWV8fCcnKS50cmltKCksCiAgICAgICAgICBzY3JpcHQ6IChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGMtc2NyaXB0JykudmFsdWV8fCcnKS50cmltKCksCiAgICAgICAgICBjb2RlOiAnJywKICAgICAgICAgIGxpbms6IChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGMtbGluaycpLnZhbHVlfHwnJykudHJpbSgpLAogICAgICAgICAgc3RhdHVzOiAnQWt0aWYnLAogICAgICAgICAgZGF0ZTogZGF0ZVN0cgogICAgICAgIH07CiAgICAgIH0KICAgIH0pOwogICAgaWYoIXYpIHJldHVybjsKCiAgICBTd2FsLmZpcmUoeyB0aXRsZTogJ0VrbGVuaXlvci4uLicsIGRpZE9wZW46ICgpID0+IFN3YWwuc2hvd0xvYWRpbmcoKSwgc2hvd0NvbmZpcm1CdXR0b246ZmFsc2UgfSk7CiAgICB0cnl7CiAgICAgIGNvbnN0IHIgPSBhd2FpdCBmZXRjaChTQ1JJUFRfVVJMLCB7CiAgICAgICAgbWV0aG9kOiAnUE9TVCcsCiAgICAgICAgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogJ3RleHQvcGxhaW47Y2hhcnNldD11dGYtOCcgfSwKICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGFjdGlvbjogJ2FkZENhcmQnLCB1c2VybmFtZTogY3VycmVudFVzZXIsIHRva2VuOiBnZXRUb2tlbigpLCAuLi52IH0pCiAgICAgIH0pOwogICAgICBjb25zdCBkID0gYXdhaXQgci5qc29uKCk7CiAgICAgIGlmKGQucmVzdWx0PT09J3N1Y2Nlc3MnKXsKICAgICAgICBTd2FsLmZpcmUoeyBpY29uOidzdWNjZXNzJywgdGl0bGU6J0VrbGVuZGknLCB0aW1lcjogMTIwMCwgc2hvd0NvbmZpcm1CdXR0b246ZmFsc2UgfSk7CiAgICAgICAgYXdhaXQgbG9hZENvbnRlbnREYXRhKCk7CiAgICAgICAgZmlsdGVyVGVjaENhcmRzKCk7CiAgICAgIH1lbHNlewogICAgICAgIFN3YWwuZmlyZSgnSGF0YScsIGQubWVzc2FnZXx8J0VrbGVuZW1lZGknLCAnZXJyb3InKTsKICAgICAgfQogICAgfWNhdGNoKGUpewogICAgICBTd2FsLmZpcmUoJ0hhdGEnLCdTdW51Y3UgaGF0YXPEsS4nLCdlcnJvcicpOwogICAgfQp9Cgphc3luYyBmdW5jdGlvbiBlZGl0VGVjaENhcmRTaGVldChkYkluZGV4KXsKICAgIGlmKCFpc0FkbWluTW9kZSkgcmV0dXJuOwogICAgY29uc3QgaXQgPSAoZGF0YWJhc2V8fFtdKVtkYkluZGV4XTsKICAgIGlmKCFpdCkgcmV0dXJuOwogICAgY29uc3QgeyB2YWx1ZTogdiB9ID0gYXdhaXQgU3dhbC5maXJlKHsKICAgICAgdGl0bGU6ICdUZWtuaWsgS2FydMSxIETDvHplbmxlJywKICAgICAgaHRtbDogYAogICAgICAgIDxpbnB1dCBpZD0idGMtdGl0bGUiIGNsYXNzPSJzd2FsMi1pbnB1dCIgcGxhY2Vob2xkZXI9IkJhxZ9sxLFrIiB2YWx1ZT0iJHtlc2NhcGVIdG1sKGl0LnRpdGxlfHwnJyl9Ij4KICAgICAgICA8dGV4dGFyZWEgaWQ9InRjLXRleHQiIGNsYXNzPSJzd2FsMi10ZXh0YXJlYSIgcGxhY2Vob2xkZXI9IkHDp8Sxa2xhbWEiPiR7ZXNjYXBlSHRtbChpdC50ZXh0fHwnJyl9PC90ZXh0YXJlYT4KICAgICAgICA8dGV4dGFyZWEgaWQ9InRjLXNjcmlwdCIgY2xhc3M9InN3YWwyLXRleHRhcmVhIiBwbGFjZWhvbGRlcj0iU2NyaXB0Ij4ke2VzY2FwZUh0bWwoaXQuc2NyaXB0fHwnJyl9PC90ZXh0YXJlYT4KICAgICAgICA8aW5wdXQgaWQ9InRjLWxpbmsiIGNsYXNzPSJzd2FsMi1pbnB1dCIgcGxhY2Vob2xkZXI9IkxpbmsiIHZhbHVlPSIke2VzY2FwZUh0bWwoaXQubGlua3x8JycpfSI+CiAgICAgIGAsCiAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAnS2F5ZGV0JywKICAgICAgY2FuY2VsQnV0dG9uVGV4dDogJ1Zhemdlw6cnLAogICAgICBwcmVDb25maXJtOiAoKT0+ewogICAgICAgIGNvbnN0IHRpdGxlID0gKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0Yy10aXRsZScpLnZhbHVlfHwnJykudHJpbSgpOwogICAgICAgIGlmKCF0aXRsZSkgcmV0dXJuIFN3YWwuc2hvd1ZhbGlkYXRpb25NZXNzYWdlKCdCYcWfbMSxayB6b3J1bmx1Jyk7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHRpdGxlLAogICAgICAgICAgdGV4dDogKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0Yy10ZXh0JykudmFsdWV8fCcnKS50cmltKCksCiAgICAgICAgICBzY3JpcHQ6IChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGMtc2NyaXB0JykudmFsdWV8fCcnKS50cmltKCksCiAgICAgICAgICBsaW5rOiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RjLWxpbmsnKS52YWx1ZXx8JycpLnRyaW0oKSwKICAgICAgICB9OwogICAgICB9CiAgICB9KTsKICAgIGlmKCF2KSByZXR1cm47CiAgICBjb25zdCBvcmlnaW5hbFRpdGxlID0gaXQudGl0bGU7CiAgICAvLyBzZW5kVXBkYXRlIHPEsXJheWxhIHVwZGF0ZSBlZGVyCiAgICBpZih2LnRleHQgIT09IChpdC50ZXh0fHwnJykpIHNlbmRVcGRhdGUob3JpZ2luYWxUaXRsZSwgJ1RleHQnLCB2LnRleHQsICdjYXJkJyk7CiAgICBzZXRUaW1lb3V0KCgpPT57IGlmKHYuc2NyaXB0ICE9PSAoaXQuc2NyaXB0fHwnJykpIHNlbmRVcGRhdGUob3JpZ2luYWxUaXRsZSwgJ1NjcmlwdCcsIHYuc2NyaXB0LCAnY2FyZCcpOyB9LCAzNTApOwogICAgc2V0VGltZW91dCgoKT0+eyBpZih2LmxpbmsgIT09IChpdC5saW5rfHwnJykpIHNlbmRVcGRhdGUob3JpZ2luYWxUaXRsZSwgJ0xpbmsnLCB2LmxpbmssICdjYXJkJyk7IH0sIDcwMCk7CiAgICBzZXRUaW1lb3V0KCgpPT57IGlmKHYudGl0bGUgIT09IG9yaWdpbmFsVGl0bGUpIHNlbmRVcGRhdGUob3JpZ2luYWxUaXRsZSwgJ1RpdGxlJywgdi50aXRsZSwgJ2NhcmQnKTsgfSwgMTEwMCk7Cn0KCmZ1bmN0aW9uIGRlbGV0ZVRlY2hDYXJkU2hlZXQoZGJJbmRleCl7CiAgICBpZighaXNBZG1pbk1vZGUpIHJldHVybjsKICAgIGNvbnN0IGl0ID0gKGRhdGFiYXNlfHxbXSlbZGJJbmRleF07CiAgICBpZighaXQpIHJldHVybjsKICAgIFN3YWwuZmlyZSh7CiAgICAgIHRpdGxlOidTaWxpbnNpbiBtaT8nLAogICAgICB0ZXh0OidLYXJ0IHBhc2lmZSBhbMSxbmFjYWsuJywKICAgICAgaWNvbjond2FybmluZycsCiAgICAgIHNob3dDYW5jZWxCdXR0b246dHJ1ZSwKICAgICAgY29uZmlybUJ1dHRvblRleHQ6J1NpbCcsCiAgICAgIGNhbmNlbEJ1dHRvblRleHQ6J1Zhemdlw6cnCiAgICB9KS50aGVuKHJlcz0+ewogICAgICBpZighcmVzLmlzQ29uZmlybWVkKSByZXR1cm47CiAgICAgIHNlbmRVcGRhdGUoaXQudGl0bGUsICdTdGF0dXMnLCAnUGFzaWYnLCAnY2FyZCcpOwogICAgfSk7Cn0KCmZ1bmN0aW9uIHJlbmRlclRlY2hDYXJkc1RhYihxPScnKXsKICAgIGNvbnN0IGJveCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd4LWNhcmRzJyk7CiAgICBpZighYm94KSByZXR1cm47CgogICAgY29uc3QgcXVlcnkgPSBTdHJpbmcocXx8JycpLnRyaW0oKS50b0xvd2VyQ2FzZSgpOwogICAgY29uc3QgYWxsID0gX19nZXRUZWNoQ2FyZHNGb3JVaSgpOwogICAgY29uc3QgZmlsdGVyZWQgPSAhcXVlcnkgPyBhbGwgOiBhbGwuZmlsdGVyKGM9PnsKICAgICAgY29uc3QgaGF5ID0gYCR7Yy50aXRsZXx8Jyd9ICR7Yy50ZXh0fHwnJ30gJHtjLnNjcmlwdHx8Jyd9ICR7Yy5saW5rfHwnJ31gLnRvTG93ZXJDYXNlKCk7CiAgICAgIHJldHVybiBoYXkuaW5jbHVkZXMocXVlcnkpOwogICAgfSk7CgogICAgY29uc3QgYmFyID0gKGlzQWRtaW5Nb2RlICYmIGlzRWRpdGluZ0FjdGl2ZSkKICAgICAgPyBgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2dhcDoxMHB4O2FsaWduLWl0ZW1zOmNlbnRlcjtmbGV4LXdyYXA6d3JhcDttYXJnaW4tYm90dG9tOjEwcHgiPgogICAgICAgICAgIDxidXR0b24gY2xhc3M9IngtYnRuIHgtYnRuLWFkbWluIiBvbmNsaWNrPSJhZGRUZWNoQ2FyZFNoZWV0KCkiPjxpIGNsYXNzPSJmYXMgZmEtcGx1cyI+PC9pPiBLYXJ0IEVrbGU8L2J1dHRvbj4KICAgICAgICAgPC9kaXY+YAogICAgICA6IGBgOwoKICAgIGlmKCFmaWx0ZXJlZC5sZW5ndGgpewogICAgICBib3guaW5uZXJIVE1MID0gYmFyICsgJzxkaXYgc3R5bGU9Im9wYWNpdHk6Ljc7cGFkZGluZzoxNnB4Ij5LYXnEsXQgYnVsdW5hbWFkxLEuPC9kaXY+JzsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGJveC5pbm5lckhUTUwgPSBiYXIgKyBgCiAgICAgIDxkaXYgY2xhc3M9IngtY2FyZC1ncmlkIj4KICAgICAgICAke2ZpbHRlcmVkLm1hcChjPT57CiAgICAgICAgICBjb25zdCBoYXNEZXRhaWwgPSAoKGMudGV4dHx8JycpLmxlbmd0aCA+IDE4MCkgfHwgKChjLnNjcmlwdHx8JycpLmxlbmd0aCA+IDEyMCkgfHwgISEoYy5saW5rfHwnJyk7CiAgICAgICAgICBjb25zdCBkZXRhaWxPYmogPSB7IHRpdGxlOmMudGl0bGUsIHRleHQ6Yy50ZXh0fHwnJywgc2NyaXB0OmMuc2NyaXB0fHwnJywgbGluazpjLmxpbmt8fCcnIH07CiAgICAgICAgICBjb25zdCBlZGl0ID0gKGlzQWRtaW5Nb2RlICYmIGlzRWRpdGluZ0FjdGl2ZSkKICAgICAgICAgICAgPyBgCiAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0ieC1idG4geC1idG4tYWRtaW4iIG9uY2xpY2s9ImV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO2VkaXRUZWNoQ2FyZFNoZWV0KCR7Yy5fX2RiSW5kZXh9KSI+PGkgY2xhc3M9ImZhcyBmYS1wZW4iPjwvaT4gRMO8emVubGU8L2J1dHRvbj4KICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJ4LWJ0biB4LWJ0bi1hZG1pbiIgb25jbGljaz0iZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7ZGVsZXRlVGVjaENhcmRTaGVldCgke2MuX19kYkluZGV4fSkiPjxpIGNsYXNzPSJmYXMgZmEtdHJhc2giPjwvaT4gU2lsPC9idXR0b24+CiAgICAgICAgICAgIGAKICAgICAgICAgICAgOiBgYDsKICAgICAgICAgIHJldHVybiBgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9IngtY2FyZCIgc3R5bGU9ImN1cnNvcjpwb2ludGVyIiBvbmNsaWNrPSdzaG93Q2FyZERldGFpbCgke0pTT04uc3RyaW5naWZ5KGRldGFpbE9iaikucmVwbGFjZSgvPC9nLCdcXHUwMDNjJyl9KSc+CiAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ieC1jYXJkLWhlYWQiPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ieC1jYXJkLXRpdGxlIj4ke2VzY2FwZUh0bWwoYy50aXRsZXx8JycpfTwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ieC1jYXJkLWJhZGdlIj5URUtOxLBLPC9kaXY+CiAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ieC1jYXJkLWJvZHkiPgogICAgICAgICAgICAgICAgJHsoYy50ZXh0fHwnJykgPyBgPGRpdiBjbGFzcz0ieC1jYXJkLXRleHQgeC1jYXJkLXRleHQtdHJ1bmNhdGUiPiR7ZXNjYXBlSHRtbChjLnRleHR8fCcnKX08L2Rpdj5gIDogYDxkaXYgc3R5bGU9Im9wYWNpdHk6LjciPsSww6dlcmlrIHlvazwvZGl2PmB9CiAgICAgICAgICAgICAgICAke2hhc0RldGFpbCA/IGA8YnV0dG9uIGNsYXNzPSJ4LXJlYWRtb3JlIiBvbmNsaWNrPSdldmVudC5zdG9wUHJvcGFnYXRpb24oKTtzaG93Q2FyZERldGFpbCgke0pTT04uc3RyaW5naWZ5KGRldGFpbE9iaikucmVwbGFjZSgvPC9nLCdcXHUwMDNjJyl9KSc+RGV2YW0gb2t1PC9idXR0b24+YCA6IGBgfQogICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgIDxkaXYgY2xhc3M9IngtY2FyZC1hY3Rpb25zIiBvbmNsaWNrPSJldmVudC5zdG9wUHJvcGFnYXRpb24oKTsiPgogICAgICAgICAgICAgICAgJHsoYy5zY3JpcHR8fCcnKSA/IGA8YnV0dG9uIGNsYXNzPSJ4LWJ0biB4LWJ0bi1jb3B5IiBvbmNsaWNrPSdjb3B5VGV4dCgke0pTT04uc3RyaW5naWZ5KGMuc2NyaXB0fHwnJyl9KSc+PGkgY2xhc3M9ImZhcyBmYS1jb3B5Ij48L2k+IEtvcHlhbGE8L2J1dHRvbj5gIDogYGB9CiAgICAgICAgICAgICAgICAke2VkaXR9CiAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgYDsKICAgICAgICB9KS5qb2luKCcnKX0KICAgICAgPC9kaXY+CiAgICBgOwp9CgpmdW5jdGlvbiBmaWx0ZXJUZWNoQ2FyZHMoKXsKICAgIGNvbnN0IGlucCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd4LWNhcmRzLXNlYXJjaCcpOwogICAgcmVuZGVyVGVjaENhcmRzVGFiKGlucCA/IGlucC52YWx1ZSA6ICcnKTsKfQoKCmZ1bmN0aW9uIGFwcGx5U3BvcnRzUmlnaHRzKCl7CiAgICBpZighQXJyYXkuaXNBcnJheShzcG9ydHNEYXRhKSB8fCBzcG9ydHNEYXRhLmxlbmd0aD09PTApIHJldHVybjsKICAgIGNvbnN0IHJpZ2h0cyA9ICh3aW5kb3cuc3BvcnRSaWdodHNGcm9tU2hlZXQgJiYgd2luZG93LnNwb3J0UmlnaHRzRnJvbVNoZWV0Lmxlbmd0aCkgPyB3aW5kb3cuc3BvcnRSaWdodHNGcm9tU2hlZXQgOiBTUE9SVFNfUklHSFRTX0ZBTExCQUNLOwogICAgc3BvcnRzRGF0YS5mb3JFYWNoKHM9PnsKICAgICAgICBjb25zdCBoYXkgPSBgJHtzLnRpdGxlfHwnJ30gJHtzLmRlc2N8fCcnfSAke3MuZGV0YWlsfHwnJ31gLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgY29uc3QgaGl0ID0gcmlnaHRzLmZpbmQocj0+aGF5LmluY2x1ZGVzKFN0cmluZyhyLm5hbWV8fCcnKS50b0xvd2VyQ2FzZSgpLnJlcGxhY2VBbGwoJyonLCcnKS50cmltKCkuc3BsaXQoJyAnKVswXSkpOwogICAgICAgIGlmKGhpdCl7CiAgICAgICAgICAgIGNvbnN0IGV4dHJhID0gYFlhecSxbiBoYWtrxLEgYml0acWfOiAke2hpdC5lbmQgfHwgaGl0LmR1cmF0aW9ufWA7CiAgICAgICAgICAgIGlmKHMudGlwICYmICFzLnRpcC5pbmNsdWRlcygnWWF5xLFuIGhha2vEsScpKSBzLnRpcCA9IGAke3MudGlwfSDigKIgJHtleHRyYX1gOwogICAgICAgICAgICBlbHNlIGlmKCFzLnRpcCkgcy50aXAgPSBleHRyYTsKICAgICAgICAgICAgaWYocy5kZXRhaWwgJiYgIXMuZGV0YWlsLmluY2x1ZGVzKCdZYXnEsW4gaGFra8SxJykpIHMuZGV0YWlsID0gYCR7cy5kZXRhaWx9XG5cbiR7ZXh0cmF9YDsKICAgICAgICAgICAgZWxzZSBpZighcy5kZXRhaWwpIHMuZGV0YWlsID0gZXh0cmE7CiAgICAgICAgfQogICAgfSk7Cn0KCi8vIFZhciBvbGFuIHZlcmkgecO8a2xlbWVzaSBiaXR0aWt0ZW4gc29ucmEgaGFrIGJpbGdpc2kgZWtsZQpjb25zdCBfb3JpZ19hZnRlckRhdGFMb2FkZWQgPSB3aW5kb3cuYWZ0ZXJEYXRhTG9hZGVkOwp3aW5kb3cuYWZ0ZXJEYXRhTG9hZGVkID0gZnVuY3Rpb24oKXsKICAgIHRyeXsgaWYodHlwZW9mIF9vcmlnX2FmdGVyRGF0YUxvYWRlZD09PSdmdW5jdGlvbicpIF9vcmlnX2FmdGVyRGF0YUxvYWRlZCgpOyB9Y2F0Y2goZSl7fQogICAgdHJ5eyBhcHBseVNwb3J0c1JpZ2h0cygpOyB9Y2F0Y2goZSl7fQp9OwoKCi8vID09PT09PT09PT09PT09PT09PT09PT0KLy8gVEVDSCBET0NTIC0gU0hFRVQgQklORAovLyA9PT09PT09PT09PT09PT09PT09PT09CmxldCBfX3RlY2hEb2NzQ2FjaGUgPSBudWxsOwpsZXQgX190ZWNoRG9jc0xvYWRlZEF0ID0gMDsKbGV0IF9fdGVjaENhdHNDYWNoZSA9IG51bGw7CmxldCBfX3RlY2hDYXRzTG9hZGVkQXQgPSAwOwoKY29uc3QgVEVDSF9UQUJfTEFCRUxTID0gewogIGJyb2FkY2FzdDogJ1lhecSxbiBTb3J1bmxhcsSxJywKICBhY2Nlc3M6ICdFcmnFn2ltIFNvcnVubGFyxLEnLAogIGFwcDogJ0FwcCBIYXRhbGFyxLEnLAogIGFjdGl2YXRpb246ICdBa3RpdmFzeW9uIFNvcnVubGFyxLEnLAogIGluZm86ICdTxLFrIFNvcnVsYW4gU29ydWxhcicsCiAgcGF5bWVudDogJ8OWZGVtZSBTb3J1bmxhcsSxJwp9OwoKZnVuY3Rpb24gX19ub3JtYWxpemVUZWNoVGFiKHRhYil7CiAgLy8gdGFiIGlkczogYnJvYWRjYXN0LCBhY2Nlc3MsIGFwcCwgYWN0aXZhdGlvbgogIHJldHVybiB0YWI7Cn0KZnVuY3Rpb24gX19ub3JtYWxpemVUZWNoQ2F0ZWdvcnkoY2F0KXsKICBjb25zdCBjID0gKGNhdHx8IiIpLnRvU3RyaW5nKCkudHJpbSgpLnRvTG93ZXJDYXNlKCk7CiAgaWYoYy5zdGFydHNXaXRoKCJ5YXkiKSkgcmV0dXJuICJicm9hZGNhc3QiOwogIGlmKGMuc3RhcnRzV2l0aCgiZXJpIikpIHJldHVybiAiYWNjZXNzIjsKICBpZihjLnN0YXJ0c1dpdGgoImFwcCIpKSByZXR1cm4gImFwcCI7CiAgaWYoYy5zdGFydHNXaXRoKCJha3QiKSkgcmV0dXJuICJhY3RpdmF0aW9uIjsKICBpZihjLnN0YXJ0c1dpdGgoImJpbCIpKSByZXR1cm4gImluZm8iOwogIGlmKGMuc3RhcnRzV2l0aCgiw7ZkZSIpIHx8IGMuc3RhcnRzV2l0aCgib2RlIikgfHwgYy5pbmNsdWRlcygiw7ZkZW1lIikgfHwgYy5pbmNsdWRlcygib2RlbWUiKSkgcmV0dXJuICJwYXltZW50IjsKICByZXR1cm4gIiI7Cn0KCmFzeW5jIGZ1bmN0aW9uIF9fZmV0Y2hUZWNoRG9jcygpewogIGlmKCFTQ1JJUFRfVVJMKXsKICAgIGlmKHR5cGVvZiBzaG93R2xvYmFsRXJyb3IgPT09ICJmdW5jdGlvbiIpIHNob3dHbG9iYWxFcnJvcigiU0NSSVBUX1VSTCBheWFybMSxIGRlxJ9pbC4gU2HEnyBhbHR0YW4gYXlhcmxheWFiaWxpcnNpbi4iKTsKICAgIHRocm93IG5ldyBFcnJvcigiU0NSSVBUX1VSTCBtaXNzaW5nIik7CiAgfQogIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKFNDUklQVF9VUkwsIHsKICAgIG1ldGhvZDogJ1BPU1QnLAogICAgaGVhZGVyczogeyAiQ29udGVudC1UeXBlIjogInRleHQvcGxhaW47Y2hhcnNldD11dGYtOCIgfSwKICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgYWN0aW9uOiAiZ2V0VGVjaERvY3MiIH0pCiAgfSk7CiAgY29uc3QgZGF0YSA9IGF3YWl0IHJlcy5qc29uKCk7CiAgaWYoZGF0YS5yZXN1bHQgIT09ICJzdWNjZXNzIikgdGhyb3cgbmV3IEVycm9yKGRhdGEubWVzc2FnZSB8fCAiZ2V0VGVjaERvY3MgZmFpbGVkIik7CiAgY29uc3Qgcm93cyA9IEFycmF5LmlzQXJyYXkoZGF0YS5kYXRhKSA/IGRhdGEuZGF0YSA6IFtdOwogIHJldHVybiByb3dzCiAgICAuZmlsdGVyKHIgPT4gKHIuRHVydW18fCIiKS50b1N0cmluZygpLnRyaW0oKS50b0xvd2VyQ2FzZSgpICE9PSAicGFzaWYiKQogICAgLm1hcChyID0+ICh7CiAgICAgIGNhdGVnb3J5S2V5OiBfX25vcm1hbGl6ZVRlY2hDYXRlZ29yeShyLkthdGVnb3JpKSwKICAgICAga2F0ZWdvcmk6IChyLkthdGVnb3JpfHwiIikudHJpbSgpLAogICAgICBiYXNsaWs6IChyLkJhxZ9sxLFrIHx8IHIuQmFzbGlrIHx8IHIuVGl0bGUgfHwgclsiQmHFn2zEsWsiXSB8fCAiIikudG9TdHJpbmcoKS50cmltKCksCiAgICAgIGljZXJpazogKHIuxLDDp2VyaWsgfHwgci5JY2VyaWsgfHwgci5Db250ZW50IHx8IHJbIsSww6dlcmlrIl0gfHwgIiIpLnRvU3RyaW5nKCksCiAgICAgIGFkaW06IChyLkFkxLFtIHx8IHIuQWRpbSB8fCByLlN0ZXAgfHwgclsiQWTEsW0iXSB8fCAiIikudG9TdHJpbmcoKSwKICAgICAgbm90OiAoci5Ob3QgfHwgIiIpLnRvU3RyaW5nKCksCiAgICAgIGxpbms6IChyLkxpbmsgfHwgIiIpLnRvU3RyaW5nKCksCiAgICAgIGR1cnVtOiAoci5EdXJ1bSB8fCAiIikudG9TdHJpbmcoKQogICAgfSkpCiAgICAuZmlsdGVyKHggPT4geC5jYXRlZ29yeUtleSAmJiB4LmJhc2xpayk7Cn0KCmFzeW5jIGZ1bmN0aW9uIF9fZmV0Y2hUZWNoRG9jQ2F0ZWdvcmllcygpewogIC8vIEsgc8O8dHVudW5kYW4gb2t1bmFuIGthdGVnb3JpIGxpc3Rlc2kgKGJvxZ9zYSBBIHPDvHR1bnVuZGFuIHTDvHJldGlsaXIpCiAgaWYoIVNDUklQVF9VUkwpIHJldHVybiBbXTsKICB0cnl7CiAgICBjb25zdCByID0gYXdhaXQgZmV0Y2goU0NSSVBUX1VSTCwgewogICAgICBtZXRob2Q6J1BPU1QnLAogICAgICBoZWFkZXJzOnsiQ29udGVudC1UeXBlIjoidGV4dC9wbGFpbjtjaGFyc2V0PXV0Zi04In0sCiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgYWN0aW9uOiAnZ2V0VGVjaERvY0NhdGVnb3JpZXMnIH0pCiAgICB9KTsKICAgIGNvbnN0IGQgPSBhd2FpdCByLmpzb24oKTsKICAgIGlmKGQgJiYgZC5yZXN1bHQgPT09ICdzdWNjZXNzJyAmJiBBcnJheS5pc0FycmF5KGQuY2F0ZWdvcmllcykpIHJldHVybiBkLmNhdGVnb3JpZXM7CiAgICByZXR1cm4gW107CiAgfWNhdGNoKGUpewogICAgcmV0dXJuIFtdOwogIH0KfQoKYXN5bmMgZnVuY3Rpb24gZ2V0VGVjaERvY0NhdGVnb3J5T3B0aW9ucyhmb3JjZT1mYWxzZSl7CiAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTsKICBpZighZm9yY2UgJiYgX190ZWNoQ2F0c0NhY2hlICYmIChub3ctX190ZWNoQ2F0c0xvYWRlZEF0KSA8IDMwMDAwMCkgcmV0dXJuIF9fdGVjaENhdHNDYWNoZTsgLy8gNWRrCiAgY29uc3QgY2F0cyA9IGF3YWl0IF9fZmV0Y2hUZWNoRG9jQ2F0ZWdvcmllcygpOwogIF9fdGVjaENhdHNDYWNoZSA9IGNhdHM7CiAgX190ZWNoQ2F0c0xvYWRlZEF0ID0gbm93OwogIHJldHVybiBjYXRzOwp9CgpmdW5jdGlvbiBfX2VzY2FwZUh0bWwocyl7CiAgcmV0dXJuIChzfHwiIikudG9TdHJpbmcoKS5yZXBsYWNlKC9bJjw+IiddL2csIG0gPT4gKHsKICAgICImIjoiJmFtcDsiLCI8IjoiJmx0OyIsIj4iOiImZ3Q7IiwiXCIiOiImcXVvdDsiLCInIjoiJiMzOTsiCiAgfVttXSkpOwp9CgpmdW5jdGlvbiBfX3JlbmRlclRlY2hMaXN0KHRhYktleSwgaXRlbXMpewogIGNvbnN0IGxpc3RFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKAogICAgdGFiS2V5PT09ImJyb2FkY2FzdCIgPyAieC1icm9hZGNhc3QtbGlzdCIgOgogICAgdGFiS2V5PT09ImFjY2VzcyIgPyAieC1hY2Nlc3MtbGlzdCIgOgogICAgdGFiS2V5PT09ImFwcCIgPyAieC1hcHAtbGlzdCIgOgogICAgdGFiS2V5PT09ImFjdGl2YXRpb24iID8gIngtYWN0aXZhdGlvbi1saXN0IiA6CiAgICB0YWJLZXk9PT0iaW5mbyIgPyAieC1pbmZvLWxpc3QiIDoKICAgIHRhYktleT09PSJwYXltZW50IiA/ICJ4LXBheW1lbnQtbGlzdCIgOiAiIgogICk7CiAgaWYoIWxpc3RFbCkgcmV0dXJuOwoKICBpZighaXRlbXMgfHwgaXRlbXMubGVuZ3RoPT09MCl7CiAgICBsaXN0RWwuaW5uZXJIVE1MID0gYDxkaXYgc3R5bGU9InBhZGRpbmc6MTZweDtvcGFjaXR5Oi43NSI+QnUgYmHFn2zEsWsgYWx0xLFuZGEgaGVuw7x6IGnDp2VyaWsgeW9rLiAoU2hlZXQ6IFRla25pa19Eb2t1bWFubGFyKTwvZGl2PmA7CiAgICByZXR1cm47CiAgfQoKICAvLyBBZG1pbiBiYXIgKGTDvHplbmxlbWUgZ2xvYmFsIG1lbsO8ZGVuIGHDp8SxbMSxcikKICBjb25zdCBhZG1pbkJhciA9IChpc0FkbWluTW9kZSAmJiBpc0VkaXRpbmdBY3RpdmUpCiAgICA/IGA8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7Z2FwOjEwcHg7YWxpZ24taXRlbXM6Y2VudGVyO21hcmdpbjowIDAgMTJweDsiPgogICAgICAgICA8YnV0dG9uIGNsYXNzPSJ4LWJ0biB4LWJ0bi1hZG1pbiIgb25jbGljaz0iYWRkVGVjaERvYygnJHt0YWJLZXl9JykiPjxpIGNsYXNzPVwiZmFzIGZhLXBsdXNcIj48L2k+IFllbmkgS29udSBFa2xlPC9idXR0b24+CiAgICAgICA8L2Rpdj5gCiAgICA6IGBgOwoKICBmdW5jdGlvbiByZW5kZXIoZmlsdGVyZWQpewogICAgbGlzdEVsLmlubmVySFRNTCA9IGFkbWluQmFyICsgZmlsdGVyZWQubWFwKChpdCwgaWR4KSA9PiB7CiAgICAgIGNvbnN0IGJvZHkgPSBbCiAgICAgICAgaXQuaWNlcmlrID8gYDxkaXYgY2xhc3M9InEtZG9jLWJvZHkiPiR7aXQuaWNlcmlrfTwvZGl2PmAgOiAiIiwKICAgICAgICBpdC5hZGltID8gYDxkaXYgY2xhc3M9InEtZG9jLW1ldGEiPjxiPkFkxLFtOjwvYj4gJHtfX2VzY2FwZUh0bWwoaXQuYWRpbSl9PC9kaXY+YCA6ICIiLAogICAgICAgIGl0Lm5vdCA/IGA8ZGl2IGNsYXNzPSJxLWRvYy1tZXRhIj48Yj5Ob3Q6PC9iPiAke19fZXNjYXBlSHRtbChpdC5ub3QpfTwvZGl2PmAgOiAiIiwKICAgICAgICBpdC5saW5rID8gYDxkaXYgY2xhc3M9InEtZG9jLW1ldGEiPjxiPkxpbms6PC9iPiA8YSBocmVmPSIke19fZXNjYXBlSHRtbChpdC5saW5rKX0iIHRhcmdldD0iX2JsYW5rIj4ke19fZXNjYXBlSHRtbChpdC5saW5rKX08L2E+PC9kaXY+YCA6ICIiCiAgICAgIF0uam9pbigiIik7CiAgICAgIGNvbnN0IGFkbWluQnRucyA9IChpc0FkbWluTW9kZSAmJiBpc0VkaXRpbmdBY3RpdmUpCiAgICAgICAgPyBgPHNwYW4gc3R5bGU9ImZsb2F0OnJpZ2h0O2Rpc3BsYXk6aW5saW5lLWZsZXg7Z2FwOjhweCIgb25jbGljaz0iZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7ZXZlbnQucHJldmVudERlZmF1bHQoKTsiPgogICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0ieC1idG4geC1idG4tYWRtaW4iIHN0eWxlPSJwYWRkaW5nOjZweCAxMHB4IiBvbmNsaWNrPSJlZGl0VGVjaERvYygnJHt0YWJLZXl9JywnJHtlc2NhcGVGb3JKc1N0cmluZyhpdC5iYXNsaWspfScpIj48aSBjbGFzcz1cImZhcyBmYS1wZW5cIj48L2k+PC9idXR0b24+CiAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJ4LWJ0biB4LWJ0bi1hZG1pbiIgc3R5bGU9InBhZGRpbmc6NnB4IDEwcHgiIG9uY2xpY2s9ImRlbGV0ZVRlY2hEb2MoJyR7dGFiS2V5fScsJyR7ZXNjYXBlRm9ySnNTdHJpbmcoaXQuYmFzbGlrKX0nKSI+PGkgY2xhc3M9XCJmYXMgZmEtdHJhc2hcIj48L2k+PC9idXR0b24+CiAgICAgICAgICAgPC9zcGFuPmAKICAgICAgICA6IGBgOwogICAgICByZXR1cm4gYAogICAgICAgIDxkZXRhaWxzIGNsYXNzPSJxLWFjY29yZGlvbiIgc3R5bGU9Im1hcmdpbi1ib3R0b206MTBweDtiYWNrZ3JvdW5kOiNmZmY7Ym9yZGVyLXJhZGl1czoxMnB4O2JvcmRlcjoxcHggc29saWQgcmdiYSgwLDAsMCwuMDgpO3BhZGRpbmc6MTBweCAxMnB4Ij4KICAgICAgICAgIDxzdW1tYXJ5IHN0eWxlPSJjdXJzb3I6cG9pbnRlcjtmb250LXdlaWdodDo4MDAiPiR7X19lc2NhcGVIdG1sKGl0LmJhc2xpayl9JHthZG1pbkJ0bnN9PC9zdW1tYXJ5PgogICAgICAgICAgPGRpdiBzdHlsZT0icGFkZGluZzoxMHB4IDJweCAycHggMnB4Ij4ke2JvZHl9PC9kaXY+CiAgICAgICAgPC9kZXRhaWxzPgogICAgICBgOwogICAgfSkuam9pbigiIik7CiAgfQoKICByZW5kZXIoaXRlbXMpOwp9Cgphc3luYyBmdW5jdGlvbiBsb2FkVGVjaERvY3NJZk5lZWRlZChmb3JjZT1mYWxzZSl7CiAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTsKICBpZighZm9yY2UgJiYgX190ZWNoRG9jc0NhY2hlICYmIChub3ctX190ZWNoRG9jc0xvYWRlZEF0KTwxMjAwMDApIHJldHVybiBfX3RlY2hEb2NzQ2FjaGU7IC8vIDJkayBjYWNoZQogIHRyeXsKICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBfX2ZldGNoVGVjaERvY3MoKTsKICAgIF9fdGVjaERvY3NDYWNoZSA9IHJvd3M7CiAgICBfX3RlY2hEb2NzTG9hZGVkQXQgPSBub3c7CiAgICByZXR1cm4gcm93czsKICB9Y2F0Y2goZSl7CiAgICBjb25zb2xlLmVycm9yKCJbVEVDSCBET0NTXSIsIGUpOwogICAgcmV0dXJuIFtdOwogIH0KfQoKLy8gVGVrbmlrIGZ1bGxzY3JlZW4gw7xzdCBhcmFtYSBrdXR1bGFyxLEgKGluZGV4Lmh0bWwpIGnDp2luCmFzeW5jIGZ1bmN0aW9uIGZpbHRlclRlY2hEb2NMaXN0KHRhYktleSl7CiAgdHJ5ewogICAgY29uc3QgaW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgeC0ke3RhYktleX0tc2VhcmNoYCk7CiAgICBjb25zdCBxID0gKGlucHV0ID8gaW5wdXQudmFsdWUgOiAnJykudG9Mb3dlckNhc2UoKS50cmltKCk7CiAgICBjb25zdCBhbGwgPSBhd2FpdCBsb2FkVGVjaERvY3NJZk5lZWRlZChmYWxzZSk7CiAgICBjb25zdCBzY29wZWQgPSBhbGwuZmlsdGVyKHggPT4geC5jYXRlZ29yeUtleSA9PT0gdGFiS2V5KTsKICAgIGNvbnN0IGZpbHRlcmVkID0gIXEgPyBzY29wZWQgOiBzY29wZWQuZmlsdGVyKHggPT4KICAgICAgKHguYmFzbGlrfHwnJykudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhxKSB8fAogICAgICAoeC5pY2VyaWt8fCcnKS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHEpIHx8CiAgICAgICh4LmFkaW18fCcnKS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHEpIHx8CiAgICAgICh4Lm5vdHx8JycpLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMocSkKICAgICk7CiAgICBfX3JlbmRlclRlY2hMaXN0KHRhYktleSwgZmlsdGVyZWQpOwogIH1jYXRjaChlKXsKICAgIGNvbnNvbGUuZXJyb3IoZSk7CiAgfQp9CgovLyBUZWtuaWtfRG9rdW1hbmxhciBrYXRlZ29yaSBsaXN0ZXNpIChTaGVldCBLIHPDvHR1bnUpCmxldCBfX3RlY2hDYXRlZ29yeU9wdGlvbnMgPSBudWxsOwphc3luYyBmdW5jdGlvbiBsb2FkVGVjaENhdGVnb3J5T3B0aW9ucygpewogIGlmKF9fdGVjaENhdGVnb3J5T3B0aW9ucykgcmV0dXJuIF9fdGVjaENhdGVnb3J5T3B0aW9uczsKICB0cnl7CiAgICBjb25zdCByID0gYXdhaXQgZmV0Y2goU0NSSVBUX1VSTCwgewogICAgICBtZXRob2Q6J1BPU1QnLAogICAgICBoZWFkZXJzOnsnQ29udGVudC1UeXBlJzondGV4dC9wbGFpbjtjaGFyc2V0PXV0Zi04J30sCiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgYWN0aW9uOidnZXRUZWNoRG9jQ2F0ZWdvcmllcycgfSkKICAgIH0pOwogICAgY29uc3QgZCA9IGF3YWl0IHIuanNvbigpOwogICAgaWYoZCAmJiBkLnJlc3VsdD09PSdzdWNjZXNzJyAmJiBBcnJheS5pc0FycmF5KGQuY2F0ZWdvcmllcykpewogICAgICBfX3RlY2hDYXRlZ29yeU9wdGlvbnMgPSBkLmNhdGVnb3JpZXMuZmlsdGVyKEJvb2xlYW4pOwogICAgICByZXR1cm4gX190ZWNoQ2F0ZWdvcnlPcHRpb25zOwogICAgfQogIH1jYXRjaChlKXsgY29uc29sZS5lcnJvcignW1RFQ0ggQ0FUU10nLCBlKTsgfQogIF9fdGVjaENhdGVnb3J5T3B0aW9ucyA9IFtdOwogIHJldHVybiBfX3RlY2hDYXRlZ29yeU9wdGlvbnM7Cn0KCmZ1bmN0aW9uIHRlY2hUYWJMYWJlbCh0YWJLZXkpewogIGNvbnN0IG0gPSB7IGJyb2FkY2FzdDonWWF5xLFuIFNvcnVubGFyxLEnLCBhY2Nlc3M6J0VyacWfaW0gU29ydW5sYXLEsScsIGFwcDonQXBwIEhhdGFsYXLEsScsIGFjdGl2YXRpb246J0FrdGl2YXN5b24gU29ydW5sYXLEsScsIGluZm86J1PEsWsgU29ydWxhbiBTb3J1bGFyJywgcGF5bWVudDonw5ZkZW1lIFNvcnVubGFyxLEnIH07CiAgcmV0dXJuIG1bdGFiS2V5XSB8fCAnWWF5xLFuIFNvcnVubGFyxLEnOwp9CgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gVEVDSCBET0NTIChTaGVldCkgLSBBZG1pbiBDUlVECi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQphc3luYyBmdW5jdGlvbiBhZGRUZWNoRG9jKHRhYktleSl7CiAgaWYoIWlzQWRtaW5Nb2RlKSByZXR1cm47CiAgY29uc3QgY2F0cyA9IGF3YWl0IGdldFRlY2hEb2NDYXRlZ29yeU9wdGlvbnMoZmFsc2UpOwogIGNvbnN0IGRlZmF1bHRMYWJlbCA9IFRFQ0hfVEFCX0xBQkVMU1t0YWJLZXldIHx8ICcnOwogIGNvbnN0IG9wdHMgPSAoY2F0cyAmJiBjYXRzLmxlbmd0aCA/IGNhdHMgOiBPYmplY3QudmFsdWVzKFRFQ0hfVEFCX0xBQkVMUykpCiAgICAubWFwKGM9PlN0cmluZyhjfHwnJykudHJpbSgpKS5maWx0ZXIoQm9vbGVhbik7CiAgY29uc3QgdW5pcSA9IEFycmF5LmZyb20obmV3IFNldChvcHRzLm1hcCh4PT54LnRvTG93ZXJDYXNlKCkpKSkubWFwKGs9Pm9wdHMuZmluZCh4PT54LnRvTG93ZXJDYXNlKCk9PT1rKSk7CiAgY29uc3Qgb3B0aW9uc0h0bWwgPSB1bmlxLm1hcChjPT5gPG9wdGlvbiB2YWx1ZT0iJHtfX2VzY2FwZUh0bWwoYyl9IiAke2M9PT1kZWZhdWx0TGFiZWw/J3NlbGVjdGVkJzonJ30+JHtfX2VzY2FwZUh0bWwoYyl9PC9vcHRpb24+YCkuam9pbignJyk7CiAgY29uc3QgeyB2YWx1ZTogdiB9ID0gYXdhaXQgU3dhbC5maXJlKHsKICAgIHRpdGxlOiAnVGVrbmlrIEtvbnUgRWtsZScsCiAgICBodG1sOiBgCiAgICAgIDxzZWxlY3QgaWQ9InRkLWNhdCIgY2xhc3M9InN3YWwyLXNlbGVjdCIgc3R5bGU9IndpZHRoOjEwMCU7bWF4LXdpZHRoOjQyMHB4Ij4KICAgICAgICAke29wdGlvbnNIdG1sfQogICAgICA8L3NlbGVjdD4KICAgICAgPGlucHV0IGlkPSJ0ZC10aXRsZSIgY2xhc3M9InN3YWwyLWlucHV0IiBwbGFjZWhvbGRlcj0iQmHFn2zEsWsiPgogICAgICA8dGV4dGFyZWEgaWQ9InRkLWNvbnRlbnQiIGNsYXNzPSJzd2FsMi10ZXh0YXJlYSIgcGxhY2Vob2xkZXI9IsSww6dlcmlrIj48L3RleHRhcmVhPgogICAgICA8aW5wdXQgaWQ9InRkLXN0ZXAiIGNsYXNzPSJzd2FsMi1pbnB1dCIgcGxhY2Vob2xkZXI9IkFkxLFtIChvcHNpeW9uZWwpIj4KICAgICAgPGlucHV0IGlkPSJ0ZC1ub3RlIiBjbGFzcz0ic3dhbDItaW5wdXQiIHBsYWNlaG9sZGVyPSJOb3QgKG9wc2l5b25lbCkiPgogICAgICA8aW5wdXQgaWQ9InRkLWxpbmsiIGNsYXNzPSJzd2FsMi1pbnB1dCIgcGxhY2Vob2xkZXI9IkxpbmsgKG9wc2l5b25lbCkiPgogICAgYCwKICAgIHNob3dDYW5jZWxCdXR0b246dHJ1ZSwKICAgIGNvbmZpcm1CdXR0b25UZXh0OidFa2xlJywKICAgIGNhbmNlbEJ1dHRvblRleHQ6J1Zhemdlw6cnLAogICAgcHJlQ29uZmlybTogKCk9PnsKICAgICAgY29uc3QgY2F0ID0gKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0ZC1jYXQnKT8udmFsdWUgfHwgZGVmYXVsdExhYmVsIHx8ICcnKS50cmltKCk7CiAgICAgIGlmKCFjYXQpIHJldHVybiBTd2FsLnNob3dWYWxpZGF0aW9uTWVzc2FnZSgnS2F0ZWdvcmkgem9ydW5sdScpOwogICAgICBjb25zdCB0aXRsZSA9IChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGQtdGl0bGUnKS52YWx1ZXx8JycpLnRyaW0oKTsKICAgICAgaWYoIXRpdGxlKSByZXR1cm4gU3dhbC5zaG93VmFsaWRhdGlvbk1lc3NhZ2UoJ0JhxZ9sxLFrIHpvcnVubHUnKTsKICAgICAgcmV0dXJuIHsKICAgICAgICBrYXRlZ29yaTogY2F0LAogICAgICAgIGJhc2xpazogdGl0bGUsCiAgICAgICAgaWNlcmlrOiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RkLWNvbnRlbnQnKS52YWx1ZXx8JycpLnRyaW0oKSwKICAgICAgICBhZGltOiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RkLXN0ZXAnKS52YWx1ZXx8JycpLnRyaW0oKSwKICAgICAgICBub3Q6IChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGQtbm90ZScpLnZhbHVlfHwnJykudHJpbSgpLAogICAgICAgIGxpbms6IChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGQtbGluaycpLnZhbHVlfHwnJykudHJpbSgpLAogICAgICAgIGR1cnVtOiAnQWt0aWYnCiAgICAgIH07CiAgICB9CiAgfSk7CiAgaWYoIXYpIHJldHVybjsKCiAgU3dhbC5maXJlKHsgdGl0bGU6J0VrbGVuaXlvci4uLicsIGRpZE9wZW46KCk9PlN3YWwuc2hvd0xvYWRpbmcoKSwgc2hvd0NvbmZpcm1CdXR0b246ZmFsc2UgfSk7CiAgdHJ5ewogICAgY29uc3QgciA9IGF3YWl0IGZldGNoKFNDUklQVF9VUkwsIHsKICAgICAgbWV0aG9kOidQT1NUJywKICAgICAgaGVhZGVyczp7J0NvbnRlbnQtVHlwZSc6J3RleHQvcGxhaW47Y2hhcnNldD11dGYtOCd9LAogICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGFjdGlvbjondXBzZXJ0VGVjaERvYycsIHVzZXJuYW1lOiBjdXJyZW50VXNlciwgdG9rZW46IGdldFRva2VuKCksIGtleUthdGVnb3JpOicnLCBrZXlCYXNsaWs6JycsIC4uLnYgfSkKICAgIH0pOwogICAgY29uc3QgZCA9IGF3YWl0IHIuanNvbigpOwogICAgaWYoZC5yZXN1bHQ9PT0nc3VjY2VzcycpewogICAgICBTd2FsLmZpcmUoeyBpY29uOidzdWNjZXNzJywgdGl0bGU6J0VrbGVuZGknLCB0aW1lcjoxMjAwLCBzaG93Q29uZmlybUJ1dHRvbjpmYWxzZSB9KTsKICAgICAgYXdhaXQgbG9hZFRlY2hEb2NzSWZOZWVkZWQodHJ1ZSk7CiAgICAgIGZpbHRlclRlY2hEb2NMaXN0KHRhYktleSk7CiAgICB9ZWxzZXsKICAgICAgU3dhbC5maXJlKCdIYXRhJywgZC5tZXNzYWdlfHwnRWtsZW5lbWVkaScsICdlcnJvcicpOwogICAgfQogIH1jYXRjaChlKXsKICAgIFN3YWwuZmlyZSgnSGF0YScsJ1N1bnVjdSBoYXRhc8SxLicsICdlcnJvcicpOwogIH0KfQoKYXN5bmMgZnVuY3Rpb24gZWRpdFRlY2hEb2ModGFiS2V5LCBiYXNsaWspewogIGlmKCFpc0FkbWluTW9kZSkgcmV0dXJuOwogIGNvbnN0IGFsbCA9IGF3YWl0IGxvYWRUZWNoRG9jc0lmTmVlZGVkKGZhbHNlKTsKICBjb25zdCBpdCA9IGFsbC5maW5kKHg9PnguY2F0ZWdvcnlLZXk9PT10YWJLZXkgJiYgKHguYmFzbGlrfHwnJyk9PT1iYXNsaWspOwogIGlmKCFpdCkgcmV0dXJuOwogIGNvbnN0IGNhdHMgPSBhd2FpdCBnZXRUZWNoRG9jQ2F0ZWdvcnlPcHRpb25zKGZhbHNlKTsKICBjb25zdCBvcHRzID0gKGNhdHMgJiYgY2F0cy5sZW5ndGggPyBjYXRzIDogT2JqZWN0LnZhbHVlcyhURUNIX1RBQl9MQUJFTFMpKQogICAgLm1hcChjPT5TdHJpbmcoY3x8JycpLnRyaW0oKSkuZmlsdGVyKEJvb2xlYW4pOwogIGNvbnN0IHVuaXEgPSBBcnJheS5mcm9tKG5ldyBTZXQob3B0cy5tYXAoeD0+eC50b0xvd2VyQ2FzZSgpKSkpLm1hcChrPT5vcHRzLmZpbmQoeD0+eC50b0xvd2VyQ2FzZSgpPT09aykpOwogIGNvbnN0IG9wdGlvbnNIdG1sID0gdW5pcS5tYXAoYz0+YDxvcHRpb24gdmFsdWU9IiR7X19lc2NhcGVIdG1sKGMpfSIgJHsoYz09PWl0LmthdGVnb3JpKT8nc2VsZWN0ZWQnOicnfT4ke19fZXNjYXBlSHRtbChjKX08L29wdGlvbj5gKS5qb2luKCcnKTsKICBjb25zdCB7IHZhbHVlOiB2IH0gPSBhd2FpdCBTd2FsLmZpcmUoewogICAgdGl0bGU6ICdUZWtuaWsgS29udXl1IETDvHplbmxlJywKICAgIGh0bWw6IGAKICAgICAgPHNlbGVjdCBpZD0idGQtY2F0IiBjbGFzcz0ic3dhbDItc2VsZWN0IiBzdHlsZT0id2lkdGg6MTAwJTttYXgtd2lkdGg6NDIwcHgiPgogICAgICAgICR7b3B0aW9uc0h0bWx9CiAgICAgIDwvc2VsZWN0PgogICAgICA8aW5wdXQgaWQ9InRkLXRpdGxlIiBjbGFzcz0ic3dhbDItaW5wdXQiIHBsYWNlaG9sZGVyPSJCYcWfbMSxayIgdmFsdWU9IiR7X19lc2NhcGVIdG1sKGl0LmJhc2xpa3x8JycpfSI+CiAgICAgIDx0ZXh0YXJlYSBpZD0idGQtY29udGVudCIgY2xhc3M9InN3YWwyLXRleHRhcmVhIiBwbGFjZWhvbGRlcj0ixLDDp2VyaWsiPiR7X19lc2NhcGVIdG1sKGl0LmljZXJpa3x8JycpfTwvdGV4dGFyZWE+CiAgICAgIDxpbnB1dCBpZD0idGQtc3RlcCIgY2xhc3M9InN3YWwyLWlucHV0IiBwbGFjZWhvbGRlcj0iQWTEsW0iIHZhbHVlPSIke19fZXNjYXBlSHRtbChpdC5hZGltfHwnJyl9Ij4KICAgICAgPGlucHV0IGlkPSJ0ZC1ub3RlIiBjbGFzcz0ic3dhbDItaW5wdXQiIHBsYWNlaG9sZGVyPSJOb3QiIHZhbHVlPSIke19fZXNjYXBlSHRtbChpdC5ub3R8fCcnKX0iPgogICAgICA8aW5wdXQgaWQ9InRkLWxpbmsiIGNsYXNzPSJzd2FsMi1pbnB1dCIgcGxhY2Vob2xkZXI9IkxpbmsiIHZhbHVlPSIke19fZXNjYXBlSHRtbChpdC5saW5rfHwnJyl9Ij4KICAgIGAsCiAgICBzaG93Q2FuY2VsQnV0dG9uOnRydWUsCiAgICBjb25maXJtQnV0dG9uVGV4dDonS2F5ZGV0JywKICAgIGNhbmNlbEJ1dHRvblRleHQ6J1Zhemdlw6cnLAogICAgcHJlQ29uZmlybTogKCk9PnsKICAgICAgY29uc3QgY2F0ID0gKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0ZC1jYXQnKT8udmFsdWUgfHwgaXQua2F0ZWdvcmkgfHwgJycpLnRyaW0oKTsKICAgICAgaWYoIWNhdCkgcmV0dXJuIFN3YWwuc2hvd1ZhbGlkYXRpb25NZXNzYWdlKCdLYXRlZ29yaSB6b3J1bmx1Jyk7CiAgICAgIGNvbnN0IHRpdGxlID0gKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0ZC10aXRsZScpLnZhbHVlfHwnJykudHJpbSgpOwogICAgICBpZighdGl0bGUpIHJldHVybiBTd2FsLnNob3dWYWxpZGF0aW9uTWVzc2FnZSgnQmHFn2zEsWsgem9ydW5sdScpOwogICAgICByZXR1cm4gewogICAgICAgIGthdGVnb3JpOiBjYXQsCiAgICAgICAgYmFzbGlrOiB0aXRsZSwKICAgICAgICBpY2VyaWs6IChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGQtY29udGVudCcpLnZhbHVlfHwnJykudHJpbSgpLAogICAgICAgIGFkaW06IChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGQtc3RlcCcpLnZhbHVlfHwnJykudHJpbSgpLAogICAgICAgIG5vdDogKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0ZC1ub3RlJykudmFsdWV8fCcnKS50cmltKCksCiAgICAgICAgbGluazogKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0ZC1saW5rJykudmFsdWV8fCcnKS50cmltKCksCiAgICAgICAgZHVydW06ICdBa3RpZicKICAgICAgfTsKICAgIH0KICB9KTsKICBpZighdikgcmV0dXJuOwoKICBTd2FsLmZpcmUoeyB0aXRsZTonS2F5ZGVkaWxpeW9yLi4uJywgZGlkT3BlbjooKT0+U3dhbC5zaG93TG9hZGluZygpLCBzaG93Q29uZmlybUJ1dHRvbjpmYWxzZSB9KTsKICB0cnl7CiAgICBjb25zdCByID0gYXdhaXQgZmV0Y2goU0NSSVBUX1VSTCwgewogICAgICBtZXRob2Q6J1BPU1QnLAogICAgICBoZWFkZXJzOnsnQ29udGVudC1UeXBlJzondGV4dC9wbGFpbjtjaGFyc2V0PXV0Zi04J30sCiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgYWN0aW9uOid1cHNlcnRUZWNoRG9jJywgdXNlcm5hbWU6IGN1cnJlbnRVc2VyLCB0b2tlbjogZ2V0VG9rZW4oKSwga2V5S2F0ZWdvcmk6IGl0LmthdGVnb3JpLCBrZXlCYXNsaWs6IGl0LmJhc2xpaywgLi4udiB9KQogICAgfSk7CiAgICBjb25zdCBkID0gYXdhaXQgci5qc29uKCk7CiAgICBpZihkLnJlc3VsdD09PSdzdWNjZXNzJyl7CiAgICAgIFN3YWwuZmlyZSh7IGljb246J3N1Y2Nlc3MnLCB0aXRsZTonS2F5ZGVkaWxkaScsIHRpbWVyOjEyMDAsIHNob3dDb25maXJtQnV0dG9uOmZhbHNlIH0pOwogICAgICBhd2FpdCBsb2FkVGVjaERvY3NJZk5lZWRlZCh0cnVlKTsKICAgICAgZmlsdGVyVGVjaERvY0xpc3QodGFiS2V5KTsKICAgIH1lbHNlewogICAgICBTd2FsLmZpcmUoJ0hhdGEnLCBkLm1lc3NhZ2V8fCdLYXlkZWRpbGVtZWRpJywgJ2Vycm9yJyk7CiAgICB9CiAgfWNhdGNoKGUpewogICAgU3dhbC5maXJlKCdIYXRhJywnU3VudWN1IGhhdGFzxLEuJywgJ2Vycm9yJyk7CiAgfQp9CgpmdW5jdGlvbiBkZWxldGVUZWNoRG9jKHRhYktleSwgYmFzbGlrKXsKICBpZighaXNBZG1pbk1vZGUpIHJldHVybjsKICBTd2FsLmZpcmUoewogICAgdGl0bGU6J1NpbGluc2luIG1pPycsCiAgICB0ZXh0OidLb251IHBhc2lmZSBhbMSxbmFjYWsuJywKICAgIGljb246J3dhcm5pbmcnLAogICAgc2hvd0NhbmNlbEJ1dHRvbjp0cnVlLAogICAgY29uZmlybUJ1dHRvblRleHQ6J1NpbCcsCiAgICBjYW5jZWxCdXR0b25UZXh0OidWYXpnZcOnJwogIH0pLnRoZW4oYXN5bmMgcmVzPT57CiAgICBpZighcmVzLmlzQ29uZmlybWVkKSByZXR1cm47CiAgICB0cnl7CiAgICAgIGNvbnN0IGFsbCA9IGF3YWl0IGxvYWRUZWNoRG9jc0lmTmVlZGVkKGZhbHNlKTsKICAgICAgY29uc3QgaXQgPSBhbGwuZmluZCh4PT54LmNhdGVnb3J5S2V5PT09dGFiS2V5ICYmICh4LmJhc2xpa3x8JycpPT09YmFzbGlrKTsKICAgICAgY29uc3Qga2V5S2F0ZWdvcmkgPSBpdCA/IGl0LmthdGVnb3JpIDogdGFiS2V5OwogICAgICBjb25zdCByID0gYXdhaXQgZmV0Y2goU0NSSVBUX1VSTCwgewogICAgICAgIG1ldGhvZDonUE9TVCcsCiAgICAgICAgaGVhZGVyczp7J0NvbnRlbnQtVHlwZSc6J3RleHQvcGxhaW47Y2hhcnNldD11dGYtOCd9LAogICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgYWN0aW9uOidkZWxldGVUZWNoRG9jJywgdXNlcm5hbWU6IGN1cnJlbnRVc2VyLCB0b2tlbjogZ2V0VG9rZW4oKSwga2V5S2F0ZWdvcmk6IGtleUthdGVnb3JpLCBrZXlCYXNsaWs6IGJhc2xpayB9KQogICAgICB9KTsKICAgICAgY29uc3QgZCA9IGF3YWl0IHIuanNvbigpOwogICAgICBpZihkLnJlc3VsdD09PSdzdWNjZXNzJyl7CiAgICAgICAgYXdhaXQgbG9hZFRlY2hEb2NzSWZOZWVkZWQodHJ1ZSk7CiAgICAgICAgZmlsdGVyVGVjaERvY0xpc3QodGFiS2V5KTsKICAgICAgICBTd2FsLmZpcmUoeyBpY29uOidzdWNjZXNzJywgdGl0bGU6J1NpbGluZGknLCB0aW1lcjoxMDAwLCBzaG93Q29uZmlybUJ1dHRvbjpmYWxzZSB9KTsKICAgICAgfWVsc2V7CiAgICAgICAgU3dhbC5maXJlKCdIYXRhJywgZC5tZXNzYWdlfHwnU2lsaW5lbWVkaScsICdlcnJvcicpOwogICAgICB9CiAgICB9Y2F0Y2goZSl7CiAgICAgIFN3YWwuZmlyZSgnSGF0YScsJ1N1bnVjdSBoYXRhc8SxLicsICdlcnJvcicpOwogICAgfQogIH0pOwp9CgovLyBvdmVycmlkZSAvIGV4dGVuZCBleGlzdGluZyBzd2l0Y2hUZWNoVGFiCndpbmRvdy5zd2l0Y2hUZWNoVGFiID0gYXN5bmMgZnVuY3Rpb24odGFiKXsKICB0cnl7CiAgICAvLyBleGlzdGluZyB2aXN1YWwgdGFiIHN3aXRjaAogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnI3RlY2gtZnVsbHNjcmVlbiAucS1uYXYtaXRlbScpLmZvckVhY2gobGkgPT4gbGkuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJykpOwogICAgY29uc3QgdGFiTWFwID0ge3dpemFyZDoneC12aWV3LXdpemFyZCcsYWNjZXNzOid4LXZpZXctYWNjZXNzJyxhcHA6J3gtdmlldy1hcHAnLGFjdGl2YXRpb246J3gtdmlldy1hY3RpdmF0aW9uJyxwYXltZW50Oid4LXZpZXctcGF5bWVudCcsY2FyZHM6J3gtdmlldy1jYXJkcycsaW5mbzoneC12aWV3LWluZm8nfTsKICAgIGNvbnN0IHZpZXdJZCA9IHRhYk1hcFt0YWJdIHx8IHRhYk1hcFsnd2l6YXJkJ107CiAgICAvLyBhY3RpdmF0ZSBjbGlja2VkIGl0ZW0KICAgIGNvbnN0IGJ5RGF0YSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCN0ZWNoLWZ1bGxzY3JlZW4gLnEtbmF2LWl0ZW1bZGF0YS10ZWNoLXRhYj0iJHt0YWJ9Il1gKTsKICAgIGlmKGJ5RGF0YSkgYnlEYXRhLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwpkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcjdGVjaC1mdWxsc2NyZWVuIC5xLXZpZXctc2VjdGlvbicpLmZvckVhY2godiA9PiB2LmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpKTsKICAgIGNvbnN0IHZpZXdFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHZpZXdJZCk7CiAgICBpZih2aWV3RWwpIHZpZXdFbC5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKCiAgICBpZihbJ2FjY2VzcycsJ2FwcCcsJ2FjdGl2YXRpb24nLCdwYXltZW50JywnaW5mbyddLmluY2x1ZGVzKHRhYikpewogICAgICBjb25zdCBhbGwgPSBhd2FpdCBsb2FkVGVjaERvY3NJZk5lZWRlZChmYWxzZSk7CiAgICAgIGNvbnN0IGZpbHRlcmVkID0gYWxsLmZpbHRlcih4ID0+IHguY2F0ZWdvcnlLZXkgPT09IHRhYik7CiAgICAgIF9fcmVuZGVyVGVjaExpc3QodGFiLCBmaWx0ZXJlZCk7CiAgICB9CgogICAgaWYodGFiID09PSAnd2l6YXJkJyl7CiAgICAgIC8vIFRla25payBzaWhpcmJhesSxIGZ1bGxzY3JlZW4gacOnaW5lIGfDtm0KICAgICAgdHJ5eyByZW5kZXJUZWNoV2l6YXJkSW50bygneC13aXphcmQnKTsgfWNhdGNoKGUpeyBjb25zb2xlLmVycm9yKGUpOyB9CiAgICB9CgogICAgaWYodGFiID09PSAnY2FyZHMnKXsKICAgICAgdHJ5eyBmaWx0ZXJUZWNoQ2FyZHMoKTsgfWNhdGNoKGUpeyBjb25zb2xlLmVycm9yKGUpOyB9CiAgICB9CiAgfWNhdGNoKGUpewogICAgY29uc29sZS5lcnJvcihlKTsKICB9Cn07CgovLyBleHBvc2UgZm9yIG9uY2xpY2sKdHJ5eyB3aW5kb3cub3Blbk1lbnVQZXJtaXNzaW9ucyA9IG9wZW5NZW51UGVybWlzc2lvbnM7IH1jYXRjaChlKXt9';const _0x5093=(s)=>{try{if(typeof atob==='function')return atob(s)}catch(e){};try{if(typeof Buffer!=='undefined')return Buffer.from(s,'base64').toString('utf8')}catch(e){};throw new Error('No base64 decoder')};(0,eval)(_0x5093(_0x4ea033));})();
